(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{250:function(e,t,r){"use strict";r.r(t),r.d(t,"UNITS",(function(){return x})),r.d(t,"h3IndexToSplitLong",(function(){return T})),r.d(t,"splitLongToh3Index",(function(){return M})),r.d(t,"h3IsValid",(function(){return V})),r.d(t,"h3IsPentagon",(function(){return j})),r.d(t,"h3IsResClassIII",(function(){return G})),r.d(t,"h3GetBaseCell",(function(){return N})),r.d(t,"h3GetFaces",(function(){return Z})),r.d(t,"h3GetResolution",(function(){return $})),r.d(t,"geoToH3",(function(){return Q})),r.d(t,"h3ToGeo",(function(){return H})),r.d(t,"h3ToGeoBoundary",(function(){return W})),r.d(t,"h3ToParent",(function(){return X})),r.d(t,"h3ToChildren",(function(){return Y})),r.d(t,"h3ToCenterChild",(function(){return K})),r.d(t,"kRing",(function(){return J})),r.d(t,"kRingDistances",(function(){return ee})),r.d(t,"hexRing",(function(){return te})),r.d(t,"polyfill",(function(){return ie})),r.d(t,"h3SetToMultiPolygon",(function(){return re})),r.d(t,"compact",(function(){return ne})),r.d(t,"uncompact",(function(){return oe})),r.d(t,"h3IndexesAreNeighbors",(function(){return ae})),r.d(t,"getH3UnidirectionalEdge",(function(){return se})),r.d(t,"getOriginH3IndexFromUnidirectionalEdge",(function(){return le})),r.d(t,"getDestinationH3IndexFromUnidirectionalEdge",(function(){return Ae})),r.d(t,"h3UnidirectionalEdgeIsValid",(function(){return ce})),r.d(t,"getH3IndexesFromUnidirectionalEdge",(function(){return ue})),r.d(t,"getH3UnidirectionalEdgesFromHexagon",(function(){return he})),r.d(t,"getH3UnidirectionalEdgeBoundary",(function(){return pe})),r.d(t,"h3Distance",(function(){return de})),r.d(t,"h3Line",(function(){return fe})),r.d(t,"experimentalH3ToLocalIj",(function(){return me})),r.d(t,"experimentalLocalIjToH3",(function(){return _e})),r.d(t,"pointDist",(function(){return ge})),r.d(t,"cellArea",(function(){return ye})),r.d(t,"exactEdgeLength",(function(){return xe})),r.d(t,"hexArea",(function(){return ve})),r.d(t,"edgeLength",(function(){return be})),r.d(t,"numHexagons",(function(){return we})),r.d(t,"getRes0Indexes",(function(){return Te})),r.d(t,"getPentagonIndexes",(function(){return Ee})),r.d(t,"degsToRads",(function(){return Me})),r.d(t,"radsToDegs",(function(){return Ce}));var n=function(e){var t,r=void 0!==(e=e||{})?e:{},n={};for(t in r)r.hasOwnProperty(t)&&(n[t]=r[t]);var o,l=[],A="";document.currentScript&&(A=document.currentScript.src),A=0!==A.indexOf("blob:")?A.substr(0,A.lastIndexOf("/")+1):"",o=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||0==n.status&&n.response)t(n.response);else{var data=re(e);data?t(data.buffer):r()}},n.onerror=r,n.send(null)};var c=r.print||console.log.bind(console),h=r.printErr||console.warn.bind(console);for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);n=null,r.arguments&&(l=r.arguments);var d=0,f=function(){return d};var m=!1;function _(e){var text,t=r["_"+e];return text="Cannot call unknown function "+e+", make sure it is exported",t||fe("Assertion failed: "+text),t}function y(e,t,r,n,o){var l={string:function(e){var t=0;if(null!=e&&0!==e){var r=1+(e.length<<2);(function(e,t,r){(function(e,t,r,n){if(!(n>0))return 0;for(var o=r,l=r+n-1,i=0;i<e.length;++i){var u=e.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((1023&u)<<10)|1023&e.charCodeAt(++i);if(u<=127){if(r>=l)break;t[r++]=u}else if(u<=2047){if(r+1>=l)break;t[r++]=192|u>>6,t[r++]=128|63&u}else if(u<=65535){if(r+2>=l)break;t[r++]=224|u>>12,t[r++]=128|u>>6&63,t[r++]=128|63&u}else{if(r+3>=l)break;t[r++]=240|u>>18,t[r++]=128|u>>12&63,t[r++]=128|u>>6&63,t[r++]=128|63&u}}t[r]=0})(e,E,t,r)})(e,t=se(r),r)}return t},array:function(e){var t=se(e.length);return function(e,t){T.set(e,t)}(e,t),t}};var A=_(e),c=[],h=0;if(n)for(var i=0;i<n.length;i++){var d=l[r[i]];d?(0===h&&(h=Ae()),c[i]=d(n[i])):c[i]=n[i]}var f=A.apply(null,c);return f=function(e){return"string"===t?v(e):"boolean"===t?Boolean(e):e}(f),0!==h&&le(h),f}var x="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function v(e,t){return e?function(e,t,r){for(var n=t+r,o=t;e[o]&&!(o>=n);)++o;if(o-t>16&&e.subarray&&x)return x.decode(e.subarray(t,o));for(var l="";t<o;){var A=e[t++];if(128&A){var c=63&e[t++];if(192!=(224&A)){var h=63&e[t++];if((A=224==(240&A)?(15&A)<<12|c<<6|h:(7&A)<<18|c<<12|h<<6|63&e[t++])<65536)l+=String.fromCharCode(A);else{var d=A-65536;l+=String.fromCharCode(55296|d>>10,56320|1023&d)}}else l+=String.fromCharCode((31&A)<<6|c)}else l+=String.fromCharCode(A)}return l}(E,e,t):""}var w,T,E,M,C,I,S;"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");function k(e,t){return e%t>0&&(e+=t-e%t),e}function z(e){w=e,r.HEAP8=T=new Int8Array(e),r.HEAP16=M=new Int16Array(e),r.HEAP32=C=new Int32Array(e),r.HEAPU8=E=new Uint8Array(e),r.HEAPU16=new Uint16Array(e),r.HEAPU32=new Uint32Array(e),r.HEAPF32=I=new Float32Array(e),r.HEAPF64=S=new Float64Array(e)}var D=r.TOTAL_MEMORY||33554432;function B(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?r.dynCall_v(n):r.dynCall_vi(n,t.arg):n(void 0===t.arg?null:t.arg)}else t()}}D=(w=r.buffer?r.buffer:new ArrayBuffer(D)).byteLength,z(w),C[6004]=5266928;var P=[],L=[],R=[],F=[];var O=Math.abs,U=Math.ceil,V=Math.floor,j=Math.min,G=0,N=null,Z=null;r.preloadedImages={},r.preloadedAudios={};var $,Q,H=null,W="data:application/octet-stream;base64,";function X(e){return String.prototype.startsWith?e.startsWith(W):0===e.indexOf(W)}H="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAEAAAD/////BwAAAP////8xAAAA/////1cBAAD/////YQkAAP////+nQQAA/////5HLAQD/////95AMAP/////B9lcAAAAAAAAAAAAAAAAAAgAAAP////8OAAAA/////2IAAAD/////rgIAAP/////CEgAA/////06DAAD/////IpcDAP/////uIRkA/////4LtrwAAAAAAAAAAAAAAAAAAAAAAAgAAAP//////////AQAAAAMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////wIAAAD//////////wEAAAAAAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA/////////////////////wEAAAD///////////////8CAAAA////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD///////////////////////////////8CAAAA////////////////AQAAAP////////////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAAAQAAAP//////////AgAAAP//////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAAEAAAD//////////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAgAAAAAAAAACAAAAAQAAAAEAAAACAAAAAgAAAAAAAAAFAAAABQAAAAAAAAACAAAAAgAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAABAAAAAgAAAAIAAAACAAAAAAAAAAUAAAAGAAAAAAAAAAIAAAACAAAAAwAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAADAAAAAgAAAAIAAAAAAAAABQAAAAcAAAAAAAAAAgAAAAIAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAACAAAAAQAAAAQAAAACAAAAAgAAAAAAAAAFAAAACAAAAAAAAAACAAAAAgAAAAMAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAACAAAAAAAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAUAAAAJAAAAAAAAAAIAAAACAAAAAwAAAAUAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAIAAAACAAAAAAAAAAMAAAAOAAAAAgAAAAAAAAACAAAAAwAAAAAAAAAAAAAAAgAAAAIAAAADAAAABgAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAgAAAAIAAAAAAAAAAwAAAAoAAAACAAAAAAAAAAIAAAADAAAAAQAAAAAAAAACAAAAAgAAAAMAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAgAAAAAAAAADAAAACwAAAAIAAAAAAAAAAgAAAAMAAAACAAAAAAAAAAIAAAACAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAACAAAAAAAAAAMAAAAMAAAAAgAAAAAAAAACAAAAAwAAAAMAAAAAAAAAAgAAAAIAAAADAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAIAAAAAAAAAAwAAAA0AAAACAAAAAAAAAAIAAAADAAAABAAAAAAAAAACAAAAAgAAAAMAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAgAAAAAAAAADAAAABgAAAAIAAAAAAAAAAgAAAAMAAAAPAAAAAAAAAAIAAAACAAAAAwAAAAsAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAIAAAACAAAAAAAAAAMAAAAHAAAAAgAAAAAAAAACAAAAAwAAABAAAAAAAAAAAgAAAAIAAAADAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAIAAAAAAAAAAwAAAAgAAAACAAAAAAAAAAIAAAADAAAAEQAAAAAAAAACAAAAAgAAAAMAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAACAAAAAgAAAAAAAAADAAAACQAAAAIAAAAAAAAAAgAAAAMAAAASAAAAAAAAAAIAAAACAAAAAwAAAA4AAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAACAAAAAAAAAAMAAAAFAAAAAgAAAAAAAAACAAAAAwAAABMAAAAAAAAAAgAAAAIAAAADAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAgAAAAAAAAACAAAAAQAAABMAAAACAAAAAgAAAAAAAAAFAAAACgAAAAAAAAACAAAAAgAAAAMAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABEAAAACAAAAAAAAAAIAAAABAAAADwAAAAIAAAACAAAAAAAAAAUAAAALAAAAAAAAAAIAAAACAAAAAwAAABEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAIAAAAAAAAAAgAAAAEAAAAQAAAAAgAAAAIAAAAAAAAABQAAAAwAAAAAAAAAAgAAAAIAAAADAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAACAAAAAQAAABEAAAACAAAAAgAAAAAAAAAFAAAADQAAAAAAAAACAAAAAgAAAAMAAAATAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAACAAAAAAAAAAIAAAABAAAAEgAAAAIAAAACAAAAAAAAAAUAAAAOAAAAAAAAAAIAAAACAAAAAwAAAAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAEAAAEBAAAAAAABAAAAAQAAAAEAAQAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAHAAAABwAAAAEAAAACAAAABAAAAAMAAAAAAAAAAAAAAAcAAAADAAAAAQAAAAIAAAAFAAAABAAAAAAAAAAAAAAAYWxnb3MuYwBfcG9seWZpbGxJbnRlcm5hbABhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0dlb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9HZW9Cb3VuZGFyeQBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGgzVG9Mb2NhbElqawBiYXNlQ2VsbCAhPSBvcmlnaW5CYXNlQ2VsbAAhKG9yaWdpbk9uUGVudCAmJiBpbmRleE9uUGVudCkAcGVudGFnb25Sb3RhdGlvbnMgPj0gMABkaXJlY3Rpb25Sb3RhdGlvbnMgPj0gMABiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvSDMAIV9pc0Jhc2VDZWxsUGVudGFnb24oYmFzZUNlbGwpAGJhc2VDZWxsUm90YXRpb25zID49IDAAd2l0aGluUGVudGFnb25Sb3RhdGlvbnMgPj0gMABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";function Y(e){return e}function K(text){return text.replace(/\b__Z[\w\d_]+/g,(function(e){return e===e?e:e+" ["+e+"]"}))}function J(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function ee(){return T.length}function te(e){try{var t=new ArrayBuffer(e);if(t.byteLength!=e)return;return new Int8Array(t).set(T),ae(t),z(t),1}catch(e){}}var ie="function"==typeof atob?atob:function(input){var e,t,r,n,o,l,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",output="",i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{e=A.indexOf(input.charAt(i++))<<2|(n=A.indexOf(input.charAt(i++)))>>4,t=(15&n)<<4|(o=A.indexOf(input.charAt(i++)))>>2,r=(3&o)<<6|(l=A.indexOf(input.charAt(i++))),output+=String.fromCharCode(e),64!==o&&(output+=String.fromCharCode(t)),64!==l&&(output+=String.fromCharCode(r))}while(i<input.length);return output};function re(e){if(X(e))return function(s){try{for(var e=ie(s),t=new Uint8Array(e.length),i=0;i<e.length;++i)t[i]=e.charCodeAt(i);return t}catch(e){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(W.length))}var path,ne,oe=function(e,t,r){var a=new e.Int8Array(r),b=new e.Int32Array(r),n=(new e.Uint8Array(r),new e.Float32Array(r),new e.Float64Array(r)),g=0|t.p,p=e.Math.floor,q=e.Math.abs,o=e.Math.sqrt,s=e.Math.pow,l=e.Math.cos,u=e.Math.sin,A=e.Math.tan,c=e.Math.acos,h=e.Math.asin,d=e.Math.atan,f=e.Math.atan2,m=e.Math.ceil,_=e.Math.imul,y=e.Math.min,x=e.Math.clz32,v=t.b,w=t.c,T=t.d,E=t.e,M=t.f,C=t.g,I=t.h,S=t.i,k=24048;function z(a,b,e,t){var r,n;0|D(a|=0,b|=0,e|=0,t|=0,0)&&(zt(0|t,0,(n=1+(0|_(3*e|0,e+1|0))|0)<<3|0),(r=0|bt(n,4))&&(B(a,b,e,t,r,n,0),vt(r)))}function D(a,e,t,r,n){a|=0,e|=0,t|=0,n|=0;var o,g=0,l=0,i=0,A=0,c=0,h=0,d=0,f=0;if(o=k,k=k+16|0,f=o,b[(g=r|=0)>>2]=a,b[g+4>>2]=e,(g=0!=(0|n))&&(b[n>>2]=0),0|Le(a,e))return k=o,0|(f=1);b[f>>2]=0;e:do{if((0|t)>=1)if(g)for(c=0,h=1,d=1,l=0,g=a;;){if(!(l|c)){if(0==(0|(g=0|P(g,e,4,f)))&0==(0|(e=0|w()))){g=2;break e}if(0|Le(g,e)){g=1;break e}}if(0==(0|(g=0|P(g,e,0|b[16+(c<<2)>>2],f)))&0==(0|(e=0|w()))){g=2;break e}if(b[(a=r+(d<<3)|0)>>2]=g,b[a+4>>2]=e,b[n+(d<<2)>>2]=h,a=(0|(l=l+1|0))==(0|h),A=6==(0|(i=c+1|0)),0|Le(g,e)){g=1;break e}if((0|(h=h+(A&a&1)|0))>(0|t)){g=0;break}c=a?A?0:i:c,d=d+1|0,l=a?0:l}else for(c=0,h=1,d=1,l=0,g=a;;){if(!(l|c)){if(0==(0|(g=0|P(g,e,4,f)))&0==(0|(e=0|w()))){g=2;break e}if(0|Le(g,e)){g=1;break e}}if(0==(0|(g=0|P(g,e,0|b[16+(c<<2)>>2],f)))&0==(0|(e=0|w()))){g=2;break e}if(b[(a=r+(d<<3)|0)>>2]=g,b[a+4>>2]=e,a=(0|(l=l+1|0))==(0|h),A=6==(0|(i=c+1|0)),0|Le(g,e)){g=1;break e}if((0|(h=h+(A&a&1)|0))>(0|t)){g=0;break}c=a?A?0:i:c,d=d+1|0,l=a?0:l}else g=0}while(0);return k=o,0|(f=g)}function B(a,e,t,r,n,g,o){t|=0,r|=0,n|=0,g|=0,o|=0;var l,A,i=0,c=0,h=0,d=0,f=0;if(A=k,k=k+16|0,l=A,0==(0|(a|=0))&0==(0|(e|=0)))k=A;else{if(i=0|Mt(0|a,0|e,0|g,((0|g)<0)<<31>>31|0),w(),!(0==(0|(f=0|b[(d=c=r+(i<<3)|0)>>2]))&0==(0|(d=0|b[d+4>>2]))|(h=(0|f)==(0|a)&(0|d)==(0|e))))do{h=(0|(d=0|b[(f=c=r+((i=(i+1|0)%(0|g)|0)<<3)|0)>>2]))==(0|a)&(0|(f=0|b[f+4>>2]))==(0|e)}while(!(0==(0|d)&0==(0|f)|h));i=n+(i<<2)|0,h&&(0|b[i>>2])<=(0|o)||(b[(f=c)>>2]=a,b[f+4>>2]=e,b[i>>2]=o,(0|o)>=(0|t)||(f=o+1|0,b[l>>2]=0,B(d=0|P(a,e,2,l),0|w(),t,r,n,g,f),b[l>>2]=0,B(d=0|P(a,e,3,l),0|w(),t,r,n,g,f),b[l>>2]=0,B(d=0|P(a,e,1,l),0|w(),t,r,n,g,f),b[l>>2]=0,B(d=0|P(a,e,5,l),0|w(),t,r,n,g,f),b[l>>2]=0,B(d=0|P(a,e,4,l),0|w(),t,r,n,g,f),b[l>>2]=0,B(d=0|P(a,e,6,l),0|w(),t,r,n,g,f))),k=A}}function P(a,e,t,r){a|=0,e|=0,t|=0;var i,n,o=0,g=0,l=0,A=0,c=0,h=0,d=0;if((0|b[(r|=0)>>2])>0){o=0;do{t=0|Ae(t),o=o+1|0}while((0|o)<(0|b[r>>2]))}i=0|Ct(0|a,0|e,45),w(),n=127&i,g=0|Re(a,e),o=0|Ct(0|a,0|e,52),w(),o&=15;e:do{if(o)for(;;){if(h=0|Ct(0|a,0|e,0|(c=3*(15-o|0)|0)),w(),h&=7,d=0==(0|je(o)),o=o+-1|0,A=0|dd(7,0,0|c),e&=~(0|w()),a=(c=0|dd(0|b[(d?464:48)+(28*h|0)+(t<<2)>>2],0,0|c))|a&~A,e|=0|w(),!(t=0|b[(d?672:256)+(28*h|0)+(t<<2)>>2])){t=0;break e}if(!o){l=6;break}}else l=6}while(0);6==(0|l)&&(a|=h=0|dd(0|(d=0|b[880+(28*n|0)+(t<<2)>>2]),0,45),e=0|w()|-1040385&e,t=0|b[4304+(28*n|0)+(t<<2)>>2],127==(127&d|0)&&(d=0|dd(0|b[880+(28*n|0)+20>>2],0,45),e=0|w()|-1040385&e,t=0|b[4304+(28*n|0)+20>>2],a=0|Oe(d|a,e),e=0|w(),b[r>>2]=1+(0|b[r>>2]))),l=0|Ct(0|a,0|e,45),w(),l&=127;e:do{if(0|R(l)){t:do{if(1==(0|Re(a,e))){if((0|n)!=(0|l)){if(0|V(l,0|b[7728+(28*n|0)>>2])){a=0|Ve(a,e),g=1,e=0|w();break}a=0|Oe(a,e),g=1,e=0|w();break}switch(0|g){case 5:a=0|Ve(a,e),e=0|w(),b[r>>2]=5+(0|b[r>>2]),g=0;break t;case 3:a=0|Oe(a,e),e=0|w(),b[r>>2]=1+(0|b[r>>2]),g=0;break t;default:return d=0,v(0|(h=0)),0|d}}else g=0}while(0);if((0|t)>0){o=0;do{a=0|Fe(a,e),e=0|w(),o=o+1|0}while((0|o)!=(0|t))}if((0|n)!=(0|l)){if(!(0|F(l))){if(0!=(0|g)|5!=(0|Re(a,e)))break;b[r>>2]=1+(0|b[r>>2]);break}switch(127&i){case 8:case 118:break e}3!=(0|Re(a,e))&&(b[r>>2]=1+(0|b[r>>2]))}}else if((0|t)>0){o=0;do{a=0|Oe(a,e),e=0|w(),o=o+1|0}while((0|o)!=(0|t))}}while(0);return b[r>>2]=((0|b[r>>2])+t|0)%6|0,d=a,v(0|(h=e)),0|d}function L(a,e,t,r,g,o){e|=0,t|=0,r|=0,g|=0,o|=0;var l,u,A,c,h,d,f,m,_,i=0,y=0,x=0,v=0,T=0,E=0,M=0,p=0,q=0,C=0,s=0,I=0,S=0,z=0;if(_=k,k=k+48|0,d=_+32|0,f=_+16|0,m=_,(0|(i=0|b[(a|=0)>>2]))<=0)return k=_,0|(I=0);l=a+4|0,u=d+8|0,A=f+8|0,c=m+8|0,h=((0|e)<0)<<31>>31,s=0;e:for(;;){q=(y=0|b[l>>2])+(s<<4)|0,b[d>>2]=b[q>>2],b[d+4>>2]=b[q+4>>2],b[d+8>>2]=b[q+8>>2],b[d+12>>2]=b[q+12>>2],(0|s)==(i+-1|0)?(b[f>>2]=b[y>>2],b[f+4>>2]=b[y+4>>2],b[f+8>>2]=b[y+8>>2],b[f+12>>2]=b[y+12>>2]):(q=y+(s+1<<4)|0,b[f>>2]=b[q>>2],b[f+4>>2]=b[q+4>>2],b[f+8>>2]=b[q+8>>2],b[f+12>>2]=b[q+12>>2]),q=0|Q(d,f,t);t:do{if((0|q)>0){C=+(0|q),p=0;i:for(;;){z=+(q-p|0),S=+(0|p),n[m>>3]=+n[d>>3]*z/C+ +n[f>>3]*S/C,n[c>>3]=+n[u>>3]*z/C+ +n[A>>3]*S/C,y=0|Mt(0|(E=0|Ge(m,t)),0|(M=0|w()),0|e,0|h),w(),v=0|b[(x=i=o+(y<<3)|0)>>2],x=0|b[x+4>>2];r:do{if(0==(0|v)&0==(0|x))I=14;else for(T=0;;){if((0|T)>(0|e)){i=1;break r}if((0|v)==(0|E)&(0|x)==(0|M)){i=7;break r}if(0==(0|(v=0|b[(x=i=o+((y=(y+1|0)%(0|e)|0)<<3)|0)>>2]))&0==(0|(x=0|b[x+4>>2]))){I=14;break}T=T+1|0}}while(0);switch(14==(0|I)&&(I=0,0==(0|E)&0==(0|M)?i=7:(b[i>>2]=E,b[i+4>>2]=M,i=0|b[r>>2],b[(T=g+(i<<3)|0)>>2]=E,b[T+4>>2]=M,b[r>>2]=i+1,i=0)),7&i){case 7:case 0:break;default:break i}if((0|q)<=(0|(p=p+1|0))){I=8;break t}}if(0|i){i=-1,I=20;break e}}else I=8}while(0);if(8==(0|I)&&(I=0),(0|(s=s+1|0))>=(0|(i=0|b[a>>2]))){i=0,I=20;break}}return 20==(0|I)?(k=_,0|i):0}function R(a){return 0|b[7728+(28*(a|=0)|0)+16>>2]}function F(a){return 4==(0|(a|=0))|117==(0|a)|0}function O(a){return 0|b[11152+(216*(0|b[(a|=0)>>2])|0)+(72*(0|b[a+4>>2])|0)+(24*(0|b[a+8>>2])|0)+(b[a+12>>2]<<3)>>2]}function U(a){return 0|b[11152+(216*(0|b[(a|=0)>>2])|0)+(72*(0|b[a+4>>2])|0)+(24*(0|b[a+8>>2])|0)+(b[a+12>>2]<<3)+4>>2]}function V(a,e){return e|=0,(0|b[7728+(28*(a|=0)|0)+20>>2])==(0|e)?0|(e=1):0|(e=(0|b[7728+(28*a|0)+24>>2])==(0|e))}function j(a,e){return 0|b[880+(28*(a|=0)|0)+((e|=0)<<2)>>2]}function G(a,e){return e|=0,(0|b[880+(28*(a|=0)|0)>>2])==(0|e)?0|(e=0):(0|b[880+(28*a|0)+4>>2])==(0|e)?0|(e=1):(0|b[880+(28*a|0)+8>>2])==(0|e)?0|(e=2):(0|b[880+(28*a|0)+12>>2])==(0|e)?0|(e=3):(0|b[880+(28*a|0)+16>>2])==(0|e)?0|(e=4):(0|b[880+(28*a|0)+20>>2])==(0|e)?0|(e=5):0|((0|b[880+(28*a|0)+24>>2])==(0|e)?6:7)}function N(a){return+n[(a|=0)+16>>3]<+n[a+24>>3]|0}function Z(a,b){a|=0;var e,t,r=0;return(r=+n[(b|=0)>>3])>=+n[a+8>>3]&&r<=+n[a>>3]?(e=+n[a+16>>3],r=+n[a+24>>3],b=(t=+n[b+8>>3])>=r,a=t<=e&1,e<r?b&&(a=1):b||(a=0),0|(b=0!=(0|a))):0|(b=0)}function $(a,e){a|=0,e|=0;var t,r,g,i,o,l,A=0,c=0;i=k,k=k+288|0,t=i+264|0,r=i+96|0,c=(A=g=i)+96|0;do{b[A>>2]=0,A=A+4|0}while((0|A)<(0|c));return Qe(e,g),qe(c=0|b[(A=g)>>2],A=0|b[A+4>>2],t),$e(c,A,r),o=+Se(t,r+8|0),n[t>>3]=+n[a>>3],n[(A=t+8|0)>>3]=+n[a+16>>3],n[r>>3]=+n[a+8>>3],n[(c=r+8|0)>>3]=+n[a+24>>3],l=+Se(t,r),c=~~+m(+l*l/+It(+ +q(+(+n[A>>3]-+n[c>>3])/(+n[t>>3]-+n[r>>3])),3)/(o*(2.59807621135*o)*.8)),k=i,0|(0==(0|c)?1:c)}function Q(a,e,t){a|=0,e|=0,t|=0;var r,n,g,i,o,l=0,A=0;i=k,k=k+288|0,r=i+264|0,n=i+96|0,A=(l=g=i)+96|0;do{b[l>>2]=0,l=l+4|0}while((0|l)<(0|A));return Qe(t,g),qe(l=0|b[(A=g)>>2],A=0|b[A+4>>2],r),$e(l,A,n),o=+Se(r,n+8|0),A=~~+m(+ +Se(a,e)/(2*o)),k=i,0|(0==(0|A)?1:A)}function H(a,e,t,r){e|=0,t|=0,r|=0,b[(a|=0)>>2]=e,b[a+4>>2]=t,b[a+8>>2]=r}function W(a,e){a|=0;var t,r,o,l,A=0,c=0,g=0,i=0,h=0,d=0,f=0;b[(l=(e|=0)+8|0)>>2]=0,r=+n[a>>3],i=+q(+r),o=+n[a+8>>3],i+=.5*(h=+q(+o)/.8660254037844386),i-=+(0|(A=~~i)),h-=+(0|(a=~~h));do{if(i<.5){if(i<.3333333333333333){if(b[e>>2]=A,h<.5*(i+1)){b[e+4>>2]=a;break}a=a+1|0,b[e+4>>2]=a;break}if(a=(1&!(h<(f=1-i)))+a|0,b[e+4>>2]=a,f<=h&h<2*i){A=A+1|0,b[e>>2]=A;break}b[e>>2]=A;break}if(!(i<.6666666666666666)){if(A=A+1|0,b[e>>2]=A,h<.5*i){b[e+4>>2]=a;break}a=a+1|0,b[e+4>>2]=a;break}if(h<1-i){if(b[e+4>>2]=a,2*i-1<h){b[e>>2]=A;break}}else a=a+1|0,b[e+4>>2]=a;A=A+1|0,b[e>>2]=A}while(0);do{if(r<0){if(1&a){A=~~(+(0|A)-(2*(+((d=0|wt(0|A,((0|A)<0)<<31>>31|0,0|(d=(a+1|0)/2|0),((0|d)<0)<<31>>31|0))>>>0)+4294967296*+(0|w()))+1)),b[e>>2]=A;break}A=~~(+(0|A)-2*(+((d=0|wt(0|A,((0|A)<0)<<31>>31|0,0|(d=(0|a)/2|0),((0|d)<0)<<31>>31|0))>>>0)+4294967296*+(0|w()))),b[e>>2]=A;break}}while(0);d=e+4|0,o<0&&(A=A-((1|a<<1)/2|0)|0,b[e>>2]=A,a=0-a|0,b[d>>2]=a),c=a-A|0,(0|A)<0?(g=0-A|0,b[d>>2]=c,b[l>>2]=g,b[e>>2]=0,a=c,A=0):g=0,(0|a)<0&&(A=A-a|0,b[e>>2]=A,g=g-a|0,b[l>>2]=g,b[d>>2]=0,a=0),t=A-g|0,c=a-g|0,(0|g)<0&&(b[e>>2]=t,b[d>>2]=c,b[l>>2]=0,a=c,A=t,g=0),(0|(c=(0|g)<(0|(c=(0|a)<(0|A)?a:A))?g:c))<=0||(b[e>>2]=A-c,b[d>>2]=a-c,b[l>>2]=g-c)}function X(a){var e,t=0,r=0,n=0,o=0,g=0;t=0|b[(a|=0)>>2],r=0|b[(e=a+4|0)>>2],(0|t)<0&&(r=r-t|0,b[e>>2]=r,b[(g=a+8|0)>>2]=(0|b[g>>2])-t,b[a>>2]=0,t=0),(0|r)<0?(t=t-r|0,b[a>>2]=t,o=(0|b[(g=a+8|0)>>2])-r|0,b[g>>2]=o,b[e>>2]=0,r=0):(g=o=a+8|0,o=0|b[o>>2]),(0|o)<0&&(t=t-o|0,b[a>>2]=t,r=r-o|0,b[e>>2]=r,b[g>>2]=0,o=0),(0|(n=(0|o)<(0|(n=(0|r)<(0|t)?r:t))?o:n))<=0||(b[a>>2]=t-n,b[e>>2]=r-n,b[g>>2]=o-n)}function Y(a,e){e|=0;var t,r;r=0|b[(a|=0)+8>>2],t=+((0|b[a+4>>2])-r|0),n[e>>3]=+((0|b[a>>2])-r|0)-.5*t,n[e+8>>3]=.8660254037844386*t}function K(a,e,t){a|=0,e|=0,b[(t|=0)>>2]=(0|b[e>>2])+(0|b[a>>2]),b[t+4>>2]=(0|b[e+4>>2])+(0|b[a+4>>2]),b[t+8>>2]=(0|b[e+8>>2])+(0|b[a+8>>2])}function J(a,e,t){a|=0,e|=0,b[(t|=0)>>2]=(0|b[a>>2])-(0|b[e>>2]),b[t+4>>2]=(0|b[a+4>>2])-(0|b[e+4>>2]),b[t+8>>2]=(0|b[a+8>>2])-(0|b[e+8>>2])}function ee(a,e){e|=0;var t,r=0;r=0|_(0|b[(a|=0)>>2],e),b[a>>2]=r,t=0|_(0|b[(r=a+4|0)>>2],e),b[r>>2]=t,e=0|_(0|b[(a=a+8|0)>>2],e),b[a>>2]=e}function te(a){var g,e,t=0,r=0,n=0,o=0,i=0;i=(0|(e=0|b[(a|=0)>>2]))<0,a=(a=(r=(0|(o=((g=(0|(n=(0|b[a+4>>2])-(i?e:0)|0))<0)?0-n|0:0)+((0|b[a+8>>2])-(i?e:0))|0))<0)?0:o)-((n=(0|(r=(0|a)<(0|(r=(0|(t=(g?0:n)-(r?o:0)|0))<(0|(o=(i?0:e)-(g?n:0)-(r?o:0)|0))?t:o))?a:r))>0)?r:0)|0,t=t-(n?r:0)|0;e:do{switch(o-(n?r:0)|0){case 0:switch(0|t){case 0:return 0|(i=0==(0|a)?0:1==(0|a)?1:7);case 1:return 0|(i=0==(0|a)?2:1==(0|a)?3:7);default:break e}case 1:switch(0|t){case 0:return 0|(i=0==(0|a)?4:1==(0|a)?5:7);case 1:if(a)break e;return 0|(a=6);default:break e}}}while(0);return 0|(i=7)}function ie(a){var e,i,t=0,r=0,n=0,o=0,g=0;r=0|b[(e=(a|=0)+8|0)>>2],n=0|yt(+((3*(t=(0|b[a>>2])-r|0)|0)-(r=(0|b[(i=a+4|0)>>2])-r|0)|0)/7),b[a>>2]=n,t=0|yt(+((r<<1)+t|0)/7),b[i>>2]=t,b[e>>2]=0,r=t-n|0,(0|n)<0?(g=0-n|0,b[i>>2]=r,b[e>>2]=g,b[a>>2]=0,t=r,n=0,r=g):r=0,(0|t)<0&&(n=n-t|0,b[a>>2]=n,r=r-t|0,b[e>>2]=r,b[i>>2]=0,t=0),g=n-r|0,o=t-r|0,(0|r)<0?(b[a>>2]=g,b[i>>2]=o,b[e>>2]=0,t=o,o=g,r=0):o=n,(0|(n=(0|r)<(0|(n=(0|t)<(0|o)?t:o))?r:n))<=0||(b[a>>2]=o-n,b[i>>2]=t-n,b[e>>2]=r-n)}function re(a){var e,i,t=0,r=0,n=0,o=0,g=0;r=0|b[(e=(a|=0)+8|0)>>2],n=0|yt(+(((t=(0|b[a>>2])-r|0)<<1)+(r=(0|b[(i=a+4|0)>>2])-r|0)|0)/7),b[a>>2]=n,t=0|yt(+((3*r|0)-t|0)/7),b[i>>2]=t,b[e>>2]=0,r=t-n|0,(0|n)<0?(g=0-n|0,b[i>>2]=r,b[e>>2]=g,b[a>>2]=0,t=r,n=0,r=g):r=0,(0|t)<0&&(n=n-t|0,b[a>>2]=n,r=r-t|0,b[e>>2]=r,b[i>>2]=0,t=0),g=n-r|0,o=t-r|0,(0|r)<0?(b[a>>2]=g,b[i>>2]=o,b[e>>2]=0,t=o,o=g,r=0):o=n,(0|(n=(0|r)<(0|(n=(0|t)<(0|o)?t:o))?r:n))<=0||(b[a>>2]=o-n,b[i>>2]=t-n,b[e>>2]=r-n)}function ne(a){var g,e,i,t=0,r=0,n=0,o=0;t=0|b[(a|=0)>>2],r=0|b[(e=a+4|0)>>2],n=0|b[(i=a+8|0)>>2],o=r+(3*t|0)|0,b[a>>2]=o,r=n+(3*r|0)|0,b[e>>2]=r,t=(3*n|0)+t|0,b[i>>2]=t,n=r-o|0,(0|o)<0?(t=t-o|0,b[e>>2]=n,b[i>>2]=t,b[a>>2]=0,r=n,n=0):n=o,(0|r)<0&&(n=n-r|0,b[a>>2]=n,t=t-r|0,b[i>>2]=t,b[e>>2]=0,r=0),g=n-t|0,o=r-t|0,(0|t)<0?(b[a>>2]=g,b[e>>2]=o,b[i>>2]=0,n=g,t=0):o=r,(0|(r=(0|t)<(0|(r=(0|o)<(0|n)?o:n))?t:r))<=0||(b[a>>2]=n-r,b[e>>2]=o-r,b[i>>2]=t-r)}function oe(a){var g,e,i,t=0,r=0,n=0,o=0;o=0|b[(a|=0)>>2],n=(3*(t=0|b[(e=a+4|0)>>2])|0)+o|0,o=(r=0|b[(i=a+8|0)>>2])+(3*o|0)|0,b[a>>2]=o,b[e>>2]=n,t=(3*r|0)+t|0,b[i>>2]=t,r=n-o|0,(0|o)<0?(t=t-o|0,b[e>>2]=r,b[i>>2]=t,b[a>>2]=0,o=0):r=n,(0|r)<0&&(o=o-r|0,b[a>>2]=o,t=t-r|0,b[i>>2]=t,b[e>>2]=0,r=0),g=o-t|0,n=r-t|0,(0|t)<0?(b[a>>2]=g,b[e>>2]=n,b[i>>2]=0,o=g,t=0):n=r,(0|(r=(0|t)<(0|(r=(0|n)<(0|o)?n:o))?t:r))<=0||(b[a>>2]=o-r,b[e>>2]=n-r,b[i>>2]=t-r)}function ae(a,e){a|=0;var g,t,i,r=0,n=0,o=0;((e|=0)+-1|0)>>>0>=6||(o=(0|b[15472+(12*e|0)>>2])+(0|b[a>>2])|0,b[a>>2]=o,i=a+4|0,n=(0|b[15472+(12*e|0)+4>>2])+(0|b[i>>2])|0,b[i>>2]=n,t=a+8|0,e=(0|b[15472+(12*e|0)+8>>2])+(0|b[t>>2])|0,b[t>>2]=e,r=n-o|0,(0|o)<0?(e=e-o|0,b[i>>2]=r,b[t>>2]=e,b[a>>2]=0,n=0):(r=n,n=o),(0|r)<0&&(n=n-r|0,b[a>>2]=n,e=e-r|0,b[t>>2]=e,b[i>>2]=0,r=0),g=n-e|0,o=r-e|0,(0|e)<0?(b[a>>2]=g,b[i>>2]=o,b[t>>2]=0,n=g,e=0):o=r,(0|(r=(0|e)<(0|(r=(0|o)<(0|n)?o:n))?e:r))<=0||(b[a>>2]=n-r,b[i>>2]=o-r,b[t>>2]=e-r))}function se(a){var g,e,i,t=0,r=0,n=0,o=0;o=0|b[(a|=0)>>2],n=(t=0|b[(e=a+4|0)>>2])+o|0,o=(r=0|b[(i=a+8|0)>>2])+o|0,b[a>>2]=o,b[e>>2]=n,t=r+t|0,b[i>>2]=t,r=n-o|0,(0|o)<0?(t=t-o|0,b[e>>2]=r,b[i>>2]=t,b[a>>2]=0,n=0):(r=n,n=o),(0|r)<0&&(n=n-r|0,b[a>>2]=n,t=t-r|0,b[i>>2]=t,b[e>>2]=0,r=0),g=n-t|0,o=r-t|0,(0|t)<0?(b[a>>2]=g,b[e>>2]=o,b[i>>2]=0,n=g,t=0):o=r,(0|(r=(0|t)<(0|(r=(0|o)<(0|n)?o:n))?t:r))<=0||(b[a>>2]=n-r,b[e>>2]=o-r,b[i>>2]=t-r)}function le(a){var g,e,i,t=0,r=0,n=0,o=0;t=0|b[(a|=0)>>2],n=0|b[(e=a+4|0)>>2],r=0|b[(i=a+8|0)>>2],o=n+t|0,b[a>>2]=o,n=r+n|0,b[e>>2]=n,t=r+t|0,b[i>>2]=t,r=n-o|0,(0|o)<0?(t=t-o|0,b[e>>2]=r,b[i>>2]=t,b[a>>2]=0,n=0):(r=n,n=o),(0|r)<0&&(n=n-r|0,b[a>>2]=n,t=t-r|0,b[i>>2]=t,b[e>>2]=0,r=0),g=n-t|0,o=r-t|0,(0|t)<0?(b[a>>2]=g,b[e>>2]=o,b[i>>2]=0,n=g,t=0):o=r,(0|(r=(0|t)<(0|(r=(0|o)<(0|n)?o:n))?t:r))<=0||(b[a>>2]=n-r,b[e>>2]=o-r,b[i>>2]=t-r)}function Ae(a){switch(0|(a|=0)){case 1:a=5;break;case 5:a=4;break;case 4:a=6;break;case 6:a=2;break;case 2:a=3;break;case 3:a=1}return 0|a}function ce(a){switch(0|(a|=0)){case 1:a=3;break;case 3:a=2;break;case 2:a=6;break;case 6:a=4;break;case 4:a=5;break;case 5:a=1}return 0|a}function ue(a){var g,e,i,t=0,r=0,n=0,o=0;t=0|b[(a|=0)>>2],r=0|b[(e=a+4|0)>>2],n=0|b[(i=a+8|0)>>2],o=r+(t<<1)|0,b[a>>2]=o,r=n+(r<<1)|0,b[e>>2]=r,t=(n<<1)+t|0,b[i>>2]=t,n=r-o|0,(0|o)<0?(t=t-o|0,b[e>>2]=n,b[i>>2]=t,b[a>>2]=0,r=n,n=0):n=o,(0|r)<0&&(n=n-r|0,b[a>>2]=n,t=t-r|0,b[i>>2]=t,b[e>>2]=0,r=0),g=n-t|0,o=r-t|0,(0|t)<0?(b[a>>2]=g,b[e>>2]=o,b[i>>2]=0,n=g,t=0):o=r,(0|(r=(0|t)<(0|(r=(0|o)<(0|n)?o:n))?t:r))<=0||(b[a>>2]=n-r,b[e>>2]=o-r,b[i>>2]=t-r)}function he(a){var g,e,i,t=0,r=0,n=0,o=0;o=0|b[(a|=0)>>2],n=((t=0|b[(e=a+4|0)>>2])<<1)+o|0,o=(r=0|b[(i=a+8|0)>>2])+(o<<1)|0,b[a>>2]=o,b[e>>2]=n,t=(r<<1)+t|0,b[i>>2]=t,r=n-o|0,(0|o)<0?(t=t-o|0,b[e>>2]=r,b[i>>2]=t,b[a>>2]=0,o=0):r=n,(0|r)<0&&(o=o-r|0,b[a>>2]=o,t=t-r|0,b[i>>2]=t,b[e>>2]=0,r=0),g=o-t|0,n=r-t|0,(0|t)<0?(b[a>>2]=g,b[e>>2]=n,b[i>>2]=0,o=g,t=0):n=r,(0|(r=(0|t)<(0|(r=(0|n)<(0|o)?n:o))?t:r))<=0||(b[a>>2]=o-r,b[e>>2]=n-r,b[i>>2]=t-r)}function pe(a,e){e|=0;var g,t,i,r=0,n=0,o=0;return i=(0|(t=(0|b[(a|=0)>>2])-(0|b[e>>2])|0))<0,g=(0|(n=(0|b[a+4>>2])-(0|b[e+4>>2])-(i?t:0)|0))<0,e=(e=(a=(0|(o=(i?0-t|0:0)+(0|b[a+8>>2])-(0|b[e+8>>2])+(g?0-n|0:0)|0))<0)?0:o)-((n=(0|(a=(0|e)<(0|(a=(0|(r=(g?0:n)-(a?o:0)|0))<(0|(o=(i?0:t)-(g?n:0)-(a?o:0)|0))?r:o))?e:a))>0)?a:0)|0,r=r-(n?a:0)|0,0|((0|(a=(0|(a=o-(n?a:0)|0))>-1?a:0-a|0))>(0|(e=(0|(r=(0|r)>-1?r:0-r|0))>(0|(e=(0|e)>-1?e:0-e|0))?r:e))?a:e)}function de(a,e){e|=0;var t;t=0|b[(a|=0)+8>>2],b[e>>2]=(0|b[a>>2])-t,b[e+4>>2]=(0|b[a+4>>2])-t}function fe(a,e){e|=0;var g,t,i,r=0,n=0,o=0;n=0|b[(a|=0)>>2],b[e>>2]=n,a=0|b[a+4>>2],b[(t=e+4|0)>>2]=a,b[(i=e+8|0)>>2]=0,r=a-n|0,(0|n)<0?(a=0-n|0,b[t>>2]=r,b[i>>2]=a,b[e>>2]=0,n=0):(r=a,a=0),(0|r)<0&&(n=n-r|0,b[e>>2]=n,a=a-r|0,b[i>>2]=a,b[t>>2]=0,r=0),g=n-a|0,o=r-a|0,(0|a)<0?(b[e>>2]=g,b[t>>2]=o,b[i>>2]=0,r=o,o=g,a=0):o=n,(0|(n=(0|a)<(0|(n=(0|r)<(0|o)?r:o))?a:n))<=0||(b[e>>2]=o-n,b[t>>2]=r-n,b[i>>2]=a-n)}function me(a){var e,t,r,n;t=(n=0|b[(e=(a|=0)+8|0)>>2])-(0|b[a>>2])|0,b[a>>2]=t,a=(0|b[(r=a+4|0)>>2])-n|0,b[r>>2]=a,b[e>>2]=0-(a+t)}function _e(a){var e,i,t=0,r=0,n=0,o=0,g=0;t=0-(r=0|b[(a|=0)>>2])|0,b[a>>2]=t,b[(e=a+8|0)>>2]=0,o=(n=0|b[(i=a+4|0)>>2])+r|0,(0|r)>0?(b[i>>2]=o,b[e>>2]=r,b[a>>2]=0,t=0,n=o):r=0,(0|n)<0?(g=t-n|0,b[a>>2]=g,r=r-n|0,b[e>>2]=r,b[i>>2]=0,o=g-r|0,t=0-r|0,(0|r)<0?(b[a>>2]=o,b[i>>2]=t,b[e>>2]=0,n=t,r=0):(n=0,o=g)):o=t,(0|(t=(0|r)<(0|(t=(0|n)<(0|o)?n:o))?r:t))<=0||(b[a>>2]=o-t,b[i>>2]=n-t,b[e>>2]=r-t)}function ge(a,e,t,r){e|=0,t|=0,r|=0;var o,g=0,h=0,i=0,d=0;if(o=k,k=k+32|0,function(a,b){b|=0;var e=0,t=0,r=0;e=+n[(a=a|0)>>3],t=+l(+e),e=+u(+e),n[b+16>>3]=e,e=+n[a+8>>3],r=t*+l(+e),n[b>>3]=r,e=t*+u(+e),n[b+8>>3]=e}(a|=0,h=o),b[t>>2]=0,g=+ct(15888,h),(i=+ct(15912,h))<g&&(b[t>>2]=1,g=i),(i=+ct(15936,h))<g&&(b[t>>2]=2,g=i),(i=+ct(15960,h))<g&&(b[t>>2]=3,g=i),(i=+ct(15984,h))<g&&(b[t>>2]=4,g=i),(i=+ct(16008,h))<g&&(b[t>>2]=5,g=i),(i=+ct(16032,h))<g&&(b[t>>2]=6,g=i),(i=+ct(16056,h))<g&&(b[t>>2]=7,g=i),(i=+ct(16080,h))<g&&(b[t>>2]=8,g=i),(i=+ct(16104,h))<g&&(b[t>>2]=9,g=i),(i=+ct(16128,h))<g&&(b[t>>2]=10,g=i),(i=+ct(16152,h))<g&&(b[t>>2]=11,g=i),(i=+ct(16176,h))<g&&(b[t>>2]=12,g=i),(i=+ct(16200,h))<g&&(b[t>>2]=13,g=i),(i=+ct(16224,h))<g&&(b[t>>2]=14,g=i),(i=+ct(16248,h))<g&&(b[t>>2]=15,g=i),(i=+ct(16272,h))<g&&(b[t>>2]=16,g=i),(i=+ct(16296,h))<g&&(b[t>>2]=17,g=i),(i=+ct(16320,h))<g&&(b[t>>2]=18,g=i),(i=+ct(16344,h))<g&&(b[t>>2]=19,g=i),(i=+c(+(1-.5*g)))<1e-16)return b[r>>2]=0,b[r+4>>2]=0,b[r+8>>2]=0,b[r+12>>2]=0,void(k=o);if(t=0|b[t>>2],g=+Ce((g=+n[16368+(24*t|0)>>3])-+Ce(+function(a,b){a|=0;var e=0,t=0,r=0,g=0,o=0;return g=+n[(b=b|0)>>3],t=+l(+g),r=+n[b+8>>3]-+n[a+8>>3],o=t*+u(+r),e=+n[a>>3],+ +f(+o,+(+u(+g)*+l(+e)-+l(+r)*(t*+u(+e))))}(15568+(t<<4)|0,a))),d=0|je(e)?+Ce(g+-.3334731722518321):g,g=+A(+i)/.381966011250105,(0|e)>0){h=0;do{g*=2.6457513110645907,h=h+1|0}while((0|h)!=(0|e))}i=+l(+d)*g,n[r>>3]=i,d=+u(+d)*g,n[r+8>>3]=d,k=o}function ye(a,e,t,r,g){e|=0,t|=0,r|=0,g|=0;var A=0,i=0;if(A=+function(a){var b=0,e=0;return e=+n[(a=a|0)>>3],b=+n[a+8>>3],+ +o(+(e*e+b*b))}(a|=0),A<1e-16)return e=15568+(e<<4)|0,b[g>>2]=b[e>>2],b[g+4>>2]=b[e+4>>2],b[g+8>>2]=b[e+8>>2],void(b[g+12>>2]=b[e+12>>2]);if(i=+f(+ +n[a+8>>3],+ +n[a>>3]),(0|t)>0){a=0;do{A/=2.6457513110645907,a=a+1|0}while((0|a)!=(0|t))}r?(A/=3,t=0==(0|je(t)),A=+d(.381966011250105*(t?A:A/2.6457513110645907))):(A=+d(.381966011250105*A),0|je(t)&&(i=+Ce(i+.3334731722518321))),function(a,e,t,r){a|=0,e=+e,r|=0;var g=0,o=0,i=0,A=0;if((t=+t)<1e-16)return b[r>>2]=b[a>>2],b[r+4>>2]=b[a+4>>2],b[r+8>>2]=b[a+8>>2],void(b[r+12>>2]=b[a+12>>2]);o=e<0?e+6.283185307179586:e,o=e>=6.283185307179586?o+-6.283185307179586:o;do{if(!(o<1e-16)){if(g=+q(+(o+-3.141592653589793))<1e-16,e=+n[a>>3],g){e-=t,n[r>>3]=e,g=r;break}if(i=+l(+t),t=+u(+t),e=i*+u(+e)+ +l(+o)*(t*+l(+e)),e=+h(+((e=e>1?1:e)<-1?-1:e)),n[r>>3]=e,+q(+(e+-1.5707963267948966))<1e-16)return n[r>>3]=1.5707963267948966,void(n[r+8>>3]=0);if(+q(+(e+1.5707963267948966))<1e-16)return n[r>>3]=-1.5707963267948966,void(n[r+8>>3]=0);if(A=+l(+e),o=t*+u(+o)/A,t=+n[a>>3],e=(i-+u(+e)*+u(+t))/+l(+t)/A,i=o>1?1:o,e=e>1?1:e,(e=+n[a+8>>3]+ +f(+(i<-1?-1:i),+(e<-1?-1:e)))>3.141592653589793)do{e+=-6.283185307179586}while(e>3.141592653589793);if(e<-3.141592653589793)do{e+=6.283185307179586}while(e<-3.141592653589793);return void(n[r+8>>3]=e)}e=+n[a>>3]+t,n[r>>3]=e,g=r}while(0);if(+q(+(e+-1.5707963267948966))<1e-16)return n[g>>3]=1.5707963267948966,void(n[r+8>>3]=0);if(+q(+(e+1.5707963267948966))<1e-16)return n[g>>3]=-1.5707963267948966,void(n[r+8>>3]=0);if((e=+n[a+8>>3])>3.141592653589793)do{e+=-6.283185307179586}while(e>3.141592653589793);if(e<-3.141592653589793)do{e+=6.283185307179586}while(e<-3.141592653589793);n[r+8>>3]=e}(15568+(e<<4)|0,+Ce(+n[16368+(24*e|0)>>3]-i),A,g)}function xe(a,e,t){e|=0,t|=0;var r,n;r=k,k=k+16|0,Y((a|=0)+4|0,n=r),ye(n,0|b[a>>2],e,0,t),k=r}function ve(a,e,t,r,g){a|=0,e|=0,t|=0,r|=0,g|=0;var o,l,A,c,h,p,q,d,s,f,m,_,y,x,v,w,E,M,C,I,S,z,D=0,i=0,B=0,u=0,P=0,L=0;if(z=k,k=k+272|0,u=z+240|0,C=z,I=z+224|0,S=z+208|0,m=z+176|0,_=z+160|0,y=z+192|0,x=z+144|0,v=z+128|0,w=z+112|0,E=z+96|0,M=z+80|0,b[(D=z+256|0)>>2]=e,b[u>>2]=b[a>>2],b[u+4>>2]=b[a+4>>2],b[u+8>>2]=b[a+8>>2],b[u+12>>2]=b[a+12>>2],be(u,D,C),b[g>>2]=0,(0|(u=r+t+(5==(0|r)&1)|0))<=(0|t))k=z;else{l=I+4|0,A=m+4|0,c=t+5|0,h=16848+((o=0|b[D>>2])<<2)|0,p=16928+(o<<2)|0,q=v+8|0,d=w+8|0,s=E+8|0,f=S+4|0,B=t;e:for(;;){i=C+(((0|B)%5|0)<<4)|0,b[S>>2]=b[i>>2],b[S+4>>2]=b[i+4>>2],b[S+8>>2]=b[i+8>>2],b[S+12>>2]=b[i+12>>2];do{}while(2==(0|we(S,o,0,1)));if((0|B)>(0|t)&0!=(0|je(e))){if(b[m>>2]=b[S>>2],b[m+4>>2]=b[S+4>>2],b[m+8>>2]=b[S+8>>2],b[m+12>>2]=b[S+12>>2],Y(l,_),r=0|b[m>>2],D=0|b[17008+(80*r|0)+(b[I>>2]<<2)>>2],b[m>>2]=b[18608+(80*r|0)+(20*D|0)>>2],(0|(i=0|b[18608+(80*r|0)+(20*D|0)+16>>2]))>0){a=0;do{se(A),a=a+1|0}while((0|a)<(0|i))}switch(i=18608+(80*r|0)+(20*D|0)+4|0,b[y>>2]=b[i>>2],b[y+4>>2]=b[i+4>>2],b[y+8>>2]=b[i+8>>2],ee(y,3*(0|b[h>>2])|0),K(A,y,A),X(A),Y(A,x),P=+(0|b[p>>2]),n[v>>3]=3*P,n[q>>3]=0,L=-1.5*P,n[w>>3]=L,n[d>>3]=2.598076211353316*P,n[E>>3]=L,n[s>>3]=-2.598076211353316*P,0|b[17008+(80*(0|b[m>>2])|0)+(b[S>>2]<<2)>>2]){case 1:a=w,r=v;break;case 3:a=E,r=w;break;case 2:a=v,r=E;break;default:a=12;break e}lt(_,x,r,a,M),ye(M,0|b[m>>2],o,1,g+8+(b[g>>2]<<4)|0),b[g>>2]=1+(0|b[g>>2])}if((0|B)<(0|c)&&(Y(f,m),ye(m,0|b[S>>2],o,1,g+8+(b[g>>2]<<4)|0),b[g>>2]=1+(0|b[g>>2])),b[I>>2]=b[S>>2],b[I+4>>2]=b[S+4>>2],b[I+8>>2]=b[S+8>>2],b[I+12>>2]=b[S+12>>2],(0|(B=B+1|0))>=(0|u)){a=3;break}}3!=(0|a)?12==(0|a)&&T(22474,22521,581,22531):k=z}}function be(a,e,t){a|=0,e|=0,t|=0;var r,n=0,o=0,g=0,l=0,i=0;r=k,k=k+128|0,o=r,l=20208,i=(g=n=r+64|0)+60|0;do{b[g>>2]=b[l>>2],g=g+4|0,l=l+4|0}while((0|g)<(0|i));l=20272,i=(g=o)+60|0;do{b[g>>2]=b[l>>2],g=g+4|0,l=l+4|0}while((0|g)<(0|i));n=(i=0==(0|je(0|b[e>>2])))?n:o,ue(o=a+4|0),he(o),0|je(0|b[e>>2])&&(oe(o),b[e>>2]=1+(0|b[e>>2])),b[t>>2]=b[a>>2],K(o,n,e=t+4|0),X(e),b[t+16>>2]=b[a>>2],K(o,n+12|0,e=t+20|0),X(e),b[t+32>>2]=b[a>>2],K(o,n+24|0,e=t+36|0),X(e),b[t+48>>2]=b[a>>2],K(o,n+36|0,e=t+52|0),X(e),b[t+64>>2]=b[a>>2],K(o,n+48|0,t=t+68|0),X(t),k=r}function we(a,e,t,r){t|=0,r|=0;var n,i,o,l,A,p,c=0,g=0,h=0,d=0,f=0;if(p=k,k=k+32|0,A=p+12|0,i=p,f=(a|=0)+4|0,d=0|b[16928+((e|=0)<<2)>>2],d=(l=0!=(0|r))?3*d|0:d,c=0|b[f>>2],n=0|b[(o=a+8|0)>>2],l){if((0|(c=n+c+(r=0|b[(g=a+12|0)>>2])|0))==(0|d))return k=p,0|(f=1);h=g}else c=n+c+(r=0|b[(h=a+12|0)>>2])|0;if((0|c)<=(0|d))return k=p,0|(f=0);do{if((0|r)>0){if(r=0|b[a>>2],(0|n)>0){g=18608+(80*r|0)+60|0,r=a;break}r=18608+(80*r|0)+40|0,t?(H(A,d,0,0),J(f,A,i),le(i),K(i,A,f),g=r,r=a):(g=r,r=a)}else g=18608+(80*(0|b[a>>2])|0)+20|0,r=a}while(0);if(b[r>>2]=b[g>>2],(0|b[(c=g+16|0)>>2])>0){r=0;do{se(f),r=r+1|0}while((0|r)<(0|b[c>>2]))}return a=g+4|0,b[A>>2]=b[a>>2],b[A+4>>2]=b[a+4>>2],b[A+8>>2]=b[a+8>>2],e=0|b[16848+(e<<2)>>2],ee(A,l?3*e|0:e),K(f,A,f),X(f),r=l&&((0|b[o>>2])+(0|b[f>>2])+(0|b[h>>2])|0)==(0|d)?1:2,k=p,0|(f=r)}function Te(a,b){a|=0,b|=0;var e=0;do{e=0|we(a,b,0,1)}while(2==(0|e));return 0|e}function Ee(a,e,t,r,g){a|=0,e|=0,t|=0,r|=0,g|=0;var o,l,A,c,h,p,q,d,s,f,u,m,_,y,x,v,w,E,M=0,i=0,C=0,I=0,S=0;if(E=k,k=k+240|0,y=E+208|0,x=E,v=E+192|0,w=E+176|0,s=E+160|0,f=E+144|0,u=E+128|0,m=E+112|0,_=E+96|0,b[(M=E+224|0)>>2]=e,b[y>>2]=b[a>>2],b[y+4>>2]=b[a+4>>2],b[y+8>>2]=b[a+8>>2],b[y+12>>2]=b[a+12>>2],Me(y,M,x),b[g>>2]=0,(0|(d=r+t+(6==(0|r)&1)|0))<=(0|t))k=E;else{l=t+6|0,A=16928+((o=0|b[M>>2])<<2)|0,c=f+8|0,h=u+8|0,p=m+8|0,q=v+4|0,i=0,C=t,r=-1;e:for(;;){if(a=x+((M=(0|C)%6|0)<<4)|0,b[v>>2]=b[a>>2],b[v+4>>2]=b[a+4>>2],b[v+8>>2]=b[a+8>>2],b[v+12>>2]=b[a+12>>2],a=i,i=0|we(v,o,0,1),(0|C)>(0|t)&0!=(0|je(e))&&(1!=(0|a)&&(0|b[v>>2])!=(0|r))){switch(Y(x+(((M+5|0)%6|0)<<4)+4|0,w),Y(x+(M<<4)+4|0,s),I=+(0|b[A>>2]),n[f>>3]=3*I,n[c>>3]=0,S=-1.5*I,n[u>>3]=S,n[h>>3]=2.598076211353316*I,n[m>>3]=S,n[p>>3]=-2.598076211353316*I,M=0|b[y>>2],0|b[17008+(80*M|0)+(((0|r)==(0|M)?0|b[v>>2]:r)<<2)>>2]){case 1:a=u,r=f;break;case 3:a=m,r=u;break;case 2:a=f,r=m;break;default:a=8;break e}lt(w,s,r,a,_),0|At(w,_)||0|At(s,_)||(ye(_,0|b[y>>2],o,1,g+8+(b[g>>2]<<4)|0),b[g>>2]=1+(0|b[g>>2]))}if((0|C)<(0|l)&&(Y(q,w),ye(w,0|b[v>>2],o,1,g+8+(b[g>>2]<<4)|0),b[g>>2]=1+(0|b[g>>2])),(0|(C=C+1|0))>=(0|d)){a=3;break}r=0|b[v>>2]}3!=(0|a)?8==(0|a)&&T(22557,22521,746,22602):k=E}}function Me(a,e,t){a|=0,e|=0,t|=0;var r,n=0,o=0,g=0,l=0,i=0;r=k,k=k+160|0,o=r,l=20336,i=(g=n=r+80|0)+72|0;do{b[g>>2]=b[l>>2],g=g+4|0,l=l+4|0}while((0|g)<(0|i));l=20416,i=(g=o)+72|0;do{b[g>>2]=b[l>>2],g=g+4|0,l=l+4|0}while((0|g)<(0|i));n=(i=0==(0|je(0|b[e>>2])))?n:o,ue(o=a+4|0),he(o),0|je(0|b[e>>2])&&(oe(o),b[e>>2]=1+(0|b[e>>2])),b[t>>2]=b[a>>2],K(o,n,e=t+4|0),X(e),b[t+16>>2]=b[a>>2],K(o,n+12|0,e=t+20|0),X(e),b[t+32>>2]=b[a>>2],K(o,n+24|0,e=t+36|0),X(e),b[t+48>>2]=b[a>>2],K(o,n+36|0,e=t+52|0),X(e),b[t+64>>2]=b[a>>2],K(o,n+48|0,e=t+68|0),X(e),b[t+80>>2]=b[a>>2],K(o,n+60|0,t=t+84|0),X(t),k=r}function Ce(a){var b;return b=(a=+a)<0?a+6.283185307179586:a,+(a>=6.283185307179586?b+-6.283185307179586:b)}function Ie(a,b){return b|=0,+q(+(+n[(a|=0)>>3]-+n[b>>3]))<17453292519943298e-27?0|(b=+q(+(+n[a+8>>3]-+n[b+8>>3]))<17453292519943298e-27):0|(b=0)}function Se(a,b){a|=0;var e,t,g,r=0;return t=+n[(b|=0)>>3],e=+n[a>>3],r=(g=+u(.5*(t-e)))*g+(r=+u(.5*(+n[b+8>>3]-+n[a+8>>3])))*(+l(+t)*+l(+e)*r),2*+f(+ +o(+r),+ +o(+(1-r)))*6371.007180918475}function ke(a,b,e){a|=0,e|=0;var i,t,r,c,h=0,m=0,g=0,_=0,y=0,x=0;return x=+n[(b|=0)>>3],r=+n[a>>3],y=+u(.5*(x-r)),g=+n[b+8>>3],t=+n[a+8>>3],_=+u(.5*(g-t)),i=+l(+r),c=+l(+x),_=2*+f(+ +o(+(_=y*y+_*(c*i*_))),+ +o(+(1-_))),y=+n[e>>3],x=+u(.5*(y-x)),h=+n[e+8>>3],g=+u(.5*(h-g)),m=+l(+y),g=2*+f(+ +o(+(g=x*x+g*(c*m*g))),+ +o(+(1-g))),y=+u(.5*(r-y)),h=+u(.5*(t-h)),h=2*+f(+ +o(+(h=y*y+h*(i*m*h))),+ +o(+(1-h))),4*+d(+ +o(+ +A(.5*(m=.5*(_+g+h)))*+A(.5*(m-_))*+A(.5*(m-g))*+A(.5*(m-h))))}function ze(a,b){return b=0|Ct(0|(a|=0),0|(b|=0),45),w(),127&b|0}function De(a,b){var e=0,t=0,r=0,n=0,g=0,o=0;if(!(!0&134217728==(-16777216&(b|=0)|0)))return 0|(b=0);if(g=0|Ct(0|(a|=0),0|b,45),w(),(g&=127)>>>0>121)return 0|(b=0);e=0|Ct(0|a,0|b,52),w(),e&=15;do{if(0|e){for(r=1,t=0;;){if(n=0|Ct(0|a,0|b,3*(15-r|0)|0),w(),0!=(0|(n&=7))&(1^t)){if(1==(0|n)&0!=(0|R(g))){o=0,t=13;break}t=1}if(7==(0|n)){o=0,t=13;break}if(!(r>>>0<e>>>0)){t=9;break}r=r+1|0}if(9==(0|t)){if(15!=(0|e))break;return 0|(o=1)}if(13==(0|t))return 0|o}}while(0);for(;;){if(o=0|Ct(0|a,0|b,3*(14-e|0)|0),w(),!(7==(7&o|0)&!0)){o=0,t=13;break}if(!(e>>>0<14)){o=1,t=13;break}e=e+1|0}return 13==(0|t)?0|o:0}function Be(a,b,e){e|=0;var t=0,r=0;if(t=0|Ct(0|(a|=0),0|(b|=0),52),w(),(0|(t&=15))>=(0|e)){if((0|t)!=(0|e))if(e>>>0<=15){if(a|=r=0|dd(0|e,0,52),b=0|w()|-15728641&b,(0|t)>(0|e))do{r=0|dd(7,0,3*(14-e|0)|0),e=e+1|0,a|=r,b=0|w()|b}while((0|e)<(0|t))}else b=0,a=0}else b=0,a=0;return v(0|b),0|a}function Pe(a,e,t,r){t|=0,r|=0;var n,o=0,g=0,l=0,i=0,A=0,c=0;if(l=0|Ct(0|(a|=0),0|(e|=0),52),w(),(0|t)<16&(0|(l&=15))<=(0|t)){if((0|l)==(0|t))return b[(t=r)>>2]=a,void(b[t+4>>2]=e);if(n=(0|(A=0|it(7,t-l|0)))/7|0,i=0|Ct(0|a,0|e,45),w(),0|R(127&i)){e:do{if(l)for(g=1;;){if(o=0|Ct(0|a,0|e,3*(15-g|0)|0),w(),0|(o&=7))break e;if(!(g>>>0<l>>>0)){o=0;break}g=g+1|0}else o=0}while(0);g=0==(0|o)}else g=0;if(c=0|dd(l+1|0,0,52),o=0|w()|-15728641&e,Pe(e=(c|a)&~(e=0|dd(7,0,0|(i=3*(14-l|0)|0))),l=o&~(0|w()),t,r),o=r+(n<<3)|0,!g)return Pe((c=0|dd(1,0,0|i))|e,0|w()|l,t,o),c=o+(n<<3)|0,Pe((A=0|dd(2,0,0|i))|e,0|w()|l,t,c),c=c+(n<<3)|0,Pe((A=0|dd(3,0,0|i))|e,0|w()|l,t,c),c=c+(n<<3)|0,Pe((A=0|dd(4,0,0|i))|e,0|w()|l,t,c),c=c+(n<<3)|0,Pe((A=0|dd(5,0,0|i))|e,0|w()|l,t,c),void Pe((A=0|dd(6,0,0|i))|e,0|w()|l,t,c+(n<<3)|0);g=o+(n<<3)|0,(0|A)>6&&(zt(0|o,0,(c=(g>>>0>(A=o+8|0)>>>0?g:A)+-1+(0-o)|0)+8&-8|0),o=A+(c>>>3<<3)|0),Pe((c=0|dd(2,0,0|i))|e,0|w()|l,t,o),c=o+(n<<3)|0,Pe((A=0|dd(3,0,0|i))|e,0|w()|l,t,c),c=c+(n<<3)|0,Pe((A=0|dd(4,0,0|i))|e,0|w()|l,t,c),c=c+(n<<3)|0,Pe((A=0|dd(5,0,0|i))|e,0|w()|l,t,c),Pe((A=0|dd(6,0,0|i))|e,0|w()|l,t,c+(n<<3)|0)}}function Le(a,b){var e=0,t=0,r=0;if(r=0|Ct(0|(a|=0),0|(b|=0),45),w(),!(0|R(127&r)))return 0|(r=0);r=0|Ct(0|a,0|b,52),w(),r&=15;e:do{if(r)for(t=1;;){if(e=0|Ct(0|a,0|b,3*(15-t|0)|0),w(),0|(e&=7))break e;if(!(t>>>0<r>>>0)){e=0;break}t=t+1|0}else e=0}while(0);return 0|(r=0==(0|e)&1)}function Re(a,b){var e=0,t=0,r=0;if(r=0|Ct(0|(a|=0),0|(b|=0),52),w(),!(r&=15))return 0|(r=0);for(t=1;;){if(e=0|Ct(0|a,0|b,3*(15-t|0)|0),w(),0|(e&=7)){t=5;break}if(!(t>>>0<r>>>0)){e=0,t=5;break}t=t+1|0}return 5==(0|t)?0|e:0}function Fe(a,b){var e=0,t=0,r=0,n=0,g=0,o=0,i=0;if(i=0|Ct(0|(a|=0),0|(b|=0),52),w(),!(i&=15))return i=a,v(0|(o=b)),0|i;for(o=1,e=0;;){t=0|dd(7,0,0|(n=3*(15-o|0)|0)),r=0|w(),g=0|Ct(0|a,0|b,0|n),w(),a=(n=0|dd(0|Ae(7&g),0,0|n))|a&~t,b=(g=0|w())|b&~r;e:do{if(!e)if(0==(n&t|0)&0==(g&r|0))e=0;else if(t=0|Ct(0|a,0|b,52),w(),t&=15){e=1;t:for(;;){switch(g=0|Ct(0|a,0|b,3*(15-e|0)|0),w(),7&g){case 1:break t;case 0:break;default:e=1;break e}if(!(e>>>0<t>>>0)){e=1;break e}e=e+1|0}for(e=1;;){if(r=0|Ct(0|a,0|b,0|(g=3*(15-e|0)|0)),w(),n=0|dd(7,0,0|g),b&=~(0|w()),a=a&~n|(g=0|dd(0|Ae(7&r),0,0|g)),b=0|b|w(),!(e>>>0<t>>>0)){e=1;break}e=e+1|0}}else e=1}while(0);if(!(o>>>0<i>>>0))break;o=o+1|0}return v(0|b),0|a}function Oe(a,b){var e=0,t=0,r=0,n=0,g=0;if(t=0|Ct(0|(a|=0),0|(b|=0),52),w(),!(t&=15))return t=a,v(0|(e=b)),0|t;for(e=1;g=0|Ct(0|a,0|b,0|(n=3*(15-e|0)|0)),w(),r=0|dd(7,0,0|n),b&=~(0|w()),a=(n=0|dd(0|Ae(7&g),0,0|n))|a&~r,b=0|w()|b,e>>>0<t>>>0;)e=e+1|0;return v(0|b),0|a}function Ue(a,b){var e=0,t=0,r=0,n=0,g=0,o=0,i=0;if(i=0|Ct(0|(a|=0),0|(b|=0),52),w(),!(i&=15))return i=a,v(0|(o=b)),0|i;for(o=1,e=0;;){t=0|dd(7,0,0|(n=3*(15-o|0)|0)),r=0|w(),g=0|Ct(0|a,0|b,0|n),w(),a=(n=0|dd(0|ce(7&g),0,0|n))|a&~t,b=(g=0|w())|b&~r;e:do{if(!e)if(0==(n&t|0)&0==(g&r|0))e=0;else if(t=0|Ct(0|a,0|b,52),w(),t&=15){e=1;t:for(;;){switch(g=0|Ct(0|a,0|b,3*(15-e|0)|0),w(),7&g){case 1:break t;case 0:break;default:e=1;break e}if(!(e>>>0<t>>>0)){e=1;break e}e=e+1|0}for(e=1;;){if(n=0|dd(7,0,0|(r=3*(15-e|0)|0)),g=b&~(0|w()),b=0|Ct(0|a,0|b,0|r),w(),a=a&~n|(b=0|dd(0|ce(7&b),0,0|r)),b=0|g|w(),!(e>>>0<t>>>0)){e=1;break}e=e+1|0}}else e=1}while(0);if(!(o>>>0<i>>>0))break;o=o+1|0}return v(0|b),0|a}function Ve(a,b){var e=0,t=0,r=0,n=0,g=0;if(t=0|Ct(0|(a|=0),0|(b|=0),52),w(),!(t&=15))return t=a,v(0|(e=b)),0|t;for(e=1;n=0|dd(7,0,0|(g=3*(15-e|0)|0)),r=b&~(0|w()),b=0|Ct(0|a,0|b,0|g),w(),a=(b=0|dd(0|ce(7&b),0,0|g))|a&~n,b=0|w()|r,e>>>0<t>>>0;)e=e+1|0;return v(0|b),0|a}function je(a){return 0|(0|(a|=0))%2}function Ge(a,e){a|=0;var t,r;return r=k,k=k+16|0,t=r,(e|=0)>>>0<=15&&2146435072!=(2146435072&b[a+4>>2]|0)&&2146435072!=(2146435072&b[a+8+4>>2]|0)?(!function(a,b,e){var t,r;t=k,k=k+16|0,ge(a|=0,b|=0,e|=0,r=t),W(r,e+4|0),k=t}(a,e,t),e=0|function(a,e){a|=0;var t,r=0,n=0,o=0,g=0,l=0,i=0,A=0,c=0;if(t=k,k=k+64|0,i=t+40|0,n=t+24|0,o=t+12|0,g=t,dd(0|(e|=0),0,52),r=134225919|w(),!e)return(0|b[a+4>>2])>2||(0|b[a+8>>2])>2||(0|b[a+12>>2])>2?(i=0,v(0|(l=0)),k=t,0|i):(dd(0|O(a),0,45),l=0|w()|r,i=-1,v(0|l),k=t,0|i);if(b[i>>2]=b[a>>2],b[i+4>>2]=b[a+4>>2],b[i+8>>2]=b[a+8>>2],b[i+12>>2]=b[a+12>>2],l=i+4|0,(0|e)>0)for(a=-1;b[n>>2]=b[l>>2],b[n+4>>2]=b[l+4>>2],b[n+8>>2]=b[l+8>>2],1&e?(ie(l),b[o>>2]=b[l>>2],b[o+4>>2]=b[l+4>>2],b[o+8>>2]=b[l+8>>2],ne(o)):(re(l),b[o>>2]=b[l>>2],b[o+4>>2]=b[l+4>>2],b[o+8>>2]=b[l+8>>2],oe(o)),J(n,o,g),X(g),A=0|dd(7,0,0|(c=3*(15-e|0)|0)),r&=~(0|w()),a=(c=0|dd(0|te(g),0,0|c))|a&~A,r=0|w()|r,(0|e)>1;)e=e+-1|0;else a=-1;e:do{if((0|b[l>>2])<=2&&(0|b[i+8>>2])<=2&&(0|b[i+12>>2])<=2){if(e=0|dd(0|(n=0|O(i)),0,45),e|=a,a=0|w()|-1040385&r,g=0|U(i),!(0|R(n))){if((0|g)<=0)break;for(o=0;;){if(n=0|Ct(0|e,0|a,52),w(),n&=15)for(r=1;i=0|Ct(0|e,0|a,0|(c=3*(15-r|0)|0)),w(),A=0|dd(7,0,0|c),a&=~(0|w()),e=e&~A|(c=0|dd(0|Ae(7&i),0,0|c)),a=0|a|w(),r>>>0<n>>>0;)r=r+1|0;if((0|(o=o+1|0))==(0|g))break e}}o=0|Ct(0|e,0|a,52),w(),o&=15;t:do{if(o){r=1;i:for(;;){switch(c=0|Ct(0|e,0|a,3*(15-r|0)|0),w(),7&c){case 1:break i;case 0:break;default:break t}if(!(r>>>0<o>>>0))break t;r=r+1|0}if(0|V(n,0|b[i>>2]))for(r=1;A=0|dd(7,0,0|(i=3*(15-r|0)|0)),c=a&~(0|w()),a=0|Ct(0|e,0|a,0|i),w(),e=e&~A|(a=0|dd(0|ce(7&a),0,0|i)),a=0|c|w(),r>>>0<o>>>0;)r=r+1|0;else for(r=1;i=0|Ct(0|e,0|a,0|(c=3*(15-r|0)|0)),w(),A=0|dd(7,0,0|c),a&=~(0|w()),e=e&~A|(c=0|dd(0|Ae(7&i),0,0|c)),a=0|a|w(),r>>>0<o>>>0;)r=r+1|0}}while(0);if((0|g)>0){r=0;do{e=0|Fe(e,a),a=0|w(),r=r+1|0}while((0|r)!=(0|g))}}else e=0,a=0}while(0);return c=e,v(0|(A=a)),k=t,0|c}(t,e),a=0|w()):(a=0,e=0),v(0|a),k=r,0|e}function Ne(a,e,t){var r,n=0,g=0,o=0;if(r=(t|=0)+4|0,g=0|Ct(0|(a|=0),0|(e|=0),52),w(),g&=15,o=0|Ct(0|a,0|e,45),w(),n=0==(0|g),0|R(127&o)){if(n)return 0|(o=1);n=1}else{if(n)return 0|(o=0);n=0==(0|b[r>>2])&&0==(0|b[t+8>>2])?0!=(0|b[t+12>>2])&1:1}for(t=1;1&t?ne(r):oe(r),o=0|Ct(0|a,0|e,3*(15-t|0)|0),w(),ae(r,7&o),t>>>0<g>>>0;)t=t+1|0;return 0|n}function Ze(a,e,t){t|=0;var r,n,o=0,l=0,g=0,A=0,i=0,c=0;n=k,k=k+16|0,r=n,c=0|Ct(0|(a|=0),0|(e|=0),45),w(),c&=127;e:do{if(0!=(0|R(c))&&(g=0|Ct(0|a,0|e,52),w(),0!=(0|(g&=15)))){o=1;t:for(;;){switch(i=0|Ct(0|a,0|e,3*(15-o|0)|0),w(),7&i){case 5:break t;case 0:break;default:o=e;break e}if(!(o>>>0<g>>>0)){o=e;break e}o=o+1|0}for(l=1,o=e;A=0|dd(7,0,0|(e=3*(15-l|0)|0)),i=o&~(0|w()),o=0|Ct(0|a,0|o,0|e),w(),a=a&~A|(o=0|dd(0|ce(7&o),0,0|e)),o=0|i|w(),l>>>0<g>>>0;)l=l+1|0}else o=e}while(0);if(i=7728+(28*c|0)|0,b[t>>2]=b[i>>2],b[t+4>>2]=b[i+4>>2],b[t+8>>2]=b[i+8>>2],b[t+12>>2]=b[i+12>>2],0|Ne(a,o,t)){if(A=t+4|0,b[r>>2]=b[A>>2],b[r+4>>2]=b[A+4>>2],b[r+8>>2]=b[A+8>>2],g=0|Ct(0|a,0|o,52),w(),i=15&g,1&g?(oe(A),g=i+1|0):g=i,0|R(c)){e:do{if(i)for(e=1;;){if(l=0|Ct(0|a,0|o,3*(15-e|0)|0),w(),0|(l&=7)){o=l;break e}if(!(e>>>0<i>>>0)){o=0;break}e=e+1|0}else o=0}while(0);o=4==(0|o)&1}else o=0;if(0|we(t,g,o,0)){if(0|R(c))do{}while(0!=(0|we(t,g,0,0)));(0|g)!=(0|i)&&re(A)}else(0|g)!=(0|i)&&(b[A>>2]=b[r>>2],b[A+4>>2]=b[r+4>>2],b[A+8>>2]=b[r+8>>2]);k=n}else k=n}function qe(a,b,e){e|=0;var t,r;t=k,k=k+16|0,Ze(a|=0,b|=0,r=t),b=0|Ct(0|a,0|b,52),w(),xe(r,15&b,e),k=t}function $e(a,b,e){e|=0;var t,g,r=0,n=0;g=k,k=k+16|0,Ze(a|=0,b|=0,t=g),r=0|Ct(0|a,0|b,45),w(),r=0==(0|R(127&r)),n=0|Ct(0|a,0|b,52),w(),n&=15;e:do{if(!r){if(0|n)for(r=1;;){if(!(0==((0|dd(7,0,3*(15-r|0)|0))&a|0)&0==((0|w())&b|0)))break e;if(!(r>>>0<n>>>0))break;r=r+1|0}return ve(t,n,0,5,e),void(k=g)}}while(0);Ee(t,n,0,6,e),k=g}function Qe(a,e){e|=0;var i,t=0,r=0,n=0,g=0,o=0,l=0;if(dd(0|(a|=0),0,52),i=134225919|w(),(0|a)<1){r=0,t=0;do{0|R(r)&&(dd(0|r,0,45),o=0|i|w(),b[(a=e+(t<<3)|0)>>2]=-1,b[a+4>>2]=o,t=t+1|0),r=r+1|0}while(122!=(0|r))}else{o=0,t=0;do{if(0|R(o)){for(dd(0|o,0,45),r=1,n=-1,g=0|i|w();n&=~(l=0|dd(7,0,3*(15-r|0)|0)),g&=~(0|w()),(0|r)!=(0|a);)r=r+1|0;b[(l=e+(t<<3)|0)>>2]=n,b[l+4>>2]=g,t=t+1|0}o=o+1|0}while(122!=(0|o))}}function He(a,e,t,r){var i,n=0,g=0,o=0,l=0,A=0;if(i=k,k=k+64|0,o=i,(0|(a|=0))==(0|(t|=0))&(0|(e|=0))==(0|(r|=0))|!1|134217728!=(2013265920&e|0)|!1|134217728!=(2013265920&r|0))return k=i,0|(o=0);if(n=0|Ct(0|a,0|e,52),w(),n&=15,g=0|Ct(0|t,0|r,52),w(),(0|n)!=(15&g|0))return k=i,0|(o=0);if(g=n+-1|0,n>>>0>1&&(A=0|Be(a,e,g),l=0|w(),(0|A)==(0|(g=0|Be(t,r,g)))&(0|l)==(0|w()))){if(n=0|Ct(0|a,0|e,0|(g=3*(15^n)|0)),w(),n&=7,g=0|Ct(0|t,0|r,0|g),w(),0==(0|n)|0==(0|(g&=7)))return k=i,0|(A=1);if((0|b[21136+(n<<2)>>2])==(0|g))return k=i,0|(A=1);if((0|b[21168+(n<<2)>>2])==(0|g))return k=i,0|(A=1)}g=(n=o)+56|0;do{b[n>>2]=0,n=n+4|0}while((0|n)<(0|g));return z(a,e,1,o),n=(0|b[(A=o)>>2])==(0|t)&&(0|b[A+4>>2])==(0|r)||(0|b[(A=o+8|0)>>2])==(0|t)&&(0|b[A+4>>2])==(0|r)||(0|b[(A=o+16|0)>>2])==(0|t)&&(0|b[A+4>>2])==(0|r)||(0|b[(A=o+24|0)>>2])==(0|t)&&(0|b[A+4>>2])==(0|r)||(0|b[(A=o+32|0)>>2])==(0|t)&&(0|b[A+4>>2])==(0|r)||(0|b[(A=o+40|0)>>2])==(0|t)&&(0|b[A+4>>2])==(0|r)?1:1&((0|b[(n=o+48|0)>>2])==(0|t)?(0|b[n+4>>2])==(0|r):0),k=i,0|(A=n)}function We(a,e,t){t|=0;var r,g,n,i,o=0;if(n=k,k=k+16|0,g=n,o=0|Ct(0|(a|=0),0|(e|=0),56),w(),e=0|function(a,e,t){t|=0;var r=0,n=0;if(r=0|Le(a=a|0,e=e|0),(t+-1|0)>>>0>5)return 0|(t=-1);if(1==(0|t)&(n=0!=(0|r)))return 0|(t=-1);return r=0|function(a,e){var t=0,r=0,n=0,g=0,o=0,i=0,l=0,A=0;if(A=k,k=k+32|0,g=A,Ze(a=a|0,e=e|0,n=A+16|0),o=0|ze(a,e),l=0|Re(a,e),function(a,e){a=7728+(28*(a|=0)|0)|0,b[(e|=0)>>2]=b[a>>2],b[e+4>>2]=b[a+4>>2],b[e+8>>2]=b[a+8>>2],b[e+12>>2]=b[a+12>>2]}(o,g),e=0|function(a,e){a|=0;var t=0,r=0;if((e|=0)>>>0>20)return-1;do{if((0|b[11152+(216*e|0)>>2])!=(0|a))if((0|b[11152+(216*e|0)+8>>2])!=(0|a))if((0|b[11152+(216*e|0)+16>>2])!=(0|a))if((0|b[11152+(216*e|0)+24>>2])!=(0|a))if((0|b[11152+(216*e|0)+32>>2])!=(0|a))if((0|b[11152+(216*e|0)+40>>2])!=(0|a))if((0|b[11152+(216*e|0)+48>>2])!=(0|a))if((0|b[11152+(216*e|0)+56>>2])!=(0|a))if((0|b[11152+(216*e|0)+64>>2])!=(0|a))if((0|b[11152+(216*e|0)+72>>2])!=(0|a))if((0|b[11152+(216*e|0)+80>>2])!=(0|a))if((0|b[11152+(216*e|0)+88>>2])!=(0|a))if((0|b[11152+(216*e|0)+96>>2])!=(0|a))if((0|b[11152+(216*e|0)+104>>2])!=(0|a))if((0|b[11152+(216*e|0)+112>>2])!=(0|a))if((0|b[11152+(216*e|0)+120>>2])!=(0|a))if((0|b[11152+(216*e|0)+128>>2])!=(0|a)){if((0|b[11152+(216*e|0)+136>>2])!=(0|a)){if((0|b[11152+(216*e|0)+144>>2])==(0|a)){a=0,t=2,r=0;break}if((0|b[11152+(216*e|0)+152>>2])==(0|a)){a=0,t=2,r=1;break}if((0|b[11152+(216*e|0)+160>>2])==(0|a)){a=0,t=2,r=2;break}if((0|b[11152+(216*e|0)+168>>2])==(0|a)){a=1,t=2,r=0;break}if((0|b[11152+(216*e|0)+176>>2])==(0|a)){a=1,t=2,r=1;break}if((0|b[11152+(216*e|0)+184>>2])==(0|a)){a=1,t=2,r=2;break}if((0|b[11152+(216*e|0)+192>>2])==(0|a)){a=2,t=2,r=0;break}if((0|b[11152+(216*e|0)+200>>2])==(0|a)){a=2,t=2,r=1;break}if((0|b[11152+(216*e|0)+208>>2])==(0|a)){a=2,t=2,r=2;break}return-1}a=2,t=1,r=2}else a=2,t=1,r=1;else a=2,t=1,r=0;else a=1,t=1,r=2;else a=1,t=1,r=1;else a=1,t=1,r=0;else a=0,t=1,r=2;else a=0,t=1,r=1;else a=0,t=1,r=0;else a=2,t=0,r=2;else a=2,t=0,r=1;else a=2,t=0,r=0;else a=1,t=0,r=2;else a=1,t=0,r=1;else a=1,t=0,r=0;else a=0,t=0,r=2;else a=0,t=0,r=1;else a=0,t=0,r=0}while(0);return 0|b[11152+(216*e|0)+(72*t|0)+(24*a|0)+(r<<3)+4>>2]}(o,0|b[n>>2]),!(0|R(o)))return k=A,0|(l=e);switch(0|o){case 4:a=0,t=14;break;case 14:a=1,t=14;break;case 24:a=2,t=14;break;case 38:a=3,t=14;break;case 49:a=4,t=14;break;case 58:a=5,t=14;break;case 63:a=6,t=14;break;case 72:a=7,t=14;break;case 83:a=8,t=14;break;case 97:a=9,t=14;break;case 107:a=10,t=14;break;case 117:a=11,t=14;break;default:i=0,r=0}14==(0|t)&&(i=0|b[22096+(24*a|0)+8>>2],r=0|b[22096+(24*a|0)+16>>2]);(0|(a=0|b[n>>2]))!=(0|b[g>>2])&&(o=0|F(o))|(0|(a=0|b[n>>2]))==(0|r)&&(e=(e+1|0)%6|0);if(3==(0|l)&(0|a)==(0|r))return k=A,0|(l=(e+5|0)%6|0);if(!(5==(0|l)&(0|a)==(0|i)))return k=A,0|(l=e);return k=A,0|(l=(e+1|0)%6|0)}(a,e),n?0|(t=(5-r+(0|b[22384+(t<<2)>>2])|0)%5|0):0|(t=(6-r+(0|b[22416+(t<<2)>>2])|0)%6|0)}(r=(i=!0&268435456==(2013265920&e|0))?a:0,a=i?-2130706433&e|134217728:0,7&o),-1==(0|e))return b[t>>2]=0,void(k=n);Ze(r,a,g),o=0|Ct(0|r,0|a,52),w(),o&=15,0|Le(r,a)?ve(g,o,e,2,t):Ee(g,o,e,2,t),k=n}function Xe(a){a|=0;var e,t,r=0;return(e=0|bt(1,12))||T(22691,22646,49,22704),0|(r=0|b[(t=a+4|0)>>2])?(b[(r=r+8|0)>>2]=e,b[t>>2]=e,0|e):(0|b[a>>2]&&T(22721,22646,61,22744),b[(r=a)>>2]=e,b[t>>2]=e,0|e)}function Ye(a,e){a|=0,e|=0;var t,r;return(r=0|xt(24))||T(22758,22646,78,22772),b[r>>2]=b[e>>2],b[r+4>>2]=b[e+4>>2],b[r+8>>2]=b[e+8>>2],b[r+12>>2]=b[e+12>>2],b[r+16>>2]=0,0|(t=0|b[(e=a+4|0)>>2])?(b[t+16>>2]=r,b[e>>2]=r,0|r):(0|b[a>>2]&&T(22787,22646,82,22772),b[a>>2]=r,b[e>>2]=r,0|r)}function Ke(a){var e,t,r=0,o=0,l=0,g=0,A=0,i=0,c=0,h=0,d=0,f=0,m=0,_=0,p=0,y=0,s=0,x=0,u=0,v=0,w=0,E=0,M=0,C=0,I=0,S=0,k=0,z=0,D=0,B=0,P=0,L=0;if(0|b[(g=(a|=0)+8|0)>>2])return 0|(L=1);if(!(l=0|b[a>>2]))return 0|(L=0);r=l,o=0;do{o=o+1|0,r=0|b[r+8>>2]}while(0!=(0|r));if(o>>>0<2)return 0|(L=0);(t=0|xt(o<<2))||T(22807,22646,317,22826),(e=0|xt(o<<5))||T(22848,22646,321,22826),b[a>>2]=0,b[(C=a+4|0)>>2]=0,b[g>>2]=0,o=0,B=0,M=0,m=0;e:for(;;){if(f=0|b[l>>2]){A=0,i=f;do{if(h=+n[i+8>>3],r=i,i=0|b[i+16>>2],c=+n[(g=(d=0==(0|i))?f:i)+8>>3],+q(+(h-c))>3.141592653589793){L=14;break}A+=(c-h)*(+n[r>>3]+ +n[g>>3])}while(!d);if(14==(0|L)){L=0,A=0,r=f;do{E=+n[r+8>>3],z=0|b[(D=r+16|0)>>2],w=+n[(z=0==(0|z)?f:z)+8>>3],A+=(+n[r>>3]+ +n[z>>3])*((w<0?w+6.283185307179586:w)-(E<0?E+6.283185307179586:E)),r=0|b[(0==(0|r)?l:D)>>2]}while(0!=(0|r))}A>0?(b[t+(B<<2)>>2]=l,B=B+1|0,g=M,r=m):L=19}else L=19;if(19==(0|L)){L=0;do{if(!o){if(m){g=C,i=m+8|0,r=l,o=a;break}if(0|b[a>>2]){L=27;break e}g=C,i=a,r=l,o=a;break}if(0|b[(r=o+8|0)>>2]){L=21;break e}if(!(o=0|bt(1,12))){L=23;break e}b[r>>2]=o,g=o+4|0,i=o,r=m}while(0);if(b[i>>2]=l,b[g>>2]=l,i=e+(M<<5)|0,d=0|b[l>>2]){for(n[(f=e+(M<<5)+8|0)>>3]=17976931348623157e292,n[(m=e+(M<<5)+24|0)>>3]=17976931348623157e292,n[i>>3]=-17976931348623157e292,n[(_=e+(M<<5)+16|0)>>3]=-17976931348623157e292,u=17976931348623157e292,v=-17976931348623157e292,g=0,p=d,h=17976931348623157e292,s=17976931348623157e292,x=-17976931348623157e292,c=-17976931348623157e292;A=+n[p>>3],E=+n[p+8>>3],p=0|b[p+16>>2],w=+n[((y=0==(0|p))?d:p)+8>>3],A<h&&(n[f>>3]=A,h=A),E<s&&(n[m>>3]=E,s=E),A>x?n[i>>3]=A:A=x,E>c&&(n[_>>3]=E,c=E),u=E>0&E<u?E:u,v=E<0&E>v?E:v,g|=+q(+(E-w))>3.141592653589793,!y;)x=A;g&&(n[_>>3]=v,n[m>>3]=u)}else b[i>>2]=0,b[i+4>>2]=0,b[i+8>>2]=0,b[i+12>>2]=0,b[i+16>>2]=0,b[i+20>>2]=0,b[i+24>>2]=0,b[i+28>>2]=0;g=M+1|0}if(l=0|b[(D=l+8|0)>>2],b[D>>2]=0,!l){L=45;break}M=g,m=r}if(21==(0|L))T(22624,22646,35,22658);else if(23==(0|L))T(22678,22646,37,22658);else if(27==(0|L))T(22721,22646,61,22744);else if(45==(0|L)){e:do{if((0|B)>0){for(D=0==(0|g),k=g<<2,z=0==(0|a),S=0,r=0;;){if(I=0|b[t+(S<<2)>>2],D)L=73;else{if(!(M=0|xt(k))){L=50;break}if(!(C=0|xt(k))){L=52;break}t:do{if(z)o=0;else{for(g=0,o=0,i=a;l=e+(g<<5)|0,0|Je(0|b[i>>2],l,0|b[I>>2])?(b[M+(o<<2)>>2]=i,b[C+(o<<2)>>2]=l,y=o+1|0):y=o,i=0|b[i+8>>2];)g=g+1|0,o=y;if((0|y)>0)if(l=0|b[M>>2],1==(0|y))o=l;else for(_=0,p=-1,o=l,m=l;;){for(d=0|b[m>>2],l=0,i=0;f=(0|(g=0|b[b[M+(i<<2)>>2]>>2]))==(0|d)?l:l+(1&(0|Je(g,0|b[C+(i<<2)>>2],0|b[d>>2])))|0,(0|(i=i+1|0))!=(0|y);)l=f;if(o=(g=(0|f)>(0|p))?m:o,(0|(l=_+1|0))==(0|y))break t;_=l,p=g?f:p,m=0|b[M+(l<<2)>>2]}else o=0}}while(0);if(vt(M),vt(C),o){if(l=0|b[(g=o+4|0)>>2])o=l+8|0;else if(0|b[o>>2]){L=70;break}b[o>>2]=I,b[g>>2]=I}else L=73}if(73==(0|L)){if(L=0,0|(r=0|b[I>>2]))do{C=r,r=0|b[r+16>>2],vt(C)}while(0!=(0|r));vt(I),r=2}if((0|(S=S+1|0))>=(0|B)){P=r;break e}}50==(0|L)?T(22863,22646,249,22882):52==(0|L)?T(22901,22646,252,22882):70==(0|L)&&T(22721,22646,61,22744)}else P=0}while(0);return vt(t),vt(e),0|(L=P)}return 0}function Je(a,e,t){a|=0;var r,o=0,g=0,l=0,i=0,A=0,c=0,h=0;if(!(0|Z(e|=0,t|=0)))return 0|(a=0);if(e=0|N(e),r=+n[t>>3],o=e&(o=+n[t+8>>3])<0?o+6.283185307179586:o,!(a=0|b[a>>2]))return 0|(a=0);if(e){e=0,t=a;e:for(;;){for(;i=+n[t>>3],c=+n[t+8>>3],h=0|b[(t=t+16|0)>>2],l=+n[(h=0==(0|h)?a:h)>>3],g=+n[h+8>>3],i>l?(A=i,i=c):(A=l,l=i,i=g,g=c),r<l|r>A;)if(!(t=0|b[t>>2])){t=22;break e}if(o=(i=i<0?i+6.283185307179586:i)==o|(c=g<0?g+6.283185307179586:g)==o?o+-2220446049250313e-31:o,((c+=(r-l)/(A-l)*(i-c))<0?c+6.283185307179586:c)>o&&(e^=1),!(t=0|b[t>>2])){t=22;break}}if(22==(0|t))return 0|e}else{e=0,t=a;e:for(;;){for(;i=+n[t>>3],c=+n[t+8>>3],h=0|b[(t=t+16|0)>>2],l=+n[(h=0==(0|h)?a:h)>>3],g=+n[h+8>>3],i>l?(A=i,i=c):(A=l,l=i,i=g,g=c),r<l|r>A;)if(!(t=0|b[t>>2])){t=22;break e}if(g+(r-l)/(A-l)*(i-g)>(o=i==o|g==o?o+-2220446049250313e-31:o)&&(e^=1),!(t=0|b[t>>2])){t=22;break}}if(22==(0|t))return 0|e}return 0}function et(e,t,r,n,g){r|=0,n|=0,g|=0;var o,l,s,u,A=0,i=0,c=0,h=0,d=0,f=0,p=0,q=0,m=0,_=0;if(u=k,k=k+32|0,_=u+16|0,s=u,A=0|Ct(0|(e|=0),0|(t|=0),52),w(),A&=15,p=0|Ct(0|r,0|n,52),w(),(0|A)!=(15&p|0))return k=u,0|(_=1);if(d=0|Ct(0|e,0|t,45),w(),d&=127,f=0|Ct(0|r,0|n,45),w(),p=(0|d)!=(0|(f&=127))){if(7==(0|(c=0|G(d,f))))return k=u,0|(_=2);7==(0|(h=0|G(f,d)))?T(22925,22949,151,22959):(q=c,i=h)}else q=0,i=0;o=0|R(d),l=0|R(f),b[_>>2]=0,b[_+4>>2]=0,b[_+8>>2]=0,b[_+12>>2]=0;do{if(q){if(c=(0|(f=0|b[4304+(28*d|0)+(q<<2)>>2]))>0,l)if(c){d=0,h=r,c=n;do{h=0|Ue(h,c),c=0|w(),1==(0|(i=0|ce(i)))&&(i=0|ce(1)),d=d+1|0}while((0|d)!=(0|f));f=i,d=h,h=c}else f=i,d=r,h=n;else if(c){d=0,h=r,c=n;do{h=0|Ve(h,c),c=0|w(),i=0|ce(i),d=d+1|0}while((0|d)!=(0|f));f=i,d=h,h=c}else f=i,d=r,h=n;if(Ne(d,h,_),p||T(22972,22949,181,22959),(c=0!=(0|o))&(i=0!=(0|l))&&T(22999,22949,182,22959),c){if(i=0|Re(e,t),0|a[22032+(7*i|0)+q>>0]){A=3;break}d=h=0|b[21200+(28*i|0)+(q<<2)>>2],m=26}else if(i){if(i=0|Re(d,h),0|a[22032+(7*i|0)+f>>0]){A=4;break}d=0,h=0|b[21200+(28*f|0)+(i<<2)>>2],m=26}else i=0;if(26==(0|m))if((0|h)<=-1&&T(23030,22949,212,22959),(0|d)<=-1&&T(23053,22949,213,22959),(0|h)>0){c=_+4|0,i=0;do{le(c),i=i+1|0}while((0|i)!=(0|h));i=d}else i=d;if(b[s>>2]=0,b[s+4>>2]=0,b[s+8>>2]=0,ae(s,q),0|A)for(;0|je(A)?ne(s):oe(s),(0|A)>1;)A=A+-1|0;if((0|i)>0){A=0;do{le(s),A=A+1|0}while((0|A)!=(0|i))}K(m=_+4|0,s,m),X(m),m=50}else if(Ne(r,n,_),0!=(0|o)&0!=(0|l))if((0|f)!=(0|d)&&T(23077,22949,243,22959),i=0|Re(e,t),A=0|Re(r,n),0|a[22032+(7*i|0)+A>>0])A=5;else if((0|(i=0|b[21200+(28*i|0)+(A<<2)>>2]))>0){c=_+4|0,A=0;do{le(c),A=A+1|0}while((0|A)!=(0|i));m=50}else m=50;else m=50}while(0);return 50==(0|m)&&(A=_+4|0,b[g>>2]=b[A>>2],b[g+4>>2]=b[A+4>>2],b[g+8>>2]=b[A+8>>2],A=0),k=u,0|(_=A)}function tt(a,e,t,r){t|=0,r|=0;var n,p,o=0,g=0,l=0,i=0,A=0,c=0,h=0,d=0,f=0,q=0,m=0,s=0,_=0;if(p=k,k=k+48|0,l=p+36|0,i=p+24|0,A=p+12|0,c=p,g=0|Ct(0|(a|=0),0|(e|=0),52),w(),g&=15,d=0|Ct(0|a,0|e,45),w(),n=0|R(d&=127),dd(0|g,0,52),m=134225919|w(),b[(q=r)>>2]=-1,b[q+4>>2]=m,!g)return(0|b[t>>2])>1||(0|b[t+4>>2])>1||(0|b[t+8>>2])>1||127==(0|(o=0|j(d,0|te(t))))?(k=p,0|(m=1)):(f=0|dd(0|o,0,45),q=0|w(),q=-1040385&b[(d=r)+4>>2]|q,b[(m=r)>>2]=b[d>>2]|f,b[m+4>>2]=q,k=p,0|(m=0));for(b[l>>2]=b[t>>2],b[l+4>>2]=b[t+4>>2],b[l+8>>2]=b[t+8>>2];b[i>>2]=b[l>>2],b[i+4>>2]=b[l+4>>2],b[i+8>>2]=b[l+8>>2],0|je(g)?(ie(l),b[A>>2]=b[l>>2],b[A+4>>2]=b[l+4>>2],b[A+8>>2]=b[l+8>>2],ne(A)):(re(l),b[A>>2]=b[l>>2],b[A+4>>2]=b[l+4>>2],b[A+8>>2]=b[l+8>>2],oe(A)),J(i,A,c),X(c),s=0|b[(q=r)>>2],q=0|b[q+4>>2],t=0|dd(7,0,0|(_=3*(15-g|0)|0)),q&=~(0|w()),_=0|dd(0|te(c),0,0|_),q=0|w()|q,b[(m=r)>>2]=_|s&~t,b[m+4>>2]=q,(0|g)>1;)g=g+-1|0;e:do{if((0|b[l>>2])<=1&&(0|b[l+4>>2])<=1&&(0|b[l+8>>2])<=1){c=127==(0|(i=0|j(d,g=0|te(l))))?0:0|R(i);t:do{if(g){if(n){if(l=21408+(28*(0|Re(a,e))|0)+(g<<2)|0,(0|(l=0|b[l>>2]))>0){t=0;do{g=0|Ae(g),t=t+1|0}while((0|t)!=(0|l))}if(1==(0|g)){o=3;break e}127==(0|(t=0|j(d,g)))&&T(23104,22949,376,23134),0|R(t)?T(23147,22949,377,23134):(f=l,h=g,o=t)}else f=0,h=g,o=i;if((0|(A=0|b[4304+(28*d|0)+(h<<2)>>2]))<=-1&&T(23178,22949,384,23134),!c){if((0|f)<=-1&&T(23030,22949,417,23134),0|f){g=0,t=0|b[(l=r)>>2],l=0|b[l+4>>2];do{t=0|Oe(t,l),l=0|w(),b[(_=r)>>2]=t,b[_+4>>2]=l,g=g+1|0}while((0|g)<(0|f))}if((0|A)<=0){g=54;break}for(g=0,t=0|b[(l=r)>>2],l=0|b[l+4>>2];;)if(t=0|Oe(t,l),l=0|w(),b[(_=r)>>2]=t,b[_+4>>2]=l,(0|(g=g+1|0))==(0|A)){g=54;break t}}if(7==(0|(i=0|G(o,d)))&&T(22925,22949,393,23134),t=0|b[(g=r)>>2],g=0|b[g+4>>2],(0|A)>0){l=0;do{t=0|Oe(t,g),g=0|w(),b[(_=r)>>2]=t,b[_+4>>2]=g,l=l+1|0}while((0|l)!=(0|A))}if(t=0|Re(t,g),_=0|F(o),(0|(t=0|b[(_?21824:21616)+(28*i|0)+(t<<2)>>2]))<=-1&&T(23030,22949,412,23134),t){g=0,l=0|b[(i=r)>>2],i=0|b[i+4>>2];do{l=0|Fe(l,i),i=0|w(),b[(_=r)>>2]=l,b[_+4>>2]=i,g=g+1|0}while((0|g)<(0|t));g=54}else g=54}else if(0!=(0|n)&0!=(0|c))if(g=21408+(28*(_=0|Re(a,e))|0)+((0|Re(0|b[(g=r)>>2],0|b[g+4>>2]))<<2)|0,(0|(g=0|b[g>>2]))<=-1&&T(23201,22949,433,23134),g){o=0,t=0|b[(l=r)>>2],l=0|b[l+4>>2];do{t=0|Oe(t,l),l=0|w(),b[(_=r)>>2]=t,b[_+4>>2]=l,o=o+1|0}while((0|o)<(0|g));o=i,g=54}else o=i,g=55;else o=i,g=54}while(0);if(54==(0|g)&&c&&(g=55),55==(0|g)&&1==(0|Re(0|b[(_=r)>>2],0|b[_+4>>2]))){o=4;break}m=0|b[(_=r)>>2],_=-1040385&b[_+4>>2],s=0|dd(0|o,0,45),_=0|_|w(),b[(o=r)>>2]=m|s,b[o+4>>2]=_,o=0}else o=2}while(0);return k=p,0|(_=o)}function it(a,b){var e=0;if(!(b|=0))return 0|(e=1);e=a|=0,a=1;do{a=0|_(0==(1&b|0)?1:e,a),b>>=1,e=0|_(e,e)}while(0!=(0|b));return 0|a}function nt(a,e,t){a|=0;var r,o,l=0,g=0,A=0,i=0,c=0,h=0,d=0,f=0;if(!(0|Z(e|=0,t|=0)))return 0|(f=0);if(e=0|N(e),o=+n[t>>3],l=e&(l=+n[t+8>>3])<0?l+6.283185307179586:l,(0|(f=0|b[a>>2]))<=0)return 0|(f=0);if(r=0|b[a+4>>2],e){e=0,t=-1,a=0;e:for(;;){for(d=a;i=+n[r+(d<<4)>>3],h=+n[r+(d<<4)+8>>3],A=+n[r+((a=(t+2|0)%(0|f)|0)<<4)>>3],g=+n[r+(a<<4)+8>>3],i>A?(c=i,i=h):(c=A,A=i,i=g,g=h),o<A|o>c;){if(!((0|(t=d+1|0))<(0|f))){t=22;break e}a=d,d=t,t=a}if(l=(i=i<0?i+6.283185307179586:i)==l|(h=g<0?g+6.283185307179586:g)==l?l+-2220446049250313e-31:l,((h+=(o-A)/(c-A)*(i-h))<0?h+6.283185307179586:h)>l&&(e^=1),(0|(a=d+1|0))>=(0|f)){t=22;break}t=d}if(22==(0|t))return 0|e}else{e=0,t=-1,a=0;e:for(;;){for(d=a;i=+n[r+(d<<4)>>3],h=+n[r+(d<<4)+8>>3],A=+n[r+((a=(t+2|0)%(0|f)|0)<<4)>>3],g=+n[r+(a<<4)+8>>3],i>A?(c=i,i=h):(c=A,A=i,i=g,g=h),o<A|o>c;){if(!((0|(t=d+1|0))<(0|f))){t=22;break e}a=d,d=t,t=a}if(g+(o-A)/(c-A)*(i-g)>(l=i==l|g==l?l+-2220446049250313e-31:l)&&(e^=1),(0|(a=d+1|0))>=(0|f)){t=22;break}t=d}if(22==(0|t))return 0|e}return 0}function ot(a,e){e|=0;var t,r,s,o,u,l=0,A=0,g=0,c=0,i=0,h=0,d=0,f=0,m=0,_=0,p=0,y=0;if(!(r=0|b[(a|=0)>>2]))return b[e>>2]=0,b[e+4>>2]=0,b[e+8>>2]=0,b[e+12>>2]=0,b[e+16>>2]=0,b[e+20>>2]=0,b[e+24>>2]=0,void(b[e+28>>2]=0);if(n[(s=e+8|0)>>3]=17976931348623157e292,n[(o=e+24|0)>>3]=17976931348623157e292,n[e>>3]=-17976931348623157e292,n[(u=e+16|0)>>3]=-17976931348623157e292,!((0|r)<=0)){for(t=0|b[a+4>>2],f=17976931348623157e292,m=-17976931348623157e292,_=0,a=-1,c=17976931348623157e292,i=17976931348623157e292,d=-17976931348623157e292,A=-17976931348623157e292,p=0;l=+n[t+(p<<4)>>3],h=+n[t+(p<<4)+8>>3],g=+n[t+(((0|(a=a+2|0))==(0|r)?0:a)<<4)+8>>3],l<c&&(n[s>>3]=l,c=l),h<i&&(n[o>>3]=h,i=h),l>d?n[e>>3]=l:l=d,h>A&&(n[u>>3]=h,A=h),f=h>0&h<f?h:f,m=h<0&h>m?h:m,_|=+q(+(h-g))>3.141592653589793,(0|(a=p+1|0))!=(0|r);)y=p,d=l,p=a,a=y;_&&(n[u>>3]=m,n[o>>3]=f)}}function at(a,e){e|=0;var t,r=0,o=0,g=0,l=0,i=0,A=0,c=0,h=0,d=0,f=0,m=0,p=0,_=0,s=0,y=0,u=0,x=0,v=0,w=0,T=0,E=0;if(_=0|b[(a|=0)>>2]){if(n[(s=e+8|0)>>3]=17976931348623157e292,n[(y=e+24|0)>>3]=17976931348623157e292,n[e>>3]=-17976931348623157e292,n[(u=e+16|0)>>3]=-17976931348623157e292,(0|_)>0){for(g=0|b[a+4>>2],m=17976931348623157e292,p=-17976931348623157e292,o=0,r=-1,c=17976931348623157e292,h=17976931348623157e292,f=-17976931348623157e292,i=-17976931348623157e292,x=0;l=+n[g+(x<<4)>>3],d=+n[g+(x<<4)+8>>3],A=+n[g+(((0|(T=r+2|0))==(0|_)?0:T)<<4)+8>>3],l<c&&(n[s>>3]=l,c=l),d<h&&(n[y>>3]=d,h=d),l>f?n[e>>3]=l:l=f,d>i&&(n[u>>3]=d,i=d),m=d>0&d<m?d:m,p=d<0&d>p?d:p,o|=+q(+(d-A))>3.141592653589793,(0|(r=x+1|0))!=(0|_);)T=x,f=l,x=r,r=T;o&&(n[u>>3]=p,n[y>>3]=m)}}else b[e>>2]=0,b[e+4>>2]=0,b[e+8>>2]=0,b[e+12>>2]=0,b[e+16>>2]=0,b[e+20>>2]=0,b[e+24>>2]=0,b[e+28>>2]=0;if(!((0|(r=0|b[(T=a+8|0)>>2]))<=0)){t=a+12|0,w=0;do{if(g=0|b[t>>2],o=w,y=e+((w=w+1|0)<<5)|0,u=0|b[g+(o<<3)>>2]){if(n[(x=e+(w<<5)+8|0)>>3]=17976931348623157e292,n[(a=e+(w<<5)+24|0)>>3]=17976931348623157e292,n[y>>3]=-17976931348623157e292,n[(v=e+(w<<5)+16|0)>>3]=-17976931348623157e292,(0|u)>0){for(_=0|b[g+(o<<3)+4>>2],m=17976931348623157e292,p=-17976931348623157e292,g=0,o=-1,s=0,c=17976931348623157e292,h=17976931348623157e292,d=-17976931348623157e292,i=-17976931348623157e292;l=+n[_+(s<<4)>>3],f=+n[_+(s<<4)+8>>3],A=+n[_+(((0|(o=o+2|0))==(0|u)?0:o)<<4)+8>>3],l<c&&(n[x>>3]=l,c=l),f<h&&(n[a>>3]=f,h=f),l>d?n[y>>3]=l:l=d,f>i&&(n[v>>3]=f,i=f),m=f>0&f<m?f:m,p=f<0&f>p?f:p,g|=+q(+(f-A))>3.141592653589793,(0|(o=s+1|0))!=(0|u);)E=s,s=o,d=l,o=E;g&&(n[v>>3]=p,n[a>>3]=m)}}else b[y>>2]=0,b[y+4>>2]=0,b[y+8>>2]=0,b[y+12>>2]=0,b[y+16>>2]=0,b[y+20>>2]=0,b[y+24>>2]=0,b[y+28>>2]=0,r=0|b[T>>2]}while((0|w)<(0|r))}}function st(a,e,t){var r=0,n=0,g=0;if(!(0|nt(a|=0,e|=0,t|=0)))return 0|(n=0);if((0|b[(n=a+8|0)>>2])<=0)return 0|(n=1);for(r=a+12|0,a=0;;){if(g=a,a=a+1|0,0|nt((0|b[r>>2])+(g<<3)|0,e+(a<<5)|0,t)){a=0,r=6;break}if((0|a)>=(0|b[n>>2])){a=1,r=6;break}}return 6==(0|r)?0|a:0}function lt(a,b,e,t,r){b|=0,e|=0,t|=0,r|=0;var o,i,l,A,c,h,d,g=0;A=+n[(a|=0)>>3],l=+n[b>>3]-A,i=+n[a+8>>3],o=+n[b+8>>3]-i,h=+n[e>>3],g=((g=+n[t>>3]-h)*(i-(d=+n[e+8>>3]))-(A-h)*(c=+n[t+8>>3]-d))/(l*c-o*g),n[r>>3]=A+l*g,n[r+8>>3]=i+o*g}function At(a,b){return b|=0,+n[(a|=0)>>3]!=+n[b>>3]?0|(b=0):0|(b=+n[a+8>>3]==+n[b+8>>3])}function ct(a,b){b|=0;var e,t,r;return+((r=+n[(a|=0)>>3]-+n[b>>3])*r+(t=+n[a+8>>3]-+n[b+8>>3])*t+(e=+n[a+16>>3]-+n[b+16>>3])*e)}function ut(a,e,t){a|=0,t|=0;var r=0;(0|(e|=0))>0?(r=0|bt(e,4),b[a>>2]=r,r||T(23230,23253,40,23267)):b[a>>2]=0,b[a+4>>2]=e,b[a+8>>2]=0,b[a+12>>2]=t}function ht(a){var g,e,i,t=0,r=0,o=0,l=0;g=(a|=0)+4|0,e=a+12|0,i=a+8|0;e:for(;;){for(r=0|b[g>>2],t=0;;){if((0|t)>=(0|r))break e;if(o=0|b[a>>2],l=0|b[o+(t<<2)>>2])break;t=t+1|0}t=o+(~~(+q(+ +s(10,+ +(15-(0|b[e>>2])|0))*(+n[l>>3]+ +n[l+8>>3]))%+(0|r))>>>0<<2)|0,r=0|b[t>>2];t:do{if(0|r){if(o=l+32|0,(0|r)==(0|l))b[t>>2]=b[o>>2];else{if(!(t=0|b[(r=r+32|0)>>2]))break;for(;(0|t)!=(0|l);)if(!(t=0|b[(r=t+32|0)>>2]))break t;b[r>>2]=b[o>>2]}vt(l),b[i>>2]=(0|b[i>>2])-1}}while(0)}vt(0|b[a>>2])}function pt(a){var e,t=0,r=0;for(e=0|b[(a|=0)+4>>2],r=0;;){if((0|r)>=(0|e)){t=0,r=4;break}if(t=0|b[(0|b[a>>2])+(r<<2)>>2]){r=4;break}r=r+1|0}return 4==(0|r)?0|t:0}function ft(a,e){e|=0;var t=0,r=0,g=0,o=0;if(t=~~(+q(+ +s(10,+ +(15-(0|b[(a|=0)+12>>2])|0))*(+n[e>>3]+ +n[e+8>>3]))%+(0|b[a+4>>2]))>>>0,t=(0|b[a>>2])+(t<<2)|0,!(r=0|b[t>>2]))return 0|(o=1);o=e+32|0;do{if((0|r)!=(0|e)){if(!(t=0|b[r+32>>2]))return 0|(o=1);for(g=t;;){if((0|g)==(0|e)){g=8;break}if(!(t=0|b[g+32>>2])){t=1,g=10;break}r=g,g=t}if(8==(0|g)){b[r+32>>2]=b[o>>2];break}if(10==(0|g))return 0|t}else b[t>>2]=b[o>>2]}while(0);return vt(e),b[(o=a+8|0)>>2]=(0|b[o>>2])-1,0|(o=0)}function mt(a,e,t){a|=0,e|=0,t|=0;var r,o=0,g=0,i=0;(r=0|xt(40))||T(23283,23253,98,23296),b[r>>2]=b[e>>2],b[r+4>>2]=b[e+4>>2],b[r+8>>2]=b[e+8>>2],b[r+12>>2]=b[e+12>>2],b[(g=r+16|0)>>2]=b[t>>2],b[g+4>>2]=b[t+4>>2],b[g+8>>2]=b[t+8>>2],b[g+12>>2]=b[t+12>>2],b[r+32>>2]=0,g=~~(+q(+ +s(10,+ +(15-(0|b[a+12>>2])|0))*(+n[e>>3]+ +n[e+8>>3]))%+(0|b[a+4>>2]))>>>0,g=(0|b[a>>2])+(g<<2)|0,o=0|b[g>>2];do{if(o){for(;!(0|Ie(o,e)&&0|Ie(o+16|0,t));)if(g=0|b[o+32>>2],!(0|b[(o=0==(0|g)?o:g)+32>>2])){i=10;break}if(10==(0|i)){b[o+32>>2]=r;break}return vt(r),0|(i=o)}b[g>>2]=r}while(0);return b[(i=a+8|0)>>2]=1+(0|b[i>>2]),0|(i=r)}function _t(a,e,t){e|=0,t|=0;var r=0,g=0;if(g=~~(+q(+ +s(10,+ +(15-(0|b[(a|=0)+12>>2])|0))*(+n[e>>3]+ +n[e+8>>3]))%+(0|b[a+4>>2]))>>>0,!(g=0|b[(0|b[a>>2])+(g<<2)>>2]))return 0|(t=0);if(!t){for(a=g;;){if(0|Ie(a,e)){r=10;break}if(!(a=0|b[a+32>>2])){a=0,r=10;break}}if(10==(0|r))return 0|a}for(a=g;;){if(0|Ie(a,e)&&0|Ie(a+16|0,t)){r=10;break}if(!(a=0|b[a+32>>2])){a=0,r=10;break}}return 10==(0|r)?0|a:0}function gt(a,e){e|=0;var t=0;if(t=~~(+q(+ +s(10,+ +(15-(0|b[(a|=0)+12>>2])|0))*(+n[e>>3]+ +n[e+8>>3]))%+(0|b[a+4>>2]))>>>0,!(a=0|b[(0|b[a>>2])+(t<<2)>>2]))return 0|(t=0);for(;;){if(0|Ie(a,e)){e=5;break}if(!(a=0|b[a+32>>2])){a=0,e=5;break}}return 5==(0|e)?0|a:0}function yt(a){return 0|~~+function(a){return+ +Dt(+(a=+a))}(a=+a)}function xt(a){a|=0;var e,t=0,r=0,n=0,o=0,g=0,l=0,i=0,A=0,c=0,h=0,d=0,f=0,m=0,p=0,q=0,_=0,s=0,y=0,u=0,x=0;e=k,k=k+16|0,f=e;do{if(a>>>0<245){if(a=(c=a>>>0<11?16:a+11&-8)>>>3,3&(r=(d=0|b[5829])>>>a)|0)return n=0|b[(r=(a=23356+((t=(1&r^1)+a|0)<<1<<2)|0)+8|0)>>2],(0|(g=0|b[(o=n+8|0)>>2]))==(0|a)?b[5829]=d&~(1<<t):(b[g+12>>2]=a,b[r>>2]=g),x=t<<3,b[n+4>>2]=3|x,b[(x=n+x+4|0)>>2]=1|b[x>>2],k=e,0|(x=o);if(c>>>0>(h=0|b[5831])>>>0){if(0|r)return t=((t=r<<a&((t=2<<a)|0-t))&0-t)-1|0,g=0|b[(a=(t=23356+((n=((r=(t>>>=i=t>>>12&16)>>>5&8)|i|(g=(t>>>=r)>>>2&4)|(a=(t>>>=g)>>>1&2)|(n=(t>>>=a)>>>1&1))+(t>>>n)|0)<<1<<2)|0)+8|0)>>2],(0|(r=0|b[(i=g+8|0)>>2]))==(0|t)?(a=d&~(1<<n),b[5829]=a):(b[r+12>>2]=t,b[a>>2]=r,a=d),l=(x=n<<3)-c|0,b[g+4>>2]=3|c,b[(o=g+c|0)+4>>2]=1|l,b[g+x>>2]=l,0|h&&(n=0|b[5834],r=23356+((t=h>>>3)<<1<<2)|0,a&(t=1<<t)?t=0|b[(a=r+8|0)>>2]:(b[5829]=a|t,t=r,a=r+8|0),b[a>>2]=n,b[t+12>>2]=n,b[n+8>>2]=t,b[n+12>>2]=r),b[5831]=l,b[5834]=o,k=e,0|(x=i);if(g=0|b[5830]){for(r=(g&0-g)-1|0,r=A=0|b[23620+(((n=(r>>>=o=r>>>12&16)>>>5&8)|o|(l=(r>>>=n)>>>2&4)|(i=(r>>>=l)>>>1&2)|(A=(r>>>=i)>>>1&1))+(r>>>A)<<2)>>2],i=A,A=(-8&b[A+4>>2])-c|0;(a=0|b[r+16>>2])||(a=0|b[r+20>>2]);)r=a,i=(o=(l=(-8&b[a+4>>2])-c|0)>>>0<A>>>0)?a:i,A=o?l:A;if((l=i+c|0)>>>0>i>>>0){o=0|b[i+24>>2],t=0|b[i+12>>2];do{if((0|t)==(0|i)){if(!(t=0|b[(a=i+20|0)>>2])&&!(t=0|b[(a=i+16|0)>>2])){r=0;break}for(;;)if(r=0|b[(n=t+20|0)>>2])t=r,a=n;else{if(!(r=0|b[(n=t+16|0)>>2]))break;t=r,a=n}b[a>>2]=0,r=t}else r=0|b[i+8>>2],b[r+12>>2]=t,b[t+8>>2]=r,r=t}while(0);do{if(0|o){if(t=0|b[i+28>>2],(0|i)==(0|b[(a=23620+(t<<2)|0)>>2])){if(b[a>>2]=r,!r){b[5830]=g&~(1<<t);break}}else if(b[((0|b[(x=o+16|0)>>2])==(0|i)?x:o+20|0)>>2]=r,!r)break;b[r+24>>2]=o,0|(t=0|b[i+16>>2])&&(b[r+16>>2]=t,b[t+24>>2]=r),0|(t=0|b[i+20>>2])&&(b[r+20>>2]=t,b[t+24>>2]=r)}}while(0);return A>>>0<16?(x=A+c|0,b[i+4>>2]=3|x,b[(x=i+x+4|0)>>2]=1|b[x>>2]):(b[i+4>>2]=3|c,b[l+4>>2]=1|A,b[l+A>>2]=A,0|h&&(n=0|b[5834],r=23356+((t=h>>>3)<<1<<2)|0,(t=1<<t)&d?t=0|b[(a=r+8|0)>>2]:(b[5829]=t|d,t=r,a=r+8|0),b[a>>2]=n,b[t+12>>2]=n,b[n+8>>2]=t,b[n+12>>2]=r),b[5831]=A,b[5834]=l),k=e,0|(x=i+8|0)}d=c}else d=c}else d=c}else if(a>>>0<=4294967231)if(c=-8&(a=a+11|0),n=0|b[5830]){o=0-c|0,A=(a>>>=8)?c>>>0>16777215?31:c>>>((A=14-((i=((q=a<<(d=(a+1048320|0)>>>16&8))+520192|0)>>>16&4)|d|(A=((q<<=i)+245760|0)>>>16&2))+(q<<A>>>15)|0)+7|0)&1|A<<1:0,r=0|b[23620+(A<<2)>>2];e:do{if(r)for(a=0,i=c<<(31==(0|A)?0:25-(A>>>1)|0),g=0;;){if((l=(-8&b[r+4>>2])-c|0)>>>0<o>>>0){if(!l){a=r,o=0,q=65;break e}a=r,o=l}if(g=0==(0|(q=0|b[r+20>>2]))|(0|q)==(0|(r=0|b[r+16+(i>>>31<<2)>>2]))?g:q,!r){r=g,q=61;break}i<<=1}else r=0,a=0,q=61}while(0);if(61==(0|q)){if(0==(0|r)&0==(0|a)){if(!(a=((a=2<<A)|0-a)&n)){d=c;break}d=(a&0-a)-1|0,a=0,r=0|b[23620+(((g=(d>>>=l=d>>>12&16)>>>5&8)|l|(i=(d>>>=g)>>>2&4)|(A=(d>>>=i)>>>1&2)|(r=(d>>>=A)>>>1&1))+(d>>>r)<<2)>>2]}r?q=65:(i=a,l=o)}if(65==(0|q))for(g=r;;){if(o=(r=(d=(-8&b[g+4>>2])-c|0)>>>0<o>>>0)?d:o,a=r?g:a,(r=0|b[g+16>>2])||(r=0|b[g+20>>2]),!r){i=a,l=o;break}g=r}if(0!=(0|i)&&l>>>0<((0|b[5831])-c|0)>>>0&&(h=i+c|0)>>>0>i>>>0){g=0|b[i+24>>2],t=0|b[i+12>>2];do{if((0|t)==(0|i)){if(!(t=0|b[(a=i+20|0)>>2])&&!(t=0|b[(a=i+16|0)>>2])){t=0;break}for(;;)if(r=0|b[(o=t+20|0)>>2])t=r,a=o;else{if(!(r=0|b[(o=t+16|0)>>2]))break;t=r,a=o}b[a>>2]=0}else x=0|b[i+8>>2],b[x+12>>2]=t,b[t+8>>2]=x}while(0);do{if(g){if(a=0|b[i+28>>2],(0|i)==(0|b[(r=23620+(a<<2)|0)>>2])){if(b[r>>2]=t,!t){n&=~(1<<a),b[5830]=n;break}}else if(b[((0|b[(x=g+16|0)>>2])==(0|i)?x:g+20|0)>>2]=t,!t)break;b[t+24>>2]=g,0|(a=0|b[i+16>>2])&&(b[t+16>>2]=a,b[a+24>>2]=t),(a=0|b[i+20>>2])&&(b[t+20>>2]=a,b[a+24>>2]=t)}}while(0);e:do{if(l>>>0<16)x=l+c|0,b[i+4>>2]=3|x,b[(x=i+x+4|0)>>2]=1|b[x>>2];else{if(b[i+4>>2]=3|c,b[h+4>>2]=1|l,b[h+l>>2]=l,t=l>>>3,l>>>0<256){r=23356+(t<<1<<2)|0,(a=0|b[5829])&(t=1<<t)?t=0|b[(a=r+8|0)>>2]:(b[5829]=a|t,t=r,a=r+8|0),b[a>>2]=h,b[t+12>>2]=h,b[h+8>>2]=t,b[h+12>>2]=r;break}if(t=23620+((r=(t=l>>>8)?l>>>0>16777215?31:l>>>((r=14-((y=((x=t<<(u=(t+1048320|0)>>>16&8))+520192|0)>>>16&4)|u|(r=((x<<=y)+245760|0)>>>16&2))+(x<<r>>>15)|0)+7|0)&1|r<<1:0)<<2)|0,b[h+28>>2]=r,b[(a=h+16|0)+4>>2]=0,b[a>>2]=0,!(n&(a=1<<r))){b[5830]=n|a,b[t>>2]=h,b[h+24>>2]=t,b[h+12>>2]=h,b[h+8>>2]=h;break}t=0|b[t>>2];t:do{if((-8&b[t+4>>2]|0)!=(0|l)){for(n=l<<(31==(0|r)?0:25-(r>>>1)|0);a=0|b[(r=t+16+(n>>>31<<2)|0)>>2];){if((-8&b[a+4>>2]|0)==(0|l)){t=a;break t}n<<=1,t=a}b[r>>2]=h,b[h+24>>2]=t,b[h+12>>2]=h,b[h+8>>2]=h;break e}}while(0);x=0|b[(u=t+8|0)>>2],b[x+12>>2]=h,b[u>>2]=h,b[h+8>>2]=x,b[h+12>>2]=t,b[h+24>>2]=0}}while(0);return k=e,0|(x=i+8|0)}d=c}else d=c;else d=-1}while(0);if((r=0|b[5831])>>>0>=d>>>0)return t=r-d|0,a=0|b[5834],t>>>0>15?(x=a+d|0,b[5834]=x,b[5831]=t,b[x+4>>2]=1|t,b[a+r>>2]=t,b[a+4>>2]=3|d):(b[5831]=0,b[5834]=0,b[a+4>>2]=3|r,b[(x=a+r+4|0)>>2]=1|b[x>>2]),k=e,0|(x=a+8|0);if((l=0|b[5832])>>>0>d>>>0)return y=l-d|0,b[5832]=y,u=(x=0|b[5835])+d|0,b[5835]=u,b[u+4>>2]=1|y,b[x+4>>2]=3|d,k=e,0|(x=x+8|0);if(0|b[5947]?a=0|b[5949]:(b[5949]=4096,b[5948]=4096,b[5950]=-1,b[5951]=-1,b[5952]=0,b[5940]=0,b[5947]=-16&f^1431655768,a=4096),i=d+48|0,(c=(g=a+(A=d+47|0)|0)&(o=0-a|0))>>>0<=d>>>0)return k=e,0|(x=0);if(0|(a=0|b[5939])&&(f=(h=0|b[5937])+c|0)>>>0<=h>>>0|f>>>0>a>>>0)return k=e,0|(x=0);e:do{if(4&b[5940])t=0,q=143;else{r=0|b[5835];t:do{if(r){for(n=23764;!((f=0|b[n>>2])>>>0<=r>>>0&&(f+(0|b[n+4>>2])|0)>>>0>r>>>0);){if(!(a=0|b[n+8>>2])){q=128;break t}n=a}if((t=g-l&o)>>>0<2147483647)if((0|(a=0|Bt(0|t)))==((0|b[n>>2])+(0|b[n+4>>2])|0)){if(-1!=(0|a)){l=t,g=a,q=145;break e}}else n=a,q=136;else t=0}else q=128}while(0);do{if(128==(0|q))if(-1!=(0|(r=0|Bt(0)))&&(t=r,p=(t=(0==((p=(m=0|b[5948])+-1|0)&t|0)?0:(p+t&0-m)-t|0)+c|0)+(m=0|b[5937])|0,t>>>0>d>>>0&t>>>0<2147483647)){if(0|(f=0|b[5939])&&p>>>0<=m>>>0|p>>>0>f>>>0){t=0;break}if((0|(a=0|Bt(0|t)))==(0|r)){l=t,g=r,q=145;break e}n=a,q=136}else t=0}while(0);do{if(136==(0|q)){if(r=0-t|0,!(i>>>0>t>>>0&t>>>0<2147483647&-1!=(0|n))){if(-1==(0|n)){t=0;break}l=t,g=n,q=145;break e}if((a=A-t+(a=0|b[5949])&0-a)>>>0>=2147483647){l=t,g=n,q=145;break e}if(-1==(0|Bt(0|a))){Bt(0|r),t=0;break}l=a+t|0,g=n,q=145;break e}}while(0);b[5940]=4|b[5940],q=143}}while(0);if(143==(0|q)&&c>>>0<2147483647&&!(-1==(0|(y=0|Bt(0|c)))|1^(s=(_=(p=0|Bt(0))-y|0)>>>0>(d+40|0)>>>0)|y>>>0<p>>>0&-1!=(0|y)&-1!=(0|p)^1)&&(l=s?_:t,g=y,q=145),145==(0|q)){t=(0|b[5937])+l|0,b[5937]=t,t>>>0>(0|b[5938])>>>0&&(b[5938]=t),A=0|b[5835];e:do{if(A){for(t=23764;;){if((0|g)==((a=0|b[t>>2])+(r=0|b[t+4>>2])|0)){q=154;break}if(!(n=0|b[t+8>>2]))break;t=n}if(154==(0|q)&&(u=t+4|0,0==(8&b[t+12>>2]|0))&&g>>>0>A>>>0&a>>>0<=A>>>0){b[u>>2]=r+l,u=A+(y=0==(7&(y=A+8|0)|0)?0:0-y&7)|0,y=(x=(0|b[5832])+l|0)-y|0,b[5835]=u,b[5832]=y,b[u+4>>2]=1|y,b[A+x+4>>2]=40,b[5836]=b[5951];break}for(g>>>0<(0|b[5833])>>>0&&(b[5833]=g),r=g+l|0,t=23764;;){if((0|b[t>>2])==(0|r)){q=162;break}if(!(a=0|b[t+8>>2]))break;t=a}if(162==(0|q)&&0==(8&b[t+12>>2]|0)){b[t>>2]=g,b[(h=t+4|0)>>2]=(0|b[h>>2])+l,c=(h=g+(0==(7&(h=g+8|0)|0)?0:0-h&7)|0)+d|0,i=(t=r+(0==(7&(t=r+8|0)|0)?0:0-t&7)|0)-h-d|0,b[h+4>>2]=3|d;t:do{if((0|A)==(0|t))x=(0|b[5832])+i|0,b[5832]=x,b[5835]=c,b[c+4>>2]=1|x;else{if((0|b[5834])==(0|t)){x=(0|b[5831])+i|0,b[5831]=x,b[5834]=c,b[c+4>>2]=1|x,b[c+x>>2]=x;break}if(1==(3&(a=0|b[t+4>>2])|0)){l=-8&a,n=a>>>3;i:do{if(a>>>0<256){if(a=0|b[t+8>>2],(0|(r=0|b[t+12>>2]))==(0|a)){b[5829]=b[5829]&~(1<<n);break}b[a+12>>2]=r,b[r+8>>2]=a;break}g=0|b[t+24>>2],a=0|b[t+12>>2];do{if((0|a)==(0|t)){if(a=0|b[(n=(r=t+16|0)+4|0)>>2])r=n;else if(!(a=0|b[r>>2])){a=0;break}for(;;)if(n=0|b[(o=a+20|0)>>2])a=n,r=o;else{if(!(n=0|b[(o=a+16|0)>>2]))break;a=n,r=o}b[r>>2]=0}else x=0|b[t+8>>2],b[x+12>>2]=a,b[a+8>>2]=x}while(0);if(!g)break;n=23620+((r=0|b[t+28>>2])<<2)|0;do{if((0|b[n>>2])==(0|t)){if(b[n>>2]=a,0|a)break;b[5830]=b[5830]&~(1<<r);break i}if(b[((0|b[(x=g+16|0)>>2])==(0|t)?x:g+20|0)>>2]=a,!a)break i}while(0);if(b[a+24>>2]=g,0|(n=0|b[(r=t+16|0)>>2])&&(b[a+16>>2]=n,b[n+24>>2]=a),!(r=0|b[r+4>>2]))break;b[a+20>>2]=r,b[r+24>>2]=a}while(0);t=t+l|0,o=l+i|0}else o=i;if(b[(t=t+4|0)>>2]=-2&b[t>>2],b[c+4>>2]=1|o,b[c+o>>2]=o,t=o>>>3,o>>>0<256){r=23356+(t<<1<<2)|0,(a=0|b[5829])&(t=1<<t)?t=0|b[(a=r+8|0)>>2]:(b[5829]=a|t,t=r,a=r+8|0),b[a>>2]=c,b[t+12>>2]=c,b[c+8>>2]=t,b[c+12>>2]=r;break}t=o>>>8;do{if(t){if(o>>>0>16777215){n=31;break}n=o>>>((n=14-((y=((x=t<<(u=(t+1048320|0)>>>16&8))+520192|0)>>>16&4)|u|(n=((x<<=y)+245760|0)>>>16&2))+(x<<n>>>15)|0)+7|0)&1|n<<1}else n=0}while(0);if(t=23620+(n<<2)|0,b[c+28>>2]=n,b[(a=c+16|0)+4>>2]=0,b[a>>2]=0,!((a=0|b[5830])&(r=1<<n))){b[5830]=a|r,b[t>>2]=c,b[c+24>>2]=t,b[c+12>>2]=c,b[c+8>>2]=c;break}t=0|b[t>>2];i:do{if((-8&b[t+4>>2]|0)!=(0|o)){for(n=o<<(31==(0|n)?0:25-(n>>>1)|0);a=0|b[(r=t+16+(n>>>31<<2)|0)>>2];){if((-8&b[a+4>>2]|0)==(0|o)){t=a;break i}n<<=1,t=a}b[r>>2]=c,b[c+24>>2]=t,b[c+12>>2]=c,b[c+8>>2]=c;break t}}while(0);x=0|b[(u=t+8|0)>>2],b[x+12>>2]=c,b[u>>2]=c,b[c+8>>2]=x,b[c+12>>2]=t,b[c+24>>2]=0}}while(0);return k=e,0|(x=h+8|0)}for(t=23764;!((a=0|b[t>>2])>>>0<=A>>>0&&(x=a+(0|b[t+4>>2])|0)>>>0>A>>>0);)t=0|b[t+8>>2];t=(a=(a=(o=x+-47|0)+(0==(7&(a=o+8|0)|0)?0:0-a&7)|0)>>>0<(o=A+16|0)>>>0?A:a)+8|0,u=g+(y=0==(7&(y=g+8|0)|0)?0:0-y&7)|0,y=(r=l+-40|0)-y|0,b[5835]=u,b[5832]=y,b[u+4>>2]=1|y,b[g+r+4>>2]=40,b[5836]=b[5951],b[(r=a+4|0)>>2]=27,b[t>>2]=b[5941],b[t+4>>2]=b[5942],b[t+8>>2]=b[5943],b[t+12>>2]=b[5944],b[5941]=g,b[5942]=l,b[5944]=0,b[5943]=t,t=a+24|0;do{u=t,b[(t=t+4|0)>>2]=7}while((u+8|0)>>>0<x>>>0);if((0|a)!=(0|A)){if(g=a-A|0,b[r>>2]=-2&b[r>>2],b[A+4>>2]=1|g,b[a>>2]=g,t=g>>>3,g>>>0<256){r=23356+(t<<1<<2)|0,(a=0|b[5829])&(t=1<<t)?t=0|b[(a=r+8|0)>>2]:(b[5829]=a|t,t=r,a=r+8|0),b[a>>2]=A,b[t+12>>2]=A,b[A+8>>2]=t,b[A+12>>2]=r;break}if(r=23620+((n=(t=g>>>8)?g>>>0>16777215?31:g>>>((n=14-((y=((x=t<<(u=(t+1048320|0)>>>16&8))+520192|0)>>>16&4)|u|(n=((x<<=y)+245760|0)>>>16&2))+(x<<n>>>15)|0)+7|0)&1|n<<1:0)<<2)|0,b[A+28>>2]=n,b[A+20>>2]=0,b[o>>2]=0,!((t=0|b[5830])&(a=1<<n))){b[5830]=t|a,b[r>>2]=A,b[A+24>>2]=r,b[A+12>>2]=A,b[A+8>>2]=A;break}t=0|b[r>>2];t:do{if((-8&b[t+4>>2]|0)!=(0|g)){for(n=g<<(31==(0|n)?0:25-(n>>>1)|0);a=0|b[(r=t+16+(n>>>31<<2)|0)>>2];){if((-8&b[a+4>>2]|0)==(0|g)){t=a;break t}n<<=1,t=a}b[r>>2]=A,b[A+24>>2]=t,b[A+12>>2]=A,b[A+8>>2]=A;break e}}while(0);x=0|b[(u=t+8|0)>>2],b[x+12>>2]=A,b[u>>2]=A,b[A+8>>2]=x,b[A+12>>2]=t,b[A+24>>2]=0}}else 0==(0|(x=0|b[5833]))|g>>>0<x>>>0&&(b[5833]=g),b[5941]=g,b[5942]=l,b[5944]=0,b[5838]=b[5947],b[5837]=-1,b[5842]=23356,b[5841]=23356,b[5844]=23364,b[5843]=23364,b[5846]=23372,b[5845]=23372,b[5848]=23380,b[5847]=23380,b[5850]=23388,b[5849]=23388,b[5852]=23396,b[5851]=23396,b[5854]=23404,b[5853]=23404,b[5856]=23412,b[5855]=23412,b[5858]=23420,b[5857]=23420,b[5860]=23428,b[5859]=23428,b[5862]=23436,b[5861]=23436,b[5864]=23444,b[5863]=23444,b[5866]=23452,b[5865]=23452,b[5868]=23460,b[5867]=23460,b[5870]=23468,b[5869]=23468,b[5872]=23476,b[5871]=23476,b[5874]=23484,b[5873]=23484,b[5876]=23492,b[5875]=23492,b[5878]=23500,b[5877]=23500,b[5880]=23508,b[5879]=23508,b[5882]=23516,b[5881]=23516,b[5884]=23524,b[5883]=23524,b[5886]=23532,b[5885]=23532,b[5888]=23540,b[5887]=23540,b[5890]=23548,b[5889]=23548,b[5892]=23556,b[5891]=23556,b[5894]=23564,b[5893]=23564,b[5896]=23572,b[5895]=23572,b[5898]=23580,b[5897]=23580,b[5900]=23588,b[5899]=23588,b[5902]=23596,b[5901]=23596,b[5904]=23604,b[5903]=23604,u=g+(y=0==(7&(y=g+8|0)|0)?0:0-y&7)|0,y=(x=l+-40|0)-y|0,b[5835]=u,b[5832]=y,b[u+4>>2]=1|y,b[g+x+4>>2]=40,b[5836]=b[5951]}while(0);if((t=0|b[5832])>>>0>d>>>0)return y=t-d|0,b[5832]=y,u=(x=0|b[5835])+d|0,b[5835]=u,b[u+4>>2]=1|y,b[x+4>>2]=3|d,k=e,0|(x=x+8|0)}return b[(x=23312)>>2]=12,k=e,0|(x=0)}function vt(a){var e=0,t=0,r=0,n=0,g=0,o=0,i=0,l=0;if(a|=0){t=a+-8|0,n=0|b[5833],l=t+(e=-8&(a=0|b[a+-4>>2]))|0;do{if(1&a)i=t,o=t;else{if(r=0|b[t>>2],!(3&a))return;if(g=r+e|0,(o=t+(0-r)|0)>>>0<n>>>0)return;if((0|b[5834])==(0|o)){if(3!=(3&(e=0|b[(a=l+4|0)>>2])|0)){i=o,e=g;break}return b[5831]=g,b[a>>2]=-2&e,b[o+4>>2]=1|g,void(b[o+g>>2]=g)}if(t=r>>>3,r>>>0<256){if(a=0|b[o+8>>2],(0|(e=0|b[o+12>>2]))==(0|a)){b[5829]=b[5829]&~(1<<t),i=o,e=g;break}b[a+12>>2]=e,b[e+8>>2]=a,i=o,e=g;break}n=0|b[o+24>>2],a=0|b[o+12>>2];do{if((0|a)==(0|o)){if(a=0|b[(t=(e=o+16|0)+4|0)>>2])e=t;else if(!(a=0|b[e>>2])){a=0;break}for(;;)if(t=0|b[(r=a+20|0)>>2])a=t,e=r;else{if(!(t=0|b[(r=a+16|0)>>2]))break;a=t,e=r}b[e>>2]=0}else i=0|b[o+8>>2],b[i+12>>2]=a,b[a+8>>2]=i}while(0);if(n){if(e=0|b[o+28>>2],(0|b[(t=23620+(e<<2)|0)>>2])==(0|o)){if(b[t>>2]=a,!a){b[5830]=b[5830]&~(1<<e),i=o,e=g;break}}else if(b[((0|b[(i=n+16|0)>>2])==(0|o)?i:n+20|0)>>2]=a,!a){i=o,e=g;break}b[a+24>>2]=n,0|(t=0|b[(e=o+16|0)>>2])&&(b[a+16>>2]=t,b[t+24>>2]=a),(e=0|b[e+4>>2])?(b[a+20>>2]=e,b[e+24>>2]=a,i=o,e=g):(i=o,e=g)}else i=o,e=g}}while(0);if(!(o>>>0>=l>>>0)&&1&(r=0|b[(a=l+4|0)>>2])){if(2&r)b[a>>2]=-2&r,b[i+4>>2]=1|e,b[o+e>>2]=e,n=e;else{if((0|b[5835])==(0|l)){if(l=(0|b[5832])+e|0,b[5832]=l,b[5835]=i,b[i+4>>2]=1|l,(0|i)!=(0|b[5834]))return;return b[5834]=0,void(b[5831]=0)}if((0|b[5834])==(0|l))return l=(0|b[5831])+e|0,b[5831]=l,b[5834]=o,b[i+4>>2]=1|l,void(b[o+l>>2]=l);n=(-8&r)+e|0,t=r>>>3;do{if(r>>>0<256){if(e=0|b[l+8>>2],(0|(a=0|b[l+12>>2]))==(0|e)){b[5829]=b[5829]&~(1<<t);break}b[e+12>>2]=a,b[a+8>>2]=e;break}g=0|b[l+24>>2],a=0|b[l+12>>2];do{if((0|a)==(0|l)){if(a=0|b[(t=(e=l+16|0)+4|0)>>2])e=t;else if(!(a=0|b[e>>2])){t=0;break}for(;;)if(t=0|b[(r=a+20|0)>>2])a=t,e=r;else{if(!(t=0|b[(r=a+16|0)>>2]))break;a=t,e=r}b[e>>2]=0,t=a}else t=0|b[l+8>>2],b[t+12>>2]=a,b[a+8>>2]=t,t=a}while(0);if(0|g){if(a=0|b[l+28>>2],(0|b[(e=23620+(a<<2)|0)>>2])==(0|l)){if(b[e>>2]=t,!t){b[5830]=b[5830]&~(1<<a);break}}else if(b[((0|b[(r=g+16|0)>>2])==(0|l)?r:g+20|0)>>2]=t,!t)break;b[t+24>>2]=g,0|(e=0|b[(a=l+16|0)>>2])&&(b[t+16>>2]=e,b[e+24>>2]=t),0|(a=0|b[a+4>>2])&&(b[t+20>>2]=a,b[a+24>>2]=t)}}while(0);if(b[i+4>>2]=1|n,b[o+n>>2]=n,(0|i)==(0|b[5834]))return void(b[5831]=n)}if(a=n>>>3,n>>>0<256)return t=23356+(a<<1<<2)|0,(e=0|b[5829])&(a=1<<a)?a=0|b[(e=t+8|0)>>2]:(b[5829]=e|a,a=t,e=t+8|0),b[e>>2]=i,b[a+12>>2]=i,b[i+8>>2]=a,void(b[i+12>>2]=t);a=23620+((r=(a=n>>>8)?n>>>0>16777215?31:n>>>((r=14-((g=((l=a<<(o=(a+1048320|0)>>>16&8))+520192|0)>>>16&4)|o|(r=((l<<=g)+245760|0)>>>16&2))+(l<<r>>>15)|0)+7|0)&1|r<<1:0)<<2)|0,b[i+28>>2]=r,b[i+20>>2]=0,b[i+16>>2]=0,e=0|b[5830],t=1<<r;e:do{if(e&t){a=0|b[a>>2];t:do{if((-8&b[a+4>>2]|0)!=(0|n)){for(r=n<<(31==(0|r)?0:25-(r>>>1)|0);e=0|b[(t=a+16+(r>>>31<<2)|0)>>2];){if((-8&b[e+4>>2]|0)==(0|n)){a=e;break t}r<<=1,a=e}b[t>>2]=i,b[i+24>>2]=a,b[i+12>>2]=i,b[i+8>>2]=i;break e}}while(0);l=0|b[(o=a+8|0)>>2],b[l+12>>2]=i,b[o>>2]=i,b[i+8>>2]=l,b[i+12>>2]=a,b[i+24>>2]=0}else b[5830]=e|t,b[a>>2]=i,b[i+24>>2]=a,b[i+12>>2]=i,b[i+8>>2]=i}while(0);if(l=(0|b[5837])-1|0,b[5837]=l,!(0|l)){for(a=23772;a=0|b[a>>2];)a=a+8|0;b[5837]=-1}}}}function bt(a,e){e|=0;var t=0;return(a|=0)?(t=0|_(e,a),(e|a)>>>0>65535&&(t=(0|(t>>>0)/(a>>>0))==(0|e)?t:-1)):t=0,(a=0|xt(t))&&3&b[a+-4>>2]?(zt(0|a,0,0|t),0|a):0|a}function wt(a,b,e,t){return 0|(v(0|(t=(b|=0)-(t|=0)-((e|=0)>>>0>(a|=0)>>>0|0)>>>0)),a-e>>>0|0)}function Tt(a){return 0|((a|=0)?31-(0|x(a^a-1))|0:32)}function Et(a,e,t,r,n){n|=0;var g=0,o=0,i=0,l=0,A=0,c=0,h=0,d=0,f=0,p=0;if(c=a|=0,o=t|=0,i=d=r|=0,!(A=l=e|=0))return g=0!=(0|n),i?g?(b[n>>2]=0|a,b[n+4>>2]=0&e,n=0,0|(v(0|(d=0)),n)):(n=0,0|(v(0|(d=0)),n)):(g&&(b[n>>2]=(c>>>0)%(o>>>0),b[n+4>>2]=0),n=(c>>>0)/(o>>>0)>>>0,0|(v(0|(d=0)),n));g=0==(0|i);do{if(o){if(!g){if((g=(0|x(0|i))-(0|x(0|A))|0)>>>0<=31){o=h=g+1|0,a=c>>>(h>>>0)&(e=g-31>>31)|A<<(i=31-g|0),e&=A>>>(h>>>0),g=0,i=c<<i;break}return n?(b[n>>2]=0|a,b[n+4>>2]=l|0&e,n=0,0|(v(0|(d=0)),n)):(n=0,0|(v(0|(d=0)),n))}if((g=o-1|0)&o|0){o=i=33+(0|x(0|o))-(0|x(0|A))|0,a=(h=32-i|0)-1>>31&A>>>((f=i-32|0)>>>0)|(A<<h|c>>>(i>>>0))&(e=f>>31),e&=A>>>(i>>>0),g=c<<(p=64-i|0)&(l=h>>31),i=(A<<p|c>>>(f>>>0))&l|c<<h&i-33>>31;break}return 0|n&&(b[n>>2]=g&c,b[n+4>>2]=0),1==(0|o)?(p=0|a,0|(v(0|(f=l|0&e)),p)):(f=A>>>((p=0|Tt(0|o))>>>0)|0,p=A<<32-p|c>>>(p>>>0)|0,0|(v(0|f),p))}if(g)return 0|n&&(b[n>>2]=(A>>>0)%(o>>>0),b[n+4>>2]=0),p=(A>>>0)/(o>>>0)>>>0,0|(v(0|(f=0)),p);if(!c)return 0|n&&(b[n>>2]=0,b[n+4>>2]=(A>>>0)%(i>>>0)),p=(A>>>0)/(i>>>0)>>>0,0|(v(0|(f=0)),p);if(!((g=i-1|0)&i))return 0|n&&(b[n>>2]=0|a,b[n+4>>2]=g&A|0&e),f=0,p=A>>>((0|Tt(0|i))>>>0),0|(v(0|f),p);if((g=(0|x(0|i))-(0|x(0|A))|0)>>>0<=30){o=e=g+1|0,a=A<<(i=31-g|0)|c>>>(e>>>0),e=A>>>(e>>>0),g=0,i=c<<i;break}return n?(b[n>>2]=0|a,b[n+4>>2]=l|0&e,p=0,0|(v(0|(f=0)),p)):(p=0,0|(v(0|(f=0)),p))}while(0);if(o){A=0|function(a,b,e,t){return 0|(v((b|=0)+(t|=0)+((e=(a|=0)+(e|=0)>>>0)>>>0<a>>>0|0)>>>0|0),0|e)}(0|(h=0|t),0|(c=d|0&r),-1,-1),t=0|w(),l=i,i=0;do{r=l,l=g>>>31|l<<1,g=i|g<<1,wt(0|A,0|t,0|(r=a<<1|r>>>31|0),0|(d=a>>>31|e<<1|0)),i=1&(f=(p=0|w())>>31|((0|p)<0?-1:0)<<1),a=0|wt(0|r,0|d,f&h|0,(((0|p)<0?-1:0)>>31|((0|p)<0?-1:0)<<1)&c|0),e=0|w(),o=o-1|0}while(0!=(0|o));A=l,l=0}else A=i,l=0,i=0;return o=0,0|n&&(b[n>>2]=a,b[n+4>>2]=e),p=-2&(g<<1|0)|i,0|(v(0|(f=(0|g)>>>31|(A|o)<<1|0&(o<<1|g>>>31)|l)),p)}function Mt(a,e,t,r){var n,g;return g=k,k=k+16|0,Et(a|=0,e|=0,t|=0,r|=0,n=0|g),k=g,0|(v(0|b[n+4>>2]),0|b[n>>2])}function Ct(a,b,e){return a|=0,b|=0,(0|(e|=0))<32?(v(b>>>e|0),a>>>e|(b&(1<<e)-1)<<32-e):(v(0),b>>>e-32|0)}function dd(a,b,e){return a|=0,b|=0,(0|(e|=0))<32?(v(b<<e|(a&(1<<e)-1<<32-e)>>>32-e|0),a<<e):(v(a<<e-32|0),0)}function It(a,b){return b=+b,(a=+a)!=a?+b:b!=b?+a:+y(+a,+b)}function St(a){return(a=+a)>=0?+p(a+.5):+m(a-.5)}function kt(e,t,r){e|=0,t|=0;var g,n,o=0;if((0|(r|=0))>=8192)return C(0|e,0|t,0|r),0|e;if(n=0|e,g=e+r|0,(3&e)==(3&t)){for(;3&e;){if(!r)return 0|n;a[e>>0]=0|a[t>>0],e=e+1|0,t=t+1|0,r=r-1|0}for(o=(r=-4&g|0)-64|0;(0|e)<=(0|o);)b[e>>2]=b[t>>2],b[e+4>>2]=b[t+4>>2],b[e+8>>2]=b[t+8>>2],b[e+12>>2]=b[t+12>>2],b[e+16>>2]=b[t+16>>2],b[e+20>>2]=b[t+20>>2],b[e+24>>2]=b[t+24>>2],b[e+28>>2]=b[t+28>>2],b[e+32>>2]=b[t+32>>2],b[e+36>>2]=b[t+36>>2],b[e+40>>2]=b[t+40>>2],b[e+44>>2]=b[t+44>>2],b[e+48>>2]=b[t+48>>2],b[e+52>>2]=b[t+52>>2],b[e+56>>2]=b[t+56>>2],b[e+60>>2]=b[t+60>>2],e=e+64|0,t=t+64|0;for(;(0|e)<(0|r);)b[e>>2]=b[t>>2],e=e+4|0,t=t+4|0}else for(r=g-4|0;(0|e)<(0|r);)a[e>>0]=0|a[t>>0],a[e+1>>0]=0|a[t+1>>0],a[e+2>>0]=0|a[t+2>>0],a[e+3>>0]=0|a[t+3>>0],e=e+4|0,t=t+4|0;for(;(0|e)<(0|g);)a[e>>0]=0|a[t>>0],e=e+1|0,t=t+1|0;return 0|n}function zt(e,t,r){t|=0;var n,o=0,g=0,i=0;if(n=(e|=0)+(r|=0)|0,t&=255,(0|r)>=67){for(;3&e;)a[e>>0]=t,e=e+1|0;for(i=t|t<<8|t<<16|t<<24,g=(o=-4&n|0)-64|0;(0|e)<=(0|g);)b[e>>2]=i,b[e+4>>2]=i,b[e+8>>2]=i,b[e+12>>2]=i,b[e+16>>2]=i,b[e+20>>2]=i,b[e+24>>2]=i,b[e+28>>2]=i,b[e+32>>2]=i,b[e+36>>2]=i,b[e+40>>2]=i,b[e+44>>2]=i,b[e+48>>2]=i,b[e+52>>2]=i,b[e+56>>2]=i,b[e+60>>2]=i,e=e+64|0;for(;(0|e)<(0|o);)b[e>>2]=i,e=e+4|0}for(;(0|e)<(0|n);)a[e>>0]=t,e=e+1|0;return n-r|0}function Dt(a){return(a=+a)>=0?+p(a+.5):+m(a-.5)}function Bt(a){a|=0;var e,t,r;return r=0|M(),(0|a)>0&(0|(e=(t=0|b[g>>2])+a|0))<(0|t)|(0|e)<0?(S(0|e),E(12),-1):(0|e)>(0|r)&&!(0|I(0|e))?(E(12),-1):(b[g>>2]=e,0|t)}return{___uremdi3:Mt,_bitshift64Lshr:Ct,_bitshift64Shl:dd,_calloc:bt,_cellAreaKm2:function(a,e){var t,r,g,n=0;if(g=k,k=k+192|0,r=g,qe(a|=0,e|=0,t=g+168|0),$e(a,e,r),(0|(e=0|b[r>>2]))>0){if(n=+ke(r+8|0,r+8+((1!=(0|e)&1)<<4)|0,t)+0,1!=(0|e)){a=1;do{n+=+ke(r+8+(a<<4)|0,r+8+(((0|(a=a+1|0))%(0|e)|0)<<4)|0,t)}while((0|a)<(0|e))}}else n=0;return k=g,6371.007180918475*n*6371.007180918475},_cellAreaM2:function(a,e){var t,r,g,n=0;if(g=k,k=k+192|0,r=g,qe(a|=0,e|=0,t=g+168|0),$e(a,e,r),(0|(e=0|b[r>>2]))>0){if(n=+ke(r+8|0,r+8+((1!=(0|e)&1)<<4)|0,t)+0,1!=(0|e)){a=1;do{n+=+ke(r+8+(a<<4)|0,r+8+(((0|(a=a+1|0))%(0|e)|0)<<4)|0,t)}while((0|a)<(0|e))}}else n=0;return k=g,6371.007180918475*n*6371.007180918475*1e3*1e3},_cellAreaRads2:function(a,e){var t,r,g,n=0;if(g=k,k=k+192|0,r=g,qe(a|=0,e|=0,t=g+168|0),$e(a,e,r),(0|(e=0|b[r>>2]))<=0)return k=g,+(n=0);if(n=+ke(r+8|0,r+8+((1!=(0|e)&1)<<4)|0,t)+0,1==(0|e))return k=g,+n;a=1;do{n+=+ke(r+8+(a<<4)|0,r+8+(((0|(a=a+1|0))%(0|e)|0)<<4)|0,t)}while((0|a)<(0|e));return k=g,+n},_compact:function(a,e,t){e|=0;var r,n=0,o=0,g=0,l=0,i=0,A=0,c=0,h=0,d=0,f=0,m=0,p=0,q=0,_=0,s=0,y=0,u=0,x=0,v=0,T=0,E=0;if(!(t|=0))return 0|(T=0);if(n=0|b[(o=a|=0)>>2],!0&0==(15728640&(o=0|b[o+4>>2])|0)){if((0|t)<=0)return 0|(T=0);if(b[(T=e)>>2]=n,b[T+4>>2]=o,1==(0|t))return 0|(T=0);n=1;do{v=0|b[(x=a+(n<<3)|0)+4>>2],b[(T=e+(n<<3)|0)>>2]=b[x>>2],b[T+4>>2]=v,n=n+1|0}while((0|n)!=(0|t));return 0|(n=0)}if(!(v=0|xt(x=t<<3)))return 0|(T=-3);if(kt(0|v,0|a,0|x),!(r=0|bt(t,8)))return vt(v),0|(T=-3);n=t;e:for(;;){y=0|Ct(0|(h=0|b[(l=v)>>2]),0|(l=0|b[l+4>>2]),52),w(),u=(y&=15)+-1|0,s=(0|n)>0;t:do{if(s){if(_=((0|n)<0)<<31>>31,p=0|dd(0|u,0,52),q=0|w(),u>>>0>15)for(o=0,a=h,t=l;;){if(!(0==(0|a)&0==(0|t))){if(g=0|Ct(0|a,0|t,52),w(),i=(0|(g&=15))<(0|u),g=(0|g)==(0|u),t=0|Mt(0|(c=i?0:g?a:0),0|(a=i?0:g?t:0),0|n,0|_),w(),0==(0|(A=0|b[(i=g=r+(t<<3)|0)>>2]))&0==(0|(i=0|b[i+4>>2])))t=c;else for(p=0,m=t,f=i,t=c;;){if((0|p)>(0|n)){T=41;break e}if((0|A)==(0|t)&(-117440513&f|0)==(0|a)){c=0|Ct(0|A,0|f,56),w(),d=(c&=7)+1|0,q=0|Ct(0|A,0|f,45),w();i:do{if(0|R(127&q)){if(A=0|Ct(0|A,0|f,52),w(),!(A&=15)){i=6;break}for(i=1;;){if(!(0==((q=0|dd(7,0,3*(15-i|0)|0))&t|0)&0==((0|w())&a|0))){i=7;break i}if(!(i>>>0<A>>>0)){i=6;break}i=i+1|0}}else i=7}while(0);if((c+2|0)>>>0>i>>>0){T=51;break e}q=0|dd(0|d,0,56),a=0|w()|-117440513&a,b[(i=g)>>2]=0,b[i+4>>2]=0,i=m,t|=q}else i=(m+1|0)%(0|n)|0;if(0==(0|(A=0|b[(f=g=r+(i<<3)|0)>>2]))&0==(0|(f=0|b[f+4>>2])))break;p=p+1|0,m=i}b[(q=g)>>2]=t,b[q+4>>2]=a}if((0|(o=o+1|0))>=(0|n))break t;a=0|b[(t=v+(o<<3)|0)>>2],t=0|b[t+4>>2]}for(o=0,a=h,t=l;;){if(!(0==(0|a)&0==(0|t))){if(i=0|Ct(0|a,0|t,52),w(),(0|(i&=15))>=(0|u)){if((0|i)!=(0|u)&&(a|=p,t=-15728641&t|q,i>>>0>=y>>>0)){g=u;do{m=0|dd(7,0,3*(14-g|0)|0),g=g+1|0,a|=m,t=0|w()|t}while(g>>>0<i>>>0)}}else a=0,t=0;if(i=0|Mt(0|a,0|t,0|n,0|_),w(),!(0==(0|(c=0|b[(A=g=r+(i<<3)|0)>>2]))&0==(0|(A=0|b[A+4>>2]))))for(m=0;;){if((0|m)>(0|n)){T=41;break e}if((0|c)==(0|a)&(-117440513&A|0)==(0|t)){d=0|Ct(0|c,0|A,56),w(),f=(d&=7)+1|0,E=0|Ct(0|c,0|A,45),w();i:do{if(0|R(127&E)){if(c=0|Ct(0|c,0|A,52),w(),!(c&=15)){A=6;break}for(A=1;;){if(!(0==((E=0|dd(7,0,3*(15-A|0)|0))&a|0)&0==((0|w())&t|0))){A=7;break i}if(!(A>>>0<c>>>0)){A=6;break}A=A+1|0}}else A=7}while(0);if((d+2|0)>>>0>A>>>0){T=51;break e}E=0|dd(0|f,0,56),t=0|w()|-117440513&t,b[(f=g)>>2]=0,b[f+4>>2]=0,a|=E}else i=(i+1|0)%(0|n)|0;if(0==(0|(c=0|b[(A=g=r+(i<<3)|0)>>2]))&0==(0|(A=0|b[A+4>>2])))break;m=m+1|0}b[(E=g)>>2]=a,b[E+4>>2]=t}if((0|(o=o+1|0))>=(0|n))break t;a=0|b[(t=v+(o<<3)|0)>>2],t=0|b[t+4>>2]}}}while(0);if((n+5|0)>>>0<11){T=99;break}if(!(q=0|bt((0|n)/6|0,8))){T=58;break}t:do{if(s){m=0,f=0;do{if(!(0==(0|(o=0|b[(a=i=r+(m<<3)|0)>>2]))&0==(0|(a=0|b[a+4>>2])))){A=0|Ct(0|o,0|a,56),w(),t=(A&=7)+1|0,c=-117440513&a,E=0|Ct(0|o,0|a,45),w();i:do{if(0|R(127&E)){if(d=0|Ct(0|o,0|a,52),w(),0|(d&=15))for(g=1;;){if(!(0==(o&(E=0|dd(7,0,3*(15-g|0)|0))|0)&0==(c&(0|w())|0)))break i;if(!(g>>>0<d>>>0))break;g=g+1|0}o|=a=0|dd(0|t,0,56),a=0|w()|c,b[(t=i)>>2]=o,b[t+4>>2]=a,t=A+2|0}}while(0);7==(0|t)&&(b[(E=q+(f<<3)|0)>>2]=o,b[E+4>>2]=-117440513&a,f=f+1|0)}m=m+1|0}while((0|m)!=(0|n));if(s){if(p=((0|n)<0)<<31>>31,d=0|dd(0|u,0,52),m=0|w(),u>>>0>15)for(a=0,o=0;;){do{if(!(0==(0|h)&0==(0|l))){for(A=0|Ct(0|h,0|l,52),w(),g=(0|(A&=15))<(0|u),A=(0|A)==(0|u),g=0|Mt(0|(i=g?0:A?h:0),0|(A=g?0:A?l:0),0|n,0|p),w(),t=0;;){if((0|t)>(0|n)){T=98;break e}if((-117440513&(c=0|b[(E=r+(g<<3)|0)+4>>2])|0)==(0|A)&&(0|b[E>>2])==(0|i)){T=70;break}if((0|b[(E=r+((g=(g+1|0)%(0|n)|0)<<3)|0)>>2])==(0|i)&&(0|b[E+4>>2])==(0|A))break;t=t+1|0}if(70==(0|T)&&(T=0,!0&100663296==(117440512&c|0)))break;b[(E=e+(o<<3)|0)>>2]=h,b[E+4>>2]=l,o=o+1|0}}while(0);if((0|(a=a+1|0))>=(0|n)){n=f;break t}h=0|b[(l=v+(a<<3)|0)>>2],l=0|b[l+4>>2]}for(a=0,o=0;;){do{if(!(0==(0|h)&0==(0|l))){if(A=0|Ct(0|h,0|l,52),w(),(0|(A&=15))>=(0|u))if((0|A)!=(0|u))if(t=h|d,g=-15728641&l|m,A>>>0<y>>>0)A=g;else{i=u;do{E=0|dd(7,0,3*(14-i|0)|0),i=i+1|0,t|=E,g=0|w()|g}while(i>>>0<A>>>0);A=g}else t=h,A=l;else t=0,A=0;for(i=0|Mt(0|t,0|A,0|n,0|p),w(),g=0;;){if((0|g)>(0|n)){T=98;break e}if((-117440513&(c=0|b[(E=r+(i<<3)|0)+4>>2])|0)==(0|A)&&(0|b[E>>2])==(0|t)){T=93;break}if((0|b[(E=r+((i=(i+1|0)%(0|n)|0)<<3)|0)>>2])==(0|t)&&(0|b[E+4>>2])==(0|A))break;g=g+1|0}if(93==(0|T)&&(T=0,!0&100663296==(117440512&c|0)))break;b[(E=e+(o<<3)|0)>>2]=h,b[E+4>>2]=l,o=o+1|0}}while(0);if((0|(a=a+1|0))>=(0|n)){n=f;break t}h=0|b[(l=v+(a<<3)|0)>>2],l=0|b[l+4>>2]}}else o=0,n=f}else o=0,n=0}while(0);if(zt(0|r,0,0|x),kt(0|v,0|q,n<<3|0),vt(q),!n)break;e=e+(o<<3)|0}return 41==(0|T)?(vt(v),vt(r),0|(E=-1)):51==(0|T)?(vt(v),vt(r),0|(E=-2)):58==(0|T)?(vt(v),vt(r),0|(E=-3)):98==(0|T)?(vt(q),vt(v),vt(r),0|(E=-1)):(99==(0|T)&&kt(0|e,0|v,n<<3|0),vt(v),vt(r),0|(E=0))},_destroyLinkedPolygon:function(a){var e=0,t=0,r=0,n=0;if(a|=0)for(r=1;;){if(0|(e=0|b[a>>2]))do{if(0|(t=0|b[e>>2]))do{n=t,t=0|b[t+16>>2],vt(n)}while(0!=(0|t));n=e,e=0|b[e+8>>2],vt(n)}while(0!=(0|e));if(e=a,a=0|b[a+8>>2],r||vt(e),!a)break;r=0}},_edgeLengthKm:function(a){return+ +n[20752+((a|=0)<<3)>>3]},_edgeLengthM:function(a){return+ +n[20880+((a|=0)<<3)>>3]},_emscripten_replace_memory:function(e){return a=new Int8Array(e),new Uint8Array(e),b=new Int32Array(e),new Float32Array(e),n=new Float64Array(e),r=e,!0},_exactEdgeLengthKm:function(a,e){var t,i,r=0,A=0,g=0,c=0,h=0,d=0;if(i=k,k=k+176|0,We(a|=0,e|=0,t=i),(0|(a=0|b[t>>2]))<=1)return k=i,+(g=0);e=a+-1|0,a=0,r=0,A=+n[t+8>>3],g=+n[t+16>>3];do{h=A,A=+n[t+8+((a=a+1|0)<<4)>>3],d=+u(.5*(A-h)),c=g,g=+n[t+8+(a<<4)+8>>3],c=d*d+(c=+u(.5*(g-c)))*(+l(+h)*+l(+A)*c),r+=2*+f(+ +o(+c),+ +o(+(1-c)))}while((0|a)!=(0|e));return k=i,+(d=6371.007180918475*r)},_exactEdgeLengthM:function(a,e){var t,i,r=0,A=0,g=0,c=0,h=0,d=0;if(i=k,k=k+176|0,We(a|=0,e|=0,t=i),(0|(a=0|b[t>>2]))<=1)return k=i,+(g=0);e=a+-1|0,a=0,r=0,A=+n[t+8>>3],g=+n[t+16>>3];do{h=A,A=+n[t+8+((a=a+1|0)<<4)>>3],d=+u(.5*(A-h)),c=g,g=+n[t+8+(a<<4)+8>>3],c=d*d+(c=+u(.5*(g-c)))*(+l(+h)*+l(+A)*c),r+=2*+f(+ +o(+c),+ +o(+(1-c)))}while((0|a)!=(0|e));return k=i,+(d=6371.007180918475*r*1e3)},_exactEdgeLengthRads:function(a,e){var t,i,r=0,A=0,g=0,c=0,h=0,d=0;if(i=k,k=k+176|0,We(a|=0,e|=0,t=i),(0|(a=0|b[t>>2]))<=1)return k=i,+(g=0);e=a+-1|0,a=0,r=0,A=+n[t+8>>3],g=+n[t+16>>3];do{h=A,A=+n[t+8+((a=a+1|0)<<4)>>3],d=+u(.5*(A-h)),c=g,g=+n[t+8+(a<<4)+8>>3],c=d*d+(c=+u(.5*(g-c)))*(+l(+A)*+l(+h)*c),r+=2*+f(+ +o(+c),+ +o(+(1-c)))}while((0|a)<(0|e));return k=i,+r},_experimentalH3ToLocalIj:function(a,b,e,t,r){var n,g;return r|=0,g=k,k=k+16|0,(a=0|et(a|=0,b|=0,e|=0,t|=0,n=g))||(de(n,r),a=0),k=g,0|a},_experimentalLocalIjToH3:function(a,b,e,t){var r,n;return a|=0,b|=0,t|=0,r=k,k=k+16|0,fe(e|=0,n=r),t=0|tt(a,b,n,t),k=r,0|t},_free:vt,_geoToH3:Ge,_getDestinationH3IndexFromUnidirectionalEdge:function(a,e){a|=0;var t,r,n=0;return t=k,k=k+16|0,n=t,!0&268435456==(2013265920&(e|=0)|0)?(r=0|Ct(0|a,0|e,56),w(),b[n>>2]=0,n=0|P(a,-2130706433&e|134217728,7&r,n),e=0|w(),v(0|e),k=t,0|n):(n=0,v(0|(e=0)),k=t,0|n)},_getH3IndexesFromUnidirectionalEdge:function(a,e,t){a|=0;var r,n,g,o,i=0;g=k,k=k+16|0,r=g,o=!0&268435456==(2013265920&(e|=0)|0),n=-2130706433&e|134217728,b[(i=t|=0)>>2]=o?a:0,b[i+4>>2]=o?n:0,o?(e=0|Ct(0|a,0|e,56),w(),b[r>>2]=0,a=0|P(a,n,7&e,r),e=0|w()):(a=0,e=0),b[(i=t+8|0)>>2]=a,b[i+4>>2]=e,k=g},_getH3UnidirectionalEdge:function(a,e,t,r){var n,o,l=0,g=0,i=0,A=0,c=0;if(o=k,k=k+16|0,n=o,!(0|He(a|=0,e|=0,t|=0,r|=0)))return A=0,v(0|(i=0)),k=o,0|A;for(i=-2130706433&e,l=(l=0==(0|Le(a,e)))?1:2;b[n>>2]=0,g=l+1|0,!((0|(c=0|P(a,e,l,n)))==(0|t)&(0|w())==(0|r));){if(!(g>>>0<7)){l=0,a=0,A=6;break}l=g}return 6==(0|A)?(v(0|l),k=o,0|a):(c=0|dd(0|l,0,56),A=0|i|w()|268435456,c|=a,v(0|A),k=o,0|c)},_getH3UnidirectionalEdgeBoundary:We,_getH3UnidirectionalEdgesFromHexagon:function(a,e,t){t|=0;var r,n=0;r=0==(0|Le(a|=0,e|=0)),e&=-2130706433,b[(n=t)>>2]=r?a:0,b[n+4>>2]=r?285212672|e:0,b[(n=t+8|0)>>2]=a,b[n+4>>2]=301989888|e,b[(n=t+16|0)>>2]=a,b[n+4>>2]=318767104|e,b[(n=t+24|0)>>2]=a,b[n+4>>2]=335544320|e,b[(n=t+32|0)>>2]=a,b[n+4>>2]=352321536|e,b[(t=t+40|0)>>2]=a,b[t+4>>2]=369098752|e},_getOriginH3IndexFromUnidirectionalEdge:function(a,b){var e;return a|=0,v(0|((e=!0&268435456==(2013265920&(b|=0)|0))?-2130706433&b|134217728:0)),0|(e?a:0)},_getPentagonIndexes:Qe,_getRes0Indexes:function(a){a|=0;var e=0,t=0,r=0;e=0;do{dd(0|e,0,45),r=134225919|w(),b[(t=a+(e<<3)|0)>>2]=-1,b[t+4>>2]=r,e=e+1|0}while(122!=(0|e))},_h3Distance:function(a,b,e,t){var r,n,g;return e|=0,t|=0,g=k,k=k+32|0,n=g,a=0==(0|et(a|=0,b|=0,a,b,r=g+12|0))&&0==(0|et(a,b,e,t,n))?0|pe(r,n):-1,k=g,0|a},_h3GetBaseCell:ze,_h3GetFaces:function e(a,t,r){r|=0;var n,o=0,l=0,g=0,A=0,i=0,c=0,h=0,d=0;n=k,k=k+128|0,h=n+112|0,g=n+96|0,d=n,l=0|Ct(0|(a|=0),0|(t|=0),52),w(),i=15&l,b[h>>2]=i,A=0|Ct(0|a,0|t,45),w(),A&=127;e:do{if(0|R(A)){if(0|i)for(o=1;;){if(!(0==((c=0|dd(7,0,3*(15-o|0)|0))&a|0)&0==((0|w())&t|0))){l=0;break e}if(!(o>>>0<i>>>0))break;o=o+1|0}if(!(1&l))return c=0|dd(i+1|0,0,52),d=0|w()|-15728641&t,e((c|a)&~(h=0|dd(7,0,3*(14-i|0)|0)),d&~(0|w()),r),void(k=n);l=1}else l=0}while(0);Ze(a,t,g),l?(be(g,h,d),c=5):(Me(g,h,d),c=6);e:do{if(0|R(A))if(i)for(o=1;;){if(!(0==((A=0|dd(7,0,3*(15-o|0)|0))&a|0)&0==((0|w())&t|0))){o=8;break e}if(!(o>>>0<i>>>0)){o=20;break}o=o+1|0}else o=20;else o=8}while(0);if(zt(0|r,-1,0|o),l){l=0;do{for(Te(g=d+(l<<4)|0,0|b[h>>2]),g=0|b[g>>2],o=0;!(-1==(0|(i=0|b[(A=r+(o<<2)|0)>>2]))|(0|i)==(0|g));)o=o+1|0;b[A>>2]=g,l=l+1|0}while((0|l)!=(0|c))}else{l=0;do{for(we(g=d+(l<<4)|0,0|b[h>>2],0,1),g=0|b[g>>2],o=0;!(-1==(0|(i=0|b[(A=r+(o<<2)|0)>>2]))|(0|i)==(0|g));)o=o+1|0;b[A>>2]=g,l=l+1|0}while((0|l)!=(0|c))}k=n},_h3GetResolution:function(a,b){return b=0|Ct(0|(a|=0),0|(b|=0),52),w(),15&b|0},_h3IndexesAreNeighbors:He,_h3IsPentagon:Le,_h3IsResClassIII:function(a,b){return b=0|Ct(0|(a|=0),0|(b|=0),52),w(),1&b|0},_h3IsValid:De,_h3Line:function(a,e,t,r,n){t|=0,r|=0,n|=0;var o,g=0,l=0,i=0,A=0,c=0,h=0,d=0,f=0,m=0,p=0,_=0,s=0,y=0,u=0,x=0,v=0,w=0;if(o=k,k=k+48|0,l=o+12|0,v=o,0==(0|et(a|=0,e|=0,a,e,g=o+24|0))&&0==(0|et(a,e,t,r,l))){if((0|(x=0|pe(g,l)))<0)return k=o,0|(v=x);for(b[g>>2]=0,b[g+4>>2]=0,b[g+8>>2]=0,b[l>>2]=0,b[l+4>>2]=0,b[l+8>>2]=0,et(a,e,a,e,g),et(a,e,t,r,l),me(g),me(l),x?(m=+(0|x),u=g,t=h=0|b[g>>2],r=d=0|b[(s=g+4|0)>>2],g=f=0|b[(y=g+8|0)>>2],p=+((0|b[l>>2])-h|0)/m,_=+((0|b[l+4>>2])-d|0)/m,m=+((0|b[l+8>>2])-f|0)/m):(s=r=g+4|0,y=f=g+8|0,u=g,t=0|b[g>>2],r=0|b[r>>2],g=0|b[f>>2],p=0,_=0,m=0),b[v>>2]=t,b[(f=v+4|0)>>2]=r,b[(d=v+8|0)>>2]=g,h=0;;){w=p*(A=+(0|h))+ +(0|t),i=_*A+ +(0|b[s>>2]),A=m*A+ +(0|b[y>>2]),r=~~+St(+w),l=~~+St(+i),t=~~+St(+A),w=+q(+(+(0|r)-w)),i=+q(+(+(0|l)-i)),A=+q(+(+(0|t)-A));do{if(!(w>i&w>A)){if(c=0-r|0,i>A){g=c-t|0;break}g=l,t=c-l|0;break}r=0-(l+t)|0,g=l}while(0);if(b[v>>2]=r,b[f>>2]=g,b[d>>2]=t,_e(v),tt(a,e,v,n+(h<<3)|0),(0|h)==(0|x))break;h=h+1|0,t=0|b[u>>2]}return k=o,0|(v=0)}return k=o,0|(v=-1)},_h3LineSize:function(a,b,e,t){var r,n,g;return e|=0,t|=0,g=k,k=k+32|0,n=g,a=0==(0|et(a|=0,b|=0,a,b,r=g+12|0))&&0==(0|et(a,b,e,t,n))?0|pe(r,n):-1,k=g,(a>>>31^1)+a|0},_h3SetToLinkedGeo:function(a,e,t){t|=0;var r,n,g,o=0;if(g=k,k=k+32|0,r=g,function(a,e,t){a|=0,t|=0;var r,n,o=0,l=0,g=0,A=0,i=0;if(n=k,k=k+176|0,r=n,(0|(e|=0))<1)return ut(t,0,0),void(k=n);A=0|Ct(0|b[(A=a)>>2],0|b[A+4>>2],52),w(),ut(t,(0|e)>6?e:6,15&A),A=0;do{if($e(0|b[(o=a+(A<<3)|0)>>2],0|b[o+4>>2],r),(0|(o=0|b[r>>2]))>0){i=0;do{g=r+8+(i<<4)|0,(l=0|_t(t,o=r+8+(((0|(i=i+1|0))%(0|o)|0)<<4)|0,g))?ft(t,l):mt(t,g,o),o=0|b[r>>2]}while((0|i)<(0|o))}A=A+1|0}while((0|A)!=(0|e));k=n}(a|=0,e|=0,n=g+16|0),b[t>>2]=0,b[t+4>>2]=0,b[t+8>>2]=0,!(a=0|pt(n)))return Ke(t),ht(n),void(k=g);do{e=0|Xe(t);do{Ye(e,a),o=a+16|0,b[r>>2]=b[o>>2],b[r+4>>2]=b[o+4>>2],b[r+8>>2]=b[o+8>>2],b[r+12>>2]=b[o+12>>2],ft(n,a),a=0|gt(n,r)}while(0!=(0|a));a=0|pt(n)}while(0!=(0|a));Ke(t),ht(n),k=g},_h3ToCenterChild:function(a,b,e){e|=0;var t=0,r=0;if(t=0|Ct(0|(a|=0),0|(b|=0),52),w(),(0|e)<16&(0|(t&=15))<=(0|e)){if((0|t)!=(0|e)&&(a|=r=0|dd(0|e,0,52),b=0|w()|-15728641&b,(0|t)<(0|e)))do{r=0|dd(7,0,3*(14-t|0)|0),t=t+1|0,a&=~r,b&=~(0|w())}while((0|t)<(0|e))}else b=0,a=0;return v(0|b),0|a},_h3ToChildren:Pe,_h3ToGeo:qe,_h3ToGeoBoundary:$e,_h3ToParent:Be,_h3UnidirectionalEdgeIsValid:function(a,b){var e=0;if(!(!0&268435456==(2013265920&(b|=0)|0)))return 0|(e=0);switch(e=0|Ct(0|(a|=0),0|b,56),w(),7&e){case 0:case 7:return 0|(e=0)}return!0&16777216==(117440512&b|0)&0!=(0|Le(a,e=-2130706433&b|134217728))?0|(e=0):0|(e=0|De(a,e))},_hexAreaKm2:function(a){return+ +n[20496+((a|=0)<<3)>>3]},_hexAreaM2:function(a){return+ +n[20624+((a|=0)<<3)>>3]},_hexRing:function(a,e,t,r){a|=0,e|=0,r|=0;var n,o=0,g=0,l=0,i=0,A=0,c=0,h=0;if(n=k,k=k+16|0,h=n,!(t|=0))return b[(h=r)>>2]=a,b[h+4>>2]=e,k=n,0|(h=0);b[h>>2]=0;e:do{if(0|Le(a,e))a=1;else{if(g=(0|t)>0){o=0,c=a;do{if(0==(0|(c=0|P(c,e,4,h)))&0==(0|(e=0|w()))){a=2;break e}if(o=o+1|0,0|Le(c,e)){a=1;break e}}while((0|o)<(0|t));if(b[(A=r)>>2]=c,b[A+4>>2]=e,A=t+-1|0,g){g=0,l=1,o=c,a=e;do{if(0==(0|(o=0|P(o,a,2,h)))&0==(0|(a=0|w()))){a=2;break e}if(b[(i=r+(l<<3)|0)>>2]=o,b[i+4>>2]=a,l=l+1|0,0|Le(o,a)){a=1;break e}g=g+1|0}while((0|g)<(0|t));i=0,g=l;do{if(0==(0|(o=0|P(o,a,3,h)))&0==(0|(a=0|w()))){a=2;break e}if(b[(l=r+(g<<3)|0)>>2]=o,b[l+4>>2]=a,g=g+1|0,0|Le(o,a)){a=1;break e}i=i+1|0}while((0|i)<(0|t));l=0;do{if(0==(0|(o=0|P(o,a,1,h)))&0==(0|(a=0|w()))){a=2;break e}if(b[(i=r+(g<<3)|0)>>2]=o,b[i+4>>2]=a,g=g+1|0,0|Le(o,a)){a=1;break e}l=l+1|0}while((0|l)<(0|t));l=0;do{if(0==(0|(o=0|P(o,a,5,h)))&0==(0|(a=0|w()))){a=2;break e}if(b[(i=r+(g<<3)|0)>>2]=o,b[i+4>>2]=a,g=g+1|0,0|Le(o,a)){a=1;break e}l=l+1|0}while((0|l)<(0|t));l=0;do{if(0==(0|(o=0|P(o,a,4,h)))&0==(0|(a=0|w()))){a=2;break e}if(b[(i=r+(g<<3)|0)>>2]=o,b[i+4>>2]=a,g=g+1|0,0|Le(o,a)){a=1;break e}l=l+1|0}while((0|l)<(0|t));for(l=0;;){if(0==(0|(o=0|P(o,a,6,h)))&0==(0|(a=0|w()))){a=2;break e}if((0|l)!=(0|A)){if(b[(i=r+(g<<3)|0)>>2]=o,b[i+4>>2]=a,0|Le(o,a)){a=1;break e}g=g+1|0}if((0|(l=l+1|0))>=(0|t)){l=c,g=e;break}}}else l=c,o=c,g=e,a=e}else b[(l=r)>>2]=a,b[l+4>>2]=e,l=a,o=a,g=e,a=e;a=1&((0|l)!=(0|o)|(0|g)!=(0|a))}}while(0);return k=n,0|(h=a)},_i64Subtract:wt,_kRing:z,_kRingDistances:function(a,b,e,t,r){var n;if(0|D(a|=0,b|=0,e|=0,t|=0,r|=0)){if(zt(0|t,0,(n=1+(0|_(3*e|0,e+1|0))|0)<<3|0),0|r)return zt(0|r,0,n<<2|0),void B(a,b,e,t,r,n,0);(r=0|bt(n,4))&&(B(a,b,e,t,r,n,0),vt(r))}},_llvm_minnum_f64:It,_llvm_round_f64:St,_malloc:xt,_maxFaceCount:function(a,b){var e=0,t=0;if(t=0|Ct(0|(a|=0),0|(b|=0),45),w(),!(0|R(127&t)))return 0|(t=2);if(t=0|Ct(0|a,0|b,52),w(),!(t&=15))return 0|(t=5);for(e=1;;){if(!(0==((0|dd(7,0,3*(15-e|0)|0))&a|0)&0==((0|w())&b|0))){e=2,a=6;break}if(!(e>>>0<t>>>0)){e=5,a=6;break}e=e+1|0}return 6==(0|a)?0|e:0},_maxH3ToChildrenSize:function(a,b,e){return e|=0,a=0|Ct(0|(a|=0),0|(b|=0),52),w(),(0|e)<16&(0|(a&=15))<=(0|e)?0|(e=0|it(7,e-a|0)):0|(e=0)},_maxKringSize:function(a){return 1+(0|_(3*(a|=0)|0,a+1|0))|0},_maxPolyfillSize:function(a,e){e|=0;var g,t=0,r=0,n=0,o=0,i=0;if(g=k,k=k+48|0,n=g+8|0,r=g,o=0|b[(i=a|=0)+4>>2],b[(t=r)>>2]=b[i>>2],b[t+4>>2]=o,ot(r,n),n=0|$(n,e),e=0|b[r>>2],(0|(r=0|b[a+8>>2]))<=0)return k=g,0|(i=(i=(o=(0|n)<(0|(i=e)))?i:n)+12|0);t=0|b[a+12>>2],a=0;do{e=(0|b[t+(a<<3)>>2])+e|0,a=a+1|0}while((0|a)<(0|r));return k=g,0|(i=(i=(i=(0|n)<(0|e))?e:n)+12|0)},_maxUncompactSize:function(a,e,t){a|=0,t|=0;var r=0,n=0,g=0,o=0;if((0|(e|=0))<=0)return 0|(t=0);if((0|t)>=16){for(r=0;;){if(!(0==(0|b[(o=a+(r<<3)|0)>>2])&0==(0|b[o+4>>2]))){r=-1,n=13;break}if((0|(r=r+1|0))>=(0|e)){r=0,n=13;break}}if(13==(0|n))return 0|r}r=0,o=0;e:for(;;){g=0|b[(n=a+(o<<3)|0)>>2],n=0|b[n+4>>2];do{if(!(0==(0|g)&0==(0|n))){if(n=0|Ct(0|g,0|n,52),w(),(0|(n&=15))>(0|t)){r=-1,n=13;break e}if((0|n)==(0|t)){r=r+1|0;break}r=(0|it(7,t-n|0))+r|0;break}}while(0);if((0|(o=o+1|0))>=(0|e)){n=13;break}}return 13==(0|n)?0|r:0},_memcpy:kt,_memset:zt,_numHexagons:function(a){var e;return a=0|b[(e=21008+((a|=0)<<3)|0)>>2],v(0|b[e+4>>2]),0|a},_pentagonIndexCount:function(){return 12},_pointDistKm:Se,_pointDistM:function(a,b){a|=0;var e,t,g,r=0;return t=+n[(b|=0)>>3],e=+n[a>>3],r=(g=+u(.5*(t-e)))*g+(r=+u(.5*(+n[b+8>>3]-+n[a+8>>3])))*(+l(+t)*+l(+e)*r),2*+f(+ +o(+r),+ +o(+(1-r)))*6371.007180918475*1e3},_pointDistRads:function(a,b){a|=0;var e,t,g,r=0;return t=+n[(b|=0)>>3],e=+n[a>>3],r=(g=+u(.5*(t-e)))*g+(r=+u(.5*(+n[b+8>>3]-+n[a+8>>3])))*(+l(+t)*+l(+e)*r),2*+f(+ +o(+r),+ +o(+(1-r)))},_polyfill:function(a,e,t){var i,r=0,n=0,g=0,o=0,l=0;if(i=k,k=k+48|0,r=i+8|0,n=i,0|function(a,e,t){e|=0,t|=0;var r=0,n=0,g=0,o=0,i=0,l=0,A=0,c=0,h=0,d=0,f=0,p=0,q=0,m=0,s=0,_=0,u=0,y=0,x=0,v=0,E=0,M=0,C=0,I=0,S=0,z=0,P=0,R=0,F=0,O=0;O=k,k=k+112|0,z=O+80|0,l=O+72|0,P=O,R=O+56|0,(F=0|xt(32+(b[(A=(a=a|0)+8|0)>>2]<<5)|0))||T(22848,22448,800,22456);if(at(a,F),r=0|b[(g=a)+4>>2],b[(i=l)>>2]=b[g>>2],b[i+4>>2]=r,ot(l,z),i=0|$(z,e),r=0|b[l>>2],(0|(g=0|b[A>>2]))>0){o=0|b[a+12>>2],n=0;do{r=(0|b[o+(n<<3)>>2])+r|0,n=n+1|0}while((0|n)!=(0|g))}if(n=0|bt(S=(i=(0|i)<(0|r)?r:i)+12|0,8),c=0|bt(S,8),b[z>>2]=0,I=0|b[(C=a)+4>>2],b[(r=l)>>2]=b[C>>2],b[r+4>>2]=I,0|(r=0|L(l,S,e,z,n,c)))return vt(n),vt(c),vt(F),k=O,0|(F=r);e:do{if((0|b[A>>2])>0){for(g=a+12|0,r=0;o=0|L((0|b[g>>2])+(r<<3)|0,S,e,z,n,c),r=r+1|0,!(0|o);)if((0|r)>=(0|b[A>>2]))break e;return vt(n),vt(c),vt(F),k=O,0|(F=o)}}while(0);(0|i)>-12&&zt(0|c,0,((0|S)>1?S:1)<<3|0);e:do{if((0|b[z>>2])>0){I=((0|S)<0)<<31>>31,y=n,x=c,v=n,E=n,M=c,C=n,r=n,m=n,s=c,_=c,u=c,n=c;t:for(;;){for(q=0|b[z>>2],f=0,p=0,g=0;;){i=(o=P)+56|0;do{b[o>>2]=0,o=o+4|0}while((0|o)<(0|i));if(0|D(l=0|b[(e=y+(f<<3)|0)>>2],e=0|b[e+4>>2],1,P,0)){i=(o=P)+56|0;do{b[o>>2]=0,o=o+4|0}while((0|o)<(0|i));0|(o=0|bt(7,4))&&(B(l,e,1,P,o,7,0),vt(o))}d=0;do{c=0|b[(h=P+(d<<3)|0)>>2],h=0|b[h+4>>2];i:do{if(!(0==(0|c)&0==(0|h))){if(l=0|Mt(0|c,0|h,0|S,0|I),w(),!(0==(0|(e=0|b[(i=o=t+(l<<3)|0)>>2]))&0==(0|(i=0|b[i+4>>2]))))for(A=0;;){if((0|A)>(0|S))break t;if((0|e)==(0|c)&(0|i)==(0|h))break i;if(0==(0|(e=0|b[(i=o=t+((l=(l+1|0)%(0|S)|0)<<3)|0)>>2]))&0==(0|(i=0|b[i+4>>2])))break;A=A+1|0}0==(0|c)&0==(0|h)||(qe(c,h,R),0|st(a,F,R)&&(b[(A=o)>>2]=c,b[A+4>>2]=h,b[(A=x+(g<<3)|0)>>2]=c,b[A+4>>2]=h,g=g+1|0))}}while(0);d=d+1|0}while(d>>>0<7);if((0|(p=p+1|0))>=(0|q))break;f=f+1|0}if((0|q)>0&&zt(0|v,0,q<<3|0),b[z>>2]=g,!((0|g)>0))break e;c=n,h=u,d=C,f=_,p=s,q=x,n=m,u=r,_=E,s=v,m=c,r=h,C=M,M=d,E=f,v=p,x=y,y=q}return vt(E),vt(M),vt(F),k=O,0|(F=-1)}r=c}while(0);return vt(F),vt(n),vt(r),k=O,0|(F=0)}(a|=0,e|=0,t|=0)){if(g=0|b[(l=a)+4>>2],b[(o=n)>>2]=b[l>>2],b[o+4>>2]=g,ot(n,r),o=0|$(r,e),e=0|b[n>>2],(0|(g=0|b[a+8>>2]))>0){n=0|b[a+12>>2],r=0;do{e=(0|b[n+(r<<3)>>2])+e|0,r=r+1|0}while((0|r)!=(0|g))}(0|(e=(0|o)<(0|e)?e:o))<=-12||zt(0|t,0,8+(((0|(l=e+11|0))>0?l:0)<<3)|0),k=i}else k=i},_res0IndexCount:function(){return 122},_round:Dt,_sbrk:Bt,_sizeOfCoordIJ:function(){return 8},_sizeOfGeoBoundary:function(){return 168},_sizeOfGeoCoord:function(){return 16},_sizeOfGeoPolygon:function(){return 16},_sizeOfGeofence:function(){return 8},_sizeOfH3Index:function(){return 8},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompact:function(a,e,t,r,n){a|=0,t|=0,r|=0,n|=0;var g=0,o=0,i=0,l=0,A=0,c=0;if((0|(e|=0))<=0)return 0|(n=0);if((0|n)>=16){for(g=0;;){if(!(0==(0|b[(c=a+(g<<3)|0)>>2])&0==(0|b[c+4>>2]))){g=14;break}if((0|(g=g+1|0))>=(0|e)){o=0,g=16;break}}if(14==(0|g))return 0|((0|r)>0?-2:-1);if(16==(0|g))return 0|o}g=0,c=0;e:for(;;){o=0|b[(i=A=a+(c<<3)|0)>>2],i=0|b[i+4>>2];do{if(!(0==(0|o)&0==(0|i))){if((0|g)>=(0|r)){o=-1,g=16;break e}if(l=0|Ct(0|o,0|i,52),w(),(0|(l&=15))>(0|n)){o=-2,g=16;break e}if((0|l)==(0|n)){b[(A=t+(g<<3)|0)>>2]=o,b[A+4>>2]=i,g=g+1|0;break}if((0|(o=(0|it(7,n-l|0))+g|0))>(0|r)){o=-1,g=16;break e}Pe(0|b[A>>2],0|b[A+4>>2],n,t+(g<<3)|0),g=o}}while(0);if((0|(c=c+1|0))>=(0|e)){o=0,g=16;break}}return 16==(0|g)?0|o:0},establishStackSpace:function(a,b){k=a|=0},stackAlloc:function(a){var b;return b=k,k=(k=k+(a|=0)|0)+15&-16,0|b},stackRestore:function(a){k=a|=0},stackSave:function(){return 0|k}}}({Math:Math,Int8Array:Int8Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Float32Array:Float32Array,Float64Array:Float64Array},{a:fe,b:function(e){d=e},c:f,d:function(e,t,line,r){fe("Assertion failed: "+v(e)+", at: "+[t?v(t):"unknown filename",line,r?v(r):"unknown function"])},e:function(e){return r.___errno_location&&(C[r.___errno_location()>>2]=e),e},f:ee,g:function(e,t,r){E.set(E.subarray(t,t+r),e)},h:function(e){var t=ee(),r=16777216,n=2130706432;if(e>n)return!1;for(var o=Math.max(t,16777216);o<e;)o=o<=536870912?k(2*o,r):Math.min(k((3*o+2147483648)/4,r),n);return!!te(o)},i:function(e){fe("OOM")},j:Y,k:K,l:te,m:J,n:function(){var e=J();return r.extraStackTrace&&(e+="\n"+r.extraStackTrace()),K(e)},o:24032,p:24016},w),ae=(r.___uremdi3=oe.___uremdi3,r._bitshift64Lshr=oe._bitshift64Lshr,r._bitshift64Shl=oe._bitshift64Shl,r._calloc=oe._calloc,r._cellAreaKm2=oe._cellAreaKm2,r._cellAreaM2=oe._cellAreaM2,r._cellAreaRads2=oe._cellAreaRads2,r._compact=oe._compact,r._destroyLinkedPolygon=oe._destroyLinkedPolygon,r._edgeLengthKm=oe._edgeLengthKm,r._edgeLengthM=oe._edgeLengthM,r._emscripten_replace_memory=oe._emscripten_replace_memory),se=(r._exactEdgeLengthKm=oe._exactEdgeLengthKm,r._exactEdgeLengthM=oe._exactEdgeLengthM,r._exactEdgeLengthRads=oe._exactEdgeLengthRads,r._experimentalH3ToLocalIj=oe._experimentalH3ToLocalIj,r._experimentalLocalIjToH3=oe._experimentalLocalIjToH3,r._free=oe._free,r._geoToH3=oe._geoToH3,r._getDestinationH3IndexFromUnidirectionalEdge=oe._getDestinationH3IndexFromUnidirectionalEdge,r._getH3IndexesFromUnidirectionalEdge=oe._getH3IndexesFromUnidirectionalEdge,r._getH3UnidirectionalEdge=oe._getH3UnidirectionalEdge,r._getH3UnidirectionalEdgeBoundary=oe._getH3UnidirectionalEdgeBoundary,r._getH3UnidirectionalEdgesFromHexagon=oe._getH3UnidirectionalEdgesFromHexagon,r._getOriginH3IndexFromUnidirectionalEdge=oe._getOriginH3IndexFromUnidirectionalEdge,r._getPentagonIndexes=oe._getPentagonIndexes,r._getRes0Indexes=oe._getRes0Indexes,r._h3Distance=oe._h3Distance,r._h3GetBaseCell=oe._h3GetBaseCell,r._h3GetFaces=oe._h3GetFaces,r._h3GetResolution=oe._h3GetResolution,r._h3IndexesAreNeighbors=oe._h3IndexesAreNeighbors,r._h3IsPentagon=oe._h3IsPentagon,r._h3IsResClassIII=oe._h3IsResClassIII,r._h3IsValid=oe._h3IsValid,r._h3Line=oe._h3Line,r._h3LineSize=oe._h3LineSize,r._h3SetToLinkedGeo=oe._h3SetToLinkedGeo,r._h3ToCenterChild=oe._h3ToCenterChild,r._h3ToChildren=oe._h3ToChildren,r._h3ToGeo=oe._h3ToGeo,r._h3ToGeoBoundary=oe._h3ToGeoBoundary,r._h3ToParent=oe._h3ToParent,r._h3UnidirectionalEdgeIsValid=oe._h3UnidirectionalEdgeIsValid,r._hexAreaKm2=oe._hexAreaKm2,r._hexAreaM2=oe._hexAreaM2,r._hexRing=oe._hexRing,r._i64Subtract=oe._i64Subtract,r._kRing=oe._kRing,r._kRingDistances=oe._kRingDistances,r._llvm_minnum_f64=oe._llvm_minnum_f64,r._llvm_round_f64=oe._llvm_round_f64,r._malloc=oe._malloc,r._maxFaceCount=oe._maxFaceCount,r._maxH3ToChildrenSize=oe._maxH3ToChildrenSize,r._maxKringSize=oe._maxKringSize,r._maxPolyfillSize=oe._maxPolyfillSize,r._maxUncompactSize=oe._maxUncompactSize,r._memcpy=oe._memcpy,r._memset=oe._memset,r._numHexagons=oe._numHexagons,r._pentagonIndexCount=oe._pentagonIndexCount,r._pointDistKm=oe._pointDistKm,r._pointDistM=oe._pointDistM,r._pointDistRads=oe._pointDistRads,r._polyfill=oe._polyfill,r._res0IndexCount=oe._res0IndexCount,r._round=oe._round,r._sbrk=oe._sbrk,r._sizeOfCoordIJ=oe._sizeOfCoordIJ,r._sizeOfGeoBoundary=oe._sizeOfGeoBoundary,r._sizeOfGeoCoord=oe._sizeOfGeoCoord,r._sizeOfGeoPolygon=oe._sizeOfGeoPolygon,r._sizeOfGeofence=oe._sizeOfGeofence,r._sizeOfH3Index=oe._sizeOfH3Index,r._sizeOfLinkedGeoPolygon=oe._sizeOfLinkedGeoPolygon,r._uncompact=oe._uncompact,r.establishStackSpace=oe.establishStackSpace,r.stackAlloc=oe.stackAlloc),le=r.stackRestore=oe.stackRestore,Ae=r.stackSave=oe.stackSave;if(r.asm=oe,r.cwrap=function(e,t,r,n){var o=(r=r||[]).every((function(e){return"number"===e}));return"string"!==t&&o&&!n?_(e):function(){return y(e,t,r,arguments)}},r.setValue=function(e,t,r,n){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":T[e>>0]=t;break;case"i16":M[e>>1]=t;break;case"i32":C[e>>2]=t;break;case"i64":Q=[t>>>0,($=t,+O($)>=1?$>0?(0|j(+V($/4294967296),4294967295))>>>0:~~+U(($-+(~~$>>>0))/4294967296)>>>0:0)],C[e>>2]=Q[0],C[e+4>>2]=Q[1];break;case"float":I[e>>2]=t;break;case"double":S[e>>3]=t;break;default:fe("invalid type for setValue: "+r)}},r.getValue=function(e,t,r){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return T[e>>0];case"i16":return M[e>>1];case"i32":case"i64":return C[e>>2];case"float":return I[e>>2];case"double":return S[e>>3];default:fe("invalid type for getValue: "+t)}return null},r.getTempRet0=f,H){X(H)||(path=H,H=r.locateFile?r.locateFile(path,A):A+path),G++,r.monitorRunDependencies&&r.monitorRunDependencies(G);var ce=function(data){data.byteLength&&(data=new Uint8Array(data)),E.set(data,8),r.memoryInitializerRequest&&delete r.memoryInitializerRequest.response,function(e){if(G--,r.monitorRunDependencies&&r.monitorRunDependencies(G),0==G&&(null!==N&&(clearInterval(N),N=null),Z)){var t=Z;Z=null,t()}}()},ue=function(){o(H,ce,(function(){throw"could not load memory initializer "+H}))},he=re(H);if(he)ce(he.buffer);else if(r.memoryInitializerRequest){var pe=function(){var e=r.memoryInitializerRequest,t=e.response;if(200!==e.status&&0!==e.status){var data=re(r.memoryInitializerRequestURL);if(!data)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+e.status+", retrying "+H),void ue();t=data.buffer}ce(t)};r.memoryInitializerRequest.response?setTimeout(pe,0):r.memoryInitializerRequest.addEventListener("load",pe)}else ue()}function de(e){function t(){ne||(ne=!0,m||(B(L),B(R),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),F.unshift(e);var e;B(F)}()))}e=e||l,G>0||(!function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),P.unshift(e);var e;B(P)}(),G>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),t()}),1)):t()))}function fe(e){throw r.onAbort&&r.onAbort(e),c(e+=""),h(e),m=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(Z=function e(){ne||de(),ne||(Z=e)},r.run=de,r.abort=fe,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return de(),e}("object"==typeof n?n:{}),o="number",l={};[["sizeOfH3Index",o],["sizeOfGeoCoord",o],["sizeOfGeoBoundary",o],["sizeOfGeoPolygon",o],["sizeOfGeofence",o],["sizeOfLinkedGeoPolygon",o],["sizeOfCoordIJ",o],["h3IsValid",o,[o,o]],["geoToH3",o,[o,o,o]],["h3ToGeo",null,[o,o,o]],["h3ToGeoBoundary",null,[o,o,o]],["maxKringSize",o,[o]],["kRing",null,[o,o,o,o]],["kRingDistances",null,[o,o,o,o,o]],["hexRing",null,[o,o,o,o]],["maxPolyfillSize",o,[o,o]],["polyfill",null,[o,o,o]],["h3SetToLinkedGeo",null,[o,o,o]],["destroyLinkedPolygon",null,[o]],["compact",o,[o,o,o]],["uncompact",o,[o,o,o,o,o]],["maxUncompactSize",o,[o,o,o]],["h3IsPentagon",o,[o,o]],["h3IsResClassIII",o,[o,o]],["h3GetBaseCell",o,[o,o]],["h3GetResolution",o,[o,o]],["maxFaceCount",o,[o,o]],["h3GetFaces",null,[o,o,o]],["h3ToParent",o,[o,o,o]],["h3ToChildren",null,[o,o,o,o]],["h3ToCenterChild",o,[o,o,o]],["maxH3ToChildrenSize",o,[o,o,o]],["h3IndexesAreNeighbors",o,[o,o,o,o]],["getH3UnidirectionalEdge",o,[o,o,o,o]],["getOriginH3IndexFromUnidirectionalEdge",o,[o,o]],["getDestinationH3IndexFromUnidirectionalEdge",o,[o,o]],["h3UnidirectionalEdgeIsValid",o,[o,o]],["getH3IndexesFromUnidirectionalEdge",null,[o,o,o]],["getH3UnidirectionalEdgesFromHexagon",null,[o,o,o]],["getH3UnidirectionalEdgeBoundary",null,[o,o,o]],["h3Distance",o,[o,o,o,o]],["h3Line",o,[o,o,o,o,o]],["h3LineSize",o,[o,o,o,o]],["experimentalH3ToLocalIj",o,[o,o,o,o,o]],["experimentalLocalIjToH3",o,[o,o,o,o]],["hexAreaM2",o,[o]],["hexAreaKm2",o,[o]],["edgeLengthM",o,[o]],["edgeLengthKm",o,[o]],["pointDistM",o,[o,o]],["pointDistKm",o,[o,o]],["pointDistRads",o,[o,o]],["cellAreaM2",o,[o,o]],["cellAreaKm2",o,[o,o]],["cellAreaRads2",o,[o,o]],["exactEdgeLengthM",o,[o,o]],["exactEdgeLengthKm",o,[o,o]],["exactEdgeLengthRads",o,[o,o]],["numHexagons",o,[o]],["getRes0Indexes",null,[o]],["res0IndexCount",o],["getPentagonIndexes",null,[o,o]],["pentagonIndexCount",o]].forEach((function(e){l[e[0]]=n.cwrap.apply(n,e)}));var A=16,c=l.sizeOfH3Index(),h=l.sizeOfGeoCoord(),d=l.sizeOfGeoBoundary(),f=l.sizeOfGeoPolygon(),m=l.sizeOfGeofence(),_=l.sizeOfLinkedGeoPolygon(),y=l.sizeOfCoordIJ(),x={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function v(e){if("number"!=typeof e||e<0||e>15||Math.floor(e)!==e)throw new Error("Invalid resolution: "+e)}var w=/[^0-9a-fA-F]/;function T(e){if(Array.isArray(e)&&2===e.length&&Number.isInteger(e[0])&&Number.isInteger(e[1]))return e;if("string"!=typeof e||w.test(e))return[0,0];var t=parseInt(e.substring(0,e.length-8),A);return[parseInt(e.substring(e.length-8),A),t]}function E(e){if(e>=0)return e.toString(A);var t=C(8,(e&=2147483647).toString(A));return t=(parseInt(t[0],A)+8).toString(A)+t.substring(1)}function M(e,t){return E(t)+C(8,E(e))}function C(e,t){for(var r=e-t.length,n="",i=0;i<r;i++)n+="0";return n+=t}function I(e,t,r){for(var o=e.length,l=n._calloc(o,h),A=r?1:0,c=r?0:1,i=0;i<2*o;i+=2)n.HEAPF64.set([e[i/2][A],e[i/2][c]].map(Me),l/8+i);return n.HEAPU32.set([o,l],t/4),t}function S(e){return[e,n.getTempRet0()]}function k(e){var t=S(e),r=t[0],n=t[1];return n?M(r,n):null}function z(e,t){void 0===t&&(t=0);var r=n.getValue(e+4*t*2,"i32"),o=n.getValue(e+4*(2*t+1),"i32");return o?M(r,o):null}function D(e,t,r){n.HEAPU32.set(T(e),t/4+2*r)}function B(e,t){for(var r=[],i=0;i<t;i++){var n=z(e,i);null!==n&&r.push(n)}return r}function P(e,t){for(var r=t.length,i=0;i<r;i++)D(t[i],e,i)}function L(e,t){var r=n._calloc(1,h);return n.HEAPF64.set([e,t].map(Me),r/8),r}function R(e){return Ce(n.getValue(e,"double"))}function F(e){return[R(e),R(e+8)]}function O(e){return[R(e+8),R(e)]}function U(e,t,r){for(var o=n.getValue(e,"i32"),l=e+8,A=[],c=t?O:F,i=0;i<2*o;i+=2)A.push(c(l+8*i));return r&&A.push(A[0]),A}function V(e){var t=T(e),r=t[0],n=t[1];return Boolean(l.h3IsValid(r,n))}function j(e){var t=T(e),r=t[0],n=t[1];return Boolean(l.h3IsPentagon(r,n))}function G(e){var t=T(e),r=t[0],n=t[1];return Boolean(l.h3IsResClassIII(r,n))}function N(e){var t=T(e),r=t[0],n=t[1];return l.h3GetBaseCell(r,n)}function Z(e){var t=T(e),r=t[0],o=t[1],A=l.maxFaceCount(r,o),c=n._malloc(4*A);l.h3GetFaces(r,o,c);var h=function(e,t){for(var r=[],i=0;i<t;i++){var o=n.getValue(e+4*i,"i32");o>=0&&r.push(o)}return r}(c,A);return n._free(c),h}function $(e){var t=T(e),r=t[0],n=t[1];return l.h3IsValid(r,n)?l.h3GetResolution(r,n):-1}function Q(e,t,r){var o=n._malloc(h);n.HEAPF64.set([e,t].map(Me),o/8);var A=k(l.geoToH3(o,r));return n._free(o),A}function H(e){var t=n._malloc(h),r=T(e),o=r[0],A=r[1];l.h3ToGeo(o,A,t);var c=F(t);return n._free(t),c}function W(e,t){var r=n._malloc(d),o=T(e),A=o[0],c=o[1];l.h3ToGeoBoundary(A,c,r);var h=U(r,t,t);return n._free(r),h}function X(e,t){var r=T(e),n=r[0],o=r[1];return k(l.h3ToParent(n,o,t))}function Y(e,t){if(!V(e))return[];var r=T(e),o=r[0],A=r[1],h=l.maxH3ToChildrenSize(o,A,t),d=n._calloc(h,c);l.h3ToChildren(o,A,t,d);var f=B(d,h);return n._free(d),f}function K(e,t){var r=T(e),n=r[0],o=r[1];return k(l.h3ToCenterChild(n,o,t))}function J(e,t){var r=T(e),o=r[0],A=r[1],h=l.maxKringSize(t),d=n._calloc(h,c);l.kRing(o,A,t,d);var f=B(d,h);return n._free(d),f}function ee(e,t){var r=T(e),o=r[0],A=r[1],h=l.maxKringSize(t),d=n._calloc(h,c),f=n._calloc(h,4);l.kRingDistances(o,A,t,d,f);for(var m=[],i=0;i<t+1;i++)m.push([]);for(var _=0;_<2*h;_+=2){var y=n.getValue(d+4*_,"i32"),x=n.getValue(d+4*(_+1),"i32"),v=n.getValue(f+_/2*4,"i32");0===y&&0===x||m[v].push(M(y,x))}return n._free(d),n._free(f),m}function te(e,t){var r=0===t?1:6*t,o=n._calloc(r,c);if(0!==l.hexRing.apply(l,T(e).concat([t],[o])))throw n._free(o),new Error("Failed to get hexRing (encountered a pentagon?)");var A=B(o,r);return n._free(o),A}function ie(e,t,r){if(v(t),r=Boolean(r),0===e.length||0===e[0].length)return[];"number"==typeof e[0][0]&&(e=[e]);var o=function(e,t){var r,o=e.length-1,l=n._calloc(f),A=0+m,c=A+4;if(I(e[0],l+0,t),o>0){r=n._calloc(o,m);for(var i=0;i<o;i++)I(e[i+1],r+m*i,t)}return n.setValue(l+A,o,"i32"),n.setValue(l+c,r,"i32"),l}(e,r),A=l.maxPolyfillSize(o,t),h=n._calloc(A,c);l.polyfill(o,t,h);var d=B(h,A);return n._free(h),function(e){var t=0+m,r=t+4;n._free(n.getValue(e+0+4,"i8*"));var o=n.getValue(e+t,"i32");if(o>0){for(var l=n.getValue(e+r,"i32"),i=0;i<o;i++)n._free(n.getValue(l+m*i+4,"i8*"));n._free(l)}n._free(e)}(o),d}function re(e,t){if(!e||!e.length)return[];var r=e.length,o=n._calloc(r,c);P(o,e);var polygon=n._calloc(_),A=polygon;l.h3SetToLinkedGeo(o,r,polygon);var h=function(polygon,e){for(var t,r,o,l,output=[],A=e?O:F;polygon;){for(output.push(t=[]),r=n.getValue(polygon,"i8*");r;){for(t.push(o=[]),l=n.getValue(r,"i8*");l;)o.push(A(l)),l=n.getValue(l+16,"i8*");e&&o.push(o[0]),r=n.getValue(r+8,"i8*")}polygon=n.getValue(polygon+8,"i8*")}return output}(polygon,t);return l.destroyLinkedPolygon(A),n._free(A),n._free(o),h}function ne(e){if(!e||!e.length)return[];var t=e.length,r=n._calloc(t,c);P(r,e);var o=n._calloc(t,c);if(0!==l.compact(r,o,t))throw n._free(r),n._free(o),new Error("Failed to compact, malformed input data (duplicate hexagons?)");var A=B(o,t);return n._free(r),n._free(o),A}function oe(e,t){if(v(t),!e||!e.length)return[];var r=e.length,o=n._calloc(r,c);P(o,e);var A=l.maxUncompactSize(o,r,t),h=n._calloc(A,c);if(0!==l.uncompact(o,r,h,A,t))throw n._free(o),n._free(h),new Error("Failed to uncompact (bad resolution?)");var d=B(h,A);return n._free(o),n._free(h),d}function ae(e,t){var r=T(e),n=r[0],o=r[1],A=T(t),c=A[0],h=A[1];return Boolean(l.h3IndexesAreNeighbors(n,o,c,h))}function se(e,t){var r=T(e),n=r[0],o=r[1],A=T(t),c=A[0],h=A[1];return k(l.getH3UnidirectionalEdge(n,o,c,h))}function le(e){var t=T(e),r=t[0],n=t[1];return k(l.getOriginH3IndexFromUnidirectionalEdge(r,n))}function Ae(e){var t=T(e),r=t[0],n=t[1];return k(l.getDestinationH3IndexFromUnidirectionalEdge(r,n))}function ce(e){var t=T(e),r=t[0],n=t[1];return Boolean(l.h3UnidirectionalEdgeIsValid(r,n))}function ue(e){var t=T(e),r=t[0],o=t[1],A=n._calloc(2,c);l.getH3IndexesFromUnidirectionalEdge(r,o,A);var h=B(A,2);return n._free(A),h}function he(e){var t=T(e),r=t[0],o=t[1],A=n._calloc(6,c);l.getH3UnidirectionalEdgesFromHexagon(r,o,A);var h=B(A,6);return n._free(A),h}function pe(e,t){var r=n._malloc(d),o=T(e),A=o[0],c=o[1];l.getH3UnidirectionalEdgeBoundary(A,c,r);var h=U(r,t);return n._free(r),h}function de(e,t){var r=T(e),n=r[0],o=r[1],A=T(t),c=A[0],h=A[1];return l.h3Distance(n,o,c,h)}function fe(e,t){var r=T(e),o=r[0],A=r[1],h=T(t),d=h[0],f=h[1],m=l.h3LineSize(o,A,d,f);if(m<0)throw new Error("Line cannot be calculated");var _=n._calloc(m,c);l.h3Line(o,A,d,f,_);var y=B(_,m);return n._free(_),y}function me(e,t){var r,o=n._malloc(y),A=l.experimentalH3ToLocalIj.apply(l,T(e).concat(T(t),[o])),c=(r=o,{i:n.getValue(r,"i32"),j:n.getValue(r+4,"i32")});switch(n._free(o),A){case 0:return c;case 1:throw new Error("Incompatible origin and index.");case 2:default:throw new Error("Local IJ coordinates undefined for this origin and index pair. The index may be too far from the origin.");case 3:case 4:case 5:throw new Error("Encountered possible pentagon distortion")}}function _e(e,t){if(!t||"number"!=typeof t.i||"number"!=typeof t.j)throw new Error("Coordinates must be provided as an {i, j} object");var r,o,i,A,h=n._malloc(y),d=n._malloc(c);r=h,i=(o=t).i,A=o.j,n.setValue(r,i,"i32"),n.setValue(r+4,A,"i32");var f=l.experimentalLocalIjToH3.apply(l,T(e).concat([h],[d])),m=z(d);if(n._free(h),n._free(d),0!==f)throw new Error("Index not defined for this origin and IJ coordinates pair. IJ coordinates may be too far from origin, or a pentagon distortion was encountered.");return m}function ge(e,t,r){var o,A=L(e[0],e[1]),c=L(t[0],t[1]);switch(r){case x.m:o=l.pointDistM(A,c);break;case x.km:o=l.pointDistKm(A,c);break;case x.rads:o=l.pointDistRads(A,c);break;default:o=null}if(n._free(A),n._free(c),null===o)throw new Error("Unknown unit: "+r);return o}function ye(e,t){var r=T(e),n=r[0],o=r[1];switch(t){case x.m2:return l.cellAreaM2(n,o);case x.km2:return l.cellAreaKm2(n,o);case x.rads2:return l.cellAreaRads2(n,o);default:throw new Error("Unknown unit: "+t)}}function xe(e,t){var r=T(e),n=r[0],o=r[1];switch(t){case x.m:return l.exactEdgeLengthM(n,o);case x.km:return l.exactEdgeLengthKm(n,o);case x.rads:return l.exactEdgeLengthRads(n,o);default:throw new Error("Unknown unit: "+t)}}function ve(e,t){switch(v(e),t){case x.m2:return l.hexAreaM2(e);case x.km2:return l.hexAreaKm2(e);default:throw new Error("Unknown unit: "+t)}}function be(e,t){switch(v(e),t){case x.m:return l.edgeLengthM(e);case x.km:return l.edgeLengthKm(e);default:throw new Error("Unknown unit: "+t)}}function we(e){v(e);var t=S(l.numHexagons(e)),r=t[0],n=t[1];return n?n*Math.pow(2,32)+r:r}function Te(){var e=l.res0IndexCount(),t=n._malloc(c*e);l.getRes0Indexes(t);var r=B(t,e);return n._free(t),r}function Ee(e){v(e);var t=l.pentagonIndexCount(),r=n._malloc(c*t);l.getPentagonIndexes(e,r);var o=B(r,t);return n._free(r),o}function Me(e){return e*Math.PI/180}function Ce(e){return 180*e/Math.PI}},271:function(e,t,r){(function(t){e.exports=function(){"use strict";var e,r,n;function o(t,o){if(e)if(r){var l="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",A={};e(A),n=o(A),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([l],{type:"text/javascript"})))}else r=o;else e=o}return o(["exports"],(function(e){var r="undefined"!=typeof self?self:{},n=o;function o(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=r,this.p2y=n}o.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},o.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},o.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},o.prototype.solveCurveX=function(e,t){var r,n,i,s,a;for(void 0===t&&(t=1e-6),i=e,a=0;a<8;a++){if(s=this.sampleCurveX(i)-e,Math.abs(s)<t)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=s/o}if((i=e)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(s=this.sampleCurveX(i),Math.abs(s-e)<t)return i;e>s?r=i:n=i,i=.5*(n-r)+r}return i},o.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var i=s;function s(e,t){this.x=e,this.y=t}s.prototype={clone:function(){return new s(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=n,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-n*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(e){return e instanceof s?e:Array.isArray(e)?new s(e[0],e[1]):e};const a=Math.PI/180,l=180/Math.PI;function A(e){return e*a}function u(e){return e*l}const c=[[0,0],[1,0],[1,1],[0,1]];function h(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}function p(e,t,r,i){const s=new n(e,t,r,i);return function(e){return s.solve(e)}}const d=p(.25,.1,.25,1);function f(e,t,r){return Math.min(r,Math.max(t,e))}function m(e,t,r){return(r=f((r-e)/(t-e),0,1))*r*(3-2*r)}function _(e,t,r){const n=r-t,i=((e-t)%n+n)%n+t;return i===t?r:i}function g(e,t,r){if(!e.length)return r(null,[]);let n=e.length;const i=new Array(e.length);let s=null;e.forEach(((e,a)=>{t(e,((e,t)=>{e&&(s=e),i[a]=t,0==--n&&r(s,i)}))}))}function y(e){const t=[];for(const r in e)t.push(e[r]);return t}function x(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}let b=1;function v(){return b++}function w(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function T(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function E(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function M(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function C(e,t){return-1!==e.indexOf(t,e.length-t.length)}function I(e,t,r){const n={};for(const i in e)n[i]=t.call(r||this,e[i],i,e);return n}function S(e,t,r){const n={};for(const i in e)t.call(r||this,e[i],i,e)&&(n[i]=e[i]);return n}function k(e){return Array.isArray(e)?e.map(k):"object"==typeof e&&e?I(e,k):e}const z={};function D(e){z[e]||("undefined"!=typeof console&&console.warn(e),z[e]=!0)}function B(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function P(e){let t=0;for(let r,n,i=0,s=e.length,a=s-1;i<s;a=i++)r=e[i],n=e[a],t+=(n.x-r.x)*(r.y+n.y);return t}function L(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function R(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,r,n,i)=>{const s=n||i;return t[r]=!s||s.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let F=null;function O(e){if(null==F){const t=e.navigator?e.navigator.userAgent:null;F=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return F}function U(e){try{const t=r[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function V(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}const j=r.performance;function G(e){const t=e?e.url.toString():void 0;return j.getEntriesByName(t)}var N="2.9.2";let q,Z,$,Q;const H={now:()=>void 0!==$?$:r.performance.now(),setNow(e){$=e},restoreNow(){$=void 0},frame(e){const t=r.requestAnimationFrame(e);return{cancel:()=>r.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:n,height:i}=e;Q||(Q=r.document.createElement("canvas"));const s=Q.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return(n>Q.width||i>Q.height)&&(Q.width=n,Q.height=i),s.clearRect(-t,-t,n+2*t,i+2*t),s.drawImage(e,0,0,n,i),s.getImageData(-t,-t,n+2*t,i+2*t)},resolveURL:e=>(q||(q=r.document.createElement("a")),q.href=e,q.href),get devicePixelRatio(){return r.devicePixelRatio},get prefersReducedMotion(){return!!r.matchMedia&&(null==Z&&(Z=r.matchMedia("(prefers-reduced-motion: reduce)")),Z.matches)}};let W;const X={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==W){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{W=null!=t.env.API_URL_REGEX?new RegExp(t.env.API_URL_REGEX):e}catch(t){W=e}}return W},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Y={supported:!1,testSupport:function(e){!ee&&J&&(te?ie(e):K=e)}};let K,J,ee=!1,te=!1;function ie(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,J),e.isContextLost())return;Y.supported=!0}catch(e){}e.deleteTexture(t),ee=!0}r.document&&(J=r.document.createElement("img"),J.onload=function(){K&&ie(K),K=null,te=!0},J.onerror=function(){ee=!0,K=null},J.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const rt="01",re="NO_ACCESS_TOKEN";function ne(e){return 0===e.indexOf("mapbox:")}function oe(e){return X.API_URL_REGEX.test(e)}const ae=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function se(e){const t=e.match(ae);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function le(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function Ae(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(r.atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class ce{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Ae(X.ACCESS_TOKEN);let n="";return n=t&&t.u?r.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):X.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=U("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const e=r.localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const i=r.localStorage.getItem(n);i&&(this.anonId=i)}catch(e){D("Unable to read from LocalStorage")}}saveEventData(){const e=U("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{r.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&r.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){D("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,r,n){if(!X.EVENTS_URL)return;const i=se(X.EVENTS_URL);i.params.push(`access_token=${n||X.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:rt,userId:this.anonId},a=t?x(s,t):s,o={url:le(i),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=ze(o,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const ue=new class extends ce{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){X.EVENTS_URL&&X.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>ne(e)||oe(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ae(X.ACCESS_TOKEN),r=t?t.u:X.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;E(this.anonId)||(this.anonId=w(),n=!0);const i=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(i),r=(i-this.eventData.lastSuccess)/864e5;n=n||r>=1||r<-1||e.getDate()!==t.getDate()}else n=!0;n?this.postEvent(i,{"enabled.telemetry":!1},(e=>{e||(this.eventData.lastSuccess=i,this.eventData.tokenU=r)}),e):this.processRequests()}},he=ue.postTurnstileEvent.bind(ue),pe=new class extends ce{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,r,n){this.skuToken=t,this.errorCb=n,X.EVENTS_URL&&(r||X.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(re)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),E(this.anonId)||(this.anonId=w()),this.postEvent(r,{skuToken:this.skuToken},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}},dt=pe.postMapLoadEvent.bind(pe),de=new class extends ce{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,r,n){if(!X.API_URL||!X.SESSION_PATH)return;const i=se(X.API_URL+X.SESSION_PATH);i.params.push(`sku=${t||""}`),i.params.push(`access_token=${n||X.ACCESS_TOKEN||""}`);const s={url:le(i),headers:{"Content-Type":"text/plain"}};this.pendingRequest=De(s,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(e,t,r,n){this.skuToken=t,this.errorCb=n,X.SESSION_PATH&&X.API_URL&&(r||X.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(re)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},fe=de.getSessionAPI.bind(de),me=new Set;let _e,ge=500,ye=50,xe={};function ve(e){const t=we(e);let r,n;t&&t.forEach((e=>{const t=e.split("=");"language"===t[0]?r=t[1]:"worldview"===t[0]&&(n=t[1])}));let i="mapbox-tiles";return r&&(i+=`-${r}`),n&&(i+=`-${n}`),i}function be(e){r.caches&&!xe[e]&&(xe[e]=r.caches.open(e))}function we(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}function Te(e){const t=e.indexOf("?");if(t<0)return e;const r=we(e).filter((e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return r.length?`${e.slice(0,t)}?${r.join("&")}`:e.slice(0,t)}let Ee=1/0;const Me={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Me);class Ce extends Error{constructor(e,t,r){401===t&&oe(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ie=L()?()=>self.worker&&self.worker.referrer:()=>("blob:"===r.location.protocol?r.parent:r).location.href,Se=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Ie())&&!/^\w+:/.test(n))){if(r.fetch&&r.Request&&r.AbortController&&r.Request.prototype.hasOwnProperty("signal"))return function(e,t){const n=new r.AbortController,i=new r.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Ie(),signal:n.signal});let s=!1,a=!1;const o=(l=i.url).indexOf("sku=")>0&&oe(l);var l;"json"===e.type&&i.headers.set("Accept","application/json");const u=(n,s,l)=>{if(a)return;if(n&&"SecurityError"!==n.message&&D(n),s&&l)return A(s);const u=Date.now();r.fetch(i).then((r=>{if(r.ok){const e=o?r.clone():null;return A(r,e,u)}return t(new Ce(r.statusText,r.status,e.url))})).catch((e=>{20!==e.code&&t(new Error(e.message))}))},A=(n,o,l)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((e=>{a||(o&&l&&function(e,t,n){const i=ve(e.url);if(be(i),!xe[i])return;const s={status:t.status,statusText:t.statusText,headers:new r.Headers};t.headers.forEach(((e,t)=>s.headers.set(t,e)));const a=R(t.headers.get("Cache-Control")||"");if(a["no-store"])return;a["max-age"]&&s.headers.set("Expires",new Date(n+1e3*a["max-age"]).toUTCString());const o=s.headers.get("Expires");o&&(new Date(o).getTime()-n<42e4||function(e,t){if(void 0===_e)try{new Response(new ReadableStream),_e=!0}catch(e){_e=!1}_e?t(e.body):e.blob().then(t)}(t,(t=>{const n=new r.Response(t,s);be(i),xe[i]&&xe[i].then((t=>t.put(Te(e.url),n))).catch((e=>D(e.message)))})))}(i,o,l),s=!0,t(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((e=>{a||t(new Error(e.message))}))};return o?function(e,t){const r=ve(e.url);if(be(r),!xe[r])return t(null);const n=Te(e.url);xe[r].then((e=>{e.match(n).then((r=>{const i=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),r=R(e.headers.get("Cache-Control")||"");return t>Date.now()&&!r["no-cache"]}(r);e.delete(n),i&&e.put(n,r.clone()),t(null,r,i)})).catch(t)})).catch(t)}(i,u):u(null,null),{cancel:()=>{a=!0,s||n.abort()}}}(e,t);if(L()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(e,t){const n=new r.XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const t in e.headers)n.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{t(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let r=n.response;if("json"===e.type)try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new Ce(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,t)},ke=function(e,t){return Se(x(e,{type:"arrayBuffer"}),t)},ze=function(e,t){return Se(x(e,{method:"POST"}),t)},De=function(e,t){return Se(x(e,{method:"GET"}),t)};function Be(e){const t=r.document.createElement("a");return t.href=e,t.protocol===r.document.location.protocol&&t.host===r.document.location.host}const Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Le,Re;Le=[],Re=0;const Fe=function(e,t){if(Y.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Re>=X.MAX_PARALLEL_IMAGE_REQUESTS){const r={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Le.push(r),r}Re++;let n=!1;const i=()=>{if(!n)for(n=!0,Re--;Le.length&&Re<X.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Le.shift(),{requestParameters:t,callback:r,cancelled:n}=e;n||(e.cancel=Fe(t,r).cancel)}},s=ke(e,((e,n,s,a)=>{i(),e?t(e):n&&(r.createImageBitmap?function(e,t){const n=new r.Blob([new Uint8Array(e)],{type:"image/png"});r.createImageBitmap(n).then((e=>{t(null,e)})).catch((e=>{t(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(n,((e,r)=>t(e,r,s,a))):function(e,t){const n=new r.Image,i=r.URL;n.onload=()=>{t(null,n),i.revokeObjectURL(n.src),n.onload=null,r.requestAnimationFrame((()=>{n.src=Pe}))},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new r.Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?i.createObjectURL(s):Pe}(n,((e,r)=>t(e,r,s,a))))}));return{cancel:()=>{s.cancel(),i()}}};function Oe(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function Ue(e,t,r){if(r&&r[e]){const n=r[e].indexOf(t);-1!==n&&r[e].splice(n,1)}}class Ve{constructor(e,t={}){x(this,t),this.type=e}}class je extends Ve{constructor(e,t={}){super("error",x({error:e},t))}}class Ge{on(e,t){return this._listeners=this._listeners||{},Oe(e,t,this._listeners),this}off(e,t){return Ue(e,t,this._listeners),Ue(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Oe(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Ve(e,t||{}));const r=e.type;if(this.listens(r)){e.target=this;const t=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of t)r.call(this,e);const n=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const t of n)Ue(r,t,this._oneTimeListeners),t.call(this,e);const i=this._eventedParent;i&&(x(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(e))}else e instanceof je&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Ne=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ze(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}function qe(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function $e(e){if(Array.isArray(e))return e.map($e);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=$e(e[r]);return t}return qe(e)}class Qe extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var He=Qe;class We{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,r]of t)this.bindings[e]=r}concat(e){return new We(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Xe=We;const Ye={kind:"null"},Ke={kind:"number"},Je={kind:"string"},et={kind:"boolean"},tt={kind:"color"},it={kind:"object"},nt={kind:"value"},ot={kind:"collator"},at={kind:"formatted"},st={kind:"resolvedImage"};function lt(e,t){return{kind:"array",itemType:e,N:t}}function At(e){if("array"===e.kind){const t=At(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const ct=[Ye,Ke,Je,et,tt,at,it,lt(nt),st];function ut(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!ut(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of ct)if(!ut(e,t))return null}return`Expected ${At(e)} but found ${At(t)} instead.`}function ht(e,t){return t.some((t=>t.kind===e.kind))}function pt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function ft(e){var t={exports:{}};return e(t,t.exports),t.exports}var mt=ft((function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(e){return(e=Math.round(e))<0?0:e>255?255:e}function i(e){return n("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function s(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function a(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{t.parseCSSColor=function(e){var t,o=e.replace(/ /g,"").toLowerCase();if(o in r)return r[o].slice();if("#"===o[0])return 4===o.length?(t=parseInt(o.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===o.length&&(t=parseInt(o.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=o.indexOf("("),u=o.indexOf(")");if(-1!==l&&u+1===o.length){var A=o.substr(0,l),c=o.substr(l+1,u-(l+1)).split(","),p=1;switch(A){case"rgba":if(4!==c.length)return null;p=s(c.pop());case"rgb":return 3!==c.length?null:[i(c[0]),i(c[1]),i(c[2]),p];case"hsla":if(4!==c.length)return null;p=s(c.pop());case"hsl":if(3!==c.length)return null;var h=(parseFloat(c[0])%360+360)%360/360,d=s(c[1]),f=s(c[2]),m=f<=.5?f*(d+1):f+d-f*d,g=2*f-m;return[n(255*a(g,m,h+1/3)),n(255*a(g,m,h)),n(255*a(g,m,h-1/3)),p];default:return null}}return null}}catch(e){}}));class _t{constructor(e,t,r,n=1){this.r=e,this.g=t,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof _t)return e;if("string"!=typeof e)return;const t=mt.parseCSSColor(e);return t?new _t(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,r,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(r)},${n})`}toArray(){const{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*r/n,n]}toArray01(){const{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,r/n,n]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:r,a:n}=this;return[e,t,r,n]}}_t.black=new _t(0,0,0,1),_t.white=new _t(1,1,1,1),_t.transparent=new _t(0,0,0,0),_t.red=new _t(1,0,0,1),_t.blue=new _t(0,0,1,1);var gt=_t;class yt{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class xt{constructor(e,t,r,n,i){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=n,this.textColor=i}}class vt{constructor(e){this.sections=e}static fromString(e){return new vt([new xt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof vt?e:vt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(r)}return e}}class bt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new bt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function wt(e,t,r,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Tt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof gt)return!0;if(e instanceof yt)return!0;if(e instanceof vt)return!0;if(e instanceof bt)return!0;if(Array.isArray(e)){for(const t of e)if(!Tt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Tt(e[t]))return!1;return!0}return!1}function Et(e){if(null===e)return Ye;if("string"==typeof e)return Je;if("boolean"==typeof e)return et;if("number"==typeof e)return Ke;if(e instanceof gt)return tt;if(e instanceof yt)return ot;if(e instanceof vt)return at;if(e instanceof bt)return st;if(Array.isArray(e)){const t=e.length;let r;for(const t of e){const e=Et(t);if(r){if(r===e)continue;r=nt;break}r=e}return lt(r||nt,t)}return it}function Mt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof gt||e instanceof vt||e instanceof bt?e.toString():JSON.stringify(e)}class Ct{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Tt(e[1]))return t.error("invalid value");const r=e[1];let n=Et(r);const i=t.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new Ct(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof gt?["rgba"].concat(this.value.toArray()):this.value instanceof vt?this.value.serialize():this.value}}var It=Ct,St=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const kt={string:Je,number:Ke,boolean:et,object:it};class zt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,n=1;const i=e[0];if("array"===i){let i,s;if(e.length>2){const r=e[1];if("string"!=typeof r||!(r in kt)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=kt[r],n++}else i=nt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);s=e[2],n++}r=lt(i,s)}else r=kt[i];const s=[];for(;n<e.length;n++){const r=t.parse(e[n],n,nt);if(!r)return null;s.push(r)}return new zt(r,s)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!ut(this.type,Et(r)))return r;if(t===this.args.length-1)throw new St(`Expected value to be of type ${At(this.type)}, but found ${At(Et(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){t.push(r.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((e=>e.serialize())))}}var Dt=zt;class Bt{constructor(e){this.type=at,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");const n=[];let i=!1;for(let r=1;r<=e.length-1;++r){const s=e[r];if(i&&"object"==typeof s&&!Array.isArray(s)){i=!1;let e=null;if(s["font-scale"]&&(e=t.parse(s["font-scale"],1,Ke),!e))return null;let r=null;if(s["text-font"]&&(r=t.parse(s["text-font"],1,lt(Je)),!r))return null;let a=null;if(s["text-color"]&&(a=t.parse(s["text-color"],1,tt),!a))return null;const o=n[n.length-1];o.scale=e,o.font=r,o.textColor=a}else{const s=t.parse(e[r],1,nt);if(!s)return null;const a=s.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:s,scale:null,font:null,textColor:null})}}return new Bt(n)}evaluate(e){return new vt(this.sections.map((t=>{const r=t.content.evaluate(e);return Et(r)===st?new xt("",r,null,null,null):new xt(Mt(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class Pt{constructor(e){this.type=st,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,Je);return r?new Pt(r):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=bt.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Lt={"to-boolean":et,"to-color":tt,"to-number":Ke,"to-string":Je};class Rt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0];if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");const n=Lt[r],i=[];for(let r=1;r<e.length;r++){const n=t.parse(e[r],r,nt);if(!n)return null;i.push(n)}return new Rt(n,i)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,r;for(const n of this.args){if(t=n.evaluate(e),r=null,t instanceof gt)return t;if("string"==typeof t){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:wt(t[0],t[1],t[2],t[3]),!r))return new gt(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new St(r||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const r of this.args){if(t=r.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new St(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?vt.fromString(Mt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?bt.fromString(Mt(this.args[0].evaluate(e))):Mt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Bt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Pt(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Ft=Rt;const Ot=["Unknown","Point","LineString","Polygon"];var Ut=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ot[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=gt.parse(e)),t}};class Vt{constructor(e,t,r,n){this.name=e,this.type=t,this._evaluate=r,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const r=e[0],n=Vt.definitions[r];if(!n)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(n)?n[0]:n.type,s=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,a=s.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let o=null;for(const[n,s]of a){o=new hi(t.registry,t.path,null,t.scope);const a=[];let l=!1;for(let t=1;t<e.length;t++){const r=e[t],i=Array.isArray(n)?n[t-1]:n.type,s=o.parse(r,1+a.length,i);if(!s){l=!0;break}a.push(s)}if(!l)if(Array.isArray(n)&&n.length!==a.length)o.error(`Expected ${n.length} arguments, but found ${a.length} instead.`);else{for(let e=0;e<a.length;e++){const t=Array.isArray(n)?n[e]:n.type,r=a[e];o.concat(e+1).checkSubtype(t,r.type)}if(0===o.errors.length)return new Vt(r,i,s,a)}}if(1===a.length)t.errors.push(...o.errors);else{const r=(a.length?a:s).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(At).join(", ")})`:`(${At(t.type)}...)`;var t})).join(" | "),n=[];for(let r=1;r<e.length;r++){const i=t.parse(e[r],1+n.length);if(!i)return null;n.push(At(i.type))}t.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){Vt.definitions=t;for(const r in t)e[r]=Vt}}var jt=Vt;class Gt{constructor(e,t,r){this.type=ot,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,et);if(!n)return null;const i=t.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,et);if(!i)return null;let s=null;return r.locale&&(s=t.parse(r.locale,1,Je),!s)?null:new Gt(n,i,s)}evaluate(e){return new yt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Nt=8192;function Zt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function qt(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function $t(e,t){const r=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(r*i*Nt),Math.round(n*i*Nt)]}function Qt(e,t,r){const n=e[0]-t[0],i=e[1]-t[1],s=e[0]-r[0],a=e[1]-r[1];return n*a-s*i==0&&n*s<=0&&i*a<=0}function Ht(e,t){let r=!1;for(let a=0,o=t.length;a<o;a++){const o=t[a];for(let t=0,a=o.length;t<a-1;t++){if(Qt(e,o[t],o[t+1]))return!1;(i=o[t])[1]>(n=e)[1]!=(s=o[t+1])[1]>n[1]&&n[0]<(s[0]-i[0])*(n[1]-i[1])/(s[1]-i[1])+i[0]&&(r=!r)}}var n,i,s;return r}function Wt(e,t){for(let r=0;r<t.length;r++)if(Ht(e,t[r]))return!0;return!1}function Xt(e,t,r,n){const i=n[0]-r[0],s=n[1]-r[1],a=(e[0]-r[0])*s-i*(e[1]-r[1]),o=(t[0]-r[0])*s-i*(t[1]-r[1]);return a>0&&o<0||a<0&&o>0}function Yt(e,t,r){for(const u of r)for(let r=0;r<u.length-1;++r)if(0!=(o=[(a=u[r+1])[0]-(s=u[r])[0],a[1]-s[1]])[0]*(l=[(i=t)[0]-(n=e)[0],i[1]-n[1]])[1]-o[1]*l[0]&&Xt(n,i,s,a)&&Xt(s,a,n,i))return!0;var n,i,s,a,o,l;return!1}function Kt(e,t){for(let r=0;r<e.length;++r)if(!Ht(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(Yt(e[r],e[r+1],t))return!1;return!0}function Jt(e,t){for(let r=0;r<t.length;r++)if(Kt(e,t[r]))return!0;return!1}function ei(e,t,r){const n=[];for(let i=0;i<e.length;i++){const s=[];for(let n=0;n<e[i].length;n++){const a=$t(e[i][n],r);Zt(t,a),s.push(a)}n.push(s)}return n}function tr(e,t,r){const n=[];for(let i=0;i<e.length;i++){const s=ei(e[i],t,r);n.push(s)}return n}function ti(e,t,r,n){if(e[0]<r[0]||e[0]>r[2]){const t=.5*n;let i=e[0]-r[0]>t?-n:r[0]-e[0]>t?n:0;0===i&&(i=e[0]-r[2]>t?-n:r[2]-e[0]>t?n:0),e[0]+=i}Zt(t,e)}function ii(e,t,r,n){const i=Math.pow(2,n.z)*Nt,s=[n.x*Nt,n.y*Nt],a=[];if(!e)return a;for(const n of e)for(const e of n){const n=[e.x+s[0],e.y+s[1]];ti(n,t,r,i),a.push(n)}return a}function ri(e,t,r,n){const i=Math.pow(2,n.z)*Nt,s=[n.x*Nt,n.y*Nt],a=[];if(!e)return a;for(const r of e){const e=[];for(const n of r){const r=[n.x+s[0],n.y+s[1]];Zt(t,r),e.push(r)}a.push(e)}if(t[2]-t[0]<=i/2){(o=t)[0]=o[1]=1/0,o[2]=o[3]=-1/0;for(const e of a)for(const n of e)ti(n,t,r,i)}var o;return a}class ni{constructor(e,t){this.type=et,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Tt(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new ni(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new ni(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new ni(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const s=ei(t.coordinates,n,i),a=ii(e.geometry(),r,n,i);if(!qt(r,n))return!1;for(const e of a)if(!Ht(e,s))return!1}if("MultiPolygon"===t.type){const s=tr(t.coordinates,n,i),a=ii(e.geometry(),r,n,i);if(!qt(r,n))return!1;for(const e of a)if(!Wt(e,s))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const s=ei(t.coordinates,n,i),a=ri(e.geometry(),r,n,i);if(!qt(r,n))return!1;for(const e of a)if(!Kt(e,s))return!1}if("MultiPolygon"===t.type){const s=tr(t.coordinates,n,i),a=ri(e.geometry(),r,n,i);if(!qt(r,n))return!1;for(const e of a)if(!Jt(e,s))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var oi=ni;function ai(e){if(e instanceof jt){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof oi)return!1;let t=!0;return e.eachChild((e=>{t&&!ai(e)&&(t=!1)})),t}function si(e){if(e instanceof jt&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!si(e)&&(t=!1)})),t}function Ai(e,t){if(e instanceof jt&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild((e=>{r&&!Ai(e,t)&&(r=!1)})),r}class ci{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new ci(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ui=ci;class hr{constructor(e,t=[],r,n=new Xe,i=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=i,this.expectedType=r}parse(e,t,r,n,i={}){return t?this.concat(t,r,n)._parse(e,i):this._parse(e,i)}_parse(e,t){function r(e,t,r){return"assert"===r?new Dt(t,[e]):"coerce"===r?new Ft(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=e[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[n];if(i){let n=i.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,i=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(e,i))return null}else n=r(n,e,t.typeAnnotation||"coerce");else n=r(n,e,t.typeAnnotation||"assert")}if(!(n instanceof It)&&"resolvedImage"!==n.type.kind&&pi(n)){const t=new Ut;try{n=new It(n.type,n.evaluate(t))}catch(e){return this.error(e.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const n="number"==typeof e?this.path.concat(e):this.path,i=r?this.scope.concat(r):this.scope;return new hr(this.registry,n,t||null,i,this.errors)}error(e,...t){const r=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new He(r,e))}checkSubtype(e,t){const r=ut(e,t);return r&&this.error(r),r}}var hi=hr;function pi(e){if(e instanceof ui)return pi(e.boundExpression);if(e instanceof jt&&"error"===e.name)return!1;if(e instanceof Gt)return!1;if(e instanceof oi)return!1;const t=e instanceof Ft||e instanceof Dt;let r=!0;return e.eachChild((e=>{r=t?r&&pi(e):r&&e instanceof It})),!!r&&ai(e)&&Ai(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function di(e,t){const r=e.length-1;let n,i,s=0,a=r,o=0;for(;s<=a;)if(o=Math.floor((s+a)/2),n=e[o],i=e[o+1],n<=t){if(o===r||t<i)return o;s=o+1}else{if(!(n>t))throw new St("Input is not a number.");a=o-1}return 0}class fi{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,Ke);if(!r)return null;const n=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let r=1;r<e.length;r+=2){const s=1===r?-1/0:e[r],a=e[r+1],o=r,l=r+1;if("number"!=typeof s)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(n.length&&n[n.length-1][0]>=s)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);const u=t.parse(a,l,i);if(!u)return null;i=i||u.type,n.push([s,u])}return new fi(i,r,n)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;return n>=t[i-1]?r[i-1].evaluate(e):r[di(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var mi=fi;function _i(e,t,r){return e*(1-r)+t*r}var gi=Object.freeze({__proto__:null,number:_i,color:function(e,t,r){return new gt(_i(e.r,t.r,r),_i(e.g,t.g,r),_i(e.b,t.b,r),_i(e.a,t.a,r))},array:function(e,t,r){return e.map(((e,n)=>_i(e,t[n],r)))}});const yi=.95047,br=1.08883,xi=4/29,vi=6/29,bi=3*vi*vi,wi=Math.PI/180,Ti=180/Math.PI;function Ei(e){return e>.008856451679035631?Math.pow(e,1/3):e/bi+xi}function Mi(e){return e>vi?e*e*e:bi*(e-xi)}function Ci(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ii(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Si(e){const t=Ii(e.r),r=Ii(e.g),n=Ii(e.b),i=Ei((.4124564*t+.3575761*r+.1804375*n)/yi),s=Ei((.2126729*t+.7151522*r+.072175*n)/1);return{l:116*s-16,a:500*(i-s),b:200*(s-Ei((.0193339*t+.119192*r+.9503041*n)/br)),alpha:e.a}}function ki(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*Mi(t),r=yi*Mi(r),n=br*Mi(n),new gt(Ci(3.2404542*r-1.5371385*t-.4985314*n),Ci(-.969266*r+1.8760108*t+.041556*n),Ci(.0556434*r-.2040259*t+1.0572252*n),e.alpha)}function zi(e,t,r){const n=t-e;return e+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const Di={forward:Si,reverse:ki,interpolate:function(e,t,r){return{l:_i(e.l,t.l,r),a:_i(e.a,t.a,r),b:_i(e.b,t.b,r),alpha:_i(e.alpha,t.alpha,r)}}},Bi={forward:function(e){const{l:t,a:r,b:n}=Si(e),i=Math.atan2(n,r)*Ti;return{h:i<0?i+360:i,c:Math.sqrt(r*r+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*wi,r=e.c;return ki({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:zi(e.h,t.h,r),c:_i(e.c,t.c,r),l:_i(e.l,t.l,r),alpha:_i(e.alpha,t.alpha,r)}}};var Pi=Object.freeze({__proto__:null,lab:Di,hcl:Bi});class Li{constructor(e,t,r,n,i){this.type=e,this.operator=t,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,r,i){let s=0;if("exponential"===e.name)s=Ri(t,e.base,r,i);else if("linear"===e.name)s=Ri(t,1,r,i);else if("cubic-bezier"===e.name){const a=e.controlPoints;s=new n(a[0],a[1],a[2],a[3]).solve(Ri(t,1,r,i))}return s}static parse(e,t){let[r,n,i,...s]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,Ke),!i)return null;const a=[];let o=null;"interpolate-hcl"===r||"interpolate-lab"===r?o=tt:t.expectedType&&"value"!==t.expectedType.kind&&(o=t.expectedType);for(let e=0;e<s.length;e+=2){const r=s[e],n=s[e+1],i=e+3,l=e+4;if("number"!=typeof r)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(a.length&&a[a.length-1][0]>=r)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const u=t.parse(n,l,o);if(!u)return null;o=o||u.type,a.push([r,u])}return"number"===o.kind||"color"===o.kind||"array"===o.kind&&"number"===o.itemType.kind&&"number"==typeof o.N?new Li(o,r,n,i,a):t.error(`Type ${At(o)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);const s=di(t,n),a=Li.interpolationFactor(this.interpolation,n,t[s],t[s+1]),o=r[s].evaluate(e),l=r[s+1].evaluate(e);return"interpolate"===this.operator?gi[this.type.kind.toLowerCase()](o,l,a):"interpolate-hcl"===this.operator?Bi.reverse(Bi.interpolate(Bi.forward(o),Bi.forward(l),a)):Di.reverse(Di.interpolate(Di.forward(o),Di.forward(l),a))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Ri(e,t,r,n){const i=n-r,s=e-r;return 0===i?0:1===t?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)}var Fi=Li;class Oi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const n=t.expectedType;n&&"value"!==n.kind&&(r=n);const i=[];for(const n of e.slice(1)){const e=t.parse(n,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,i.push(e)}const s=n&&i.some((e=>ut(n,e.type)));return new Oi(s?nt:r,i)}evaluate(e){let t,r=null,n=0;for(const i of this.args){if(n++,r=i.evaluate(e),r&&r instanceof bt&&!r.available&&(t||(t=r),r=null,n===this.args.length))return t;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Ui=Oi;class Vi{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let n=1;n<e.length-1;n+=2){const i=e[n];if("string"!=typeof i)return t.error(`Expected string, but found ${typeof i} instead.`,n);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const s=t.parse(e[n+1],n+1);if(!s)return null;r.push([i,s])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return n?new Vi(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}var ji=Vi;class Gi{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Ke),n=t.parse(e[2],2,lt(t.expectedType||nt));return r&&n?new Gi(n.type.itemType,r,n):null}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new St(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new St(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new St(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ni=Gi;class Zi{constructor(e,t){this.type=et,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,nt),n=t.parse(e[2],2,nt);return r&&n?ht(r.type,[et,Je,Ke,Ye,nt])?new Zi(r,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${At(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!pt(t,["boolean","string","number","null"]))throw new St(`Expected first argument to be of type boolean, string, number or null, but found ${At(Et(t))} instead.`);if(!pt(r,["string","array"]))throw new St(`Expected second argument to be of type array or string, but found ${At(Et(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var qi=Zi;class $i{constructor(e,t,r){this.type=Ke,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,nt),n=t.parse(e[2],2,nt);if(!r||!n)return null;if(!ht(r.type,[et,Je,Ke,Ye,nt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${At(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,Ke);return i?new $i(r,n,i):null}return new $i(r,n)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!pt(t,["boolean","string","number","null"]))throw new St(`Expected first argument to be of type boolean, string, number or null, but found ${At(Et(t))} instead.`);if(!pt(r,["string","array"]))throw new St(`Expected second argument to be of type array or string, but found ${At(Et(r))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return r.indexOf(t,n)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Qi=$i;class Hi{constructor(e,t,r,n,i,s){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=i,this.otherwise=s}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i={},s=[];for(let a=2;a<e.length-1;a+=2){let o=e[a];const l=e[a+1];Array.isArray(o)||(o=[o]);const u=t.concat(a);if(0===o.length)return u.error("Expected at least one branch label.");for(const e of o){if("number"!=typeof e&&"string"!=typeof e)return u.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,Et(e)))return null}else r=Et(e);if(void 0!==i[String(e)])return u.error("Branch labels must be unique.");i[String(e)]=s.length}const A=t.parse(l,a,n);if(!A)return null;n=n||A.type,s.push(A)}const a=t.parse(e[1],1,nt);if(!a)return null;const o=t.parse(e[e.length-1],e.length-1,n);return o?"value"!==a.type.kind&&t.concat(1).checkSubtype(r,a.type)?null:new Hi(r,n,a,i,s,o):null}evaluate(e){const t=this.input.evaluate(e);return(Et(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=r.length,r.push([this.cases[e],[e]])):r[t][1].push(e)}const i=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of r)e.push(1===n.length?i(n[0]):n.map(i)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}var Wi=Hi;class Xi{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n=[];for(let i=1;i<e.length-1;i+=2){const s=t.parse(e[i],i,et);if(!s)return null;const a=t.parse(e[i+1],i+1,r);if(!a)return null;n.push([s,a]),r=r||a.type}const i=t.parse(e[e.length-1],e.length-1,r);return i?new Xi(r,n,i):null}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Yi=Xi;class Ki{constructor(e,t,r,n){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,nt),n=t.parse(e[2],2,Ke);if(!r||!n)return null;if(!ht(r.type,[lt(nt),Je,nt]))return t.error(`Expected first argument to be of type array or string, but found ${At(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,Ke);return i?new Ki(r.type,r,n,i):null}return new Ki(r.type,r,n)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!pt(t,["string","array"]))throw new St(`Expected first argument to be of type array or string, but found ${At(Et(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(r,n)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ji=Ki;function er(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ir(e,t,r,n){return 0===n.compare(t,r)}function rr(e,t,r){const n="=="!==e&&"!="!==e;return class i{constructor(e,t,r){this.type=et,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const r=e[0];let s=t.parse(e[1],1,nt);if(!s)return null;if(!er(r,s.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${At(s.type)}'.`);let a=t.parse(e[2],2,nt);if(!a)return null;if(!er(r,a.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${At(a.type)}'.`);if(s.type.kind!==a.type.kind&&"value"!==s.type.kind&&"value"!==a.type.kind)return t.error(`Cannot compare types '${At(s.type)}' and '${At(a.type)}'.`);n&&("value"===s.type.kind&&"value"!==a.type.kind?s=new Dt(a.type,[s]):"value"!==s.type.kind&&"value"===a.type.kind&&(a=new Dt(s.type,[a])));let o=null;if(4===e.length){if("string"!==s.type.kind&&"string"!==a.type.kind&&"value"!==s.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(o=t.parse(e[3],3,ot),!o)return null}return new i(s,a,o)}evaluate(i){const s=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){const t=Et(s),r=Et(a);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new St(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${r.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=Et(s),r=Et(a);if("string"!==e.kind||"string"!==r.kind)return t(i,s,a)}return this.collator?r(i,s,a,this.collator.evaluate(i)):t(i,s,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const nr=rr("==",(function(e,t,r){return t===r}),ir),or=rr("!=",(function(e,t,r){return t!==r}),(function(e,t,r,n){return!ir(0,t,r,n)})),ar=rr("<",(function(e,t,r){return t<r}),(function(e,t,r,n){return n.compare(t,r)<0})),sr=rr(">",(function(e,t,r){return t>r}),(function(e,t,r,n){return n.compare(t,r)>0})),lr=rr("<=",(function(e,t,r){return t<=r}),(function(e,t,r,n){return n.compare(t,r)<=0})),Ar=rr(">=",(function(e,t,r){return t>=r}),(function(e,t,r,n){return n.compare(t,r)>=0}));class cr{constructor(e,t,r,n,i){this.type=Je,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,Ke);if(!r)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let i=null;if(n.locale&&(i=t.parse(n.locale,1,Je),!i))return null;let s=null;if(n.currency&&(s=t.parse(n.currency,1,Je),!s))return null;let a=null;if(n["min-fraction-digits"]&&(a=t.parse(n["min-fraction-digits"],1,Ke),!a))return null;let o=null;return n["max-fraction-digits"]&&(o=t.parse(n["max-fraction-digits"],1,Ke),!o)?null:new cr(r,i,s,a,o)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ur{constructor(e){this.type=Ke,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error(`Expected argument of type string or array, but found ${At(r.type)} instead.`):new ur(r):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new St(`Expected value to be of type string or array, but found ${At(Et(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const pr={"==":nr,"!=":or,">":sr,"<":ar,">=":Ar,"<=":lr,array:Dt,at:Ni,boolean:Dt,case:Yi,coalesce:Ui,collator:Gt,format:Bt,image:Pt,in:qi,"index-of":Qi,interpolate:Fi,"interpolate-hcl":Fi,"interpolate-lab":Fi,length:ur,let:ji,literal:It,match:Wi,number:Dt,"number-format":cr,object:Dt,slice:Ji,step:mi,string:Dt,"to-boolean":Ft,"to-color":Ft,"to-number":Ft,"to-string":Ft,var:ui,within:oi};function dr(e,[t,r,n,i]){t=t.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const s=i?i.evaluate(e):1,a=wt(t,r,n,s);if(a)throw new St(a);return new gt(t/255*s,r/255*s,n/255*s,s)}function fr(e,t){return e in t}function mr(e,t){const r=t[e];return void 0===r?null:r}function _r(e){return{type:e}}jt.register(pr,{error:[{kind:"error"},[Je],(e,[t])=>{throw new St(t.evaluate(e))}],typeof:[Je,[nt],(e,[t])=>At(Et(t.evaluate(e)))],"to-rgba":[lt(Ke,4),[tt],(e,[t])=>t.evaluate(e).toArray()],rgb:[tt,[Ke,Ke,Ke],dr],rgba:[tt,[Ke,Ke,Ke,Ke],dr],has:{type:et,overloads:[[[Je],(e,[t])=>fr(t.evaluate(e),e.properties())],[[Je,it],(e,[t,r])=>fr(t.evaluate(e),r.evaluate(e))]]},get:{type:nt,overloads:[[[Je],(e,[t])=>mr(t.evaluate(e),e.properties())],[[Je,it],(e,[t,r])=>mr(t.evaluate(e),r.evaluate(e))]]},"feature-state":[nt,[Je],(e,[t])=>mr(t.evaluate(e),e.featureState||{})],properties:[it,[],e=>e.properties()],"geometry-type":[Je,[],e=>e.geometryType()],id:[nt,[],e=>e.id()],zoom:[Ke,[],e=>e.globals.zoom],pitch:[Ke,[],e=>e.globals.pitch||0],"distance-from-center":[Ke,[],e=>e.distanceFromCenter()],"heatmap-density":[Ke,[],e=>e.globals.heatmapDensity||0],"line-progress":[Ke,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[Ke,[],e=>e.globals.skyRadialProgress||0],accumulated:[nt,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Ke,_r(Ke),(e,t)=>{let r=0;for(const n of t)r+=n.evaluate(e);return r}],"*":[Ke,_r(Ke),(e,t)=>{let r=1;for(const n of t)r*=n.evaluate(e);return r}],"-":{type:Ke,overloads:[[[Ke,Ke],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[Ke],(e,[t])=>-t.evaluate(e)]]},"/":[Ke,[Ke,Ke],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[Ke,[Ke,Ke],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[Ke,[Ke],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Ke,[Ke],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Ke,[Ke],(e,[t])=>Math.log(t.evaluate(e))],log2:[Ke,[Ke],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Ke,[Ke],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Ke,[Ke],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Ke,[Ke],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Ke,[Ke],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Ke,[Ke],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Ke,[Ke],(e,[t])=>Math.atan(t.evaluate(e))],min:[Ke,_r(Ke),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Ke,_r(Ke),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Ke,[Ke],(e,[t])=>Math.abs(t.evaluate(e))],round:[Ke,[Ke],(e,[t])=>{const r=t.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ke,[Ke],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Ke,[Ke],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[et,[Je,nt],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[et,[nt],(e,[t])=>e.id()===t.value],"filter-type-==":[et,[Je],(e,[t])=>e.geometryType()===t.value],"filter-<":[et,[Je,nt],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<i}],"filter-id-<":[et,[nt],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<n}],"filter->":[et,[Je,nt],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>i}],"filter-id->":[et,[nt],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>n}],"filter-<=":[et,[Je,nt],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[et,[nt],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<=n}],"filter->=":[et,[Je,nt],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[et,[nt],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>=n}],"filter-has":[et,[nt],(e,[t])=>t.value in e.properties()],"filter-has-id":[et,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[et,[lt(Je)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[et,[lt(nt)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[et,[Je,lt(nt)],(e,[t,r])=>r.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[et,[Je,lt(nt)],(e,[t,r])=>function(e,t,r,n){for(;r<=n;){const i=r+n>>1;if(t[i]===e)return!0;t[i]>e?n=i-1:r=i+1}return!1}(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:et,overloads:[[[et,et],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[_r(et),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:et,overloads:[[[et,et],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[_r(et),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[et,[et],(e,[t])=>!t.evaluate(e)],"is-supported-script":[et,[Je],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[Je,[Je],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Je,[Je],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Je,_r(nt),(e,t)=>t.map((t=>Mt(t.evaluate(e)))).join("")],"resolved-locale":[Je,[ot],(e,[t])=>t.evaluate(e).resolvedLocale()]});var gr=pr;function yr(e){return{result:"success",value:e}}function xr(e){return{result:"error",value:e}}function vr(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function wr(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Tr(e){return!!e.expression&&e.expression.interpolated}function Er(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Mr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Cr(e){return e}function Ir(e,t){const r="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],i=n||!(n||void 0!==e.property),s=e.type||(Tr(t)?"exponential":"interval");if(r&&((e=Ze({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],gt.parse(e[1])]))),e.default=gt.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Pi[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let a,o,l;if("exponential"===s)a=Dr;else if("interval"===s)a=zr;else if("categorical"===s){a=kr,o=Object.create(null);for(const t of e.stops)o[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);a=Br}if(n){const r={},n=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],s=i[0].zoom;void 0===r[s]&&(r[s]={zoom:s,type:e.type,property:e.property,default:e.default,stops:[]},n.push(s)),r[s].stops.push([i[0].value,i[1]])}const i=[];for(const e of n)i.push([r[e].zoom,Ir(r[e],t)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:Fi.interpolationFactor.bind(void 0,s),zoomStops:i.map((e=>e[0])),evaluate:({zoom:r},n)=>Dr({stops:i,base:e.base},t,r).evaluate(r,n)}}if(i){const r="exponential"===s?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:Fi.interpolationFactor.bind(void 0,r),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:r})=>a(e,t,r,o,l)}}return{kind:"source",evaluate(r,n){const i=n&&n.properties?n.properties[e.property]:void 0;return void 0===i?Sr(e.default,t.default):a(e,t,i,o,l)}}}function Sr(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function kr(e,t,r,n,i){return Sr(typeof r===i?n[r]:void 0,e.default,t.default)}function zr(e,t,r){if("number"!==Er(r))return Sr(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];const i=di(e.stops.map((e=>e[0])),r);return e.stops[i][1]}function Dr(e,t,r){const n=void 0!==e.base?e.base:1;if("number"!==Er(r))return Sr(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];const s=di(e.stops.map((e=>e[0])),r),a=function(e,t,r,n){const i=n-r,s=e-r;return 0===i?0:1===t?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)}(r,n,e.stops[s][0],e.stops[s+1][0]),o=e.stops[s][1],l=e.stops[s+1][1];let u=gi[t.type]||Cr;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Pi[e.colorSpace];u=(e,r)=>t.reverse(t.interpolate(t.forward(e),t.forward(r),a))}return"function"==typeof o.evaluate?{evaluate(...e){const t=o.evaluate.apply(void 0,e),r=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==r)return u(t,r,a)}}:u(o,l,a)}function Br(e,t,r){return"color"===t.type?r=gt.parse(r):"formatted"===t.type?r=vt.fromString(r.toString()):"resolvedImage"===t.type?r=bt.fromString(r.toString()):Er(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),Sr(r,e.default,t.default)}class Pr{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Ut,this._defaultValue=t?function(e){return"color"===e.type&&(Mr(e.default)||Array.isArray(e.default))?new gt(0,0,0,0):"color"===e.type?gt.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,n,i,s,a,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=o||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,n,i,s,a,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=o||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new St(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Lr(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in gr}function Rr(e,t){const r=new hi(gr,[],t?function(e){const t={color:tt,string:Je,number:Ke,enum:Je,boolean:et,formatted:at,resolvedImage:st};return"array"===e.type?lt(t[e.value]||nt,e.length):t[e.type]}(t):void 0),n=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?yr(new Pr(n,t)):xr(r.errors)}class Fr{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!si(t.expression)}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,s)}evaluate(e,t,r,n,i,s){return this._styleExpression.evaluate(e,t,r,n,i,s)}}class Or{constructor(e,t,r,n){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!si(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,s)}evaluate(e,t,r,n,i,s){return this._styleExpression.evaluate(e,t,r,n,i,s)}interpolationFactor(e,t,r){return this.interpolationType?Fi.interpolationFactor(this.interpolationType,e,t,r):0}}function Ur(e,t){if("error"===(e=Rr(e,t)).result)return e;const r=e.value.expression,n=ai(r);if(!n&&!vr(t))return xr([new He("","data expressions not supported")]);const i=Ai(r,["zoom","pitch","distance-from-center"]);if(!i&&!wr(t))return xr([new He("","zoom expressions not supported")]);const s=jr(r);return s||i?s instanceof He?xr([s]):s instanceof Fi&&!Tr(t)?xr([new He("",'"interpolate" expressions cannot be used with this property')]):yr(s?new Or(n?"camera":"composite",e.value,s.labels,s instanceof Fi?s.interpolation:void 0):new Fr(n?"constant":"source",e.value)):xr([new He("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Vr{constructor(e,t){this._parameters=e,this._specification=t,Ze(this,Ir(this._parameters,this._specification))}static deserialize(e){return new Vr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function jr(e){let t=null;if(e instanceof ji)t=jr(e.result);else if(e instanceof Ui){for(const r of e.args)if(t=jr(r),t)break}else(e instanceof mi||e instanceof Fi)&&e.input instanceof jt&&"zoom"===e.input.name&&(t=e);return t instanceof He||e.eachChild((e=>{const r=jr(e);r instanceof He?t=r:!t&&r?t=new He("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&r&&t!==r&&(t=new He("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}class Gr{constructor(e,t,r,n){this.message=(e?`${e}: `:"")+r,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}function Nr(e){const t=e.key,r=e.value,n=e.valueSpec||{},i=e.objectElementValidators||{},s=e.style,a=e.styleSpec;let o=[];const l=Er(r);if("object"!==l)return[new Gr(t,r,`object expected, ${l} found`)];for(const e in r){const l=e.split(".")[0],u=n[l]||n["*"];let A;i[l]?A=i[l]:n[l]?A=bn:i["*"]?A=i["*"]:n["*"]&&(A=bn),A?o=o.concat(A({key:(t?`${t}.`:t)+e,value:r[e],valueSpec:u,style:s,styleSpec:a,object:r,objectKey:e},r)):o.push(new Gr(t,r[e],`unknown property "${e}"`))}for(const e in n)i[e]||n[e].required&&void 0===n[e].default&&void 0===r[e]&&o.push(new Gr(t,r,`missing required property "${e}"`));return o}function Zr(e){const t=e.value,r=e.valueSpec,n=e.style,i=e.styleSpec,s=e.key,a=e.arrayElementValidator||bn;if("array"!==Er(t))return[new Gr(s,t,`array expected, ${Er(t)} found`)];if(r.length&&t.length!==r.length)return[new Gr(s,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Gr(s,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let o={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};i.$version<7&&(o.function=r.function),"object"===Er(r.value)&&(o=r.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(a({array:t,arrayIndex:e,value:t[e],valueSpec:o,style:n,styleSpec:i,key:`${s}[${e}]`}));return l}function qr(e){const t=e.key,r=e.value,n=e.valueSpec;let i=Er(r);if("number"===i&&r!=r&&(i="NaN"),"number"!==i)return[new Gr(t,r,`number expected, ${i} found`)];if("minimum"in n){let i=n.minimum;if("array"===Er(n.minimum)&&(i=n.minimum[e.arrayIndex]),r<i)return[new Gr(t,r,`${r} is less than the minimum value ${i}`)]}if("maximum"in n){let i=n.maximum;if("array"===Er(n.maximum)&&(i=n.maximum[e.arrayIndex]),r>i)return[new Gr(t,r,`${r} is greater than the maximum value ${i}`)]}return[]}function $r(e){const t=e.valueSpec,r=qe(e.value.type);let n,i,s,a={};const o="categorical"!==r&&void 0===e.value.property,l=!o,u="array"===Er(e.value.stops)&&"array"===Er(e.value.stops[0])&&"object"===Er(e.value.stops[0][0]),A=Nr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===r)return[new Gr(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const n=e.value;return t=t.concat(Zr({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:c})),"array"===Er(n)&&0===n.length&&t.push(new Gr(e.key,n,"array must have at least one stop")),t},default:function(e){return bn({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===r&&o&&A.push(new Gr(e.key,e.value,'missing required property "property"')),"identity"===r||e.value.stops||A.push(new Gr(e.key,e.value,'missing required property "stops"')),"exponential"===r&&e.valueSpec.expression&&!Tr(e.valueSpec)&&A.push(new Gr(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!vr(e.valueSpec)?A.push(new Gr(e.key,e.value,"property functions not supported")):o&&!wr(e.valueSpec)&&A.push(new Gr(e.key,e.value,"zoom functions not supported"))),"categorical"!==r&&!u||void 0!==e.value.property||A.push(new Gr(e.key,e.value,'"property" property is required')),A;function c(e){let r=[];const n=e.value,o=e.key;if("array"!==Er(n))return[new Gr(o,n,`array expected, ${Er(n)} found`)];if(2!==n.length)return[new Gr(o,n,`array length 2 expected, length ${n.length} found`)];if(u){if("object"!==Er(n[0]))return[new Gr(o,n,`object expected, ${Er(n[0])} found`)];if(void 0===n[0].zoom)return[new Gr(o,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new Gr(o,n,"object stop key must have value")];const t=qe(n[0].zoom);if("number"!=typeof t)return[new Gr(o,n[0].zoom,"stop zoom values must be numbers")];if(s&&s>t)return[new Gr(o,n[0].zoom,"stop zoom values must appear in ascending order")];t!==s&&(s=t,i=void 0,a={}),r=r.concat(Nr({key:`${o}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:qr,value:p}}))}else r=r.concat(p({key:`${o}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return Lr($e(n[1]))?r.concat([new Gr(`${o}[1]`,n[1],"expressions are not allowed in function stops.")]):r.concat(bn({key:`${o}[1]`,value:n[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function p(e,s){const o=Er(e.value),l=qe(e.value),u=null!==e.value?e.value:s;if(n){if(o!==n)return[new Gr(e.key,u,`${o} stop domain type must match previous stop domain type ${n}`)]}else n=o;if("number"!==o&&"string"!==o&&"boolean"!==o&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new Gr(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==o&&"categorical"!==r){let n=`number expected, ${o} found`;return vr(t)&&void 0===r&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Gr(e.key,u,n)]}return"categorical"!==r||"number"!==o||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==r&&"number"===o&&"number"==typeof l&&"number"==typeof i&&void 0!==i&&l<i?[new Gr(e.key,u,"stop domain values must appear in ascending order")]:(i=l,"categorical"===r&&l in a?[new Gr(e.key,u,"stop domain values must be unique")]:(a[l]=!0,[])):[new Gr(e.key,u,`integer expected, found ${String(l)}`)]}}function Qr(e){const t=("property"===e.expressionContext?Ur:Rr)($e(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Gr(`${e.key}${t.key}`,e.value,t.message)));const r=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!r.outputDefined())return[new Gr(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!si(r))return[new Gr(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Hr(r,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Ai(r,["zoom","feature-state"]))return[new Gr(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!ai(r))return[new Gr(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hr(e,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const e of t.valueSpec.expression.parameters)r.delete(e);if(0===r.size)return[];const n=[];return e instanceof jt&&r.has(e.name)?[new Gr(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild((e=>{n.push(...Hr(e,t))})),n)}function Wr(e){const t=e.key,r=e.value,n=e.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(qe(r))&&i.push(new Gr(t,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(n.values).indexOf(qe(r))&&i.push(new Gr(t,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),i}function Xr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Xr(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Yr(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xr(e)||(e=on(e));const r=e;let n=!0;try{n=function(e){if(!en(e))return e;let t=$e(e);return Jr(t),t=Kr(t),t}(r)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const i=Ne[`filter_${t}`],s=Rr(n,i);let a=null;if("error"===s.result)throw new Error(s.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(e,t,r)=>s.value.evaluate(e,t,{},r);let o=null,l=null;if(n!==r){const e=Rr(r,i);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));o=(t,r,n,i,s)=>e.value.evaluate(t,r,{},n,void 0,void 0,i,s),l=!ai(e.value.expression)}return{filter:a,dynamicFilter:o||void 0,needGeometry:nn(n),needFeature:!!l}}function Kr(e){if(!Array.isArray(e))return e;const t=function(e){if(tn.has(e[0]))for(let t=1;t<e.length;t++)if(en(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>Kr(e)))}function Jr(e){let t=!1;const r=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||en(e[n]),r.push(e[n+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||en(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||en(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}t&&(e.length=0,e.push("any",...r));for(let t=1;t<e.length;t++)Jr(e[t])}function en(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++)if(en(e[t]))return!0;return!1}const tn=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function rn(e,t){return e<t?-1:e>t?1:0}function nn(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(nn(e[t]))return!0;return!1}function on(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?an(e[1],e[2],"=="):"!="===t?An(an(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?an(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(on))):"all"===t?["all"].concat(e.slice(1).map(on)):"none"===t?["all"].concat(e.slice(1).map(on).map(An)):"in"===t?sn(e[1],e.slice(2)):"!in"===t?An(sn(e[1],e.slice(2))):"has"===t?ln(e[1]):"!has"===t?An(ln(e[1])):"within"!==t||e;var r}function an(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function sn(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(rn)]]:["filter-in-small",e,["literal",t]]}}function ln(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function An(e){return["!",e]}function li(e){return Xr($e(e.value))?Qr(Ze({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):cn(e)}function cn(e){const t=e.value,r=e.key;if("array"!==Er(t))return[new Gr(r,t,`array expected, ${Er(t)} found`)];const n=e.styleSpec;let i,s=[];if(t.length<1)return[new Gr(r,t,"filter array must have at least 1 element")];switch(s=s.concat(Wr({key:`${r}[0]`,value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),qe(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===qe(t[1])&&s.push(new Gr(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&s.push(new Gr(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(i=Er(t[1]),"string"!==i&&s.push(new Gr(`${r}[1]`,t[1],`string expected, ${i} found`)));for(let a=2;a<t.length;a++)i=Er(t[a]),"$type"===qe(t[1])?s=s.concat(Wr({key:`${r}[${a}]`,value:t[a],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&s.push(new Gr(`${r}[${a}]`,t[a],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let n=1;n<t.length;n++)s=s.concat(cn({key:`${r}[${n}]`,value:t[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Er(t[1]),2!==t.length?s.push(new Gr(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==i&&s.push(new Gr(`${r}[1]`,t[1],`string expected, ${i} found`));break;case"within":i=Er(t[1]),2!==t.length?s.push(new Gr(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==i&&s.push(new Gr(`${r}[1]`,t[1],`object expected, ${i} found`))}return s}function un(e,t){const r=e.key,n=e.style,i=e.styleSpec,s=e.value,a=e.objectKey,o=i[`${t}_${e.layerType}`];if(!o)return[];const l=a.match(/^(.*)-transition$/);if("paint"===t&&l&&o[l[1]]&&o[l[1]].transition)return bn({key:r,value:s,valueSpec:i.transition,style:n,styleSpec:i});const u=e.valueSpec||o[a];if(!u)return[new Gr(r,s,`unknown property "${a}"`)];let A;if("string"===Er(s)&&vr(u)&&!u.tokens&&(A=/^{([^}]+)}$/.exec(s)))return[new Gr(r,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const c=[];return"symbol"===e.layerType&&("text-field"===a&&n&&!n.glyphs&&c.push(new Gr(r,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Mr($e(s))&&"identity"===qe(s.type)&&c.push(new Gr(r,s,'"text-font" does not support identity functions'))),c.concat(bn({key:e.key,value:s,valueSpec:u,style:n,styleSpec:i,expressionContext:"property",propertyType:t,propertyKey:a}))}function hn(e){return un(e,"paint")}function pn(e){return un(e,"layout")}function dn(e){let t=[];const r=e.value,n=e.key,i=e.style,s=e.styleSpec;r.type||r.ref||t.push(new Gr(n,r,'either "type" or "ref" is required'));let a=qe(r.type);const o=qe(r.ref);if(r.id){const s=qe(r.id);for(let a=0;a<e.arrayIndex;a++){const e=i.layers[a];qe(e.id)===s&&t.push(new Gr(n,r.id,`duplicate layer id "${r.id}", previously used at line ${e.id.__line__}`))}}if("ref"in r){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in r&&t.push(new Gr(n,r[e],`"${e}" is prohibited for ref layers`))})),i.layers.forEach((t=>{qe(t.id)===o&&(e=t)})),e?e.ref?t.push(new Gr(n,r.ref,"ref cannot reference another ref layer")):a=qe(e.type):"string"==typeof o&&t.push(new Gr(n,r.ref,`ref layer "${o}" not found`))}else if("background"!==a&&"sky"!==a)if(r.source){const e=i.sources&&i.sources[r.source],s=e&&qe(e.type);e?"vector"===s&&"raster"===a?t.push(new Gr(n,r.source,`layer "${r.id}" requires a raster source`)):"raster"===s&&"raster"!==a?t.push(new Gr(n,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==s||r["source-layer"]?"raster-dem"===s&&"hillshade"!==a?t.push(new Gr(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==a||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===s&&e.lineMetrics||t.push(new Gr(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Gr(n,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Gr(n,r.source,`source "${r.source}" not found`))}else t.push(new Gr(n,r,'missing required property "source"'));return t=t.concat(Nr({key:n,value:r,valueSpec:s.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bn({key:`${n}.type`,value:r.type,valueSpec:s.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"}),filter:e=>li(Ze({layerType:a},e)),layout:e=>Nr({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>pn(Ze({layerType:a},e))}}),paint:e=>Nr({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>hn(Ze({layerType:a},e))}})}})),t}function fn(e){const t=e.value,r=e.key,n=Er(t);return"string"!==n?[new Gr(r,t,`string expected, ${n} found`)]:[]}const mn={promoteId:function({key:e,value:t}){if("string"===Er(t))return fn({key:e,value:t});{const r=[];for(const n in t)r.push(...fn({key:`${e}.${n}`,value:t[n]}));return r}}};function _n(e){const t=e.value,r=e.key,n=e.styleSpec,i=e.style;if(!t.type)return[new Gr(r,t,'"type" is required')];const s=qe(t.type);let a;switch(s){case"vector":case"raster":case"raster-dem":return a=Nr({key:r,value:t,valueSpec:n[`source_${s.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:mn}),a;case"geojson":if(a=Nr({key:r,value:t,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:mn}),t.cluster)for(const e in t.clusterProperties){const[n,i]=t.clusterProperties[e],s="string"==typeof n?[n,["accumulated"],["get",e]]:n;a.push(...Qr({key:`${r}.${e}.map`,value:i,expressionContext:"cluster-map"})),a.push(...Qr({key:`${r}.${e}.reduce`,value:s,expressionContext:"cluster-reduce"}))}return a;case"video":return Nr({key:r,value:t,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return Nr({key:r,value:t,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new Gr(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wr({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}}function gn(e){const t=e.value,r=e.styleSpec,n=r.light,i=e.style;let s=[];const a=Er(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new Gr("light",t,`object expected, ${a} found`)]),s;for(const e in t){const a=e.match(/^(.*)-transition$/);s=s.concat(a&&n[a[1]]&&n[a[1]].transition?bn({key:e,value:t[e],valueSpec:r.transition,style:i,styleSpec:r}):n[e]?bn({key:e,value:t[e],valueSpec:n[e],style:i,styleSpec:r}):[new Gr(e,t[e],`unknown property "${e}"`)])}return s}function yn(e){const t=e.value,r=e.key,n=e.style,i=e.styleSpec,s=i.terrain;let a=[];const o=Er(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new Gr("terrain",t,`object expected, ${o} found`)]),a;for(const e in t){const r=e.match(/^(.*)-transition$/);a=a.concat(r&&s[r[1]]&&s[r[1]].transition?bn({key:e,value:t[e],valueSpec:i.transition,style:n,styleSpec:i}):s[e]?bn({key:e,value:t[e],valueSpec:s[e],style:n,styleSpec:i}):[new Gr(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=n.sources&&n.sources[t.source],i=e&&qe(e.type);e?"raster-dem"!==i&&a.push(new Gr(r,t.source,`terrain cannot be used with a source of type ${String(i)}, it only be used with a "raster-dem" source type`)):a.push(new Gr(r,t.source,`source "${t.source}" not found`))}else a.push(new Gr(r,t,'terrain is missing required property "source"'));return a}function xn(e){const t=e.value,r=e.style,n=e.styleSpec,i=n.fog;let s=[];const a=Er(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new Gr("fog",t,`object expected, ${a} found`)]),s;for(const e in t){const a=e.match(/^(.*)-transition$/);s=s.concat(a&&i[a[1]]&&i[a[1]].transition?bn({key:e,value:t[e],valueSpec:n.transition,style:r,styleSpec:n}):i[e]?bn({key:e,value:t[e],valueSpec:i[e],style:r,styleSpec:n}):[new Gr(e,t[e],`unknown property "${e}"`)])}return s}const vn={"*":()=>[],array:Zr,boolean:function(e){const t=e.value,r=e.key,n=Er(t);return"boolean"!==n?[new Gr(r,t,`boolean expected, ${n} found`)]:[]},number:qr,color:function(e){const t=e.key,r=e.value,n=Er(r);return"string"!==n?[new Gr(t,r,`color expected, ${n} found`)]:null===mt.parseCSSColor(r)?[new Gr(t,r,`color expected, "${r}" found`)]:[]},enum:Wr,filter:li,function:$r,layer:dn,object:Nr,source:_n,light:gn,terrain:yn,fog:xn,string:fn,formatted:function(e){return 0===fn(e).length?[]:Qr(e)},resolvedImage:function(e){return 0===fn(e).length?[]:Qr(e)},projection:function(e){const t=e.value,r=e.styleSpec,n=r.projection,i=e.style;let s=[];const a=Er(t);if("object"===a)for(const e in t)s=s.concat(bn({key:e,value:t[e],valueSpec:n[e],style:i,styleSpec:r}));else"string"!==a&&(s=s.concat([new Gr("projection",t,`object or string expected, ${a} found`)]));return s}};function bn(e){const t=e.value,r=e.valueSpec,n=e.styleSpec;return r.expression&&Mr(qe(t))?$r(e):r.expression&&Lr($e(t))?Qr(e):r.type&&vn[r.type]?vn[r.type](e):Nr(Ze({},e,{valueSpec:r.type?n[r.type]:r}))}function wn(e){const t=e.value,r=e.key,n=fn(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new Gr(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new Gr(r,t,'"glyphs" url must include a "{range}" token'))),n}function Tn(e,t=Ne){return Cn(bn({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:wn,"*":()=>[]}}))}const En=e=>Cn(hn(e)),Mn=e=>Cn(pn(e));function Cn(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function In(e,t){let r=!1;if(t&&t.length)for(const n of t)e.fire(new je(new Error(n.message))),r=!0;return r}var Sn=kn;function kn(e,t,r){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(r=i[2]);for(var s=0;s<this.d*this.d;s++){var a=i[3+s],o=i[3+s+1];n.push(a===o?null:i.subarray(a,o))}var l=i[3+n.length+1];this.keys=i.subarray(i[3+n.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var A=r/t*e;this.min=-A,this.max=e+A}kn.prototype.insert=function(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},kn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},kn.prototype._insertCell=function(e,t,r,n,i,s){this.cells[i].push(s)},kn.prototype.query=function(e,t,r,n,i){var s=this.min,a=this.max;if(e<=s&&t<=s&&a<=r&&a<=n&&!i)return Array.prototype.slice.call(this.keys);var o=[];return this._forEachCell(e,t,r,n,this._queryCell,o,{},i),o},kn.prototype._queryCell=function(e,t,r,n,i,s,a,o){var l=this.cells[i];if(null!==l)for(var u=this.keys,A=this.bboxes,c=0;c<l.length;c++){var p=l[c];if(void 0===a[p]){var h=4*p;(o?o(A[h+0],A[h+1],A[h+2],A[h+3]):e<=A[h+2]&&t<=A[h+3]&&r>=A[h+0]&&n>=A[h+1])?(a[p]=!0,s.push(u[p])):a[p]=!1}}},kn.prototype._forEachCell=function(e,t,r,n,i,s,a,o){for(var l=this._convertToCellCoord(e),u=this._convertToCellCoord(t),A=this._convertToCellCoord(r),c=this._convertToCellCoord(n),p=l;p<=A;p++)for(var h=u;h<=c;h++){var d=this.d*h+p;if((!o||o(this._convertFromCellCoord(p),this._convertFromCellCoord(h),this._convertFromCellCoord(p+1),this._convertFromCellCoord(h+1)))&&i.call(this,e,t,r,n,d,s,a,o))return}},kn.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},kn.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},kn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(t+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var s=t,a=0;a<e.length;a++){var o=e[a];i[3+a]=s,i.set(o,s),s+=o.length}return i[3+e.length]=s,i.set(this.keys,s),i[3+e.length+1]=s+=this.keys.length,i.set(this.bboxes,s),s+=this.bboxes.length,i.buffer};const zn={};function Dn(e,t,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),zn[t]={klass:e,omit:r.omit||[]}}Dn(Object,"Object"),Sn.serialize=function(e,t){const r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Sn.deserialize=function(e){return new Sn(e.buffer)},Object.defineProperty(Sn,"name",{value:"Grid"}),Dn(Sn,"Grid"),Dn(gt,"Color"),Dn(Error,"Error"),Dn(Ce,"AJAXError"),Dn(bt,"ResolvedImage"),Dn(Vr,"StylePropertyFunction"),Dn(Pr,"StyleExpression",{omit:["_evaluator"]}),Dn(Or,"ZoomDependentExpression"),Dn(Fr,"ZoomConstantExpression"),Dn(jt,"CompoundExpression",{omit:["_evaluate"]});for(const e in gr)zn[gr[e]._classRegistryKey]||Dn(gr[e],`Expression${e}`);function Bn(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Pn(e){return r.ImageBitmap&&e instanceof r.ImageBitmap}function Ln(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Bn(e)||Pn(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const r=e;return t&&t.push(r.buffer),r}if(e instanceof r.ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const r=[];for(const n of e)r.push(Ln(n,t));return r}if("object"==typeof e){const r=e.constructor,n=r._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const i=r.serialize?r.serialize(e,t):{};if(!r.serialize){for(const r in e)e.hasOwnProperty(r)&&(zn[n].omit.indexOf(r)>=0||(i[r]=Ln(e[r],t)));e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(i.$name=n),i}throw new Error("can't serialize object of type "+typeof e)}function Rn(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Bn(e)||Pn(e)||ArrayBuffer.isView(e)||e instanceof r.ImageData)return e;if(Array.isArray(e))return e.map(Rn);if("object"==typeof e){const t=e.$name||"Object",{klass:r}=zn[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(e);const n=Object.create(r.prototype);for(const t of Object.keys(e))"$name"!==t&&(n[t]=Rn(e[t]));return n}throw new Error("can't deserialize object of type "+typeof e)}class Fn{constructor(){this.first=!0}update(e,t){const r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const On=e=>e>=1536&&e<=1791,Un=e=>e>=1872&&e<=1919,Vn=e=>e>=2208&&e<=2303,jn=e=>e>=11904&&e<=12031,Gn=e=>e>=12032&&e<=12255,Nn=e=>e>=12272&&e<=12287,Zn=e=>e>=12288&&e<=12351,qn=e=>e>=12352&&e<=12447,$n=e=>e>=12448&&e<=12543,Qn=e=>e>=12544&&e<=12591,Hn=e=>e>=12704&&e<=12735,Wn=e=>e>=12736&&e<=12783,Xn=e=>e>=12784&&e<=12799,Yn=e=>e>=12800&&e<=13055,Kn=e=>e>=13056&&e<=13311,Jn=e=>e>=13312&&e<=19903,eo=e=>e>=19968&&e<=40959,to=e=>e>=40960&&e<=42127,io=e=>e>=42128&&e<=42191,ro=e=>e>=44032&&e<=55215,no=e=>e>=63744&&e<=64255,oo=e=>e>=64336&&e<=65023,ao=e=>e>=65040&&e<=65055,so=e=>e>=65072&&e<=65103,lo=e=>e>=65104&&e<=65135,Ao=e=>e>=65136&&e<=65279,co=e=>e>=65280&&e<=65519;function uo(e){for(const t of e)if(fo(t.charCodeAt(0)))return!0;return!1}function ho(e){for(const t of e)if(!po(t.charCodeAt(0)))return!1;return!0}function po(e){return!(On(e)||Un(e)||Vn(e)||oo(e)||Ao(e))}function fo(e){return!(746!==e&&747!==e&&(e<4352||!(Hn(e)||Qn(e)||so(e)&&!(e>=65097&&e<=65103)||no(e)||Kn(e)||jn(e)||Wn(e)||!(!Zn(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Jn(e)||eo(e)||Yn(e)||(e=>e>=12592&&e<=12687)(e)||(e=>e>=43360&&e<=43391)(e)||(e=>e>=55216&&e<=55295)(e)||(e=>e>=4352&&e<=4607)(e)||ro(e)||qn(e)||Nn(e)||(e=>e>=12688&&e<=12703)(e)||Gn(e)||Xn(e)||$n(e)&&12540!==e||!(!co(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!lo(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(e=>e>=5120&&e<=5759)(e)||(e=>e>=6320&&e<=6399)(e)||ao(e)||(e=>e>=19904&&e<=19967)(e)||to(e)||io(e))))}function mo(e){return!(fo(e)||function(e){return!!((e=>e>=128&&e<=255)(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(e=>e>=8192&&e<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(e=>e>=8448&&e<=8527)(e)||(e=>e>=8528&&e<=8591)(e)||(e=>e>=8960&&e<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(e=>e>=9216&&e<=9279)(e)&&9251!==e||(e=>e>=9280&&e<=9311)(e)||(e=>e>=9312&&e<=9471)(e)||(e=>e>=9632&&e<=9727)(e)||(e=>e>=9728&&e<=9983)(e)&&!(e>=9754&&e<=9759)||(e=>e>=11008&&e<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Zn(e)||$n(e)||(e=>e>=57344&&e<=63743)(e)||so(e)||lo(e)||co(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function _o(e){return e>=1424&&e<=2303||oo(e)||Ao(e)}function go(e,t){return!(!t&&_o(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||(e=>e>=6016&&e<=6143)(e))}function yo(e){for(const t of e)if(_o(t.charCodeAt(0)))return!0;return!1}const xo="deferred",vo="loading",bo="loaded";let wo=null,To="unavailable",Eo=null;const Mo=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(To="error"),wo&&wo(e)};function Co(){Io.fire(new Ve("pluginStateChange",{pluginStatus:To,pluginURL:Eo}))}const Io=new Ge,So=function(){return To},ko=function(){if(To!==xo||!Eo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");To=vo,Co(),Eo&&ke({url:Eo},(e=>{e?Mo(e):(To=bo,Co())}))},zo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>To===bo||null!=zo.applyArabicShaping,isLoading:()=>To===vo,setState(e){To=e.pluginStatus,Eo=e.pluginURL},isParsed:()=>null!=zo.applyArabicShaping&&null!=zo.processBidirectionalText&&null!=zo.processStyledBidirectionalText,getPluginURL:()=>Eo};class Do{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fn,this.transition={},this.pitch=0)}isSupportedScript(e){return function(e,t){for(const r of e)if(!go(r.charCodeAt(0),t))return!1;return!0}(e,zo.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}}}class Bo{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Mr(e))return new Vr(e,t);if(Lr(e)){const r=Ur(e,t);if("error"===r.result)throw new Error(r.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return r.value}{let r=e;return"string"==typeof e&&"color"===t.type&&(r=gt.parse(e)),{kind:"constant",evaluate:()=>r}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class Po{constructor(e){this.property=e,this.value=new Bo(e,void 0)}transitioned(e,t){return new Ro(this.property,this.value,t,x({},e.transition,this.transition),e.now)}untransitioned(){return new Ro(this.property,this.value,null,{},0)}}class Lo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return k(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Po(this._values[e].property)),this._values[e].value=new Bo(this._values[e].property,null===t?void 0:k(t))}getTransition(e){return k(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Po(this._values[e].property)),this._values[e].transition=k(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r);const n=this.getTransition(t);void 0!==n&&(e[`${t}-transition`]=n)}return e}transitioned(e,t){const r=new Fo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,t._values[n]);return r}untransitioned(){const e=new Fo(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Ro{constructor(e,t,r,n,i){const s=n.delay||0,a=n.duration||0;i=i||0,this.property=e,this.value=t,this.begin=i+s,this.end=this.begin+a,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const n=e.now||0,i=this.value.possiblyEvaluate(e,t,r),s=this.prior;if(s){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return s.possiblyEvaluate(e,t,r);{const a=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(e,t,r),i,h(a))}}return i}}class Fo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const n=new Vo(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Oo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return k(this._values[e].value)}setValue(e,t){this._values[e]=new Bo(this._values[e].property,null===t?void 0:k(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r)}return e}possiblyEvaluate(e,t,r){const n=new Vo(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}}class Uo{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,n){return this.property.evaluate(this.value,this.parameters,e,t,r,n)}}class Vo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class jo{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){const n=gi[this.specification.type];return n?n(e,t,r):e}}class Go{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,n){return new Uo(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},r,n)}:e.expression,t)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Uo(this,{kind:"constant",value:void 0},e.parameters);const n=gi[this.specification.type];return n?new Uo(this,{kind:"constant",value:n(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,n,i,s){return"constant"===e.kind?e.value:e.evaluate(t,r,n,i,s)}}class No extends Go{possiblyEvaluate(e,t,r,n){if(void 0===e.value)return new Uo(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const i=e.expression.evaluate(t,null,{},r,n),s="resolvedImage"===e.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(s,s,s,t);return new Uo(this,{kind:"constant",value:a},t)}if("camera"===e.expression.kind){const r=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Uo(this,{kind:"constant",value:r},t)}return new Uo(this,e.expression,t)}evaluate(e,t,r,n,i,s){if("source"===e.kind){const a=e.evaluate(t,r,n,i,s);return this._calculate(a,a,a,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},r,n),e.evaluate({zoom:Math.floor(t.zoom)},r,n),e.evaluate({zoom:Math.floor(t.zoom)+1},r,n),t):e.value}_calculate(e,t,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t,other:r}:{from:r,to:t,other:e}}interpolate(e){return e}}class Zo{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){if(void 0!==e.value){if("constant"===e.expression.kind){const i=e.expression.evaluate(t,null,{},r,n);return this._calculate(i,i,i,t)}return this._calculate(e.expression.evaluate(new Do(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Do(Math.floor(t.zoom),t)),e.expression.evaluate(new Do(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}}interpolate(e){return e}}class qo{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){return!!e.expression.evaluate(t,null,{},r,n)}interpolate(){return!1}}class $o{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Do(0,{});for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const i=this.defaultPropertyValues[r]=new Bo(n,void 0),s=this.defaultTransitionablePropertyValues[r]=new Po(n);this.defaultTransitioningPropertyValues[r]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=i.possiblyEvaluate(t)}}}function Qo(e,t){return 256*(e=f(Math.floor(e),0,255))+f(Math.floor(t),0,255)}Dn(Go,"DataDrivenProperty"),Dn(jo,"DataConstantProperty"),Dn(No,"CrossFadedDataDrivenProperty"),Dn(Zo,"CrossFadedProperty"),Dn(qo,"ColorRampProperty");const Ho={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Wo{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yo(e,t=1){let r=0,n=0;return{members:e.map((e=>{const i=Ho[e.type].BYTES_PER_ELEMENT,s=r=Ko(r,Math.max(t,i)),a=e.components||1;return n=Math.max(n,i),r+=i*a,{name:e.name,type:e.type,components:a,offset:s}})),size:Ko(r,Math.max(n,t)),alignment:t}}function Ko(e,t){return Math.ceil(e/t)*t}class Jo extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=r,e}}Jo.prototype.bytesPerElement=4,Dn(Jo,"StructArrayLayout2i4");class ea extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.int16[i+2]=n,e}}ea.prototype.bytesPerElement=6,Dn(ea,"StructArrayLayout3i6");class ta extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=4*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,e}}ta.prototype.bytesPerElement=8,Dn(ta,"StructArrayLayout4i8");class ia extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,s,a)}emplace(e,t,r,n,i,s,a,o){const l=6*e,u=12*e,A=3*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.uint8[u+4]=n,this.uint8[u+5]=i,this.uint8[u+6]=s,this.uint8[u+7]=a,this.float32[A+2]=o,e}}ia.prototype.bytesPerElement=12,Dn(ia,"StructArrayLayout2i4ub1f12");class ra extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=4*e;return this.float32[s+0]=t,this.float32[s+1]=r,this.float32[s+2]=n,this.float32[s+3]=i,e}}ra.prototype.bytesPerElement=16,Dn(ra,"StructArrayLayout4f16");class na extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o,l,u){const A=this.length;return this.resize(A+1),this.emplace(A,e,t,r,n,i,s,a,o,l,u)}emplace(e,t,r,n,i,s,a,o,l,u,A){const c=10*e;return this.uint16[c+0]=t,this.uint16[c+1]=r,this.uint16[c+2]=n,this.uint16[c+3]=i,this.uint16[c+4]=s,this.uint16[c+5]=a,this.uint16[c+6]=o,this.uint16[c+7]=l,this.uint16[c+8]=u,this.uint16[c+9]=A,e}}na.prototype.bytesPerElement=20,Dn(na,"StructArrayLayout10ui20");class oa extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,r,n,i,s,a,o)}emplace(e,t,r,n,i,s,a,o,l){const u=8*e;return this.uint16[u+0]=t,this.uint16[u+1]=r,this.uint16[u+2]=n,this.uint16[u+3]=i,this.uint16[u+4]=s,this.uint16[u+5]=a,this.uint16[u+6]=o,this.uint16[u+7]=l,e}}oa.prototype.bytesPerElement=16,Dn(oa,"StructArrayLayout8ui16");class aa extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,a){const o=6*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.int16[o+2]=n,this.int16[o+3]=i,this.int16[o+4]=s,this.int16[o+5]=a,e}}aa.prototype.bytesPerElement=12,Dn(aa,"StructArrayLayout6i12");class sa extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o,l,u,A,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,n,i,s,a,o,l,u,A,c)}emplace(e,t,r,n,i,s,a,o,l,u,A,c,p){const h=12*e;return this.int16[h+0]=t,this.int16[h+1]=r,this.int16[h+2]=n,this.int16[h+3]=i,this.uint16[h+4]=s,this.uint16[h+5]=a,this.uint16[h+6]=o,this.uint16[h+7]=l,this.int16[h+8]=u,this.int16[h+9]=A,this.int16[h+10]=c,this.int16[h+11]=p,e}}sa.prototype.bytesPerElement=24,Dn(sa,"StructArrayLayout4i4ui4i24");class la extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,a){const o=10*e,l=5*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.int16[o+2]=n,this.float32[l+2]=i,this.float32[l+3]=s,this.float32[l+4]=a,e}}la.prototype.bytesPerElement=20,Dn(la,"StructArrayLayout3i3f20");class Aa extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Aa.prototype.bytesPerElement=4,Dn(Aa,"StructArrayLayout1ul4");class ca extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o,l,u,A,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,r,n,i,s,a,o,l,u,A,c,p)}emplace(e,t,r,n,i,s,a,o,l,u,A,c,p,h){const d=20*e,f=10*e;return this.int16[d+0]=t,this.int16[d+1]=r,this.int16[d+2]=n,this.int16[d+3]=i,this.int16[d+4]=s,this.float32[f+3]=a,this.float32[f+4]=o,this.float32[f+5]=l,this.float32[f+6]=u,this.int16[d+14]=A,this.uint32[f+8]=c,this.uint16[d+18]=p,this.uint16[d+19]=h,e}}ca.prototype.bytesPerElement=40,Dn(ca,"StructArrayLayout5i4f1i1ul2ui40");class ua extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,s,a)}emplace(e,t,r,n,i,s,a,o){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.int16[l+2]=n,this.int16[l+4]=i,this.int16[l+5]=s,this.int16[l+6]=a,this.int16[l+7]=o,e}}ua.prototype.bytesPerElement=16,Dn(ua,"StructArrayLayout3i2i2i16");class ha extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i)}emplace(e,t,r,n,i,s){const a=4*e,o=8*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=n,this.int16[o+6]=i,this.int16[o+7]=s,e}}ha.prototype.bytesPerElement=16,Dn(ha,"StructArrayLayout2f1f2i16");class pa extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=12*e,a=3*e;return this.uint8[s+0]=t,this.uint8[s+1]=r,this.float32[a+1]=n,this.float32[a+2]=i,e}}pa.prototype.bytesPerElement=12,Dn(pa,"StructArrayLayout2ub2f12");class da extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.float32[i+0]=t,this.float32[i+1]=r,this.float32[i+2]=n,e}}da.prototype.bytesPerElement=12,Dn(da,"StructArrayLayout3f12");class fa extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=r,this.uint16[i+2]=n,e}}fa.prototype.bytesPerElement=6,Dn(fa,"StructArrayLayout3ui6");class ma extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o,l,u,A,c,p,h,d,f,m,g,_,y,b){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,r,n,i,s,a,o,l,u,A,c,p,h,d,f,m,g,_,y,b)}emplace(e,t,r,n,i,s,a,o,l,u,A,c,p,h,d,f,m,g,_,y,b,x){const v=30*e,w=15*e,T=60*e;return this.int16[v+0]=t,this.int16[v+1]=r,this.int16[v+2]=n,this.float32[w+2]=i,this.float32[w+3]=s,this.uint16[v+8]=a,this.uint16[v+9]=o,this.uint32[w+5]=l,this.uint32[w+6]=u,this.uint32[w+7]=A,this.uint16[v+16]=c,this.uint16[v+17]=p,this.uint16[v+18]=h,this.float32[w+10]=d,this.float32[w+11]=f,this.uint8[T+48]=m,this.uint8[T+49]=g,this.uint8[T+50]=_,this.uint32[w+13]=y,this.int16[v+28]=b,this.uint8[T+58]=x,e}}ma.prototype.bytesPerElement=60,Dn(ma,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class _a extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a,o,l,u,A,c,p,h,d,f,m,g,_,y,b,x,v,w,T,E,M,C,I,S){const k=this.length;return this.resize(k+1),this.emplace(k,e,t,r,n,i,s,a,o,l,u,A,c,p,h,d,f,m,g,_,y,b,x,v,w,T,E,M,C,I,S)}emplace(e,t,r,n,i,s,a,o,l,u,A,c,p,h,d,f,m,g,_,y,b,x,v,w,T,E,M,C,I,S,k){const z=38*e,D=19*e;return this.int16[z+0]=t,this.int16[z+1]=r,this.int16[z+2]=n,this.float32[D+2]=i,this.float32[D+3]=s,this.int16[z+8]=a,this.int16[z+9]=o,this.int16[z+10]=l,this.int16[z+11]=u,this.int16[z+12]=A,this.int16[z+13]=c,this.uint16[z+14]=p,this.uint16[z+15]=h,this.uint16[z+16]=d,this.uint16[z+17]=f,this.uint16[z+18]=m,this.uint16[z+19]=g,this.uint16[z+20]=_,this.uint16[z+21]=y,this.uint16[z+22]=b,this.uint16[z+23]=x,this.uint16[z+24]=v,this.uint16[z+25]=w,this.uint16[z+26]=T,this.uint16[z+27]=E,this.uint16[z+28]=M,this.uint32[D+15]=C,this.float32[D+16]=I,this.float32[D+17]=S,this.float32[D+18]=k,e}}_a.prototype.bytesPerElement=76,Dn(_a,"StructArrayLayout3i2f6i15ui1ul3f76");class ga extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ga.prototype.bytesPerElement=4,Dn(ga,"StructArrayLayout1f4");class ya extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,s,a)}emplace(e,t,r,n,i,s,a,o){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=r,this.float32[l+2]=n,this.float32[l+3]=i,this.float32[l+4]=s,this.float32[l+5]=a,this.float32[l+6]=o,e}}ya.prototype.bytesPerElement=28,Dn(ya,"StructArrayLayout7f28");class xa extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i)}emplace(e,t,r,n,i,s){const a=5*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=i,this.float32[a+4]=s,e}}xa.prototype.bytesPerElement=20,Dn(xa,"StructArrayLayout5f20");class va extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=6*e;return this.uint32[3*e+0]=t,this.uint16[s+2]=r,this.uint16[s+3]=n,this.uint16[s+4]=i,e}}va.prototype.bytesPerElement=12,Dn(va,"StructArrayLayout1ul3ui12");class ba extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=r,e}}ba.prototype.bytesPerElement=4,Dn(ba,"StructArrayLayout2ui4");class wa extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}wa.prototype.bytesPerElement=2,Dn(wa,"StructArrayLayout1ui2");class Ta extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=r,e}}Ta.prototype.bytesPerElement=8,Dn(Ta,"StructArrayLayout2f8");class Ea extends Wo{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Ea.prototype.size=12;class Ma extends aa{get(e){return new Ea(this,e)}}Dn(Ma,"FillExtrusionExtArray");class Ca extends Wo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ca.prototype.size=40;class Ia extends ca{get(e){return new Ca(this,e)}}Dn(Ia,"CollisionBoxArray");class Sa extends Wo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Sa.prototype.size=60;class ka extends ma{get(e){return new Sa(this,e)}}Dn(ka,"PlacedSymbolArray");class za extends Wo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}za.prototype.size=76;class Da extends _a{get(e){return new za(this,e)}}Dn(Da,"SymbolInstanceArray");class Ba extends ga{getoffsetX(e){return this.float32[1*e+0]}}Dn(Ba,"GlyphOffsetArray");class Pa extends ea{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Dn(Pa,"SymbolLineVertexArray");class La extends Wo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}La.prototype.size=12;class Ra extends va{get(e){return new La(this,e)}}Dn(Ra,"FeatureIndexArray");class Fa extends Wo{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Fa.prototype.size=4;class Oa extends ba{get(e){return new Fa(this,e)}}Dn(Oa,"FillExtrusionCentroidArray");class Ua extends Wo{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Ua.prototype.size=12;class Va extends aa{get(e){return new Ua(this,e)}}Dn(Va,"CircleGlobeExtArray");const ja=Yo([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Ga=Yo([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Na=ft((function(e){e.exports=function(e,t){var r,n,i,s,a,o,l,u;for(n=e.length-(r=3&e.length),i=t,a=3432918353,o=461845907,u=0;u<n;)l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,i=27492+(65535&(s=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),Za=ft((function(e){e.exports=function(e,t){for(var r,n=e.length,i=t^n,s=0;n>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(s)|(255&e.charCodeAt(++s))<<8|(255&e.charCodeAt(++s))<<16|(255&e.charCodeAt(++s))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++s;switch(n){case 3:i^=(255&e.charCodeAt(s+2))<<16;case 2:i^=(255&e.charCodeAt(s+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(s)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),qa=Na,$a=Za;qa.murmur3=Na,qa.murmur2=$a;class Qa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,r,n){this.ids.push(Ha(e)),this.positions.push(t,r,n)}getPositions(e){const t=Ha(e);let r=0,n=this.ids.length-1;for(;r<n;){const e=r+n>>1;this.ids[e]>=t?n=e:r=e+1}const i=[];for(;this.ids[r]===t;)i.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return i}static serialize(e,t){const r=new Float64Array(e.ids),n=new Uint32Array(e.positions);return Wa(r,n,0,r.length-1),t&&t.push(r.buffer,n.buffer),{ids:r,positions:n}}static deserialize(e){const t=new Qa;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Ha(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:qa(String(e))}function Wa(e,t,r,n){for(;r<n;){const i=e[r+n>>1];let s=r-1,a=n+1;for(;;){do{s++}while(e[s]<i);do{a--}while(e[a]>i);if(s>=a)break;Xa(e,s,a),Xa(t,3*s,3*a),Xa(t,3*s+1,3*a+1),Xa(t,3*s+2,3*a+2)}a-r<n-a?(Wa(e,t,r,a),r=a+1):(Wa(e,t,a+1,n),n=a)}}function Xa(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}Dn(Qa,"FeaturePositionMap");class Ya{constructor(e,t){this.gl=e.gl,this.location=t}}class Ka extends Ya{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ja extends Ya{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class es extends Ya{constructor(e,t){super(e,t),this.current=gt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ts=new Float32Array(16),is=new Float32Array(9),rs=new Float32Array(4);function ns(e){return[Qo(255*e.r,255*e.g),Qo(255*e.b,255*e.a)]}class os{constructor(e,t,r){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=r}setUniform(e,t,r){e.set(r.constantOr(this.value))}getBinding(e,t,r){return"color"===this.type?new es(e,t):new Ka(e,t)}}class as{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,r,n){const i="u_pattern_to"===n||"u_dash_to"===n?this.patternTo:"u_pattern_from"===n||"u_dash_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;i&&e.set(i)}getBinding(e,t,r){return"u_pattern_from"===r||"u_pattern_to"===r||"u_dash_from"===r||"u_dash_to"===r?new Ja(e,t):new Ka(e,t)}}class ss{constructor(e,t,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(e,t,r,n,i,s){const a=this.paintVertexArray.length,o=this.expression.evaluate(new Do(0),t,{},i,n,s);this.paintVertexArray.resize(e),this._setPaintValue(a,e,o)}updatePaintArray(e,t,r,n,i){const s=this.expression.evaluate({zoom:0},r,n,void 0,i);this._setPaintValue(e,t,s)}_setPaintValue(e,t,r){if("color"===this.type){const n=ns(r);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n[0],n[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ls{constructor(e,t,r,n,i,s){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?4:2,offset:0}))),this.paintVertexArray=new s}populatePaintArray(e,t,r,n,i,s){const a=this.expression.evaluate(new Do(this.zoom),t,{},i,n,s),o=this.expression.evaluate(new Do(this.zoom+1),t,{},i,n,s),l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(l,e,a,o)}updatePaintArray(e,t,r,n,i){const s=this.expression.evaluate({zoom:this.zoom},r,n,void 0,i),a=this.expression.evaluate({zoom:this.zoom+1},r,n,void 0,i);this._setPaintValue(e,t,s,a)}_setPaintValue(e,t,r,n){if("color"===this.type){const i=ns(r),s=ns(n);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i[0],i[1],s[0],s[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,n=f(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(n)}getBinding(e,t,r){return new Ka(e,t)}}class As{constructor(e,t,r,n,i,s,a){this.expression=e,this.type=r,this.useIntegerZoom=n,this.zoom=i,this.layerId=a,this.paintVertexAttributes=("array"===r?Ga:ja).members;for(let e=0;e<t.length;++e);this.zoomInPaintVertexArray=new s,this.zoomOutPaintVertexArray=new s}populatePaintArray(e,t,r){const n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,n,i,s){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],s)}_setPaintValues(e,t,r,n){if(!n||!r)return;const{min:i,mid:s,max:a}=r,o=n[i],l=n[s],u=n[a];if(o&&l&&u)for(let r=e;r<t;r++)this._setPaintValue(this.zoomInPaintVertexArray,r,l,o),this._setPaintValue(this.zoomOutPaintVertexArray,r,l,u)}_setPaintValue(e,t,r,n){e.emplace(t,r.tl[0],r.tl[1],r.br[0],r.br[1],n.tl[0],n.tl[1],n.br[0],n.br[1],r.pixelRatio,n.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class cs{constructor(e,t,r=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const i in e.paint._values){if(!r(i))continue;const s=e.paint.get(i);if(!(s instanceof Uo&&vr(s.property.specification)))continue;const a=ps(i,e.type),o=s.value,l=s.property.specification.type,u=s.property.useIntegerZoom,A=s.property.specification["property-type"],c="cross-faded"===A||"cross-faded-data-driven"===A,p="line-dasharray"===String(i)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==o.kind||p)if("source"===o.kind||p||c){const r=ms(i,l,"source");this.binders[i]=c?new As(o,a,l,u,t,r,e.id):new ss(o,a,l,r),n.push(`/a_${i}`)}else{const e=ms(i,l,"composite");this.binders[i]=new ls(o,a,l,u,t,e),n.push(`/z_${i}`)}else this.binders[i]=c?new as(o.value,a):new os(o.value,a,l),n.push(`/u_${i}`)}this.cacheKey=n.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof ss||t instanceof ls?t.maxValue:0}populatePaintArrays(e,t,r,n,i,s){for(const a in this.binders){const o=this.binders[a];(o instanceof ss||o instanceof ls||o instanceof As)&&o.populatePaintArray(e,t,r,n,i,s)}}setConstantPatternPositions(e,t){for(const r in this.binders){const n=this.binders[r];n instanceof as&&n.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,r,n,i,s){let a=!1;for(const o in e){const l=t.getPositions(o);for(const t of l){const l=r.feature(t.index);for(const r in this.binders){const u=this.binders[r];if((u instanceof ss||u instanceof ls||u instanceof As)&&!0===u.expression.isStateDependent){const A=n.paint.get(r);u.expression=A.value,u.updatePaintArray(t.start,t.end,l,e[o],i,s),a=!0}}}}return a}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof os||r instanceof as)&&e.push(...r.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof ss||r instanceof ls||r instanceof As)for(let t=0;t<r.paintVertexAttributes.length;t++)e.push(r.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof os||r instanceof as||r instanceof ls)for(const t of r.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const r=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof os||i instanceof as||i instanceof ls)for(const s of i.uniformNames)if(t[s]){const a=i.getBinding(e,t[s],s);r.push({name:s,property:n,binding:a})}}return r}setUniforms(e,t,r,n){for(const{name:e,property:i,binding:s}of t)this.binders[i].setUniform(s,n,r.get(i),e)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const r=this.binders[t];if(e&&r instanceof As){const t=2===e.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(r instanceof ss||r instanceof ls)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof ss||r instanceof ls||r instanceof As)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof ss||t instanceof ls||t instanceof As)&&t.destroy()}}}class us{constructor(e,t,r=(()=>!0)){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new cs(n,t,r);this.needsUpload=!1,this._featureMap=new Qa,this._bufferOffset=0}populatePaintArrays(e,t,r,n,i,s,a){for(const r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(e,t,n,i,s,a);void 0!==t.id&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,n,i){for(const s of r)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(e,this._featureMap,t,s,n,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const hs={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function ps(e,t){return hs[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const ds={"line-pattern":{source:na,composite:na},"fill-pattern":{source:na,composite:na},"fill-extrusion-pattern":{source:na,composite:na},"line-dasharray":{source:oa,composite:oa}},fs={color:{source:Ta,composite:ra},number:{source:ga,composite:Ta}};function ms(e,t,r){const n=ds[e];return n&&n[r]||fs[t][r]}Dn(os,"ConstantBinder"),Dn(as,"CrossFadedConstantBinder"),Dn(ss,"SourceExpressionBinder"),Dn(As,"CrossFadedCompositeBinder"),Dn(ls,"CompositeExpressionBinder"),Dn(cs,"ProgramConfiguration",{omit:["_buffers"]}),Dn(us,"ProgramConfigurationSet");const _s="-transition";class gs extends Ge{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Oo(t.layout)),t.paint)){this._transitionablePaint=new Lo(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vo(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,r={}){null!=t&&this._validate(Mn,`layers.${this.id}.layout.${e}`,e,t,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return C(e,_s)?this._transitionablePaint.getTransition(e.slice(0,-_s.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,r={}){if(null!=t&&this._validate(En,`layers.${this.id}.paint.${e}`,e,t,r))return!1;if(C(e,_s))return this._transitionablePaint.setTransition(e.slice(0,-_s.length),t||void 0),!1;{const r=this._transitionablePaint._values[e],n="cross-faded-data-driven"===r.property.specification["property-type"],i=r.value.isDataDriven(),s=r.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const a=this._transitionablePaint._values[e].value;return a.isDataDriven()||i||n||this._handleOverridablePaintPropertyUpdate(e,s,a)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),S(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,r,n,i={}){return(!i||!1!==i.validate)&&In(this,e.call(Tn,{key:t,layerType:this.type,objectKey:r,value:n,styleSpec:Ne,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Uo&&vr(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Yr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const ys=Yo([{name:"a_pos",components:2,type:"Int16"}],4),xs=Yo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class vs{constructor(e=[]){this.segments=e}prepareSegment(e,t,r,n){let i=this.segments[this.segments.length-1];return e>vs.MAX_VERTEX_ARRAY_LENGTH&&D(`Max vertices per segment is ${vs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!i||i.vertexLength+e>vs.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,n){return new vs([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}vs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dn(vs,"SegmentVector");var bs=8192;class ws{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Es?new Es(e.lng,e.lat):Es.convert(e),this}setSouthWest(e){return this._sw=e instanceof Es?new Es(e.lng,e.lat):Es.convert(e),this}extend(e){const t=this._sw,r=this._ne;let n,i;if(e instanceof Es)n=e,i=e;else{if(!(e instanceof ws))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(ws.convert(e)):this.extend(Es.convert(e)):this;if(n=e._sw,i=e._ne,!n||!i)return this}return t||r?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new Es(n.lng,n.lat),this._ne=new Es(i.lng,i.lat)),this}getCenter(){return new Es((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Es(this.getWest(),this.getNorth())}getSouthEast(){return new Es(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:r}=Es.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(e){return!e||e instanceof ws?e:new ws(e)}}const Ts=6371008.8;class Es{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Es(_(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,r=this.lat*t,n=e.lat*t,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return Ts*Math.acos(Math.min(i,1))}toBounds(e=0){const t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new ws(new Es(this.lng-r,this.lat-t),new Es(this.lng+r,this.lat+t))}static convert(e){if(e instanceof Es)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Es(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Es(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ms=2*Math.PI*Ts;function Cs(e){return Ms*Math.cos(e*Math.PI/180)}function Is(e){return(180+e)/360}function Ss(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ks(e,t){return e/Cs(t)}function zs(e){return 360*e-180}function Ds(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Bs(e,t){return e*Cs(Ds(t))}const Ps=85.051129;class Ls{constructor(e,t,r=0){this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e,t=0){const r=Es.convert(e);return new Ls(Is(r.lng),Ss(r.lat),ks(t,r.lat))}toLngLat(){return new Es(zs(this.x),Ds(this.y))}toAltitude(){return Bs(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ms*(e=Ds(this.y),1/Math.cos(e*Math.PI/180));var e}}function Rs(e,t,r,n,s,a,o,l,u){const A=(t+n)/2,c=(r+s)/2,p=new i(A,c);l(p),function(e,t,r,n,i,s){const a=r-i,o=n-s;return Math.abs((n-t)*a-(r-e)*o)/Math.hypot(a,o)}(p.x,p.y,a.x,a.y,o.x,o.y)>=u?(Rs(e,t,r,A,c,a,p,l,u),Rs(e,A,c,n,s,p,o,l,u)):e.push(o)}function Fs(e,t,r){let n=e[0],i=n.x,s=n.y;t(n);const a=[n];for(let o=1;o<e.length;o++){const l=e[o],{x:u,y:A}=l;t(l),Rs(a,i,s,u,A,n,l,t,r),i=u,s=A,n=l}return a}function Os(e,t,r,n,i){if(i(t,r)){const s=t.add(r).mult(.5);n(s),Os(e,t,s,n,i),Os(e,s,r,n,i)}else e.push(r)}function Us(e,t,r){let n=e[0];t(n);const i=[n];for(let s=1;s<e.length;s++){const a=e[s];t(a),Os(i,n,a,t,r),n=a}return i}const Vs=Math.pow(2,14)-1,js=-Vs-1;function Gs(e,t){const r=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=f(r,js,Vs),e.y=f(n,js,Vs),(r<e.x||r>e.x+1||n<e.y||n>e.y+1)&&D("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Ns(e,t,r){const n=e.loadGeometry(),i=e.extent,s=bs/i;if(t&&r&&r.projection.isReprojectedInTileSpace){const s=1<<t.z,{scale:a,x:o,y:l,projection:u}=r,A=e=>{const r=zs((t.x+e.x/i)/s),n=Ds((t.y+e.y/i)/s),A=u.project(r,n);e.x=(A.x*a-o)*i,e.y=(A.y*a-l)*i};for(let t=0;t<n.length;t++)if(1!==e.type)n[t]=Fs(n[t],A,1);else{const e=[];for(const r of n[t])r.x<0||r.x>=i||r.y<0||r.y>=i||(A(r),e.push(r));n[t]=e}}for(const e of n)for(const t of e)Gs(t,s);return n}function Zs(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ns(e):[]}}function qs(e,t,r,n,i){e.emplaceBack(2*t+(n+1)/2,2*r+(i+1)/2)}function $s(e,t,r){const n=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*n,r[1]*n,r[2]*n)}class Qs{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Jo,this.indexArray=new fa,this.segments=new vs,this.programConfigurations=new us(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,n){const i=this.layers[0],s=[];let a=null;"circle"===i.type&&(a=i.layout.get("circle-sort-key"));for(const{feature:t,id:i,index:o,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Zs(t,e);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom),u,r))continue;const A=a?a.evaluate(u,{},r):void 0,c={id:i,properties:t.properties,type:t.type,sourceLayerIndex:l,index:o,geometry:e?u.geometry:Ns(t,r,n),patterns:{},sortKey:A};s.push(c)}a&&s.sort(((e,t)=>e.sortKey-t.sortKey));let o=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new Va,o=n.projection);for(const n of s){const{geometry:i,index:s,sourceLayerIndex:a}=n,l=e[s].feature;this.addFeature(n,i,s,t.availableImages,r,o),t.featureIndex.insert(l,i,s,a,this.index)}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ys.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xs.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,r,n,i,s){for(const r of t)for(const t of r){const r=t.x,n=t.y;if(r<0||r>=bs||n<0||n>=bs)continue;if(s){const e=s.projectTilePoint(r,n,i),t=s.upVector(i,r,n),a=this.globeExtVertexArray;$s(a,e,t),$s(a,e,t),$s(a,e,t),$s(a,e,t)}const a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),o=a.vertexLength;qs(this.layoutVertexArray,r,n,-1,-1),qs(this.layoutVertexArray,r,n,1,-1),qs(this.layoutVertexArray,r,n,1,1),qs(this.layoutVertexArray,r,n,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+2,o+3),a.vertexLength+=4,a.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,i)}}function Hs(e,t){for(let r=0;r<e.length;r++)if(rl(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(rl(e,t[r]))return!0;return!!Ks(e,t)}function Ws(e,t,r){return!!rl(e,t)||!!el(t,e,r)}function Xs(e,t){if(1===e.length)return il(t,e[0]);for(let r=0;r<t.length;r++){const n=t[r];for(let t=0;t<n.length;t++)if(rl(e,n[t]))return!0}for(let r=0;r<e.length;r++)if(il(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(Ks(e,t[r]))return!0;return!1}function Ys(e,t,r){if(e.length>1){if(Ks(e,t))return!0;for(let n=0;n<t.length;n++)if(el(t[n],e,r))return!0}for(let n=0;n<e.length;n++)if(el(e[n],t,r))return!0;return!1}function Ks(e,t){if(0===e.length||0===t.length)return!1;for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++)if(Js(n,i,t[e],t[e+1]))return!0}return!1}function Js(e,t,r,n){return B(e,r,n)!==B(t,r,n)&&B(e,t,r)!==B(e,t,n)}function el(e,t,r){const n=r*r;if(1===t.length)return e.distSqr(t[0])<n;for(let r=1;r<t.length;r++)if(tl(e,t[r-1],t[r])<n)return!0;return!1}function tl(e,t,r){const n=t.distSqr(r);if(0===n)return e.distSqr(t);const i=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/n;return e.distSqr(i<0?t:i>1?r:r.sub(t)._mult(i)._add(t))}function il(e,t){let r,n,i,s=!1;for(let a=0;a<e.length;a++){r=e[a];for(let e=0,a=r.length-1;e<r.length;a=e++)n=r[e],i=r[a],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(s=!s)}return s}function rl(e,t){let r=!1;for(let n=0,i=e.length-1;n<e.length;i=n++){const s=e[n],a=e[i];s.y>t.y!=a.y>t.y&&t.x<(a.x-s.x)*(t.y-s.y)/(a.y-s.y)+s.x&&(r=!r)}return r}function nl(e,t,r,n,s){for(const i of e)if(t<=i.x&&r<=i.y&&n>=i.x&&s>=i.y)return!0;const a=[new i(t,r),new i(t,s),new i(n,s),new i(n,r)];if(e.length>2)for(const t of a)if(rl(e,t))return!0;for(let t=0;t<e.length-1;t++)if(al(e[t],e[t+1],a))return!0;return!1}function al(e,t,r){const n=r[0],i=r[2];if(e.x<n.x&&t.x<n.x||e.x>i.x&&t.x>i.x||e.y<n.y&&t.y<n.y||e.y>i.y&&t.y>i.y)return!1;const s=B(e,t,r[0]);return s!==B(e,t,r[1])||s!==B(e,t,r[2])||s!==B(e,t,r[3])}function sl(e,t,r){const n=t.paint.get(e).value;return"constant"===n.kind?n.value:r.programConfigurations.get(t.id).getMaxValue(e)}function ll(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ol(e,t,r,n,s){if(!t[0]&&!t[1])return e;const a=i.convert(t)._mult(s);"viewport"===r&&a._rotate(-n);const o=[];for(let t=0;t<e.length;t++)o.push(e[t].sub(a));return o}function Al(e,t,r,n){const s=i.convert(e)._mult(n);return"viewport"===t&&s._rotate(-r),s}Dn(Qs,"CircleBucket",{omit:["layers"]});const ul=new $o({"circle-sort-key":new Go(Ne.layout_circle["circle-sort-key"])});var cl={paint:new $o({"circle-radius":new Go(Ne.paint_circle["circle-radius"]),"circle-color":new Go(Ne.paint_circle["circle-color"]),"circle-blur":new Go(Ne.paint_circle["circle-blur"]),"circle-opacity":new Go(Ne.paint_circle["circle-opacity"]),"circle-translate":new jo(Ne.paint_circle["circle-translate"]),"circle-translate-anchor":new jo(Ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jo(Ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jo(Ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Go(Ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Go(Ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Go(Ne.paint_circle["circle-stroke-opacity"])}),layout:ul},hl=1e-6,pl="undefined"!=typeof Float32Array?Float32Array:Array;function fl(){var e=new pl(9);return pl!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function dl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ml(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],A=t[7],c=t[8],p=t[9],h=t[10],d=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=r[0],b=r[1],x=r[2],v=r[3];return e[0]=y*n+b*o+x*c+v*f,e[1]=y*i+b*l+x*p+v*m,e[2]=y*s+b*u+x*h+v*g,e[3]=y*a+b*A+x*d+v*_,e[4]=(y=r[4])*n+(b=r[5])*o+(x=r[6])*c+(v=r[7])*f,e[5]=y*i+b*l+x*p+v*m,e[6]=y*s+b*u+x*h+v*g,e[7]=y*a+b*A+x*d+v*_,e[8]=(y=r[8])*n+(b=r[9])*o+(x=r[10])*c+(v=r[11])*f,e[9]=y*i+b*l+x*p+v*m,e[10]=y*s+b*u+x*h+v*g,e[11]=y*a+b*A+x*d+v*_,e[12]=(y=r[12])*n+(b=r[13])*o+(x=r[14])*c+(v=r[15])*f,e[13]=y*i+b*l+x*p+v*m,e[14]=y*s+b*u+x*h+v*g,e[15]=y*a+b*A+x*d+v*_,e}function _l(e,t,r){var n,i,s,a,o,l,u,A,c,p,h,d,f=r[0],m=r[1],g=r[2];return t===e?(e[12]=t[0]*f+t[4]*m+t[8]*g+t[12],e[13]=t[1]*f+t[5]*m+t[9]*g+t[13],e[14]=t[2]*f+t[6]*m+t[10]*g+t[14],e[15]=t[3]*f+t[7]*m+t[11]*g+t[15]):(i=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],A=t[7],c=t[8],p=t[9],h=t[10],d=t[11],e[0]=n=t[0],e[1]=i,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=u,e[7]=A,e[8]=c,e[9]=p,e[10]=h,e[11]=d,e[12]=n*f+o*m+c*g+t[12],e[13]=i*f+l*m+p*g+t[13],e[14]=s*f+u*m+h*g+t[14],e[15]=a*f+A*m+d*g+t[15]),e}function gl(e,t,r){var n=r[0],i=r[1],s=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function yl(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[4],a=t[5],o=t[6],l=t[7],u=t[8],A=t[9],c=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+u*n,e[5]=a*i+A*n,e[6]=o*i+c*n,e[7]=l*i+p*n,e[8]=u*i-s*n,e[9]=A*i-a*n,e[10]=c*i-o*n,e[11]=p*i-l*n,e}function xl(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],u=t[8],A=t[9],c=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-u*n,e[1]=a*i-A*n,e[2]=o*i-c*n,e[3]=l*i-p*n,e[8]=s*n+u*i,e[9]=a*n+A*i,e[10]=o*n+c*i,e[11]=l*n+p*i,e}function vl(e,t,r){var n,i,s,a=r[0],o=r[1],l=r[2],u=Math.hypot(a,o,l);return u<hl?null:(a*=u=1/u,o*=u,l*=u,n=Math.sin(t),i=Math.cos(t),e[0]=a*a*(s=1-i)+i,e[1]=o*a*s+l*n,e[2]=l*a*s-o*n,e[3]=0,e[4]=a*o*s-l*n,e[5]=o*o*s+i,e[6]=l*o*s+a*n,e[7]=0,e[8]=a*l*s+o*n,e[9]=o*l*s-a*n,e[10]=l*l*s+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var bl=ml;function wl(){var e=new pl(3);return pl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Tl(e){var t=new pl(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function El(e){return Math.hypot(e[0],e[1],e[2])}function Ml(e,t,r){var n=new pl(3);return n[0]=e,n[1]=t,n[2]=r,n}function Cl(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Il(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Sl(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function kl(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function zl(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Dl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Bl(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function Pl(e,t){var r=t[0],n=t[1],i=t[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function Ll(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Rl(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1],l=r[2];return e[0]=i*l-s*o,e[1]=s*a-n*l,e[2]=n*o-i*a,e}function Fl(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[3]*n+r[7]*i+r[11]*s+r[15];return e[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/(a=a||1),e[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/a,e[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/a,e}function Ol(e,t,r){var n=r[0],i=r[1],s=r[2],a=t[0],o=t[1],l=t[2],u=i*l-s*o,A=s*a-n*l,c=n*o-i*a,p=i*c-s*A,h=s*u-n*c,d=n*A-i*u,f=2*r[3];return A*=f,c*=f,h*=2,d*=2,e[0]=a+(u*=f)+(p*=2),e[1]=o+A+h,e[2]=l+c+d,e}var Ul,Vl=Il,jl=Sl,Gl=El;function Nl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Zl(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*a,e[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*a,e[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*a,e[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*a,e}function ql(){var e=new pl(4);return pl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function $l(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ql(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*o,e[1]=i*l+s*o,e[2]=s*l-i*o,e[3]=a*l-n*o,e}function Hl(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l-s*o,e[1]=i*l+a*o,e[2]=s*l+n*o,e[3]=a*l-i*o,e}wl(),Ul=new pl(4),pl!=Float32Array&&(Ul[0]=0,Ul[1]=0,Ul[2]=0,Ul[3]=0),wl(),Ml(1,0,0),Ml(0,1,0),ql(),ql(),fl();class Wl{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,r){const n=Ll(t,this.dir);if(Math.abs(n)<1e-6)return!1;const i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,r[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(e,t,r){if(function(e,t){var r=e[0],n=e[1],i=e[2],s=t[0],a=t[1],o=t[2];return Math.abs(r-s)<=hl*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=hl*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=hl*Math.max(1,Math.abs(i),Math.abs(o))}(this.pos,e)||0===t)return r[0]=r[1]=r[2]=0,!1;const[n,i,s]=this.dir,a=this.pos[0]-e[0],o=this.pos[1]-e[1],l=this.pos[2]-e[2],u=n*n+i*i+s*s,A=2*(a*n+o*i+l*s),c=A*A-4*u*(a*a+o*o+l*l-t*t);if(c<0){const e=Math.max(-A/2,0),u=a+n*e,c=o+i*e,p=l+s*e,h=Math.hypot(u,c,p);return r[0]=u*t/h,r[1]=c*t/h,r[2]=p*t/h,!1}{const e=(-A-Math.sqrt(c))/(2*u);if(e<0){const e=Math.hypot(a,o,l);return r[0]=a*t/e,r[1]=o*t/e,r[2]=l*t/e,!1}return r[0]=a+n*e,r[1]=o+i*e,r[2]=l+s*e,!0}}}class Xl{constructor(e,t,r,n,i){this.TL=e,this.TR=t,this.BR=r,this.BL=n,this.horizon=i}static fromInvProjectionMatrix(e,t,r){const n=[-1,1,1],i=[1,1,1],s=[1,-1,1],a=[-1,-1,1],o=Fl(n,n,e),l=Fl(i,i,e),u=Fl(s,s,e),A=Fl(a,a,e);return new Xl(o,l,u,A,t/r)}}class Yl{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,r,n){const i=Math.pow(2,r),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const s=Zl([],r,e),a=1/s[3]/t*i;return function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}(s,s,[a,a,n?1/s[3]:a,a])})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=Pl([],Rl([],Vl([],s[e[0]],s[e[1]]),Vl([],s[e[2]],s[e[1]]))),r=-Ll(t,s[e[1]]);return t.concat(r)}));return new Yl(s,a)}}class Kl{constructor(e,t){this.min=e,this.max=t,this.center=Dl([],Cl([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],r=Tl(this.min),n=Tl(this.max);for(let e=0;e<t.length;e++)r[e]=t[e]?this.min[e]:this.center[e],n[e]=t[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new Kl(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let r=!0;for(let n=0;n<e.planes.length;n++){const i=e.planes[n];let s=0;for(let e=0;e<t.length;e++)s+=Ll(i,t[e])+i[3]>=0;if(0===s)return 0;s!==t.length&&(r=!1)}if(r)return 2;for(let t=0;t<3;t++){let r=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let i=0;i<e.points.length;i++){const s=e.points[i][t]-this.min[t];r=Math.min(r,s),n=Math.max(n,s)}if(n<0||r>this.max[t]-this.min[t])return 0}return 1}}function Jl(e,t,r,n,i,s,a,o,l){if(s&&e.queryGeometry.isAboveHorizon)return!1;s&&(l*=e.pixelToTileUnitsFactor);const u=e.tileID.canonical,A=r.projection.upVectorScale(u,r.center.lat,r.worldSize).metersToTile;for(const c of t)for(const t of c){const c=t.add(o),p=i&&r.elevation?r.elevation.exaggeration()*i.getElevationAt(c.x,c.y,!0):0,h=r.projection.projectTilePoint(c.x,c.y,u);if(p>0){const e=r.projection.upVector(u,c.x,c.y);h.x+=e[0]*A*p,h.y+=e[1]*A*p,h.z+=e[2]*A*p}const d=s?c:eA(h.x,h.y,h.z,n),f=s?e.tilespaceRays.map((e=>rA(e,p))):e.queryGeometry.screenGeometry,m=Zl([],[h.x,h.y,h.z,1],n);if(!a&&s?l*=m[3]/r.cameraToCenterDistance:a&&!s&&(l*=r.cameraToCenterDistance/m[3]),s){const e=Ds((t.y/bs+u.y)/(1<<u.z));l/=r.projection.pixelsPerMeter(e,1)/ks(1,e)}if(Ws(f,d,l))return!0}return!1}function eA(e,t,r,n){const s=Zl([],[e,t,r,1],n);return new i(s[0]/s[3],s[1]/s[3])}const tA=Ml(0,0,0),iA=Ml(0,0,1);function rA(e,t){const r=wl();return tA[2]=t,e.intersectsPlane(tA,iA,r),new i(r[0],r[1])}class nA extends Qs{}function oA(e,{width:t,height:r},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==t*r*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(t*r*n);return e.width=t,e.height=r,e.data=i,e}function aA(e,t,r){const{width:n,height:i}=t;n===e.width&&i===e.height||(sA(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},r),e.width=n,e.height=i,e.data=t.data)}function sA(e,t,r,n,i,s){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const a=e.data,o=t.data;for(let l=0;l<i.height;l++){const u=((r.y+l)*e.width+r.x)*s,A=((n.y+l)*t.width+n.x)*s;for(let e=0;e<i.width*s;e++)o[A+e]=a[u+e]}return t}Dn(nA,"HeatmapBucket",{omit:["layers"]});class lA{constructor(e,t){oA(this,e,1,t)}resize(e){aA(this,new lA(e),1)}clone(){return new lA({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){sA(e,t,r,n,i,1)}}class AA{constructor(e,t){oA(this,e,4,t)}resize(e){aA(this,new AA(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new AA({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){sA(e,t,r,n,i,4)}}Dn(lA,"AlphaImage"),Dn(AA,"RGBAImage");var cA={paint:new $o({"heatmap-radius":new Go(Ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Go(Ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jo(Ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qo(Ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jo(Ne.paint_heatmap["heatmap-opacity"])})};function uA(e){const t={},r=e.resolution||256,n=e.clips?e.clips.length:1,i=e.image||new AA({width:r,height:n}),s=(r,n,s)=>{t[e.evaluationKey]=s;const a=e.expression.evaluate(t);i.data[r+n+0]=Math.floor(255*a.r/a.a),i.data[r+n+1]=Math.floor(255*a.g/a.a),i.data[r+n+2]=Math.floor(255*a.b/a.a),i.data[r+n+3]=Math.floor(255*a.a)};if(e.clips)for(let t=0,i=0;t<n;++t,i+=4*r)for(let n=0,a=0;n<r;n++,a+=4){const o=n/(r-1),{start:l,end:u}=e.clips[t];s(i,a,l*(1-o)+u*o)}else for(let e=0,t=0;e<r;e++,t+=4)s(0,t,e/(r-1));return i}var hA={paint:new $o({"hillshade-illumination-direction":new jo(Ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jo(Ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jo(Ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jo(Ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jo(Ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jo(Ne.paint_hillshade["hillshade-accent-color"])})};const pA=Yo([{name:"a_pos",components:2,type:"Int16"}],4),{members:dA}=pA;var fA=_A,mA=_A;function _A(e,t,r){r=r||2;var n,i,s,a,o,l,u,A=t&&t.length,c=A?t[0]*r:e.length,p=gA(e,0,c,r,!0),h=[];if(!p||p.next===p.prev)return h;if(A&&(p=function(e,t,r,n){var i,s,a,o=[];for(i=0,s=t.length;i<s;i++)(a=gA(e,t[i]*n,i<s-1?t[i+1]*n:e.length,n,!1))===a.next&&(a.steiner=!0),o.push(SA(a));for(o.sort(EA),i=0;i<o.length;i++)r=yA(r=MA(o[i],r),r.next);return r}(e,t,p,r)),e.length>80*r){n=s=e[0],i=a=e[1];for(var d=r;d<c;d+=r)(o=e[d])<n&&(n=o),(l=e[d+1])<i&&(i=l),o>s&&(s=o),l>a&&(a=l);u=0!==(u=Math.max(s-n,a-i))?1/u:0}return xA(p,h,r,n,i,u),h}function gA(e,t,r,n,i){var s,a;if(i===GA(e,t,r,n)>0)for(s=t;s<r;s+=n)a=UA(s,e[s],e[s+1],a);else for(s=r-n;s>=t;s-=n)a=UA(s,e[s],e[s+1],a);return a&&BA(a,a.next)&&(VA(a),a=a.next),a}function yA(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!BA(n,n.next)&&0!==DA(n.prev,n,n.next))n=n.next;else{if(VA(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function xA(e,t,r,n,i,s,a){if(e){!a&&s&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=IA(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,s,a,o,l,u=1;do{for(r=e,e=null,s=null,a=0;r;){for(a++,n=r,o=0,t=0;t<u&&(o++,n=n.nextZ);t++);for(l=u;o>0||l>0&&n;)0!==o&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=n}s.nextZ=null,u*=2}while(a>1)}(i)}(e,n,i,s);for(var o,l,u=e;e.prev!==e.next;)if(o=e.prev,l=e.next,s?bA(e,n,i,s):vA(e))t.push(o.i/r),t.push(e.i/r),t.push(l.i/r),VA(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?xA(e=wA(yA(e),t,r),t,r,n,i,s,2):2===a&&TA(e,t,r,n,i,s):xA(yA(e),t,r,n,i,s,1);break}}}function vA(e){var t=e.prev,r=e,n=e.next;if(DA(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(kA(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&DA(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function bA(e,t,r,n){var i=e.prev,s=e,a=e.next;if(DA(i,s,a)>=0)return!1;for(var o=i.x>s.x?i.x>a.x?i.x:a.x:s.x>a.x?s.x:a.x,l=i.y>s.y?i.y>a.y?i.y:a.y:s.y>a.y?s.y:a.y,u=IA(i.x<s.x?i.x<a.x?i.x:a.x:s.x<a.x?s.x:a.x,i.y<s.y?i.y<a.y?i.y:a.y:s.y<a.y?s.y:a.y,t,r,n),A=IA(o,l,t,r,n),c=e.prevZ,p=e.nextZ;c&&c.z>=u&&p&&p.z<=A;){if(c!==e.prev&&c!==e.next&&kA(i.x,i.y,s.x,s.y,a.x,a.y,c.x,c.y)&&DA(c.prev,c,c.next)>=0)return!1;if(c=c.prevZ,p!==e.prev&&p!==e.next&&kA(i.x,i.y,s.x,s.y,a.x,a.y,p.x,p.y)&&DA(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;c&&c.z>=u;){if(c!==e.prev&&c!==e.next&&kA(i.x,i.y,s.x,s.y,a.x,a.y,c.x,c.y)&&DA(c.prev,c,c.next)>=0)return!1;c=c.prevZ}for(;p&&p.z<=A;){if(p!==e.prev&&p!==e.next&&kA(i.x,i.y,s.x,s.y,a.x,a.y,p.x,p.y)&&DA(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function wA(e,t,r){var n=e;do{var i=n.prev,s=n.next.next;!BA(i,s)&&PA(i,n,n.next,s)&&FA(i,s)&&FA(s,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(s.i/r),VA(n),VA(n.next),n=e=s),n=n.next}while(n!==e);return yA(n)}function TA(e,t,r,n,i,s){var a=e;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&zA(a,o)){var l=OA(a,o);return a=yA(a,a.next),l=yA(l,l.next),xA(a,t,r,n,i,s),void xA(l,t,r,n,i,s)}o=o.next}a=a.next}while(a!==e)}function EA(e,t){return e.x-t.x}function MA(e,t){var r=function(e,t){var r,n=t,i=e.x,s=e.y,a=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var o=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>a){if(a=o,o===i){if(s===n.y)return n;if(s===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r;var l,u=r,A=r.x,c=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=A&&i!==n.x&&kA(s<c?i:a,s,A,c,s<c?a:i,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(i-n.x),FA(n,e)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&CA(r,n)))&&(r=n,p=l)),n=n.next}while(n!==u);return r}(e,t);if(!r)return t;var n=OA(r,e),i=yA(r,r.next);return yA(n,n.next),t===r?i:t}function CA(e,t){return DA(e.prev,e,t.prev)<0&&DA(t.next,e,e.next)<0}function IA(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function SA(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function kA(e,t,r,n,i,s,a,o){return(i-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(n-o)-(r-a)*(t-o)>=0&&(r-a)*(s-o)-(i-a)*(n-o)>=0}function zA(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&PA(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(FA(e,t)&&FA(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(DA(e.prev,e,t.prev)||DA(e,t.prev,t))||BA(e,t)&&DA(e.prev,e,e.next)>0&&DA(t.prev,t,t.next)>0)}function DA(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function BA(e,t){return e.x===t.x&&e.y===t.y}function PA(e,t,r,n){var i=RA(DA(e,t,r)),s=RA(DA(e,t,n)),a=RA(DA(r,n,e)),o=RA(DA(r,n,t));return i!==s&&a!==o||!(0!==i||!LA(e,r,t))||!(0!==s||!LA(e,n,t))||!(0!==a||!LA(r,e,n))||!(0!==o||!LA(r,t,n))}function LA(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function RA(e){return e>0?1:e<0?-1:0}function FA(e,t){return DA(e.prev,e,e.next)<0?DA(e,t,e.next)>=0&&DA(e,e.prev,t)>=0:DA(e,t,e.prev)<0||DA(e,e.next,t)<0}function OA(e,t){var r=new jA(e.i,e.x,e.y),n=new jA(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function UA(e,t,r,n){var i=new jA(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function VA(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jA(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function GA(e,t,r,n){for(var i=0,s=t,a=r-n;s<r;s+=n)i+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return i}function NA(e,t,r,n,i){ZA(e,t,r||0,n||e.length-1,i||$A)}function ZA(e,t,r,n,i){for(;n>r;){if(n-r>600){var s=n-r+1,a=t-r+1,o=Math.log(s),l=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*l*(s-l)/s)*(a-s/2<0?-1:1);ZA(e,t,Math.max(r,Math.floor(t-a*l/s+u)),Math.min(n,Math.floor(t+(s-a)*l/s+u)),i)}var A=e[t],c=r,p=n;for(qA(e,r,t),i(e[n],A)>0&&qA(e,r,n);c<p;){for(qA(e,c,p),c++,p--;i(e[c],A)<0;)c++;for(;i(e[p],A)>0;)p--}0===i(e[r],A)?qA(e,r,p):qA(e,++p,n),p<=t&&(r=p+1),t<=p&&(n=p-1)}}function qA(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function $A(e,t){return e<t?-1:e>t?1:0}function QA(e,t){const r=e.length;if(r<=1)return[e];const n=[];let i,s;for(let t=0;t<r;t++){const r=P(e[t]);0!==r&&(e[t].area=Math.abs(r),void 0===s&&(s=r<0),s===r<0?(i&&n.push(i),i=[e[t]]):i.push(e[t]))}if(i&&n.push(i),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(NA(n[e],t,1,n[e].length-1,HA),n[e]=n[e].slice(0,t));return n}function HA(e,t){return t.area-e.area}function WA(e,t,r){const n=r.patternDependencies;let i=!1;for(const r of t){const t=r.paint.get(`${e}-pattern`);t.isConstant()||(i=!0);const s=t.constantOr(null);s&&(i=!0,n[s.to]=!0,n[s.from]=!0)}return i}function XA(e,t,r,n,i){const s=i.patternDependencies;for(const a of t){const t=a.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:n-1},r,{},i.availableImages),o=t.evaluate({zoom:n},r,{},i.availableImages),l=t.evaluate({zoom:n+1},r,{},i.availableImages);e=e&&e.name?e.name:e,o=o&&o.name?o.name:o,l=l&&l.name?l.name:l,s[e]=!0,s[o]=!0,s[l]=!0,r.patterns[a.id]={min:e,mid:o,max:l}}}return r}_A.deviation=function(e,t,r,n){var i=t&&t.length,s=Math.abs(GA(e,0,i?t[0]*r:e.length,r));if(i)for(var a=0,o=t.length;a<o;a++)s-=Math.abs(GA(e,t[a]*r,a<o-1?t[a+1]*r:e.length,r));var l=0;for(a=0;a<n.length;a+=3){var u=n[a]*r,A=n[a+1]*r,c=n[a+2]*r;l+=Math.abs((e[u]-e[c])*(e[A+1]-e[u+1])-(e[u]-e[A])*(e[c+1]-e[u+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},_A.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var s=0;s<e[i].length;s++)for(var a=0;a<t;a++)r.vertices.push(e[i][s][a]);i>0&&r.holes.push(n+=e[i-1].length)}return r},fA.default=mA;class YA{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jo,this.indexArray=new fa,this.indexArray2=new ba,this.programConfigurations=new us(e.layers,e.zoom),this.segments=new vs,this.segments2=new vs,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,r,n){this.hasPattern=WA("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),s=[];for(const{feature:a,id:o,index:l,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,A=Zs(a,e);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom),A,r))continue;const c=i?i.evaluate(A,{},r,t.availableImages):void 0,p={id:o,properties:a.properties,type:a.type,sourceLayerIndex:u,index:l,geometry:e?A.geometry:Ns(a,r,n),patterns:{},sortKey:c};s.push(p)}i&&s.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of s){const{geometry:i,index:s,sourceLayerIndex:a}=n;if(this.hasPattern){const e=XA("fill",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,s,r,{},t.availableImages);t.featureIndex.insert(e[s].feature,i,s,a,this.index)}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}addFeatures(e,t,r,n,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,r,n,i,s=[]){for(const e of QA(t,500)){let t=0;for(const r of e)t+=r.length;const r=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=r.vertexLength,i=[],s=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&s.push(i.length/2);const r=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),n=r.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(n+t.length-1,n),i.push(t[0].x),i.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(n+e-1,n+e),i.push(t[e].x),i.push(t[e].y);r.vertexLength+=t.length,r.primitiveLength+=t.length}const a=fA(i,s);for(let e=0;e<a.length;e+=3)this.indexArray.emplaceBack(n+a[e],n+a[e+1],n+a[e+2]);r.vertexLength+=t,r.primitiveLength+=a.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,s,n)}}Dn(YA,"FillBucket",{omit:["layers","patternFeatures"]});const KA=new $o({"fill-sort-key":new Go(Ne.layout_fill["fill-sort-key"])});var JA={paint:new $o({"fill-antialias":new jo(Ne.paint_fill["fill-antialias"]),"fill-opacity":new Go(Ne.paint_fill["fill-opacity"]),"fill-color":new Go(Ne.paint_fill["fill-color"]),"fill-outline-color":new Go(Ne.paint_fill["fill-outline-color"]),"fill-translate":new jo(Ne.paint_fill["fill-translate"]),"fill-translate-anchor":new jo(Ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new No(Ne.paint_fill["fill-pattern"])}),layout:KA};const ec=Yo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tc=Yo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ic=Yo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:rc}=ec;var nc=oc;function oc(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(ac,this,t)}function ac(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function sc(e){for(var t,r,n=0,i=0,s=e.length,a=s-1;i<s;a=i++)n+=((r=e[a]).x-(t=e[i]).x)*(t.y+r.y);return n}oc.types=["Unknown","Point","LineString","Polygon"],oc.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,n=1,s=0,a=0,o=0,l=[];e.pos<r;){if(s<=0){var u=e.readVarint();n=7&u,s=u>>3}if(s--,1===n||2===n)a+=e.readSVarint(),o+=e.readSVarint(),1===n&&(t&&l.push(t),t=[]),t.push(new i(a,o));else{if(7!==n)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&l.push(t),l},oc.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,s=0,a=1/0,o=-1/0,l=1/0,u=-1/0;e.pos<t;){if(n<=0){var A=e.readVarint();r=7&A,n=A>>3}if(n--,1===r||2===r)(i+=e.readSVarint())<a&&(a=i),i>o&&(o=i),(s+=e.readSVarint())<l&&(l=s),s>u&&(u=s);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,o,u]},oc.prototype.toGeoJSON=function(e,t,r){var n,i,s=this.extent*Math.pow(2,r),a=this.extent*e,o=this.extent*t,l=this.loadGeometry(),u=oc.types[this.type];function A(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+a)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+o)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(n=0;n<l.length;n++)c[n]=l[n][0];A(l=c);break;case 2:for(n=0;n<l.length;n++)A(l[n]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var r,n,i=[],s=0;s<t;s++){var a=sc(e[s]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(r&&i.push(r),r=[e[s]]):r.push(e[s]))}return r&&i.push(r),i}(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)A(l[n][i])}1===l.length?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var lc=Ac;function Ac(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(cc,this,t),this.length=this._features.length}function cc(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(r))}function uc(e,t,r){if(3===e){var n=new lc(r,r.readVarint()+r.pos);n.length&&(t[n.name]=n)}}Ac.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new nc(this._pbf,t,this.extent,this._keys,this._values)};var hc={VectorTile:function(e,t){this.layers=e.readFields(uc,{},t)},VectorTileFeature:nc,VectorTileLayer:lc};function pc(e,t,r,n){const s=[],a=0===n?(e,t,r,n,s,a)=>{e.push(new i(a,r+(a-t)/(n-t)*(s-r)))}:(e,t,r,n,s,a)=>{e.push(new i(t+(a-r)/(s-r)*(n-t),a))};for(const i of e){const e=[];for(const s of i){if(s.length<=2)continue;const i=[];for(let e=0;e<s.length-1;e++){const o=s[e].x,l=s[e].y,u=s[e+1].x,A=s[e+1].y,c=0===n?o:l,p=0===n?u:A;c<t?p>t&&a(i,o,l,u,A,t):c>r?p<r&&a(i,o,l,u,A,r):i.push(s[e]),p<t&&c>=t&&a(i,o,l,u,A,t),p>r&&c<=r&&a(i,o,l,u,A,r)}let o=s[s.length-1];const l=0===n?o.x:o.y;l>=t&&l<=r&&i.push(o),i.length&&(o=i[i.length-1],i[0].x===o.x&&i[0].y===o.y||i.push(i[0]),e.push(i))}e.length&&s.push(e)}return s}const dc=hc.VectorTileFeature.types,fc=Math.pow(2,13);function mc(e,t,r,n,i,s,a,o){e.emplaceBack((t<<1)+a,(r<<1)+s,(Math.floor(n*fc)<<1)+i,Math.round(o))}function _c(e,t,r){const n=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*n,r[1]*n,r[2]*n)}class gc{constructor(){this.acc=new i(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new i(e.x,e.y),this.max=new i(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,n=this.max;e.x<r.x?r.x=e.x:e.x>n.x&&(n.x=e.x),e.y<r.y?r.y=e.y:e.y>n.y&&(n.y=e.y),((0===e.x||e.x===bs)&&e.x===t.x)!=((0===e.y||e.y===bs)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,_i(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>bs!=e.x>bs&&this.addBorderIntersection(1,_i(t.y,e.y,(bs-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,_i(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>bs!=e.y>bs&&this.addBorderIntersection(3,_i(t.x,e.x,(bs-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce(((e,t)=>e+t.edges),0);return 0!==e?this.acc.div(e)._round():new i(0,0)}span(){return new i(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0)}}class yc{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ta,this.centroidVertexArray=new Oa,this.indexArray=new fa,this.programConfigurations=new us(e.layers,e.zoom),this.segments=new vs,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.enableTerrain=e.enableTerrain}populate(e,t,r,n){this.features=[],this.hasPattern=WA("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(e){const t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/bs/(1<<e.z)}(r);for(const{feature:i,id:s,index:a,sourceLayerIndex:o}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Zs(i,e);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom),l,r))continue;const u={id:s,sourceLayerIndex:o,index:a,geometry:e?l.geometry:Ns(i,r,n),properties:i.properties,type:i.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(XA("fill-extrusion",this.layers,u,this.zoom,t)):this.addFeature(u,u.geometry,a,r,{},t.availableImages,n),t.featureIndex.insert(i,u.geometry,a,o,this.index,A)}this.sortBorders()}addFeatures(e,t,r,n,i){for(const e of this.features){const{geometry:s}=e;this.addFeature(e,s,e.index,t,r,n,i)}this.sortBorders()}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rc),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,ic.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,tc.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,n,s,a,o){const l=[new i(0,0),new i(bs,bs)],u=o.projection,A="globe"===u.name,c=this.enableTerrain&&!A?new gc:null;A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ma);const p=QA(t,500);for(let e=p.length-1;e>=0;e--){const t=p[e];(0===t.length||(h=t[0]).every((e=>e.x<=0))||h.every((e=>e.x>=bs))||h.every((e=>e.y<=0))||h.every((e=>e.y>=bs)))&&p.splice(e,1)}var h;let d;if(A)d=bc(p,l,n);else{d=[];for(const e of p)d.push({polygon:e,bounds:l})}for(const t of d){const r=t.polygon;let i=0,s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let e=0;e<r.length;e++){const a=r[e];if(0===a.length)continue;i+=a.length;let o=0;c&&c.startRing(a[0]);for(let e=0;e<a.length;e++){const r=a[e];if(e>=1){const i=a[e-1];if(!xc(r,i,t.bounds)){c&&c.append(r,i),s.vertexLength+4>vs.MAX_VERTEX_ARRAY_LENGTH&&(s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=r.sub(i)._perp(),t=e.x/(Math.abs(e.x)+Math.abs(e.y)),a=e.y>0?1:0,l=i.dist(r);o+l>32768&&(o=0),mc(this.layoutVertexArray,r.x,r.y,t,a,0,0,o),mc(this.layoutVertexArray,r.x,r.y,t,a,0,1,o),o+=l,mc(this.layoutVertexArray,i.x,i.y,t,a,0,0,o),mc(this.layoutVertexArray,i.x,i.y,t,a,0,1,o);const p=s.vertexLength;if(this.indexArray.emplaceBack(p,p+2,p+1),this.indexArray.emplaceBack(p+1,p+2,p+3),s.vertexLength+=4,s.primitiveLength+=2,A){const e=this.layoutVertexExtArray,t=u.projectTilePoint(r.x,r.y,n),s=u.projectTilePoint(i.x,i.y,n),a=u.upVector(n,r.x,r.y),o=u.upVector(n,i.x,i.y);_c(e,t,a),_c(e,t,a),_c(e,s,o),_c(e,s,o)}}}}}if(s.vertexLength+i>vs.MAX_VERTEX_ARRAY_LENGTH&&(s=this.segments.prepareSegment(i,this.layoutVertexArray,this.indexArray)),"Polygon"!==dc[e.type])continue;const a=[],o=[],l=s.vertexLength;for(let e=0;e<r.length;e++){const t=r[e];if(0!==t.length){t!==r[0]&&o.push(a.length/2);for(let e=0;e<t.length;e++){const r=t[e];mc(this.layoutVertexArray,r.x,r.y,0,0,1,1,0),a.push(r.x),a.push(r.y),c&&c.currentPolyCount.top++,A&&_c(this.layoutVertexExtArray,u.projectTilePoint(r.x,r.y,n),u.upVector(n,r.x,r.y))}}}const p=fA(a,o);for(let e=0;e<p.length;e+=3)this.indexArray.emplaceBack(l+p[e],l+p[e+2],l+p[e+1]);s.primitiveLength+=p.length/3,s.vertexLength+=i}if(c&&c.polyCount.length>0){if(c.borders){c.vertexArrayOffset=this.centroidVertexArray.length;const e=c.borders,t=this.featuresOnBorder.push(c)-1;for(let r=0;r<4;r++)e[r][0]!==Number.MAX_VALUE&&this.borders[r].push(t)}this.encodeCentroid(c.borders?void 0:c.centroid(),c)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,s,a,n)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((t,r)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[r].borders[e][0]))}encodeCentroid(e,t,r=!0){let n,i;if(e)if(0!==e.y){const r=t.span()._mult(this.tileToMeter);n=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(r.x/10)),i=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(r.y/10))}else n=Math.ceil(7*(e.x+450)),i=0;else n=0,i=+r;let s=r?this.centroidVertexArray.length:t.vertexArrayOffset;for(const e of t.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*e.edges+e.top);for(let t=0;t<2*e.edges;t++)this.centroidVertexArray.emplace(s++,0,i),this.centroidVertexArray.emplace(s++,n,i);for(let t=0;t<e.top;t++)this.centroidVertexArray.emplace(s++,n,i)}}}function xc(e,t,r){return e.x===t.x&&(e.x<r[0].x||e.x>r[1].x)||e.y===t.y&&(e.y<r[0].y||e.y>r[1].y)}function vc(){const e=Math.PI/32,t=Math.tan(e),r=Ts;return r*Math.sqrt(1+2*t*t)-r}function bc(e,t,r){const n=1<<r.z,s=zs(r.x/n),a=zs((r.x+1)/n),o=Ds(r.y/n),l=Ds((r.y+1)/n);return function(e,t,r,n,s=0,a){const o=[];if(!e.length||!r||!n)return o;const l=(e,t)=>{for(const r of e)o.push({polygon:r,bounds:t})},u=Math.ceil(Math.log2(r)),A=Math.ceil(Math.log2(n)),c=u-A,p=[];for(let e=0;e<Math.abs(c);e++)p.push(c>0?0:1);for(let e=0;e<Math.min(u,A);e++)p.push(0),p.push(1);let h=e;if(h=pc(h,t[0].y-s,t[1].y+s,1),h=pc(h,t[0].x-s,t[1].x+s,0),!h.length)return o;const d=[];for(p.length?d.push({polygons:h,bounds:t,depth:0}):l(h,t);d.length;){const e=d.pop(),t=e.depth,r=p[t],n=e.bounds[0],o=e.bounds[1],u=0===r?n.x:n.y,A=0===r?o.x:o.y,c=a?a(r,u,A):.5*(u+A),h=pc(e.polygons,u-s,c+s,r),f=pc(e.polygons,c-s,A+s,r);if(h.length){const e=[n,new i(0===r?c:o.x,1===r?c:o.y)];p.length>t+1?d.push({polygons:h,bounds:e,depth:t+1}):l(h,e)}if(f.length){const e=[new i(0===r?c:n.x,1===r?c:n.y),o];p.length>t+1?d.push({polygons:f,bounds:e,depth:t+1}):l(f,e)}}return o}(e,t,Math.ceil((a-s)/11.25),Math.ceil((o-l)/11.25),1,((e,t,i)=>{if(0===e)return.5*(t+i);{const e=Ds((r.y+t/bs)/n);return(Ss(.5*(Ds((r.y+i/bs)/n)+e))*n-r.y)*bs}}))}Dn(yc,"FillExtrusionBucket",{omit:["layers","features"]}),Dn(gc,"PartMetadata");var wc={paint:new $o({"fill-extrusion-opacity":new jo(Ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Go(Ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jo(Ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jo(Ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new No(Ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Go(Ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Go(Ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jo(Ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Tc(e,t,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}class Ec{constructor(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Ic(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const r=function(e,t,r){var n=Tc(256*e,256*(t=Math.pow(2,r)-t-1),r),i=Tc(256*(e+1),256*(t+1),r);return n[0]+","+n[1]+","+i[0]+","+i[1]}(this.x,this.y,this.z),n=function(e,t,r){let n,i="";for(let s=e;s>0;s--)n=1<<s-1,i+=(t&n?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Mc{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Ic(e,t.z,t.z,t.x,t.y)}}class Cc{constructor(e,t,r,n,i){this.overscaledZ=e,this.wrap=t,this.canonical=new Ec(r,+n,+i),this.key=0===t&&e===r?this.canonical.key:Ic(t,e,r,n,i)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Cc(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Cc(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Ic(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Ic(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Cc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new Cc(t,this.wrap,t,r,n),new Cc(t,this.wrap,t,r+1,n),new Cc(t,this.wrap,t,r,n+1),new Cc(t,this.wrap,t,r+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Cc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Cc(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Mc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ic(e,t,r,n,i){const s=1<<Math.min(r,22);let a=s*(i%s)+n%s;return e&&r<22&&(a+=s*s*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*a+r)+(t-r)}function Sc(e,t){return e.x*t.x+e.y*t.y}function kc(e,t){if(1===e.length){let r=0;const n=t[r++];let i;for(;!i||n.equals(i);)if(i=t[r++],!i)return 1/0;for(;r<t.length;r++){const s=t[r],a=e[0],o=i.sub(n),l=s.sub(n),u=a.sub(n),A=Sc(o,o),c=Sc(o,l),p=Sc(l,l),h=Sc(u,o),d=Sc(u,l),f=A*p-c*c,m=(p*h-c*d)/f,g=(A*d-c*h)/f,_=n.z*(1-m-g)+i.z*m+s.z*g;if(isFinite(_))return _}return 1/0}{let e=1/0;for(const r of t)e=Math.min(e,r.z);return e}}function zc(e){const t=new i(e[0],e[1]);return t.z=e[2],t}function Dc(e,t,r,n,i,s,a,o){const l=a*i.getElevationAt(e,t,!0,!0),u=0!==s[0],A=u?0===s[1]?a*(s[0]/7-450):a*function(e,t,r){const n=Math.floor(t[0]/8),i=Math.floor(t[1]/8),s=10*(t[0]-8*n),a=10*(t[1]-8*i),o=e.getElevationAt(n,i,!0,!0),l=e.getMeterToDEM(r),u=Math.floor(.5*(s*l-1)),A=Math.floor(.5*(a*l-1)),c=e.tileCoordToPixel(n,i),p=2*u+1,h=2*A+1,d=function(e,t,r,n,i){return[e.getElevationAtPixel(t,r,!0),e.getElevationAtPixel(t+i,r,!0),e.getElevationAtPixel(t,r+i,!0),e.getElevationAtPixel(t+n,r+i,!0)]}(e,c.x-u,c.y-A,p,h),f=Math.abs(d[0]-d[1]),m=Math.abs(d[2]-d[3]),g=Math.abs(d[0]-d[2])+Math.abs(d[1]-d[3]),_=Math.min(.25,.5*l*(f+m)/p),y=Math.min(.25,.5*l*g/h);return o+Math.max(_*s,y*a)}(i,s,o):l;return{base:l+(0===r)?-1:r,top:u?Math.max(A+n,l+r+2):l+n}}Dn(Ec,"CanonicalTileID"),Dn(Cc,"OverscaledTileID",{omit:["projMatrix"]});const Bc=Yo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Pc}=Bc,Lc=Yo([{name:"a_packed",components:4,type:"Float32"}]),{members:Rc}=Lc,Fc=hc.VectorTileFeature.types,Oc=Math.cos(Math.PI/180*37.5);class Uc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new ia,this.layoutVertexArray2=new ra,this.indexArray=new fa,this.programConfigurations=new us(e.layers,e.zoom),this.segments=new vs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,n){this.hasPattern=WA("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),s=[];for(const{feature:t,id:a,index:o,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Zs(t,e);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom),u,r))continue;const A=i?i.evaluate(u,{},r):void 0,c={id:a,properties:t.properties,type:t.type,sourceLayerIndex:l,index:o,geometry:e?u.geometry:Ns(t,r,n),patterns:{},sortKey:A};s.push(c)}i&&s.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:a,featureIndex:o}=t,l=this.addConstantDashes(a);for(const n of s){const{geometry:i,index:s,sourceLayerIndex:u}=n;if(l&&this.addFeatureDashes(n,a),this.hasPattern){const e=XA("line",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,s,r,a.positions,t.availableImages);o.insert(e[s].feature,i,s,u,this.index)}}addConstantDashes(e){let t=!1;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,i=r.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==i.kind)t=!0;else{const t=i.value,r=n.value;if(!r)continue;e.addDash(r.from,t),e.addDash(r.to,t),r.other&&e.addDash(r.other,t)}}return t}addFeatureDashes(e,t){const r=this.zoom;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,s=n.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===s.kind)continue;let a,o,l,u,A,c;if("constant"===i.kind){const e=i.value;if(!e)continue;a=e.other||e.to,o=e.to,l=e.from}else a=i.evaluate({zoom:r-1},e),o=i.evaluate({zoom:r},e),l=i.evaluate({zoom:r+1},e);"constant"===s.kind?u=A=c=s.value:(u=s.evaluate({zoom:r-1},e),A=s.evaluate({zoom:r},e),c=s.evaluate({zoom:r+1},e)),t.addDash(a,u),t.addDash(o,A),t.addDash(l,c);const p=t.getKey(a,u),h=t.getKey(o,A),d=t.getKey(l,c);e.patterns[n.id]={min:p,mid:h,max:d}}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}addFeatures(e,t,r,n,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Rc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,n,i,s){const a=this.layers[0].layout,o=a.get("line-join").evaluate(e,{}),l=a.get("line-cap").evaluate(e,{}),u=a.get("line-miter-limit"),A=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const r of t)this.addLine(r,e,o,l,u,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,s,n)}addLine(e,t,r,n,i,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const a="Polygon"===Fc[t.type];let o=e.length;for(;o>=2&&e[o-1].equals(e[o-2]);)o--;let l=0;for(;l<o-1&&e[l].equals(e[l+1]);)l++;if(o<(a?3:2))return;"bevel"===r&&(i=1.05);const u=this.overscaling<=16?122880/(512*this.overscaling):0,A=this.segments.prepareSegment(10*o,this.layoutVertexArray,this.indexArray);let c,p,h,d,f;this.e1=this.e2=-1,a&&(c=e[o-2],f=e[l].sub(c)._unit()._perp());for(let t=l;t<o;t++){if(h=t===o-1?a?e[l+1]:void 0:e[t+1],h&&e[t].equals(h))continue;f&&(d=f),c&&(p=c),c=e[t],f=h?h.sub(c)._unit()._perp():d,d=d||f;let m=d.add(f);0===m.x&&0===m.y||m._unit();const g=d.x*f.x+d.y*f.y,_=m.x*f.x+m.y*f.y,y=0!==_?1/_:1/0,b=2*Math.sqrt(2-2*_),x=_<Oc&&p&&h,v=d.x*f.y-d.y*f.x>0;if(x&&t>l){const e=c.dist(p);if(e>2*u){const t=c.sub(c.sub(p)._mult(u/e)._round());this.updateDistance(p,t),this.addCurrentVertex(t,d,0,0,A),p=t}}const w=p&&h;let T=w?r:a?"butt":n;if(w&&"round"===T&&(y<s?T="miter":y<=2&&(T="fakeround")),"miter"===T&&y>i&&(T="bevel"),"bevel"===T&&(y>2&&(T="flipbevel"),y<i&&(T="miter")),p&&this.updateDistance(p,c),"miter"===T)m._mult(y),this.addCurrentVertex(c,m,0,0,A);else if("flipbevel"===T){if(y>100)m=f.mult(-1);else{const e=y*d.add(f).mag()/d.sub(f).mag();m._perp()._mult(e*(v?-1:1))}this.addCurrentVertex(c,m,0,0,A),this.addCurrentVertex(c,m.mult(-1),0,0,A)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(y*y-1),t=v?e:0,r=v?0:e;if(p&&this.addCurrentVertex(c,d,t,r,A),"fakeround"===T){const e=Math.round(180*b/Math.PI/20);for(let t=1;t<e;t++){let r=t/e;if(.5!==r){const e=r-.5;r+=r*e*(r-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*e*e+(.848013+g*(.215638*g-1.06021)))}const n=f.sub(d)._mult(r)._add(d)._unit()._mult(v?-1:1);this.addHalfVertex(c,n.x,n.y,!1,v,0,A)}}h&&this.addCurrentVertex(c,f,-t,-r,A)}else if("butt"===T)this.addCurrentVertex(c,m,0,0,A);else if("square"===T){const e=p?1:-1;p||this.addCurrentVertex(c,m,e,e,A),this.addCurrentVertex(c,m,0,0,A),p&&this.addCurrentVertex(c,m,e,e,A)}else"round"===T&&(p&&(this.addCurrentVertex(c,d,0,0,A),this.addCurrentVertex(c,d,1,1,A,!0)),h&&(this.addCurrentVertex(c,f,-1,-1,A,!0),this.addCurrentVertex(c,f,0,0,A)));if(x&&t<o-1){const e=c.dist(h);if(e>2*u){const t=c.add(h.sub(c)._mult(u/e)._round());this.updateDistance(c,t),this.addCurrentVertex(t,f,0,0,A),c=t}}}}addCurrentVertex(e,t,r,n,i,s=!1){const a=t.y*n-t.x,o=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,s,!1,r,i),this.addHalfVertex(e,a,o,s,!0,-n,i)}addHalfVertex({x:e,y:t},r,n,i,s,a,o){this.layoutVertexArray.emplaceBack((e<<1)+(i?1:0),(t<<1)+(s?1:0),Math.round(63*r)+128,Math.round(63*n)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),o.primitiveLength++),s?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Dn(Uc,"LineBucket",{omit:["layers","patternFeatures"]});const Vc=new $o({"line-cap":new Go(Ne.layout_line["line-cap"]),"line-join":new Go(Ne.layout_line["line-join"]),"line-miter-limit":new jo(Ne.layout_line["line-miter-limit"]),"line-round-limit":new jo(Ne.layout_line["line-round-limit"]),"line-sort-key":new Go(Ne.layout_line["line-sort-key"])});var jc={paint:new $o({"line-opacity":new Go(Ne.paint_line["line-opacity"]),"line-color":new Go(Ne.paint_line["line-color"]),"line-translate":new jo(Ne.paint_line["line-translate"]),"line-translate-anchor":new jo(Ne.paint_line["line-translate-anchor"]),"line-width":new Go(Ne.paint_line["line-width"]),"line-gap-width":new Go(Ne.paint_line["line-gap-width"]),"line-offset":new Go(Ne.paint_line["line-offset"]),"line-blur":new Go(Ne.paint_line["line-blur"]),"line-dasharray":new No(Ne.paint_line["line-dasharray"]),"line-pattern":new No(Ne.paint_line["line-pattern"]),"line-gradient":new qo(Ne.paint_line["line-gradient"]),"line-trim-offset":new jo(Ne.paint_line["line-trim-offset"])}),layout:Vc};const Gc=new class extends Go{possiblyEvaluate(e,t){return t=new Do(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,n){return t=x({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,n)}}(jc.paint.properties["line-width"].specification);function Nc(e,t){return t>0?t+2*e:e}Gc.useIntegerZoom=!0;const Zc=Yo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qc=Yo([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),$c=Yo([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Qc=Yo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Hc=Yo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Yo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Wc=Yo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xc=Yo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yo([{name:"triangle",components:3,type:"Uint16"}]),Yo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Yo([{type:"Float32",name:"offsetX"}]),Yo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Yc=24;const Kc=128;function Jc(e,t){const{expression:r}=t;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new Do(e+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:n}=r;let i=0;for(;i<t.length&&t[i]<=e;)i++;i=Math.max(0,i-1);let s=i;for(;s<t.length&&t[s]<e+1;)s++;s=Math.min(t.length-1,s);const a=t[i],o=t[s];return"composite"===r.kind?{kind:"composite",minZoom:a,maxZoom:o,interpolationType:n}:{kind:"camera",minZoom:a,maxZoom:o,minSize:r.evaluate(new Do(a)),maxSize:r.evaluate(new Do(o)),interpolationType:n}}}function eu(e,{uSize:t,uSizeT:r},{lowerSize:n,upperSize:i}){return"source"===e.kind?n/Kc:"composite"===e.kind?_i(n/Kc,i/Kc,r):t}function th(e,t){let r=0,n=0;if("constant"===e.kind)n=e.layoutSize;else if("source"!==e.kind){const{interpolationType:i,minZoom:s,maxZoom:a}=e,o=i?f(Fi.interpolationFactor(i,t,s,a),0,1):0;"camera"===e.kind?n=_i(e.minSize,e.maxSize,o):r=o}return{uSizeT:r,uSize:n}}var tu=Object.freeze({__proto__:null,getSizeData:Jc,evaluateSizeForFeature:eu,evaluateSizeForZoom:th,SIZE_PACK_FACTOR:Kc});function iu(e,t,r){return e.sections.forEach((e=>{e.text=function(e,t,r){const n=t.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),zo.applyArabicShaping&&(e=zo.applyArabicShaping(e)),e}(e.text,t,r)})),e}const ru={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function nu(e){return"︶"===e||"﹈"===e||"︸"===e||"﹄"===e||"﹂"===e||"︾"===e||"︼"===e||"︺"===e||"︘"===e||"﹀"===e||"︐"===e||"︓"===e||"︔"===e||"｀"===e||"￣"===e||"︑"===e||"︒"===e}function ou(e){return"︵"===e||"﹇"===e||"︷"===e||"﹃"===e||"﹁"===e||"︽"===e||"︻"===e||"︹"===e||"︗"===e||"︿"===e}var au=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,A=-7,c=r?i-1:0,p=r?-1:1,h=e[t+c];for(c+=p,s=h&(1<<-A)-1,h>>=-A,A+=o;A>0;s=256*s+e[t+c],c+=p,A-=8);for(a=s&(1<<-A)-1,s>>=-A,A+=n;A>0;a=256*a+e[t+c],c+=p,A-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,n),s-=u}return(h?-1:1)*a*Math.pow(2,s-n)},su=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,A=(1<<u)-1,c=A>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:s-1,d=n?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=A):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+c>=1?p/l:p*Math.pow(2,1-c))*l>=2&&(a++,l/=2),a+c>=A?(o=0,a=A):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+h]=255&o,h+=d,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+h]=255&a,h+=d,a/=256,u-=8);e[r+h-d]|=128*f},lu=Au;function Au(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Au.Varint=0,Au.Fixed64=1,Au.Bytes=2,Au.Fixed32=5;var cu=4294967296,uu=1/cu,hu="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function pu(e){return e.type===Au.Bytes?e.readVarint()+e.pos:e.pos+1}function du(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function fu(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function mu(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function _u(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function gu(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function yu(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function xu(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function vu(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function bu(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function wu(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Tu(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Eu(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Mu(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function Cu(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Iu(e,t,r){t.glyphs=[],1===e&&r.readMessage(Su,t)}function Su(e,t,r){if(3===e){const{id:e,bitmap:n,width:i,height:s,left:a,top:o,advance:l}=r.readMessage(ku,{});t.glyphs.push({id:e,bitmap:new lA({width:i+6,height:s+6},n),metrics:{width:i,height:s,left:a,top:o,advance:l}})}else 4===e?t.ascender=r.readSVarint():5===e&&(t.descender=r.readSVarint())}function ku(e,t,r){1===e?t.id=r.readVarint():2===e?t.bitmap=r.readBytes():3===e?t.width=r.readVarint():4===e?t.height=r.readVarint():5===e?t.left=r.readSVarint():6===e?t.top=r.readSVarint():7===e&&(t.advance=r.readVarint())}function zu(e){let t=0,r=0;for(const n of e)t+=n.w*n.h,r=Math.max(r,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let i=0,s=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const r=n[e];if(!(t.w>r.w||t.h>r.h)){if(t.x=r.x,t.y=r.y,s=Math.max(s,t.y+t.h),i=Math.max(i,t.x+t.w),t.w===r.w&&t.h===r.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===r.h?(r.x+=t.w,r.w-=t.w):t.w===r.w?(r.y+=t.h,r.h-=t.h):(n.push({x:r.x+t.w,y:r.y,w:r.w-t.w,h:t.h}),r.y+=t.h,r.h-=t.h);break}}return{w:i,h:s,fill:t/(i*s)||0}}Au.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,s=this.pos;this.type=7&n,e(i,t,this),this.pos===s&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Eu(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Cu(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Eu(this.buf,this.pos)+Eu(this.buf,this.pos+4)*cu;return this.pos+=8,e},readSFixed64:function(){var e=Eu(this.buf,this.pos)+Cu(this.buf,this.pos+4)*cu;return this.pos+=8,e},readFloat:function(){var e=au(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=au(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,n=this.buf;return t=127&(r=n[this.pos++]),r<128?t:(t|=(127&(r=n[this.pos++]))<<7,r<128?t:(t|=(127&(r=n[this.pos++]))<<14,r<128?t:(t|=(127&(r=n[this.pos++]))<<21,r<128?t:function(e,t,r){var n,i,s=r.buf;if(n=(112&(i=s[r.pos++]))>>4,i<128)return du(e,n,t);if(n|=(127&(i=s[r.pos++]))<<3,i<128)return du(e,n,t);if(n|=(127&(i=s[r.pos++]))<<10,i<128)return du(e,n,t);if(n|=(127&(i=s[r.pos++]))<<17,i<128)return du(e,n,t);if(n|=(127&(i=s[r.pos++]))<<24,i<128)return du(e,n,t);if(n|=(1&(i=s[r.pos++]))<<31,i<128)return du(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&hu?function(e,t,r){return hu.decode(e.subarray(t,r))}(this.buf,t,e):function(e,t,r){for(var n="",i=t;i<r;){var s,a,o,l=e[i],u=null,A=l>239?4:l>223?3:l>191?2:1;if(i+A>r)break;1===A?l<128&&(u=l):2===A?128==(192&(s=e[i+1]))&&(u=(31&l)<<6|63&s)<=127&&(u=null):3===A?(a=e[i+2],128==(192&(s=e[i+1]))&&128==(192&a)&&((u=(15&l)<<12|(63&s)<<6|63&a)<=2047||u>=55296&&u<=57343)&&(u=null)):4===A&&(a=e[i+2],o=e[i+3],128==(192&(s=e[i+1]))&&128==(192&a)&&128==(192&o)&&((u=(15&l)<<18|(63&s)<<12|(63&a)<<6|63&o)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,A=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),i+=A}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Au.Bytes)return e.push(this.readVarint(t));var r=pu(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Au.Bytes)return e.push(this.readSVarint());var t=pu(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Au.Bytes)return e.push(this.readBoolean());var t=pu(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Au.Bytes)return e.push(this.readFloat());var t=pu(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Au.Bytes)return e.push(this.readDouble());var t=pu(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Au.Bytes)return e.push(this.readFixed32());var t=pu(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Au.Bytes)return e.push(this.readSFixed32());var t=pu(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Au.Bytes)return e.push(this.readFixed64());var t=pu(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Au.Bytes)return e.push(this.readSFixed64());var t=pu(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Au.Varint)for(;this.buf[this.pos++]>127;);else if(t===Au.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Au.Fixed32)this.pos+=4;else{if(t!==Au.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Mu(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Mu(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Mu(this.buf,-1&e,this.pos),Mu(this.buf,Math.floor(e*uu),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Mu(this.buf,-1&e,this.pos),Mu(this.buf,Math.floor(e*uu),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,r.buf[r.pos]=127&(e>>>=7)}(r,0,t),function(e,t){var r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var n,i,s=0;s<t.length;s++){if((n=t.charCodeAt(s))>55295&&n<57344){if(!i){n>56319||s+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&fu(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),su(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),su(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&fu(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,Au.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,mu,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,_u,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,xu,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,gu,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,yu,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,vu,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,bu,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,wu,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Tu,t)},writeBytesField:function(e,t){this.writeTag(e,Au.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Au.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Au.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Au.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Au.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Au.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Au.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Au.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Au.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Au.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class Du{constructor(e,{pixelRatio:t,version:r,stretchX:n,stretchY:i,content:s}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=i,this.content=s,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Bu{constructor(e,t){const r={},n={};this.haveRenderCallbacks=[];const i=[];this.addImages(e,r,i),this.addImages(t,n,i);const{w:s,h:a}=zu(i),o=new AA({width:s||1,height:a||1});for(const t in e){const n=e[t],i=r[t].paddedRect;AA.copy(n.data,o,{x:0,y:0},{x:i.x+1,y:i.y+1},n.data)}for(const e in t){const r=t[e],i=n[e].paddedRect,s=i.x+1,a=i.y+1,l=r.data.width,u=r.data.height;AA.copy(r.data,o,{x:0,y:0},{x:s,y:a},r.data),AA.copy(r.data,o,{x:0,y:u-1},{x:s,y:a-1},{width:l,height:1}),AA.copy(r.data,o,{x:0,y:0},{x:s,y:a+u},{width:l,height:1}),AA.copy(r.data,o,{x:l-1,y:0},{x:s-1,y:a},{width:1,height:u}),AA.copy(r.data,o,{x:0,y:0},{x:s+l,y:a},{width:1,height:u})}this.image=o,this.iconPositions=r,this.patternPositions=n}addImages(e,t,r){for(const n in e){const i=e[n],s={x:0,y:0,w:i.data.width+2,h:i.data.height+2};r.push(s),t[n]=new Du(s,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t))),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)}patchUpdatedImage(e,t,r){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[n,i]=e.tl;r.update(t.data,void 0,{x:n,y:i})}}Dn(Du,"ImagePosition"),Dn(Bu,"ImageAtlas");const Pu={horizontal:1,vertical:2,horizontalOnly:3};class Lu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const r=new Lu;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new Lu;return t.imageName=e,t}}class Ru{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const r=new Ru;for(let n=0;n<e.sections.length;n++){const i=e.sections[n];i.image?r.addImageSection(i):r.addTextSection(i,t)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(e,t){let r="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n+1)||null,s=e.charCodeAt(n-1)||null;r+=!t&&(i&&mo(i)&&!ru[e[n+1]]||s&&mo(s)&&!ru[e[n-1]])||!ru[e[n]]?e[n]:ru[e[n]]}return r}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&Ou[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Ou[this.text.charCodeAt(r)];r--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const r=new Ru;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Lu.forText(e.scale,e.fontStack||t));const r=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(r)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void D("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Lu.forImage(t)),this.sectionIndex.push(this.sections.length-1)):D("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fu(e,t,r,n,i,s,a,o,l,u,A,c,p,h,d,f){const m=Ru.fromFeature(e,i);let g;c===Pu.vertical&&m.verticalizePunctuation(p);const{processBidirectionalText:_,processStyledBidirectionalText:y}=zo;if(_&&1===m.sections.length){g=[];const e=_(m.toString(),qu(m,u,s,t,n,h,d));for(const t of e){const e=new Ru;e.text=t,e.sections=m.sections;for(let r=0;r<t.length;r++)e.sectionIndex.push(0);g.push(e)}}else if(y){g=[];const e=y(m.text,m.sectionIndex,qu(m,u,s,t,n,h,d));for(const t of e){const e=new Ru;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const r=[],n=e.text;let i=0;for(const n of t)r.push(e.substring(i,n)),i=n;return i<n.length&&r.push(e.substring(i,n.length)),r}(m,qu(m,u,s,t,n,h,d));const b=[],x={positionedLines:b,text:m.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:c,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,r,n,i,s,a,o,l,u,A,c){let p=0,h=0,d=0;const f="right"===o?1:"left"===o?0:.5;let m=!1;for(const e of i){const r=e.getSections();for(const e of r){if(e.imageName)continue;const r=t[e.fontStack];if(r&&(m=void 0!==r.ascender&&void 0!==r.descender,!m))break}if(!m)break}let g=0;for(const a of i){a.trim();const i=a.getMaxScale(),o=(i-1)*Yc,y={positionedGlyphs:[],lineOffset:0};e.positionedLines[g]=y;const b=y.positionedGlyphs;let x=0;if(!a.length()){h+=s,++g;continue}let v=0,w=0;for(let s=0;s<a.length();s++){const o=a.getSection(s),d=a.getSectionIndex(s),f=a.getCharCode(s);let g=o.scale,y=null,T=null,E=null,M=Yc,C=0;const I=!(l===Pu.horizontal||!A&&!fo(f)||A&&(Ou[f]||(_=f,On(_)||Un(_)||Vn(_)||oo(_)||Ao(_))));if(o.imageName){const t=n[o.imageName];if(!t)continue;E=o.imageName,e.iconsInText=e.iconsInText||!0,T=t.paddedRect;const r=t.displaySize;g=g*Yc/c,y={width:r[0],height:r[1],left:1,top:-3,advance:I?r[1]:r[0],localGlyph:!1},C=m?-y.height*g:i*Yc-17-r[1]*g,M=y.advance;const s=(I?r[0]:r[1])*g-Yc*i;s>0&&s>x&&(x=s)}else{const e=r[o.fontStack];if(!e)continue;e[f]&&(T=e[f]);const n=t[o.fontStack];if(!n)continue;const s=n.glyphs[f];if(!s)continue;if(y=s.metrics,M=8203!==f?Yc:0,m){const e=void 0!==n.ascender?Math.abs(n.ascender):0,t=void 0!==n.descender?Math.abs(n.descender):0,r=(e+t)*g;v<r&&(v=r,w=(e-t)/2*g),C=-e*g}else C=(i-g)*Yc-17}I?(e.verticalizable=!0,b.push({glyph:f,imageName:E,x:p,y:h+C,vertical:I,scale:g,localGlyph:y.localGlyph,fontStack:o.fontStack,sectionIndex:d,metrics:y,rect:T}),p+=M*g+u):(b.push({glyph:f,imageName:E,x:p,y:h+C,vertical:I,scale:g,localGlyph:y.localGlyph,fontStack:o.fontStack,sectionIndex:d,metrics:y,rect:T}),p+=y.advance*g+u)}0!==b.length&&(d=Math.max(p-u,d),m?Qu(b,f,x,w,s*i/2):Qu(b,f,x,0,s/2)),p=0;const T=s*i+x;y.lineOffset=Math.max(x,o),h+=T,++g}var _;const y=h,{horizontalAlign:b,verticalAlign:x}=$u(a);(function(e,t,r,n,i,s){const a=(t-r)*i,o=-s*n;for(const t of e)for(const e of t.positionedGlyphs)e.x+=a,e.y+=o})(e.positionedLines,f,b,x,d,y),e.top+=-x*y,e.bottom=e.top+y,e.left+=-b*d,e.right=e.left+d,e.hasBaseline=m}(x,t,r,n,g,a,o,l,c,u,p,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b)&&x}const Ou={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Uu={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Vu(e,t,r,n,i,s){if(t.imageName){const e=n[t.imageName];return e?e.displaySize[0]*t.scale*Yc/s+i:0}{const n=r[t.fontStack],s=n&&n.glyphs[e];return s?s.metrics.advance*t.scale+i:0}}function ju(e,t,r,n){const i=Math.pow(e-t,2);return n?e<t?i/2:2*i:i+Math.abs(r)*r}function Gu(e,t,r){let n=0;return 10===e&&(n-=1e4),r&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function Nu(e,t,r,n,i,s){let a=null,o=ju(t,r,i,s);for(const e of n){const n=ju(t-e.x,r,i,s)+e.badness;n<=o&&(a=e,o=n)}return{index:e,x:t,priorBreak:a,badness:o}}function Zu(e){return e?Zu(e.priorBreak).concat(e.index):[]}function qu(e,t,r,n,i,s,a){if("point"!==s)return[];if(!e)return[];const o=[],l=function(e,t,r,n,i,s){let a=0;for(let r=0;r<e.length();r++){const o=e.getSection(r);a+=Vu(e.getCharCode(r),o,n,i,t,s)}return a/Math.max(1,Math.ceil(a/r))}(e,t,r,n,i,a),u=e.text.indexOf("​")>=0;let A=0;for(let r=0;r<e.length();r++){const s=e.getSection(r),p=e.getCharCode(r);if(Ou[p]||(A+=Vu(p,s,n,i,t,a)),r<e.length()-1){const t=!((c=p)<11904||!(Hn(c)||Qn(c)||so(c)||no(c)||Kn(c)||jn(c)||Wn(c)||Zn(c)||Jn(c)||eo(c)||Yn(c)||co(c)||qn(c)||Nn(c)||Gn(c)||Xn(c)||$n(c)||ao(c)||io(c)||to(c)));(Uu[p]||t||s.imageName)&&o.push(Nu(r+1,A,l,o,Gu(p,e.getCharCode(r+1),t&&u),!1))}}var c;return Zu(Nu(e.length(),A,l,o,0,!0))}function $u(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Qu(e,t,r,n,i){if(!(t||r||n||i))return;const s=e.length-1,a=e[s],o=(a.x+a.metrics.advance*a.scale)*t;for(let t=0;t<=s;t++)e[t].x-=o,e[t].y+=r+n+i}function Hu(e,t,r){const{horizontalAlign:n,verticalAlign:i}=$u(r),s=t[0]-e.displaySize[0]*n,a=t[1]-e.displaySize[1]*i;return{image:e,top:a,bottom:a+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function Wu(e,t,r,n,i,s){const a=e.image;let o;if(a.content){const e=a.content,t=a.pixelRatio||1;o=[e[0]/t,e[1]/t,a.displaySize[0]-e[2]/t,a.displaySize[1]-e[3]/t]}const l=t.left*s,u=t.right*s;let A,c,p,h;"width"===r||"both"===r?(h=i[0]+l-n[3],c=i[0]+u+n[1]):(h=i[0]+(l+u-a.displaySize[0])/2,c=h+a.displaySize[0]);const d=t.top*s,f=t.bottom*s;return"height"===r||"both"===r?(A=i[1]+d-n[0],p=i[1]+f+n[2]):(A=i[1]+(d+f-a.displaySize[1])/2,p=A+a.displaySize[1]),{image:a,top:A,right:c,bottom:p,left:h,collisionPadding:o}}class Xu extends i{constructor(e,t,r,n,i){super(e,t),this.angle=n,this.z=r,void 0!==i&&(this.segment=i)}clone(){return new Xu(this.x,this.y,this.z,this.angle,this.segment)}}function Yu(e,t,r,n,i){if(void 0===t.segment)return!0;let s=t,a=t.segment+1,o=0;for(;o>-r/2;){if(a--,a<0)return!1;o-=e[a].dist(s),s=e[a]}o+=e[a].dist(e[a+1]),a++;const l=[];let u=0;for(;o<r/2;){const t=e[a],r=e[a+1];if(!r)return!1;let s=e[a-1].angleTo(t)-t.angleTo(r);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:o,angleDelta:s}),u+=s;o-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return!1;a++,o+=t.dist(r)}return!0}function Ku(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Ju(e,t,r){return e?.6*t*r:0}function eh(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function ih(e,t,r,n,i,s){const a=Ju(r,i,s),o=eh(r,n)*s;let l=0;const u=Ku(e)/2;for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1],s=n.dist(i);if(l+s>u){const A=(u-l)/s,c=_i(n.x,i.x,A),p=_i(n.y,i.y,A),h=new Xu(c,p,0,i.angleTo(n),r);return!a||Yu(e,h,o,a,t)?h:void 0}l+=s}}function rp(e,t,r,n,i,s,a,o,l){const u=Ju(n,s,a),A=eh(n,i),c=A*a,p=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-c<t/4&&(t=c+t/4),rh(e,p?t/2*o%t:(A/2+2*s)*a*o%t,t,u,r,c,p,!1,l)}function rh(e,t,r,n,i,s,a,o,l){const u=s/2,A=Ku(e);let c=0,p=t-r,h=[];for(let t=0;t<e.length-1;t++){const a=e[t],o=e[t+1],d=a.dist(o),f=o.angleTo(a);for(;p+r<c+d;){p+=r;const m=(p-c)/d,g=_i(a.x,o.x,m),_=_i(a.y,o.y,m);if(g>=0&&g<l&&_>=0&&_<l&&p-u>=0&&p+u<=A){const r=new Xu(g,_,0,f,t);r._round(),n&&!Yu(e,r,s,n,i)||h.push(r)}}c+=d}return o||h.length||a||(h=rh(e,c/2,r,n,i,s,a,!0,l)),h}function nh(e,t,r,n,s){const a=[];for(let o=0;o<e.length;o++){const l=e[o];let u;for(let e=0;e<l.length-1;e++){let o=l[e],A=l[e+1];o.x<t&&A.x<t||(o.x<t?o=new i(t,o.y+(t-o.x)/(A.x-o.x)*(A.y-o.y))._round():A.x<t&&(A=new i(t,o.y+(t-o.x)/(A.x-o.x)*(A.y-o.y))._round()),o.y<r&&A.y<r||(o.y<r?o=new i(o.x+(r-o.y)/(A.y-o.y)*(A.x-o.x),r)._round():A.y<r&&(A=new i(o.x+(r-o.y)/(A.y-o.y)*(A.x-o.x),r)._round()),o.x>=n&&A.x>=n||(o.x>=n?o=new i(n,o.y+(n-o.x)/(A.x-o.x)*(A.y-o.y))._round():A.x>=n&&(A=new i(n,o.y+(n-o.x)/(A.x-o.x)*(A.y-o.y))._round()),o.y>=s&&A.y>=s||(o.y>=s?o=new i(o.x+(s-o.y)/(A.y-o.y)*(A.x-o.x),s)._round():A.y>=s&&(A=new i(o.x+(s-o.y)/(A.y-o.y)*(A.x-o.x),s)._round()),u&&o.equals(u[u.length-1])||(u=[o],a.push(u)),u.push(A)))))}}return a}Dn(Xu,"Anchor");const oh=1e20;function ah(e,t,r,n,i,s,a,o,l){for(let u=t;u<t+n;u++)sh(e,r*s+u,s,i,a,o,l);for(let u=r;u<r+i;u++)sh(e,u*s+t,1,n,a,o,l)}function sh(e,t,r,n,i,s,a){s[0]=0,a[0]=-oh,a[1]=oh,i[0]=e[t];for(let o=1,l=0,u=0;o<n;o++){i[o]=e[t+o*r];const n=o*o;do{const e=s[l];u=(i[o]-i[e]+n-e*e)/(o-e)/2}while(u<=a[l]&&--l>-1);l++,s[l]=o,a[l]=u,a[l+1]=oh}for(let o=0,l=0;o<n;o++){for(;a[l+1]<o;)l++;const n=s[l],u=o-n;e[t+o*r]=i[n]+u*u}}const lh={none:0,ideographs:1,all:2};class Ah{constructor(e,t,r){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const r=[];for(const t in e)for(const n of e[t])r.push({stack:t,id:n});g(r,(({stack:e,id:t},r)=>{let n=this.entries[e];n||(n=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let i=n.glyphs[t];if(void 0!==i)return void r(null,{stack:e,id:t,glyph:i});if(i=this._tinySDF(n,e,t),i)return n.glyphs[t]=i,void r(null,{stack:e,id:t,glyph:i});const s=Math.floor(t/256);if(256*s>65535)return void r(new Error("glyphs > 65535 not supported"));if(n.ranges[s])return void r(null,{stack:e,id:t,glyph:i});let a=n.requests[s];a||(a=n.requests[s]=[],Ah.loadGlyphRange(e,s,this.url,this.requestManager,((e,t)=>{if(t){n.ascender=t.ascender,n.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(n.glyphs[+e]=t.glyphs[+e]);n.ranges[s]=!0}for(const r of a)r(e,t);delete n.requests[s]}))),a.push(((n,i)=>{n?r(n):i&&r(null,{stack:e,id:t,glyph:i.glyphs[t]||null})}))}),((e,r)=>{if(e)t(e);else if(r){const e={};for(const{stack:t,id:n,glyph:i}of r)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[n]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==lh.none&&(this.localGlyphMode===lh.all?!!this.localFontFamily:!!this.localFontFamily&&(eo(e)||ro(e)||qn(e)||$n(e)||Zn(e)))}_tinySDF(e,t,r){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(r))return;let i=e.tinySDF;if(!i){let r="400";/bold/i.test(t)?r="900":/medium/i.test(t)?r="500":/light/i.test(t)&&(r="200"),i=e.tinySDF=new Ah.TinySDF({fontFamily:n,fontWeight:r,fontSize:48,buffer:6,radius:16}),i.fontWeight=r}if(this.localGlyphs[i.fontWeight][r])return this.localGlyphs[i.fontWeight][r];const s=String.fromCharCode(r),{data:a,width:o,height:l,glyphWidth:u,glyphHeight:A,glyphLeft:c,glyphTop:p,glyphAdvance:h}=i.draw(s);return this.localGlyphs[i.fontWeight][r]={id:r,bitmap:new lA({width:o,height:l},a),metrics:{width:u/2,height:A/2,left:c/2,top:p/2-27,advance:h/2,localGlyph:!0}}}}function ch(e,t,r,n){const s=[],a=e.image,o=a.pixelRatio,l=a.paddedRect.w-2,u=a.paddedRect.h-2,A=e.right-e.left,c=e.bottom-e.top,p=a.stretchX||[[0,l]],h=a.stretchY||[[0,u]],d=(e,t)=>e+t[1]-t[0],f=p.reduce(d,0),m=h.reduce(d,0),g=l-f,_=u-m;let y=0,b=f,x=0,v=m,w=0,T=g,E=0,M=_;if(a.content&&n){const e=a.content;y=uh(p,0,e[0]),x=uh(h,0,e[1]),b=uh(p,e[0],e[2]),v=uh(h,e[1],e[3]),w=e[0]-y,E=e[1]-x,T=e[2]-e[0]-b,M=e[3]-e[1]-v}const C=(n,s,l,u)=>{const p=ph(n.stretch-y,b,A,e.left),h=dh(n.fixed-w,T,n.stretch,f),d=ph(s.stretch-x,v,c,e.top),g=dh(s.fixed-E,M,s.stretch,m),_=ph(l.stretch-y,b,A,e.left),C=dh(l.fixed-w,T,l.stretch,f),I=ph(u.stretch-x,v,c,e.top),S=dh(u.fixed-E,M,u.stretch,m),k=new i(p,d),z=new i(_,d),D=new i(_,I),B=new i(p,I),P=new i(h/o,g/o),L=new i(C/o,S/o),R=t*Math.PI/180;if(R){const e=Math.sin(R),t=Math.cos(R),r=[t,-e,e,t];k._matMult(r),z._matMult(r),B._matMult(r),D._matMult(r)}const F=n.stretch+n.fixed,O=s.stretch+s.fixed;return{tl:k,tr:z,bl:B,br:D,tex:{x:a.paddedRect.x+1+F,y:a.paddedRect.y+1+O,w:l.stretch+l.fixed-F,h:u.stretch+u.fixed-O},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:P,pixelOffsetBR:L,minFontScaleX:T/o/A,minFontScaleY:M/o/c,isSDF:r}};if(n&&(a.stretchX||a.stretchY)){const e=hh(p,g,f),t=hh(h,_,m);for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++)s.push(C(n,t[e],i,t[e+1]))}}else s.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:u+1}));return s}function uh(e,t,r){let n=0;for(const i of e)n+=Math.max(t,Math.min(r,i[1]))-Math.max(t,Math.min(r,i[0]));return n}function hh(e,t,r){const n=[{fixed:-1,stretch:0}];for(const[t,r]of e){const e=n[n.length-1];n.push({fixed:t-e.stretch,stretch:e.stretch}),n.push({fixed:t-e.stretch,stretch:e.stretch+(r-t)})}return n.push({fixed:t+1,stretch:r}),n}function ph(e,t,r,n){return e/t*r+n}function dh(e,t,r,n){return e-t*r/n}function fh(e,t,r,n){const i=t+e.positionedLines[n].lineOffset;return 0===n?r+i/2:r+(i+(t+e.positionedLines[n-1].lineOffset))/2}Ah.loadGlyphRange=function(e,t,r,n,i){const s=256*t,a=s+255,o=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",`${s}-${a}`),Me.Glyphs);ke(o,((e,t)=>{if(e)i(e);else if(t){const e={},r=function(e){return new lu(e).readFields(Iu,{})}(t);for(const t of r.glyphs)e[t.id]=t;i(null,{glyphs:e,ascender:r.ascender,descender:r.descender})}}))},Ah.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:n=.25,fontFamily:i="sans-serif",fontWeight:s="normal",fontStyle:a="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=r;const o=this.size=e+4*t,l=this._createCanvas(o),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${s} ${e}px ${i}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Uint16Array(o)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:i,actualBoundingBoxRight:s}=this.ctx.measureText(e),a=Math.ceil(r),o=Math.min(this.size-this.buffer,Math.ceil(s-i)),l=Math.min(this.size-this.buffer,a+Math.ceil(n)),u=o+2*this.buffer,A=l+2*this.buffer,c=Math.max(u*A,0),p=new Uint8ClampedArray(c),h={data:p,width:u,height:A,glyphWidth:o,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0===o||0===l)return h;const{ctx:d,buffer:f,gridInner:m,gridOuter:g}=this;d.clearRect(f,f,o,l),d.fillText(e,f,f+a);const _=d.getImageData(f,f,o,l);g.fill(oh,0,c),m.fill(0,0,c);for(let e=0;e<l;e++)for(let t=0;t<o;t++){const r=_.data[4*(e*o+t)+3]/255;if(0===r)continue;const n=(e+f)*u+t+f;if(1===r)g[n]=0,m[n]=oh;else{const e=.5-r;g[n]=e>0?e*e:0,m[n]=e<0?e*e:0}}ah(g,0,0,u,A,u,this.f,this.v,this.z),ah(m,f,f,o,l,u,this.f,this.v,this.z);for(let e=0;e<c;e++){const t=Math.sqrt(g[e])-Math.sqrt(m[e]);p[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return h}};class mh{constructor(e=[],t=_h){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,n=t[e];for(;e>0;){const i=e-1>>1,s=t[i];if(r(n,s)>=0)break;t[e]=s,e=i}t[e]=n}_down(e){const{data:t,compare:r}=this,n=this.length>>1,i=t[e];for(;e<n;){let n=1+(e<<1),s=t[n];const a=n+1;if(a<this.length&&r(t[a],s)<0&&(n=a,s=t[a]),r(s,i)>=0)break;t[e]=s,e=n}t[e]=i}}function _h(e,t){return e<t?-1:e>t?1:0}function gh(e,t=1,r=!1){let n=1/0,s=1/0,a=-1/0,o=-1/0;const l=e[0];for(let e=0;e<l.length;e++){const t=l[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<s)&&(s=t.y),(!e||t.x>a)&&(a=t.x),(!e||t.y>o)&&(o=t.y)}const u=Math.min(a-n,o-s);let A=u/2;const c=new mh([],yh);if(0===u)return new i(n,s);for(let t=n;t<a;t+=u)for(let r=s;r<o;r+=u)c.push(new xh(t+A,r+A,A,e));let p=function(e){let t=0,r=0,n=0;const i=e[0];for(let e=0,s=i.length,a=s-1;e<s;a=e++){const s=i[e],o=i[a],l=s.x*o.y-o.x*s.y;r+=(s.x+o.x)*l,n+=(s.y+o.y)*l,t+=3*l}return new xh(r/t,n/t,0,e)}(e),h=c.length;for(;c.length;){const n=c.pop();(n.d>p.d||!p.d)&&(p=n,r&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,h)),n.max-p.d<=t||(A=n.h/2,c.push(new xh(n.p.x-A,n.p.y-A,A,e)),c.push(new xh(n.p.x+A,n.p.y-A,A,e)),c.push(new xh(n.p.x-A,n.p.y+A,A,e)),c.push(new xh(n.p.x+A,n.p.y+A,A,e)),h+=4)}return r&&(console.log(`num probes: ${h}`),console.log(`best distance: ${p.d}`)),p.p}function yh(e,t){return t.max-e.max}function xh(e,t,r,n){this.p=new i(e,t),this.h=r,this.d=function(e,t){let r=!1,n=1/0;for(let i=0;i<t.length;i++){const s=t[i];for(let t=0,i=s.length,a=i-1;t<i;a=t++){const i=s[t],o=s[a];i.y>e.y!=o.y>e.y&&e.x<(o.x-i.x)*(e.y-i.y)/(o.y-i.y)+i.x&&(r=!r),n=Math.min(n,tl(e,i,o))}}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const vh=Number.POSITIVE_INFINITY,bh=Math.sqrt(2);function wh(e,t){return t[1]!==vh?function(e,t,r){let n=0,i=0;switch(t=Math.abs(t),r=Math.abs(r),e){case"top-right":case"top-left":case"top":i=r-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-r}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}return[n,i]}(e,t[0],t[1]):function(e,t){let r=0,n=0;t<0&&(t=0);const i=t/bh;switch(e){case"top-right":case"top-left":n=i-7;break;case"bottom-right":case"bottom-left":n=7-i;break;case"bottom":n=7-t;break;case"top":n=t-7}switch(e){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=t;break;case"right":r=-t}return[r,n]}(e,t[0])}function Th(e,t,r,n,i,s,a,o,l,u){e.createArrays(),e.tilePixelRatio=bs/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const A=e.layers[0].layout,c=e.layers[0]._unevaluatedLayout._values,p={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:r}=e.textSizeData;p.compositeTextSizes=[c["text-size"].possiblyEvaluate(new Do(t),o),c["text-size"].possiblyEvaluate(new Do(r),o)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:r}=e.iconSizeData;p.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new Do(t),o),c["icon-size"].possiblyEvaluate(new Do(r),o)]}p.layoutTextSize=c["text-size"].possiblyEvaluate(new Do(l+1),o),p.layoutIconSize=c["icon-size"].possiblyEvaluate(new Do(l+1),o),p.textMaxSize=c["text-size"].possiblyEvaluate(new Do(18),o);const h="map"===A.get("text-rotation-alignment")&&"point"!==A.get("symbol-placement"),d=A.get("text-size");for(const s of e.features){const l=A.get("text-font").evaluate(s,{},o).join(","),c=d.evaluate(s,{},o),f=p.layoutTextSize.evaluate(s,{},o),m=(p.layoutIconSize.evaluate(s,{},o),{horizontal:{},vertical:void 0}),g=s.text;let _,y=[0,0];if(g){const n=g.toString(),a=A.get("text-letter-spacing").evaluate(s,{},o)*Yc,u=A.get("text-line-height").evaluate(s,{},o)*Yc,p=ho(n)?a:0,d=A.get("text-anchor").evaluate(s,{},o),_=A.get("text-variable-anchor");if(!_){const e=A.get("text-radial-offset").evaluate(s,{},o);y=e?wh(d,[e*Yc,vh]):A.get("text-offset").evaluate(s,{},o).map((e=>e*Yc))}let b=h?"center":A.get("text-justify").evaluate(s,{},o);const x=A.get("symbol-placement"),v="point"===x,w="point"===x?A.get("text-max-width").evaluate(s,{},o)*Yc:0,T=s=>{e.allowVerticalPlacement&&uo(n)&&(m.vertical=Fu(g,t,r,i,l,w,u,d,s,p,y,Pu.vertical,!0,x,f,c))};if(!h&&_){const e="auto"===b?_.map((e=>Eh(e))):[b];let n=!1;for(let s=0;s<e.length;s++){const a=e[s];if(!m.horizontal[a])if(n)m.horizontal[a]=m.horizontal[0];else{const e=Fu(g,t,r,i,l,w,u,"center",a,p,y,Pu.horizontal,!1,x,f,c);e&&(m.horizontal[a]=e,n=1===e.positionedLines.length)}}T("left")}else{if("auto"===b&&(b=Eh(d)),v||A.get("text-writing-mode").indexOf("horizontal")>=0||!uo(n)){const e=Fu(g,t,r,i,l,w,u,d,b,p,y,Pu.horizontal,!1,x,f,c);e&&(m.horizontal[b]=e)}T("point"===x?"left":b)}}let b=!1;if(s.icon&&s.icon.name){const t=n[s.icon.name];t&&(_=Hu(i[s.icon.name],A.get("icon-offset").evaluate(s,{},o),A.get("icon-anchor").evaluate(s,{},o)),b=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&D("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==A.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const x=Sh(m.horizontal)||m.vertical;e.iconsInText||(e.iconsInText=!!x&&x.iconsInText),(x||_)&&Mh(e,s,m,_,n,p,f,0,y,b,a,o,u)}s&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function Eh(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Mh(e,t,r,n,i,s,a,o,u,l,c,p,h){let d=s.textMaxSize.evaluate(t,{},p);void 0===d&&(d=a);const f=e.layers[0].layout,m=f.get("icon-offset").evaluate(t,{},p),g=Sh(r.horizontal)||r.vertical,_="globe"===h.name,y=a/24,b=e.tilePixelRatio*d/24,x=(S=e.overscaling,e.zoom>18&&S>2&&(S>>=1),Math.max(bs/(512*S),1)*f.get("symbol-spacing")),v=f.get("text-padding")*e.tilePixelRatio,w=f.get("icon-padding")*e.tilePixelRatio,T=A(f.get("text-max-angle")),E="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),M="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),C=f.get("symbol-placement"),I=x/2;var S;const k=f.get("icon-text-fit");let z;n&&"none"!==k&&(e.allowVerticalPlacement&&r.vertical&&(z=Wu(n,r.vertical,k,f.get("icon-text-fit-padding"),m,y)),g&&(n=Wu(n,g,k,f.get("icon-text-fit-padding"),m,y)));const B=(a,o,A)=>{if(o.x<0||o.x>=bs||o.y<0||o.y>=bs)return;let d=null;if(_){const{x:e,y:t,z:r}=h.projectTilePoint(o.x,o.y,A);d={anchor:new Xu(e,t,r,0,void 0),up:h.upVector(A,o.x,o.y)}}!function(e,t,r,n,i,s,a,o,l,u,A,c,p,h,d,f,m,g,_,y,b,x,v,w,T){const E=e.addToLineVertexArray(t,n);let M,C,I,S,k,z,B,P=0,L=0,R=0,F=0,O=-1,U=-1;const V={};let j=qa("");const G=r?r.anchor:t;let q=0,N=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[q,N]=l.layout.get("text-offset").evaluate(b,{},T).map((e=>e*Yc)):(q=l.layout.get("text-radial-offset").evaluate(b,{},T)*Yc,N=vh),e.allowVerticalPlacement&&i.vertical){const e=i.vertical;if(d)z=zh(e),o&&(B=zh(o));else{const r=l.layout.get("text-rotate").evaluate(b,{},T)+90;I=kh(u,G,t,A,c,p,e,h,r,f),o&&(S=kh(u,G,t,A,c,p,o,g,r))}}if(s){const n=l.layout.get("icon-rotate").evaluate(b,{},T),i="none"!==l.layout.get("icon-text-fit"),a=ch(s,n,v,i),h=o?ch(o,n,v,i):void 0;C=kh(u,G,t,A,c,p,s,g,n),P=4*a.length;const d=e.iconSizeData;let f=null;"source"===d.kind?(f=[Kc*l.layout.get("icon-size").evaluate(b,{},T)],f[0]>Ch&&D(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===d.kind&&(f=[Kc*x.compositeIconSizes[0].evaluate(b,{},T),Kc*x.compositeIconSizes[1].evaluate(b,{},T)],(f[0]>Ch||f[1]>Ch)&&D(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,a,f,y,_,b,!1,r,t,E.lineStartIndex,E.lineLength,-1,w,T),O=e.icon.placedSymbolArray.length-1,h&&(L=4*h.length,e.addSymbols(e.icon,h,f,y,_,b,Pu.vertical,r,t,E.lineStartIndex,E.lineLength,-1,w,T),U=e.icon.placedSymbolArray.length-1)}for(const n in i.horizontal){const s=i.horizontal[n];M||(j=qa(s.text),d?k=zh(s):M=kh(u,G,t,A,c,p,s,h,l.layout.get("text-rotate").evaluate(b,{},T),f));const o=1===s.positionedLines.length;if(R+=Ih(e,r,t,s,a,l,d,b,f,E,i.vertical?Pu.horizontal:Pu.horizontalOnly,o?Object.keys(i.horizontal):[n],V,O,x,w,T),o)break}i.vertical&&(F+=Ih(e,r,t,i.vertical,a,l,d,b,f,E,Pu.vertical,["vertical"],V,U,x,w,T));let Z=-1;const $=(e,t)=>e?Math.max(e,t):t;Z=$(k,Z),Z=$(z,Z),Z=$(B,Z);const Q=Z>-1?1:0;e.glyphOffsetArray.length>=Up.MAX_GLYPHS&&D("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,b.sortKey),e.symbolInstances.emplaceBack(G.x,G.y,G.z,t.x,t.y,V.right>=0?V.right:-1,V.center>=0?V.center:-1,V.left>=0?V.left:-1,V.vertical>=0?V.vertical:-1,O,U,j,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==I?I:e.collisionBoxArray.length,void 0!==I?I+1:e.collisionBoxArray.length,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,S||e.collisionBoxArray.length,S?S+1:e.collisionBoxArray.length,A,R,F,P,L,Q,0,q,N,Z)}(e,o,d,a,r,n,i,z,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,v,E,u,0,w,M,m,t,s,l,c,p)};if("line"===C)for(const i of nh(t.geometry,0,0,bs,bs)){const t=rp(i,x,T,r.vertical||g,n,24,b,e.overscaling,bs);for(const r of t){const t=g;t&&Dh(e,t.text,I,r)||B(i,r,p)}}else if("line-center"===C){for(const e of t.geometry)if(e.length>1){const t=ih(e,T,r.vertical||g,n,24,b);t&&B(e,t,p)}}else if("Polygon"===t.type)for(const e of QA(t.geometry,0)){const t=gh(e,16);B(e[0],new Xu(t.x,t.y,0,0,void 0),p)}else if("LineString"===t.type)for(const e of t.geometry)B(e,new Xu(e[0].x,e[0].y,0,0,void 0),p);else if("Point"===t.type)for(const e of t.geometry)for(const t of e)B([t],new Xu(t.x,t.y,0,0,void 0),p)}const Ch=32640;function Ih(e,t,r,n,s,a,o,l,u,A,c,p,h,d,f,m,g){const _=function(e,t,r,n,s,a,o,l){const u=[];if(0===t.positionedLines.length)return u;const A=n.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=function(e){const t=e[0],r=e[1],n=t*r;return n>0?[t,-r]:n<0?[-t,r]:0===t?[r,t]:[r,-t]}(r);let p=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)p-=e.lineOffset;const h=t.positionedLines.length,d=p/h;let f=t.top-r[1];for(let e=0;e<h;++e){const n=t.positionedLines[e];f=fh(t,d,f,e);for(const e of n.positionedGlyphs){if(!e.rect)continue;const n=e.rect||{};let a=4,p=!0,h=1,d=0;if(e.imageName){const t=o[e.imageName];if(!t)continue;if(t.sdf){D("SDF images are not supported in formatted text and will be ignored.");continue}p=!1,h=t.pixelRatio,a=1/h}const m=(s||l)&&e.vertical,g=e.metrics.advance*e.scale/2,_=e.metrics,y=e.rect;if(null===y)continue;l&&t.verticalizable&&(d=e.imageName?g-e.metrics.width*e.scale/2:0);const b=s?[e.x+g,e.y]:[0,0];let x=[0,0],v=[0,0],w=!1;s||(m?(v=[e.x+g+c[0],e.y+c[1]-d],w=!0):x=[e.x+g+r[0],e.y+r[1]-d]);const T=y.w*e.scale/(h*(e.localGlyph?2:1)),E=y.h*e.scale/(h*(e.localGlyph?2:1));let M,C,I,S;if(m){const t=e.y-f,r=new i(-g,g-t),n=-Math.PI/2,s=new i(...v);M=new i(-g+x[0],x[1]),M._rotateAround(n,r)._add(s),M.x+=-t+g,M.y-=(_.left-a)*e.scale;const o=e.imageName?_.advance*e.scale:Yc*e.scale,l=String.fromCharCode(e.glyph);nu(l)?M.x+=(1-a)*e.scale:ou(l)?M.x+=o-_.height*e.scale+(-a-1)*e.scale:M.x+=e.imageName||_.width+2*a===y.w&&_.height+2*a===y.h?(o-E)/2:(o-(_.height+2*a)*e.scale)/2,C=new i(M.x,M.y-T),I=new i(M.x+E,M.y),S=new i(M.x+E,M.y-T)}else{const t=(_.left-a)*e.scale-g+x[0],r=(-_.top-a)*e.scale+x[1],n=t+T,s=r+E;M=new i(t,r),C=new i(n,r),I=new i(t,s),S=new i(n,s)}if(A){let e;e=s?new i(0,0):w?new i(c[0],c[1]):new i(r[0],r[1]),M._rotateAround(A,e),C._rotateAround(A,e),I._rotateAround(A,e),S._rotateAround(A,e)}const k=new i(0,0),z=new i(0,0);u.push({tl:M,tr:C,bl:I,br:S,tex:n,writingMode:t.writingMode,glyphOffset:b,sectionIndex:e.sectionIndex,isSDF:p,pixelOffsetTL:k,pixelOffsetBR:z,minFontScaleX:0,minFontScaleY:0})}}return u}(0,n,u,a,o,l,s,e.allowVerticalPlacement),y=e.textSizeData;let b=null;"source"===y.kind?(b=[Kc*a.layout.get("text-size").evaluate(l,{},g)],b[0]>Ch&&D(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===y.kind&&(b=[Kc*f.compositeTextSizes[0].evaluate(l,{},g),Kc*f.compositeTextSizes[1].evaluate(l,{},g)],(b[0]>Ch||b[1]>Ch)&&D(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,_,b,u,o,l,c,t,r,A.lineStartIndex,A.lineLength,d,m,g);for(const t of p)h[t]=e.text.placedSymbolArray.length-1;return 4*_.length}function Sh(e){for(const t in e)return e[t];return null}function kh(e,t,r,n,s,a,o,u,l,c){let p=o.top,h=o.bottom,d=o.left,f=o.right;const m=o.collisionPadding;if(m&&(d-=m[0],p-=m[1],f+=m[2],h+=m[3]),l){const e=new i(d,p),t=new i(f,p),r=new i(d,h),n=new i(f,h),s=A(l);let a=new i(0,0);c&&(a=new i(c[0],c[1])),e._rotateAround(s,a),t._rotateAround(s,a),r._rotateAround(s,a),n._rotateAround(s,a),d=Math.min(e.x,t.x,r.x,n.x),f=Math.max(e.x,t.x,r.x,n.x),p=Math.min(e.y,t.y,r.y,n.y),h=Math.max(e.y,t.y,r.y,n.y)}return e.emplaceBack(t.x,t.y,t.z,r.x,r.y,d,p,f,h,u,n,s,a),e.length-1}function zh(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Dh(e,t,r,n){const i=e.compareText;if(t in i){const e=i[t];for(let t=e.length-1;t>=0;t--)if(n.dist(e[t])<r)return!0}else i[t]=[];return i[t].push(n),!1}const Bh=Yo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:Ph}=Bh,Lh=Yo([{name:"a_pos_3",components:3,type:"Int16"}]);var Rh=Yo([{name:"a_pos",type:"Int16",components:2}]);const Fh=bs/Math.PI/2,Oh=2*ks(1,0)*Fh*Math.PI,Uh=[64,32,16],Vh=-Fh,jh=Fh,Gh=[new Kl([Vh,Vh,Vh],[jh,jh,jh]),new Kl([Vh,Vh,Vh],[0,0,jh]),new Kl([0,Vh,Vh],[jh,0,jh]),new Kl([Vh,0,Vh],[0,jh,jh]),new Kl([0,0,Vh],[jh,jh,jh])];function Nh(e,t,r,n=!0){const i=Dl([],e._camera.position,e.worldSize),s=[t,r,1,1];Zl(s,s,e.pixelMatrixInverse),Nl(s,s,1/s[3]);const a=Pl([],Vl([],s,i)),o=e.globeMatrix,l=[o[12],o[13],o[14]],A=Vl([],l,i),c=El(A),p=Pl([],A),h=e.worldSize/(2*Math.PI),d=Ll(p,a),m=Math.asin(h/c);if(m<Math.acos(d)){if(!n)return null;const e=[],t=[];Dl(e,a,c/d),Pl(t,Vl(t,e,A)),Pl(a,Cl(a,A,Dl(a,t,Math.tan(m)*c)))}const g=[];new Wl(i,a).closestPointOnSphere(l,h,g);const _=Pl([],V(o,0)),y=Pl([],V(o,1)),b=Pl([],V(o,2)),x=Ll(_,g),v=Ll(y,g),w=Ll(b,g),T=u(Math.asin(-v/h));let E=u(Math.atan2(x,w));E=e.center.lng+function(e,t){const r=(t-e+180)%360-180;return r<-180?r+360:r}(e.center.lng,E);const M=Is(E),C=f(Ss(T),0,1);return new Ls(M,C)}class Zh{constructor(e,t,r){this.a=Vl([],e,r),this.b=Vl([],t,r),this.center=r;const n=Pl([],this.a),i=Pl([],this.b);this.angle=Math.acos(Ll(n,i))}}function qh(e,t){if(0===e.angle)return null;let r;return r=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),r<0||r>1?null:function(e,t,r,n){const i=Math.sin(r);return e*(Math.sin((1-n)*r)/i)+t*(Math.sin(n*r)/i)}(e.a[t],e.b[t],e.angle,f(r,0,1))+e.center[t]}function $h(e){if(e.z<=1)return Gh[e.z+2*e.y+e.x];const[t,r]=Hh(e),n=[Xh(t[0],t[1]),Xh(t[0],r[1]),Xh(r[0],t[1]),Xh(r[0],r[1])],i=[jh,jh,jh],s=[Vh,Vh,Vh];for(const e of n)i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.min(i[2],e[2]),s[0]=Math.max(s[0],e[0]),s[1]=Math.max(s[1],e[1]),s[2]=Math.max(s[2],e[2]);return new Kl(i,s)}function Qh(e,t,r){const n=t/e.worldSize,i=Number.MAX_VALUE,s=[-i,-i,-i],a=[i,i,i],o=dl(new Float64Array(16));if(gl(o,o,[n,n,n]),ml(o,o,e.globeMatrix),r.z<=1){const e=$h(r).getCorners();for(let t=0;t<e.length;t++)Fl(e[t],e[t],o),kl(a,a,e[t]),zl(s,s,e[t]);return new Kl(a,s)}const[u,l]=Hh(r),c=new ws;c.setSouthWest([u[1],l[0]]),c.setNorthEast([l[1],u[0]]);const p=[Xh(c.getSouth(),c.getWest()),Xh(c.getSouth(),c.getEast()),Xh(c.getNorth(),c.getEast()),Xh(c.getNorth(),c.getWest())];for(let e=0;e<p.length;e++)Fl(p[e],p[e],o),kl(a,a,p[e]),zl(s,s,p[e]);if(c.contains(e.center)){s[2]=0;const t=e.point,r=[t.x*n,t.y*n,0];return kl(a,a,r),zl(s,s,r),new Kl(a,s)}const h=[o[12],o[13],o[14]],d=e.center.lng,m=f(e.center.lat,-85.051129,Ps),g=[Is(d),Ss(m)],_=c.getCenter().lng,y=f(c.getCenter().lat,-85.051129,Ps),b=[Is(_),Ss(y)];let x=new Array(3),v=0,w=g[0]-b[0];const T=g[1]-b[1];if(w>.5?w-=1:w<-.5&&(w+=1),Math.abs(w)>Math.abs(T))v=w>=0?1:3,x=h;else{v=T>=0?0:2;const e=[o[4],o[5],o[6]];let t;t=T>=0?-Math.sin(A(c.getSouth()))*Fh:-Math.sin(A(c.getNorth()))*Fh,x=Bl(x,h,e,t)}const E=p[v],M=p[(v+1)%4],C=new Zh(E,M,x),I=[qh(C,0)||E[0],qh(C,1)||E[1],qh(C,2)||E[2]];return a[2]=Math.min(E[2],M[2]),kl(a,a,I),zl(s,s,I),new Kl(a,s)}function Hh(e){const t=1<<e.z,r=e.x/t,n=(e.x+1)/t,i=(e.y+1)/t;return[[Ds(e.y/t),zs(r)],[Ds(i),zs(n)]]}function Wh(e,t,r,n=Fh){return r=A(r),[e*Math.sin(r)*n,-t*n,e*Math.cos(r)*n]}function Xh(e,t,r){return Wh(Math.cos(A(e)),Math.sin(A(e)),t,r)}function Yh(e,t,r){const n=Math.pow(2,r.z),i=(e/bs+r.x)/n;return Xh(Ds((t/bs+r.y)/n),zs(i))}function Kh(e){return 16383/Math.max(...Vl([],e.max,e.min))}function Jh(e){const t=dl(new Float64Array(16)),r=Kh(e);var n,i;return gl(t,t,[r,r,r]),_l(t,t,((n=[])[0]=-(i=e.min)[0],n[1]=-i[1],n[2]=-i[2],n)),t}function ep(e){const t=dl(new Float64Array(16)),r=1/Kh(e);return _l(t,t,e.min),gl(t,t,[r,r,r]),t}function tp(e,t,r,n,i){const s=function(e){const t=bs/(2*Math.PI);return e/(2*Math.PI)/t}(r),a=[e,t,-r/(2*Math.PI)],o=dl(new Float64Array(16));return _l(o,o,a),gl(o,o,[s,s,s]),yl(o,o,A(-i)),xl(o,o,A(-n)),o}function ip(e){return m(5,6,e)}function np(e,t){const r=Xh(t.lat,t.lng);return s=(n=Il([],function(e){const t=Xh(e._center.lat,e._center.lng);let r=Rl([],Ml(0,1,0),t);const n=vl([],-e.angle,t);r=Fl(r,r,n),vl(n,-e._pitch,r);const i=Pl([],t);return Dl(i,i,e.cameraToCenterDistance/e.pixelsPerMeter*Oh),Fl(i,i,n),Cl([],t,i)}(e),r))[0],a=n[1],o=n[2],l=(i=r)[0],u=i[1],A=i[2],p=(c=Math.sqrt(s*s+a*a+o*o)*Math.sqrt(l*l+u*u+A*A))&&Ll(n,i)/c,Math.acos(Math.min(Math.max(p,-1),1));var n,i,s,a,o,l,u,A,c,p}const op=A(85),ap=Math.cos(op),sp=Math.sin(op);function lp(e,t){const r=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,i=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),s=Math.sin(r)*i/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01)),a=Math.sin(e._pitch)*s+i;return Math.min(1.01*a,i*(1/e._horizonShift))}function Ap(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const r=Math.pow(2,-e.z),n=e.x*r,i=(e.x+1)*r,s=e.y*r,a=(e.y+1)*r,o=zs(n),l=zs(i),u=Ds(s),A=Ds(a),c=t.project(o,u),p=t.project(l,u),h=t.project(l,A),d=t.project(o,A);let f=Math.min(c.x,p.x,h.x,d.x),m=Math.min(c.y,p.y,h.y,d.y),g=Math.max(c.x,p.x,h.x,d.x),_=Math.max(c.y,p.y,h.y,d.y);const y=r/16;function b(e,r,n,i,s,a){const o=(n+s)/2,l=(i+a)/2,u=t.project(zs(o),Ds(l)),A=Math.max(0,f-u.x,m-u.y,u.x-g,u.y-_);f=Math.min(f,u.x),g=Math.max(g,u.x),m=Math.min(m,u.y),_=Math.max(_,u.y),A>y&&(b(e,u,n,i,o,l),b(u,r,o,l,s,a))}b(c,p,n,s,i,s),b(p,h,i,s,i,a),b(h,d,i,a,n,a),b(d,c,n,a,n,s),f-=y,m-=y,g+=y,_+=y;const x=1/Math.max(g-f,_-m);return{scale:x,x:f*x,y:m*x,x2:g*x,y2:_*x,projection:t}}const cp=dl(new Float32Array(16));class up{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Es(0,0)}projectTilePoint(e,t,r){return{x:e,y:t,z:0}}locationPoint(e,t,r=!0){return e._coordinatePoint(e.locationCoordinate(t),r)}pixelsPerMeter(e,t){return ks(1,e)*t}pixelSpaceConversion(e,t,r){return 1}farthestPixelDistance(e){return lp(e,e.pixelsPerMeter)}pointCoordinate(e,t,r,n){const s=e.horizonLineFromTop(!1),a=new i(t,Math.max(s,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(a,n))}pointCoordinate3D(e,t,r){const n=new i(t,r);if(e.elevation)return e.elevation.pointCoordinate(n);{const t=this.pointCoordinate(e,n.x,n.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const r=e.horizonLineFromTop();return t.y<r}createInversionMatrix(e,t){return cp}createTileMatrix(e,t,r){let n,i,s;const a=r.canonical,o=dl(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Ap(a,this);n=1,i=l.x+r.wrap*l.scale,s=l.y,gl(o,o,[n/l.scale,n/l.scale,e.pixelsPerMeter/t])}else n=t/e.zoomScale(a.z),i=(a.x+Math.pow(2,a.z)*r.wrap)*n,s=a.y*n;return _l(o,o,[i,s,0]),gl(o,o,[n/bs,n/bs,1]),o}upVector(e,t,r){return[0,0,1]}upVectorScale(e,t,r){return{metersToTile:1}}}class hp extends up{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,r]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(A(t));this.n=(n+Math.sin(A(r)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:r,c:n,r0:i}=this,s=A(e-this.center[0]),a=A(t),o=Math.sqrt(n-2*r*Math.sin(a))/r;return{x:o*Math.sin(s*r),y:o*Math.cos(s*r)-i,z:0}}unproject(e,t){const{n:r,c:n,r0:i}=this,s=i+t;let a=Math.atan2(e,Math.abs(s))*Math.sign(s);s*r<0&&(a-=Math.PI*Math.sign(e)*Math.sign(s));const o=A(this.center[0])*r;a=_(a,-Math.PI-o,Math.PI-o);const l=u(a/r)+this.center[0],c=Math.asin(f((n-(e*e+s*s)*r*r)/(2*r),-1,1)),p=f(u(c),-85.051129,Ps);return new Es(l,p)}}const pp=1.340264,dp=-.081106,fp=893e-6,mp=.003796,_p=Math.sqrt(3)/2;class gp extends up{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(_p*Math.sin(t)),n=r*r,i=n*n*n;return{x:.5*(e*Math.cos(r)/(_p*(pp+3*dp*n+i*(7*fp+9*mp*n)))/Math.PI+.5),y:1-.5*(r*(pp+dp*n+i*(fp+mp*n))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=r*r,i=n*n*n;for(let e,s,a,o=0;o<12&&(s=r*(pp+dp*n+i*(fp+mp*n))-t,a=pp+3*dp*n+i*(7*fp+9*mp*n),e=s/a,r=f(r-e,-Math.PI/3,Math.PI/3),n=r*r,i=n*n*n,!(Math.abs(e)<1e-12));++o);const s=_p*e*(pp+3*dp*n+i*(7*fp+9*mp*n))/Math.cos(r),a=Math.asin(Math.sin(r)/_p),o=f(180*s/Math.PI,-180,180),l=f(180*a/Math.PI,-85.051129,Ps);return new Es(o,l)}}class yp extends up{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const r=360*(e-.5),n=f(360*(.5-t),-85.051129,Ps);return new Es(r,n)}}const xp=Math.PI/2;function vp(e){return Math.tan((xp+e)/2)}class bp extends up{constructor(e){super(e),this.center=e.center||[0,30];const[t,r]=this.parallels=e.parallels||[30,30],n=A(t),i=A(r),s=Math.cos(n);this.n=n===i?Math.sin(n):Math.log(s/Math.cos(i))/Math.log(vp(i)/vp(n)),this.f=s*Math.pow(vp(n),this.n)/this.n}project(e,t){t=A(t),e=A(e-this.center[0]);const r=1e-6,{n:n,f:i}=this;i>0?t<-xp+r&&(t=-xp+r):t>xp-r&&(t=xp-r);const s=i/Math.pow(vp(t),n),a=s*Math.sin(n*e),o=i-s*Math.cos(n*e);return{x:.5*(a/Math.PI+.5),y:1-.5*(o/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:r,f:n}=this,i=n-t,s=Math.sign(i),a=Math.sign(r)*Math.sqrt(e*e+i*i);let o=Math.atan2(e,Math.abs(i))*s;i*r<0&&(o-=Math.PI*Math.sign(e)*s);const l=f(u(o/r)+this.center[0],-180,180),A=f(u(2*Math.atan(Math.pow(n/a,1/r))-xp),-85.051129,Ps);return new Es(l,A)}}class wp extends up{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Is(e),y:Ss(t),z:0}}unproject(e,t){const r=zs(e),n=Ds(t);return new Es(r,n)}}const Tp=A(Ps);class Ep extends up{project(e,t){const r=(t=A(t))*t,n=r*r;return{x:.5*((e=A(e))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=25,i=0,s=r*r;do{s=r*r;const e=s*s;i=(r*(1.007226+s*(.015085+e*(.028874*s-.044475-.005916*e)))-t)/(1.007226+s*(.045255+e*(.259866*s-.311325-.005916*11*e))),r=f(r-i,-Tp,Tp)}while(Math.abs(i)>1e-6&&--n>0);s=r*r;const a=f(u(e/(.8707+s*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979))),-180,180),o=u(r);return new Es(a,o)}}const Mp=A(Ps);class Cp extends up{project(e,t){t=A(t),e=A(e);const r=Math.cos(t),n=2/Math.PI,i=Math.acos(r*Math.cos(e/2)),s=Math.sin(i)/i,a=.5*(e*n+2*r*Math.sin(e/2)/s)||0,o=.5*(t+Math.sin(t)/s)||0;return{x:.5*(a/Math.PI+.5),y:1-.5*(o/Math.PI+1),z:0}}unproject(e,t){let r=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,i=25;const s=1e-6;let a=0,o=0;do{const i=Math.cos(n),s=Math.sin(n),l=2*s*i,u=s*s,A=i*i,c=Math.cos(r/2),p=Math.sin(r/2),h=2*c*p,d=p*p,m=1-A*c*c,g=m?1/m:0,_=m?Math.acos(i*c)*Math.sqrt(1/m):0,y=.5*(2*_*i*p+2*r/Math.PI)-e,b=.5*(_*s+n)-t,x=.5*g*(A*d+_*i*c*u)+1/Math.PI,v=g*(h*l/4-_*s*p),w=.125*g*(l*p-_*s*A*h),T=.5*g*(u*c+_*d*i)+.5,E=v*w-T*x;a=(b*v-y*T)/E,o=(y*w-b*x)/E,r=f(r-a,-Math.PI,Math.PI),n=f(n-o,-Mp,Mp)}while((Math.abs(a)>s||Math.abs(o)>s)&&--i>0);return new Es(u(r),u(n))}}class Ip extends up{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(A(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:r,cosPhi:n}=this;return{x:A(e)*n*r+.5,y:-Math.sin(A(t))/n*r+.5,z:0}}unproject(e,t){const{scale:r,cosPhi:n}=this,i=-(t-.5)/r,s=f(u((e-.5)/r)/n,-180,180),a=Math.asin(f(i*n,-1,1)),o=f(u(a),-85.051129,Ps);return new Es(s,o)}}class Sp extends wp{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,r){const n=Math.pow(2,r.z),i=(e/bs+r.x)/n,s=Xh(Ds((t/bs+r.y)/n),zs(i));return Fl(s,s,Jh($h(r))),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,t){const r=Xh(t.lat,t.lng),n=Pl([],r),s=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Bl(r,r,n,ks(1,0)*bs*s);const a=dl(new Float64Array(16));return ml(a,e.pixelMatrix,e.globeMatrix),Fl(r,r,a),new i(r[0],r[1])}pixelsPerMeter(e,t){return ks(1,0)*t}pixelSpaceConversion(e,t,r){const n=_i(ks(1,45)*t,ks(1,e)*t,r);return this.pixelsPerMeter(e,t)/n}createTileMatrix(e,t,r){const n=ep($h(r.canonical));return ml(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,t){const{center:r}=e,n=dl(new Float64Array(16));return ml(n,n,Jh($h(t))),xl(n,n,A(r.lng)),yl(n,n,A(r.lat)),gl(n,n,[e._projectionScaler,e._projectionScaler,1]),Float32Array.from(n)}pointCoordinate(e,t,r,n){return Nh(e,t,r,!0)||new Ls(0,0)}pointCoordinate3D(e,t,r){const n=this.pointCoordinate(e,t,r,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,t){return!Nh(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const r=e.cameraToCenterDistance,n=e._centerAltitude*t,i=e._camera,s=e._camera.forward(),a=Cl([],Dl([],s,-r),[0,0,n]),o=e.worldSize/(2*Math.PI),l=[0,0,-o],u=e.width/e.height,A=Math.tan(e.fovAboveCenter),c=Dl([],i.up(),A),p=Dl([],i.right(),A*u),h=Pl([],Cl([],Cl([],s,c),p)),d=[];let f;if(new Wl(a,h).closestPointOnSphere(l,o,d)){const t=Cl([],d,l),r=Vl([],t,a);f=Math.cos(e.fovAboveCenter)*El(r)}else{const e=Vl([],a,l),t=Vl([],l,a);Pl(t,t);const r=El(e)-o;f=Math.sqrt(r*(r+2*o));const n=Math.acos(f/(o+r))-Math.acos(Ll(s,t));f*=Math.cos(n)}return 1.01*f}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=ip(e.zoom);if(r>0){const n=lp(e,ks(1,e.center.lat)*e.worldSize),i=e.worldSize/(2*Math.PI),s=Math.max(e.width,e.height)/e.worldSize*Math.PI;return _i(t,n+i*(1-Math.cos(s)),Math.pow(r,10))}return t}upVector(e,t,r){const n=1<<e.z,i=(t/bs+e.x)/n;return Xh(Ds((r/bs+e.y)/n),zs(i),1)}upVectorScale(e){return{metersToTile:Oh*Kh($h(e))}}}function kp(e){const t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new wp(e);case"equirectangular":return new yp(e);case"naturalEarth":return new Ep(e);case"equalEarth":return new gp(e);case"winkelTripel":return new Cp(e);case"albers":return r?new Ip(e):new hp(e);case"lambertConformalConic":return r?new Ip(e):new bp(e);case"globe":return new Sp(e)}throw new Error(`Invalid projection name: ${e.name}`)}const zp=hc.VectorTileFeature.types,Dp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bp(e,t,r,n,i,s,a,o,l,u,A,c,p){const h=o?Math.min(Ch,Math.round(o[0])):0,d=o?Math.min(Ch,Math.round(o[1])):0;e.emplaceBack(t,r,Math.round(32*n),Math.round(32*i),s,a,(h<<1)+(l?1:0),d,16*u,16*A,256*c,256*p)}function Pp(e,t,r,n,i,s,a){e.emplaceBack(t,r,n,i,s,a)}function Lp(e,t,r,n,i){e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i)}function Rp(e){for(const t of e.sections)if(yo(t.text))return!0;return!1}class Fp{constructor(e){this.layoutVertexArray=new sa,this.indexArray=new fa,this.programConfigurations=e,this.segments=new vs,this.dynamicLayoutVertexArray=new ra,this.opacityVertexArray=new Aa,this.placedSymbolArray=new ka,this.globeExtVertexArray=new la}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,r,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,$c.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Dp,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,qc.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Dn(Fp,"SymbolBuffers");class Op{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new vs,this.collisionVertexArray=new pa,this.collisionVertexArrayExt=new da}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Qc.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Hc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Dn(Op,"CollisionBuffers");class Up{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=dl([]),this.placementViewportMatrix=dl([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jc(this.zoom,t["text-size"]),this.iconSizeData=Jc(this.zoom,t["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map((e=>Pu[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Fp(new us(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Fp(new us(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Ba,this.lineVertexArray=new Pa,this.symbolInstances=new Da}calculateGlyphDependencies(e,t,r,n,i){for(let r=0;r<e.length;r++)if(t[e.charCodeAt(r)]=!0,n&&i){const n=ru[e.charAt(r)];n&&(t[n.charCodeAt(0)]=!0)}}populate(e,t,r,n){const i=this.layers[0],s=i.layout,a="globe"===this.projection.name,o=s.get("text-font"),l=s.get("text-field"),u=s.get("icon-image"),A=("constant"!==l.value.kind||l.value.value instanceof vt&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),c="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,p=s.get("symbol-sort-key");if(this.features=[],!A&&!c)return;const h=t.iconDependencies,d=t.glyphDependencies,f=t.availableImages,m=new Do(this.zoom);for(const{feature:t,id:l,index:u,sourceLayerIndex:g}of e){const e=i._featureFilter.needGeometry,_=Zs(t,e);if(!i._featureFilter.filter(m,_,r))continue;if(e||(_.geometry=Ns(t,r,n)),a&&1!==t.type&&r.z<=5){const e=_.geometry,t=1<<r.z,n=r.x,i=r.y,s=.98078528056;for(let r=0;r<e.length;r++)e[r]=Us(e[r],(e=>e),((e,r)=>Ll(Xh(Ds((e.y/bs+i)/t),zs((e.x/bs+n)/t),1),Xh(Ds((r.y/bs+i)/t),zs((r.x/bs+n)/t),1))<s))}let y,b;if(A){const e=i.getValueAndResolveTokens("text-field",_,r,f),t=vt.factory(e);Rp(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===So()||this.hasRTLText&&zo.isParsed())&&(y=iu(t,i,_))}if(c){const e=i.getValueAndResolveTokens("icon-image",_,r,f);b=e instanceof bt?e:bt.fromString(e)}if(!y&&!b)continue;const x=this.sortFeaturesByKey?p.evaluate(_,{},r):void 0;if(this.features.push({id:l,text:y,icon:b,index:u,sourceLayerIndex:g,geometry:_.geometry,properties:t.properties,type:zp[t.type],sortKey:x}),b&&(h[b.name]=!0),y){const e=o.evaluate(_,{},r).join(","),t="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pu.vertical)>=0;for(const r of y.sections)if(r.image)h[r.image.name]=!0;else{const n=uo(y.toString()),i=r.fontStack||e,s=d[i]=d[i]||{};this.calculateGlyphDependencies(r.text,s,t,this.allowVerticalPlacement,n)}}}"line"===s.get("symbol-placement")&&(this.features=function(e){const t={},r={},n=[];let i=0;function s(t){n.push(e[t]),i++}function a(e,t,i){const s=r[e];return delete r[e],r[t]=s,n[s].geometry[0].pop(),n[s].geometry[0]=n[s].geometry[0].concat(i[0]),s}function o(e,r,i){const s=t[r];return delete t[r],t[e]=s,n[s].geometry[0].shift(),n[s].geometry[0]=i[0].concat(n[s].geometry[0]),s}function l(e,t,r){const n=r?t[0][t[0].length-1]:t[0][0];return`${e}:${n.x}:${n.y}`}for(let u=0;u<e.length;u++){const A=e[u],c=A.geometry,p=A.text?A.text.toString():null;if(!p){s(u);continue}const h=l(p,c),d=l(p,c,!0);if(h in r&&d in t&&r[h]!==t[d]){const e=o(h,d,c),i=a(h,d,n[e].geometry);delete t[h],delete r[d],r[l(p,n[i].geometry,!0)]=i,n[e].geometry=null}else h in r?a(h,d,c):d in t?o(h,d,c):(s(u),t[h]=i-1,r[d]=i-1)}return n.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=kp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const r=this.lineVertexArray.length,n=e.segment;if(void 0!==n){let r=e.dist(t[n+1]),i=e.dist(t[n]);const s={};for(let e=n+1;e<t.length;e++)s[e]={x:t[e].x,y:t[e].y,tileUnitDistanceFromAnchor:r},e<t.length-1&&(r+=t[e+1].dist(t[e]));for(let e=n||0;e>=0;e--)s[e]={x:t[e].x,y:t[e].y,tileUnitDistanceFromAnchor:i},e>0&&(i+=t[e-1].dist(t[e]));for(let e=0;e<t.length;e++){const t=s[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,t,r,n,i,s,a,o,l,u,A,c,p,h){const d=e.indexArray,f=e.layoutVertexArray,m=e.globeExtVertexArray,g=e.segments.prepareSegment(4*t.length,f,d,this.canOverlap?s.sortKey:void 0),_=this.glyphOffsetArray.length,y=g.vertexLength,b=this.allowVerticalPlacement&&a===Pu.vertical?Math.PI/2:0,x=s.text&&s.text.sections;for(let n=0;n<t.length;n++){const{tl:i,tr:a,bl:u,br:A,tex:c,pixelOffsetTL:_,pixelOffsetBR:y,minFontScaleX:v,minFontScaleY:w,glyphOffset:T,isSDF:E,sectionIndex:M}=t[n],C=g.vertexLength,I=T[1];if(Bp(f,l.x,l.y,i.x,I+i.y,c.x,c.y,r,E,_.x,_.y,v,w),Bp(f,l.x,l.y,a.x,I+a.y,c.x+c.w,c.y,r,E,y.x,_.y,v,w),Bp(f,l.x,l.y,u.x,I+u.y,c.x,c.y+c.h,r,E,_.x,y.y,v,w),Bp(f,l.x,l.y,A.x,I+A.y,c.x+c.w,c.y+c.h,r,E,y.x,y.y,v,w),o){const t=o.anchor,r=o.up;Pp(m,t.x,t.y,t.z,r[0],r[1],r[2]),Pp(m,t.x,t.y,t.z,r[0],r[1],r[2]),Pp(m,t.x,t.y,t.z,r[0],r[1],r[2]),Pp(m,t.x,t.y,t.z,r[0],r[1],r[2]),Lp(e.dynamicLayoutVertexArray,t.x,t.y,t.z,b)}else Lp(e.dynamicLayoutVertexArray,l.x,l.y,l.z,b);d.emplaceBack(C,C+1,C+2),d.emplaceBack(C+1,C+2,C+3),g.vertexLength+=4,g.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(T[0]),n!==t.length-1&&M===t[n+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,s,s.index,{},p,h,x&&x[M])}const v=o?o.anchor:l;e.placedSymbolArray.emplaceBack(v.x,v.y,v.z,l.x,l.y,_,this.glyphOffsetArray.length-_,y,u,A,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,0,!1,0,c,0)}_commitLayoutVertex(e,t,r,n,i,s,a){e.emplaceBack(t,r,n,i,s,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(e,t,r,n,s,a,o){const l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),u=l.vertexLength,A=o.tileAnchorX,c=o.tileAnchorY;for(let e=0;e<4;e++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,A,c,new i(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,A,c,new i(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,A,c,new i(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,s,a,A,c,new i(e.x1,e.y2)),l.vertexLength+=4;const p=r.indexArray;p.emplaceBack(u,u+1),p.emplaceBack(u+1,u+2),p.emplaceBack(u+2,u+3),p.emplaceBack(u+3,u),l.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,r,n,i,s){for(let a=n;a<i;a++){const n=r.get(a),i=this.getSymbolInstanceTextSize(e,s,t,a);this._addCollisionDebugVertices(n,i,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s)}}_addIconDebugCollisionBoxes(e,t,r,n,i,s){for(let a=n;a<i;a++){const n=r.get(a),i=this.getSymbolInstanceIconSize(e,t,a);this._addCollisionDebugVertices(n,i,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Op(ua,Wc.members,ba),this.iconCollisionBox=new Op(ua,Wc.members,ba);const r=th(this.iconSizeData,e),n=th(this.textSizeData,e);for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(n,e,t,s.textBoxStartIndex,s.textBoxEndIndex,s),this._addTextDebugCollisionBoxes(n,e,t,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._addIconDebugCollisionBoxes(r,e,t,s.iconBoxStartIndex,s.iconBoxEndIndex,s),this._addIconDebugCollisionBoxes(r,e,t,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s)}}getSymbolInstanceTextSize(e,t,r,n){const i=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n),s=eu(this.textSizeData,e,i)/Yc;return this.tilePixelRatio*s}getSymbolInstanceIconSize(e,t,r){const n=this.icon.placedSymbolArray.get(r),i=eu(this.iconSizeData,e,n);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(e,t,r){e.emplaceBack(t,-r,-r),e.emplaceBack(t,r,-r),e.emplaceBack(t,r,r),e.emplaceBack(t,-r,r)}_updateTextDebugCollisionBoxes(e,t,r,n,i,s){for(let a=n;a<i;a++){const n=r.get(a),i=this.getSymbolInstanceTextSize(e,s,t,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,n.padding)}}_updateIconDebugCollisionBoxes(e,t,r,n,i){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceIconSize(e,t,s);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,n.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=th(this.iconSizeData,e),n=th(this.textSizeData,e);for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this._updateTextDebugCollisionBoxes(n,e,t,s.textBoxStartIndex,s.textBoxEndIndex,s),this._updateTextDebugCollisionBoxes(n,e,t,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._updateIconDebugCollisionBoxes(r,e,t,s.iconBoxStartIndex,s.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(r,e,t,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,r,n,i,s,a,o,l){const u={};for(let n=t;n<r;n++){const t=e.get(n);u.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,padding:t.padding,projectedAnchorX:t.projectedAnchorX,projectedAnchorY:t.projectedAnchorY,projectedAnchorZ:t.projectedAnchorZ,tileAnchorX:t.tileAnchorX,tileAnchorY:t.tileAnchorY},u.textFeatureIndex=t.featureIndex;break}for(let t=n;t<i;t++){const r=e.get(t);u.verticalTextBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,padding:r.padding,projectedAnchorX:r.projectedAnchorX,projectedAnchorY:r.projectedAnchorY,projectedAnchorZ:r.projectedAnchorZ,tileAnchorX:r.tileAnchorX,tileAnchorY:r.tileAnchorY},u.verticalTextFeatureIndex=r.featureIndex;break}for(let t=s;t<a;t++){const r=e.get(t);u.iconBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,padding:r.padding,projectedAnchorX:r.projectedAnchorX,projectedAnchorY:r.projectedAnchorY,projectedAnchorZ:r.projectedAnchorZ,tileAnchorX:r.tileAnchorX,tileAnchorY:r.tileAnchorY},u.iconFeatureIndex=r.featureIndex;break}for(let t=o;t<l;t++){const r=e.get(t);u.verticalIconBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,padding:r.padding,projectedAnchorX:r.projectedAnchorX,projectedAnchorY:r.projectedAnchorY,projectedAnchorZ:r.projectedAnchorZ,tileAnchorX:r.tileAnchorX,tileAnchorY:r.tileAnchorY},u.verticalIconFeatureIndex=r.featureIndex;break}return u}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const r=e.placedSymbolArray.get(t),n=r.vertexStartIndex+4*r.numGlyphs;for(let t=r.vertexStartIndex;t<n;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),n=[],i=[],s=[];for(let e=0;e<this.symbolInstances.length;++e){s.push(e);const a=this.symbolInstances.get(e);n.push(0|Math.round(t*a.tileAnchorX+r*a.tileAnchorY)),i.push(a.featureIndex)}return s.sort(((e,t)=>n[e]-n[t]||i[t]-i[e])),s}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,r)=>{e>=0&&r.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Dn(Up,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Up.MAX_GLYPHS=65535,Up.addDynamicAttributes=Lp;const Vp=new $o({"symbol-placement":new jo(Ne.layout_symbol["symbol-placement"]),"symbol-spacing":new jo(Ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jo(Ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Go(Ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jo(Ne.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jo(Ne.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jo(Ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new jo(Ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jo(Ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new Go(Ne.layout_symbol["icon-size"]),"icon-text-fit":new jo(Ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jo(Ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new Go(Ne.layout_symbol["icon-image"]),"icon-rotate":new Go(Ne.layout_symbol["icon-rotate"]),"icon-padding":new jo(Ne.layout_symbol["icon-padding"]),"icon-keep-upright":new jo(Ne.layout_symbol["icon-keep-upright"]),"icon-offset":new Go(Ne.layout_symbol["icon-offset"]),"icon-anchor":new Go(Ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jo(Ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jo(Ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jo(Ne.layout_symbol["text-rotation-alignment"]),"text-field":new Go(Ne.layout_symbol["text-field"]),"text-font":new Go(Ne.layout_symbol["text-font"]),"text-size":new Go(Ne.layout_symbol["text-size"]),"text-max-width":new Go(Ne.layout_symbol["text-max-width"]),"text-line-height":new Go(Ne.layout_symbol["text-line-height"]),"text-letter-spacing":new Go(Ne.layout_symbol["text-letter-spacing"]),"text-justify":new Go(Ne.layout_symbol["text-justify"]),"text-radial-offset":new Go(Ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jo(Ne.layout_symbol["text-variable-anchor"]),"text-anchor":new Go(Ne.layout_symbol["text-anchor"]),"text-max-angle":new jo(Ne.layout_symbol["text-max-angle"]),"text-writing-mode":new jo(Ne.layout_symbol["text-writing-mode"]),"text-rotate":new Go(Ne.layout_symbol["text-rotate"]),"text-padding":new jo(Ne.layout_symbol["text-padding"]),"text-keep-upright":new jo(Ne.layout_symbol["text-keep-upright"]),"text-transform":new Go(Ne.layout_symbol["text-transform"]),"text-offset":new Go(Ne.layout_symbol["text-offset"]),"text-allow-overlap":new jo(Ne.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jo(Ne.layout_symbol["text-ignore-placement"]),"text-optional":new jo(Ne.layout_symbol["text-optional"])});var jp={paint:new $o({"icon-opacity":new Go(Ne.paint_symbol["icon-opacity"]),"icon-color":new Go(Ne.paint_symbol["icon-color"]),"icon-halo-color":new Go(Ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new Go(Ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Go(Ne.paint_symbol["icon-halo-blur"]),"icon-translate":new jo(Ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new jo(Ne.paint_symbol["icon-translate-anchor"]),"text-opacity":new Go(Ne.paint_symbol["text-opacity"]),"text-color":new Go(Ne.paint_symbol["text-color"],{runtimeType:tt,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Go(Ne.paint_symbol["text-halo-color"]),"text-halo-width":new Go(Ne.paint_symbol["text-halo-width"]),"text-halo-blur":new Go(Ne.paint_symbol["text-halo-blur"]),"text-translate":new jo(Ne.paint_symbol["text-translate"]),"text-translate-anchor":new jo(Ne.paint_symbol["text-translate-anchor"])}),layout:Vp};class Gp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ye,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dn(Gp,"FormatSectionOverride",{omit:["defaultValue"]});class Np extends gs{constructor(e){super(e,jp)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const e=[];for(const t of r)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,n){const i=this.layout.get(e).evaluate(t,{},r,n),s=this._unevaluatedLayout._values[e];return s.isDataDriven()||Lr(s.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,((t,r)=>r in e?String(e[r]):""))}(t.properties,i)}createBucket(e){return new Up(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of jp.paint.overridableProperties){if(!Np.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),r=new Gp(t),n=new Pr(r,t.property.specification);let i=null;i="constant"===t.value.kind||"source"===t.value.kind?new Fr("source",n):new Or("composite",n,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Uo(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&Np.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const r=e.get("text-field"),n=jp.paint.properties[t];let i=!1;const s=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof vt)s(r.value.value.sections);else if("source"===r.value.kind){const e=t=>{i||(t instanceof It&&Et(t.value)===at?s(t.value.sections):t instanceof Bt?s(t.sections):t.eachChild(e))},t=r.value;t._styleExpression&&e(t._styleExpression.expression)}return i}getProgramConfiguration(e){return new cs(this,e)}}var Zp={paint:new $o({"background-color":new jo(Ne.paint_background["background-color"]),"background-pattern":new Zo(Ne.paint_background["background-pattern"]),"background-opacity":new jo(Ne.paint_background["background-opacity"])})},qp={paint:new $o({"raster-opacity":new jo(Ne.paint_raster["raster-opacity"]),"raster-hue-rotate":new jo(Ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jo(Ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jo(Ne.paint_raster["raster-brightness-max"]),"raster-saturation":new jo(Ne.paint_raster["raster-saturation"]),"raster-contrast":new jo(Ne.paint_raster["raster-contrast"]),"raster-resampling":new jo(Ne.paint_raster["raster-resampling"]),"raster-fade-duration":new jo(Ne.paint_raster["raster-fade-duration"])})};class $p extends gs{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Qp={paint:new $o({"sky-type":new jo(Ne.paint_sky["sky-type"]),"sky-atmosphere-sun":new jo(Ne.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new jo(Ne.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new jo(Ne.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new jo(Ne.paint_sky["sky-gradient-radius"]),"sky-gradient":new qo(Ne.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new jo(Ne.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new jo(Ne.paint_sky["sky-atmosphere-color"]),"sky-opacity":new jo(Ne.paint_sky["sky-opacity"])})};function Hp(e,t,r){const n=[0,0,1],i=$l([]);return Hl(i,i,r?-A(e)+Math.PI:A(e)),Ql(i,i,-A(t)),Ol(n,n,i),Pl(n,n)}const Wp={circle:class extends gs{constructor(e){super(e,cl)}createBucket(e){return new Qs(e)}queryRadius(e){const t=e;return sl("circle-radius",this,t)+sl("circle-stroke-width",this,t)+ll(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,n,i,s,a,o){const l=Al(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return Jl(e,n,s,a,o,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,u)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new cs(this,e)}},heatmap:class extends gs{createBucket(e){return new nA(e)}constructor(e){super(e,cA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=uA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return sl("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,n,s,a,o,l){const u=this.paint.get("heatmap-radius").evaluate(t,r);return Jl(e,n,a,o,l,!0,!0,new i(0,0),u)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new cs(this,e)}},hillshade:class extends gs{constructor(e){super(e,hA)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends gs{constructor(e){super(e,JA)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(e){return new cs(this,e)}recalculate(e,t){super.recalculate(e,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new YA(e)}queryRadius(){return ll(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,n,i,s){return!e.queryGeometry.isAboveHorizon&&Xs(ol(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends gs{constructor(e){super(e,wc)}createBucket(e){return new yc(e)}queryRadius(){return ll(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new cs(this,e)}queryIntersectsFeature(e,t,r,n,s,a,o,l,u){const A=Al(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),c=this.paint.get("fill-extrusion-height").evaluate(t,r),p=this.paint.get("fill-extrusion-base").evaluate(t,r),h=[0,0],d=l&&a.elevation,f=a.elevation?a.elevation.exaggeration():1,m=e.tile.getBucket(this);if(d&&m instanceof yc){const e=m.centroidVertexArray,t=u+1;if(t<e.length){const r=e.get(t);h[0]=r.a_centroid_pos0,h[1]=r.a_centroid_pos1}}if(0===h[0]&&1===h[1])return!1;"globe"===a.projection.name&&(n=bc([n],[new i(0,0),new i(bs,bs)],e.tileID.canonical).map((e=>e.polygon)).flat());const g=function(e,t,r,n,s,a,o,l,u,A,c){return"globe"===e.projection.name?function(e,t,r,n,i,s,a,o,l,u,A){const c=[],p=[],h=e.projection.upVectorScale(A,e.center.lat,e.worldSize).metersToTile,d=[0,0,0,1],f=[0,0,0,1],m=(e,t,r,n)=>{e[0]=t,e[1]=r,e[2]=n,e[3]=1},g=vc();r>0&&(r+=g),n+=g;for(const g of t){const t=[],_=[];for(const c of g){const p=c.x+i.x,g=c.y+i.y,y=e.projection.projectTilePoint(p,g,A),b=e.projection.upVector(A,c.x,c.y);let x=r,v=n;if(a){const e=Dc(p,g,r,n,a,o,l,u);x+=e.base,v+=e.top}0!==r?m(d,y.x+b[0]*h*x,y.y+b[1]*h*x,y.z+b[2]*h*x):m(d,y.x,y.y,y.z),m(f,y.x+b[0]*h*v,y.y+b[1]*h*v,y.z+b[2]*h*v),Fl(d,d,s),Fl(f,f,s),t.push(zc(d)),_.push(zc(f))}c.push(t),p.push(_)}return[c,p]}(e,t,r,n,s,a,o,l,u,A,c):o?function(e,t,r,n,i,s,a,o,l){const u=[],A=[],c=[0,0,0,1];for(const p of e){const e=[],h=[];for(const u of p){const A=u.x+n.x,p=u.y+n.y,d=Dc(A,p,t,r,s,a,o,l);c[0]=A,c[1]=p,c[2]=d.base,c[3]=1,Zl(c,c,i),c[3]=Math.max(c[3],1e-5);const f=zc([c[0]/c[3],c[1]/c[3],c[2]/c[3]]);c[0]=A,c[1]=p,c[2]=d.top,c[3]=1,Zl(c,c,i),c[3]=Math.max(c[3],1e-5);const m=zc([c[0]/c[3],c[1]/c[3],c[2]/c[3]]);e.push(f),h.push(m)}u.push(e),A.push(h)}return[u,A]}(t,r,n,s,a,o,l,u,A):function(e,t,r,n,s){const a=[],o=[],l=s[8]*t,u=s[9]*t,A=s[10]*t,c=s[11]*t,p=s[8]*r,h=s[9]*r,d=s[10]*r,f=s[11]*r;for(const t of e){const e=[],r=[];for(const a of t){const t=a.x+n.x,o=a.y+n.y,m=s[0]*t+s[4]*o+s[12],g=s[1]*t+s[5]*o+s[13],_=s[2]*t+s[6]*o+s[14],y=s[3]*t+s[7]*o+s[15],b=m+l,x=g+u,v=_+A,w=Math.max(y+c,1e-5),T=m+p,E=g+h,M=_+d,C=Math.max(y+f,1e-5),I=new i(b/w,x/w);I.z=v/w,e.push(I);const S=new i(T/C,E/C);S.z=M/C,r.push(S)}a.push(e),o.push(r)}return[a,o]}(t,r,n,s,a)}(a,n,p,c,A,o,d?l:null,h,f,a.center.lat,e.tileID.canonical),_=e.queryGeometry;return function(e,t,r){let n=1/0;Xs(r,t)&&(n=kc(r,t[0]));for(let i=0;i<t.length;i++){const s=t[i],a=e[i];for(let e=0;e<s.length-1;e++){const t=s[e],i=[t,s[e+1],a[e+1],a[e],t];Hs(r,i)&&(n=Math.min(n,kc(r,i)))}}return n!==1/0&&n}(g[0],g[1],_.isPointQuery()?_.screenBounds:_.screenGeometry)}},line:class extends gs{constructor(e){super(e,jc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof mi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Gc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Uc(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new cs(this,e)}queryRadius(e){const t=e,r=Nc(sl("line-width",this,t),sl("line-gap-width",this,t)),n=sl("line-offset",this,t);return r/2+Math.abs(n)+ll(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,n,s,a){if(e.queryGeometry.isAboveHorizon)return!1;const o=ol(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),l=e.pixelToTileUnitsFactor/2*Nc(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),u=this.paint.get("line-offset").evaluate(t,r);return u&&(n=function(e,t){const r=[],n=new i(0,0);for(let i=0;i<e.length;i++){const s=e[i],a=[];for(let e=0;e<s.length;e++){const r=s[e-1],i=s[e],o=s[e+1],l=0===e?n:i.sub(r)._unit()._perp(),u=e===s.length-1?n:o.sub(i)._unit()._perp(),A=l._add(u)._unit();A._mult(1/(A.x*u.x+A.y*u.y)),a.push(A._mult(t)._add(i))}r.push(a)}return r}(n,u*e.pixelToTileUnitsFactor)),function(e,t,r){for(let n=0;n<t.length;n++){const i=t[n];if(e.length>=3)for(let t=0;t<i.length;t++)if(rl(e,i[t]))return!0;if(Ys(e,i,r))return!0}return!1}(o,n,l)}isTileClipped(){return!0}},symbol:Np,background:class extends gs{constructor(e){super(e,Zp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends gs{constructor(e){super(e,qp)}getProgramIds(){return["raster"]}},sky:class extends gs{constructor(e){super(e,Qp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=uA({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),n=!r,i=e.style.light,s=i.properties.get("position");return n&&"viewport"===i.properties.get("anchor")&&D("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?Hp(s.azimuthal,90-s.polar,t):Hp(r[0],90-r[1],t)}const r=this.paint.get("sky-gradient-center");return Hp(r[0],90-r[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}};class Xp{constructor(e,t,r,n){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,n)}update(e,t,n){const{width:i,height:s}=e,{context:a}=this,{gl:o}=a,{HTMLImageElement:l,HTMLCanvasElement:u,HTMLVideoElement:A,ImageData:c,ImageBitmap:p}=r;if(o.bindTexture(o.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!t||!1!==t.premultiply)),n||this.size&&this.size[0]===i&&this.size[1]===s){const{x:t,y:r}=n||{x:0,y:0};e instanceof l||e instanceof u||e instanceof A||e instanceof c||p&&e instanceof p?o.texSubImage2D(o.TEXTURE_2D,0,t,r,o.RGBA,o.UNSIGNED_BYTE,e):o.texSubImage2D(o.TEXTURE_2D,0,t,r,i,s,o.RGBA,o.UNSIGNED_BYTE,e.data)}else this.size=[i,s],e instanceof l||e instanceof u||e instanceof A||e instanceof c||p&&e instanceof p?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,e):o.texImage2D(o.TEXTURE_2D,0,this.format,i,s,0,this.format,o.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(e,t){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Yp{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new lA({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const r=this.getKey(e,t);return this.positions[r]}trim(){const e=this.width,t=this.height=T(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,r){const n=[];let i=e.length%2==1?-e[e.length-1]*r:0,s=e[0]*r,a=!0;n.push({left:i,right:s,isDash:a,zeroLength:0===e[0]});let o=e[0];for(let t=1;t<e.length;t++){a=!a;const l=e[t];i=o*r,o+=l,s=o*r,n.push({left:i,right:s,isDash:a,zeroLength:0===l})}return n}addRoundDash(e,t,r){const n=t/2;for(let t=-r;t<=r;t++){const i=this.width*(this.nextRow+r+t);let s=0,a=e[s];for(let o=0;o<this.width;o++){o/a.right>1&&(a=e[++s]);const l=Math.abs(o-a.left),u=Math.abs(o-a.right),A=Math.min(l,u);let c;const p=t/r*(n+1);if(a.isDash){const e=n-Math.abs(p);c=Math.sqrt(A*A+e*e)}else c=n-Math.sqrt(A*A+p*p);this.image.data[i+o]=Math.max(0,Math.min(255,c+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const r=e[t],n=e[t+1];r.zeroLength?e.splice(t,1):n&&n.isDash===r.isDash&&(n.left=r.left,e.splice(t,1))}const r=e[0],n=e[e.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);const i=this.width*this.nextRow;let s=0,a=e[s];for(let r=0;r<this.width;r++){r/a.right>1&&(a=e[++s]);const n=Math.abs(r-a.left),o=Math.abs(r-a.right),l=Math.min(n,o);this.image.data[i+r]=Math.max(0,Math.min(255,(a.isDash?l:-l)+t+128))}}addDash(e,t){const r=this.getKey(e,t);if(this.positions[r])return this.positions[r];const n="round"===t,i=n?7:0,s=2*i+1;if(this.nextRow+s>this.height)return D("LineAtlas out of space"),null;0===e.length&&e.push(1);let a=0;for(let t=0;t<e.length;t++)e[t]<0&&(D("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),a+=e[t];if(0!==a){const r=this.width/a,s=this.getDashRanges(e,this.width,r);n?this.addRoundDash(s,r,i):this.addRegularDash(s,"square"===t?.5*r:0)}const o=this.nextRow+i;this.nextRow+=s;const l={tl:[o,i],br:[a,0]};return this.positions[r]=l,l}}Dn(Yp,"LineAtlas");class Kp{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Jp{constructor(){this.tasks={},this.taskQueue=[],M(["process"],this),this.invoker=new Kp(this.process),this.nextId=0}add(e,t){const r=this.nextId++,n=function({type:e,isSymbolTile:t,zoom:r}){return r=r||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-r:"maybePrepare"===e&&t?400-r:500:200-r:100-r}(t);if(0===n){L();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:t,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){L();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let r=0;r<this.taskQueue.length;r++){const n=this.tasks[this.taskQueue[r]];n.priority<t&&(t=n.priority,e=r)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class td{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const ed=["tile","layer","source","sourceLayer","state"];class id{constructor(e,t,r,n,i){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=r,this._y=n,this.properties=e.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of ed)void 0!==this[t]&&(e[t]=this[t]);return e}}const rd=32,nd=33,od=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,r=0,n=0,i=0,s=0,a=0,o=0;for(1&t?i=s=a=rd:r=n=o=rd;(t>>=1)>1;){const e=r+i>>1,l=n+s>>1;1&t?(i=r,s=n,r=a,n=o):(r=i,n=s,i=a,s=o),a=e,o=l}const l=4*e;od[l+0]=r,od[l+1]=n,od[l+2]=i,od[l+3]=s}const ad=new Uint16Array(2178),sd=new Uint8Array(1089),ld=new Uint16Array(1089);function Ad(e){return 0===e?-.03125:32===e?.03125:0}var cd=Yo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ud={type:2,extent:bs,loadGeometry:()=>[[new i(0,0),new i(8193,0),new i(8193,8193),new i(0,8193),new i(0,0)]]};class hd{constructor(e,t,r,n,i){this.tileID=e,this.uid=v(),this.uses=0,this.tileSize=t,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=i,this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<H.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ap(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const r={};if(!t)return r;for(const n of e){const e=n.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)r[t.id]=n}}return r}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof Up){if(this.hasSymbolBuckets=!0,!r)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof Up&&t.hasRTLText){this.hasRTLText=!0,zo.isLoading()||zo.isLoaded()||"deferred"!==So()||ko();break}}this.queryPadding=0;for(const e in this.buckets){const r=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(r))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ia}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const r=this.buckets[t];r.uploadPending()&&r.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Xp(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Xp(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Xp(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,r,n,i,s,a,o){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:a,transform:s,params:i,tileTransform:this.tileTransform},e,t,r):{}}querySourceFeatures(e,t){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),i=t?t.sourceLayer:"",s=n._geojsonTileLayer||n[i];if(!s)return;const a=Yr(t&&t.filter),{z:o,x:l,y:u}=this.tileID.canonical,A={z:o,x:l,y:u};for(let t=0;t<s.length;t++){const n=s.feature(t);if(a.needGeometry){const e=Zs(n,!0);if(!a.filter(new Do(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new Do(this.tileID.overscaledZ),n))continue;const c=r.getId(n,i),p=new id(n,o,l,u,c);p.tile=A,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=R(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let r=!1;if(this.expirationTime>e)r=!1;else if(t)if(this.expirationTime<t)r=!0;else{const n=this.expirationTime-t;n?this.expirationTime=e+Math.max(n,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!t)return;const r=this.latestFeatureIndex.loadVTLayers(),n=t.style.listImages();for(const i in this.buckets){if(!t.style.hasLayer(i))continue;const s=this.buckets[i],a=s.layers[0].sourceLayer||"_geojsonTileLayer",o=r[a],l=e[a];if(!o||!l||0===Object.keys(l).length)continue;if(s.update(l,o,n,this.imageAtlas&&this.imageAtlas.patternPositions||{}),s instanceof Uc||s instanceof YA){const e=t.style._getSourceCache(s.layers[0].source);t._terrain&&t._terrain.enabled&&e&&s.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const u=t&&t.style&&t.style.getLayer(i);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(s)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<H.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=H.now()+e}setTexture(e,t){const r=t.context,n=r.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Xp(r,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}setDependencies(e,t){const r={};for(const e of t)r[e]=!0;this.dependencies[e]=r}hasDependency(e,t){for(const r of e){const e=this.dependencies[r];if(e)for(const r of t)if(e[r])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const r=Ns(ud,this.tileID.canonical,this.tileTransform)[0],n=new Jo,i=new wa;for(let e=0;e<r.length;e++){const{x:t,y:s}=r[e];n.emplaceBack(t,s),i.emplaceBack(e)}i.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(i),this._tileDebugBuffer=e.createVertexBuffer(n,Rh.members),this._tileDebugSegments=vs.simpleSegment(0,0,n.length,i.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const r=Ns(ud,this.tileID.canonical,this.tileTransform)[0];let n,i;if(this.isRaster){const e=function(e,t){const r=Ap(e,t),n=Math.pow(2,e.z);for(let i=0;i<nd;i++)for(let s=0;s<nd;s++){const a=zs((e.x+(s+Ad(s))/rd)/n),o=Ds((e.y+(i+Ad(i))/rd)/n),l=t.project(a,o),u=i*nd+s;ad[2*u+0]=Math.round((l.x*r.scale-r.x)*bs),ad[2*u+1]=Math.round((l.y*r.scale-r.y)*bs)}sd.fill(0),ld.fill(0);for(let e=2045;e>=0;e--){const t=4*e,r=od[t+0],n=od[t+1],i=od[t+2],s=od[t+3],a=r+i>>1,o=n+s>>1,l=a+o-n,u=o+r-a,A=n*nd+r,c=s*nd+i,p=o*nd+a,h=Math.hypot((ad[2*A+0]+ad[2*c+0])/2-ad[2*p+0],(ad[2*A+1]+ad[2*c+1])/2-ad[2*p+1])>=16;if(sd[p]=sd[p]||(h?1:0),e<1022){const e=(n+u>>1)*nd+(r+l>>1),t=(s+u>>1)*nd+(i+l>>1);sd[p]=sd[p]||sd[e]||sd[t]}}const i=new ta,s=new fa;let a=0;function o(e,t){const r=t*nd+e;return 0===ld[r]&&(i.emplaceBack(ad[2*r+0],ad[2*r+1],e*bs/rd,t*bs/rd),ld[r]=++a),ld[r]-1}function l(e,t,r,n,i,a){const u=e+r>>1,A=t+n>>1;if(Math.abs(e-i)+Math.abs(t-a)>1&&sd[A*nd+u])l(i,a,e,t,u,A),l(r,n,i,a,u,A);else{const l=o(e,t),u=o(r,n),A=o(i,a);s.emplaceBack(l,u,A)}}return l(0,0,rd,rd,rd,0),l(rd,rd,0,0,0,rd),{vertices:i,indices:s}}(this.tileID.canonical,t);n=e.vertices,i=e.indices}else{n=new ta,i=new fa;for(const{x:e,y:t}of r)n.emplaceBack(e,t,0,0);const e=fA(n.int16,void 0,4);for(let t=0;t<e.length;t+=3)i.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(n,cd.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(i),this._tileBoundsSegments=vs.simpleSegment(0,0,n.length,i.length)}_makeGlobeTileDebugBuffers(e,t){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!t||"globe"!==t.name)return;const r=this.tileID.canonical,n=Jh($h(r));this._makeGlobeTileDebugBorderBuffer(e,r,n),this._makeGlobeTileDebugTextBuffer(e,r,n)}_makeGlobeTileDebugBorderBuffer(e,t,r){const n=new Jo,i=new wa,s=new ea,a=(e,a,o,l,u)=>{const A=(o-e)/(u-1),c=(l-a)/(u-1),p=n.length;for(let o=0;o<u;o++){const l=e+o*A,u=a+o*c;n.emplaceBack(l,u);const h=Yh(l,u,t),d=Fl(h,h,r);s.emplaceBack(d[0],d[1],d[2]),i.emplaceBack(p+o)}},o=bs;a(0,0,o,0,16),a(o,0,o,o,16),a(o,o,0,o,16),a(0,o,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(i),this._tileDebugBuffer=e.createVertexBuffer(n,Rh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(s,Lh.members),this._tileDebugSegments=vs.simpleSegment(0,0,n.length,i.length)}_makeGlobeTileDebugTextBuffer(e,t,r){const n=new Jo,i=new fa,s=new ea,a=25;i.reserve(32),n.reserve(a),s.reserve(a);const o=(e,t)=>a*e+t;for(let e=0;e<a;e++){const i=2048*e;for(let e=0;e<a;e++){const a=2048*e;n.emplaceBack(a,i);const o=Yh(a,i,t),l=Fl(o,o,r);s.emplaceBack(l[0],l[1],l[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const r=o(e,t),n=o(e,t+1),s=o(e+1,t),a=o(e+1,t+1);i.emplaceBack(r,n,s),i.emplaceBack(s,n,a)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(i),this._tileDebugTextBuffer=e.createVertexBuffer(n,Rh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(s,Lh.members),this._tileDebugTextSegments=vs.simpleSegment(0,0,a,32)}}class pd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,r){const n=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},x(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(e,t,r){if(null===this.deletedStates[e])return;const n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][r]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(r in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][r]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(e,t){const r=String(t),n=x({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const r=this.deletedStates[e][t];if(null===r)return{};for(const e in r)delete n[e]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const r={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const r in this.stateChanges[e])this.state[e][r]||(this.state[e][r]={}),x(this.state[e][r],this.stateChanges[e][r]),t[r]=this.state[e][r];r[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const r in this.state[e])t[r]={},this.state[e][r]={};else for(const r in this.deletedStates[e]){if(null===this.deletedStates[e][r])this.state[e][r]={};else for(const t of Object.keys(this.deletedStates[e][r]))delete this.state[e][r][t];t[r]=this.state[e][r]}r[e]=r[e]||{},x(r[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const n in e)e[n].setFeatureState(r,t)}}class dd{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const r=this.toIdx(e,t);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function fd(e,t,r,n){let i=0,s=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(n[a])<1e-15){if(r[a]<e[a]||r[a]>t[a])return null}else{const o=1/n[a];let l=(e[a]-r[a])*o,u=(t[a]-r[a])*o;if(l>u){const e=l;l=u,u=e}if(l>i&&(i=l),u<s&&(s=u),i>s)return null}return i}function md(e,t,r,n,i,s,a,o,l,u,A){const c=n-e,p=i-t,h=s-r,d=a-e,f=o-t,m=l-r,g=A[1]*m-A[2]*f,_=A[2]*d-A[0]*m,y=A[0]*f-A[1]*d,b=c*g+p*_+h*y;if(Math.abs(b)<1e-15)return null;const x=1/b,v=u[0]-e,w=u[1]-t,T=u[2]-r,E=(v*g+w*_+T*y)*x;if(E<0||E>1)return null;const M=w*h-T*p,C=T*c-v*h,I=v*p-w*c,S=(A[0]*M+A[1]*C+A[2]*I)*x;return S<0||E+S>1?null:(d*M+f*C+m*I)*x}function _d(e,t,r){return(e-t)/(r-t)}function gd(e,t,r,n,i,s,a,o,l){const u=1<<r,A=s-n,c=a-i,p=(e+1)/u*A+n,h=(t+0)/u*c+i,d=(t+1)/u*c+i;o[0]=(e+0)/u*A+n,o[1]=h,l[0]=p,l[1]=d}class yd{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),r=[];let n=Math.ceil(Math.pow(2,t));const i=1/n,s=(e,t,r,n,i)=>{const s=n?1:0,a=(e+1)*r-s,o=t*r,l=(t+1)*r-s;i[0]=e*r,i[1]=o,i[2]=a,i[3]=l};let a=new dd(n);const o=[];for(let t=0;t<n*n;t++){s(t%n,Math.floor(t/n),i,!1,o);const r=vd(o[0],o[1],e),l=vd(o[2],o[1],e),u=vd(o[2],o[3],e),A=vd(o[0],o[3],e);a.minimums.push(Math.min(r,l,u,A)),a.maximums.push(Math.max(r,l,u,A)),a.leaves.push(1)}for(r.push(a),n/=2;n>=1;n/=2){const e=r[r.length-1];a=new dd(n);for(let t=0;t<n*n;t++){s(t%n,Math.floor(t/n),2,!0,o);const r=e.getElevation(o[0],o[1]),i=e.getElevation(o[2],o[1]),l=e.getElevation(o[2],o[3]),u=e.getElevation(o[0],o[3]),A=e.isLeaf(o[0],o[1]),c=e.isLeaf(o[2],o[1]),p=e.isLeaf(o[2],o[3]),h=e.isLeaf(o[0],o[3]),d=Math.min(r.min,i.min,l.min,u.min),f=Math.max(r.max,i.max,l.max,u.max),m=A&&c&&p&&h;a.maximums.push(f),a.minimums.push(d),a.leaves.push(f-d<=5&&m?1:0)}r.push(a)}return r}(this.dem),r=t.length-1,n=t[r];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(t,0,0,r,0)}raycastRoot(e,t,r,n,i,s,a=1){return fd([e,t,-100],[r,n,this.maximums[0]*a],i,s)}raycast(e,t,r,n,i,s,a=1){if(!this.nodeCount)return null;const o=this.raycastRoot(e,t,r,n,i,s,a);if(null==o)return null;const l=[],u=[],A=[],c=[],p=[{idx:0,t:o,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:o,t:h,nodex:d,nodey:f,depth:m}=p.pop();if(this.leaves[o]){gd(d,f,m,e,t,r,n,A,c);const o=1<<m,l=(d+0)/o,u=(d+1)/o,p=(f+0)/o,g=(f+1)/o,_=vd(l,p,this.dem)*a,y=vd(u,p,this.dem)*a,b=vd(u,g,this.dem)*a,x=vd(l,g,this.dem)*a,v=md(A[0],A[1],_,c[0],A[1],y,c[0],c[1],b,i,s),w=md(c[0],c[1],b,A[0],c[1],x,A[0],A[1],_,i,s),T=Math.min(null!==v?v:Number.MAX_VALUE,null!==w?w:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const e=Bl([],i,s,h);if(xd(_,y,x,b,_d(e[0],A[0],c[0]),_d(e[1],A[1],c[1]))>=e[2])return h}continue}let g=0;for(let p=0;p<this._siblingOffset.length;p++){gd((d<<1)+this._siblingOffset[p][0],(f<<1)+this._siblingOffset[p][1],m+1,e,t,r,n,A,c),A[2]=-100,c[2]=this.maximums[this.childOffsets[o]+p]*a;const h=fd(A,c,i,s);if(null!=h){const e=h;l[p]=e;let t=!1;for(let r=0;r<g&&!t;r++)e>=l[u[r]]&&(u.splice(r,0,p),t=!0);t||(u[g]=p),g++}}for(let e=0;e<g;e++){const t=u[e];p.push({idx:this.childOffsets[o]+t,t:l[t],nodex:(d<<1)+this._siblingOffset[t][0],nodey:(f<<1)+this._siblingOffset[t][1],depth:m+1})}}return null}_addNode(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,r,n,i){if(1===e[n].isLeaf(t,r))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const s=n-1,a=e[s];let o=0,l=0;for(let e=0;e<this._siblingOffset.length;e++){const n=2*t+this._siblingOffset[e][0],i=2*r+this._siblingOffset[e][1],s=a.getElevation(n,i),u=a.isLeaf(n,i),A=this._addNode(s.min,s.max,u);u&&(o|=1<<e),l||(l=A)}for(let n=0;n<this._siblingOffset.length;n++)o&1<<n||this._construct(e,2*t+this._siblingOffset[n][0],2*r+this._siblingOffset[n][1],s,l+n)}}function xd(e,t,r,n,i,s){return _i(_i(e,r,s),_i(t,n,s),i)}function vd(e,t,r){const n=r.dim,i=f(e*n-.5,0,n-1),s=f(t*n-.5,0,n-1),a=Math.floor(i),o=Math.floor(s),l=Math.min(a+1,n-1),u=Math.min(o+1,n-1);return xd(r.get(a,o),r.get(l,o),r.get(a,u),r.get(l,u),i-a,s-o)}const bd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class wd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,r,n=!1,i=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return D(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const s=this.dim=t.height-2,a=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=r||"mapbox",this.borderReady=n,!n){for(let e=0;e<s;e++)a[this._idx(-1,e)]=a[this._idx(0,e)],a[this._idx(s,e)]=a[this._idx(s-1,e)],a[this._idx(e,-1)]=a[this._idx(e,0)],a[this._idx(e,s)]=a[this._idx(e,s-1)];a[this._idx(-1,-1)]=a[this._idx(0,0)],a[this._idx(s,-1)]=a[this._idx(s-1,0)],a[this._idx(-1,s)]=a[this._idx(0,s-1)],a[this._idx(s,s)]=a[this._idx(s-1,s-1)],i&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new yd(this)}get(e,t,r=!1){r&&(e=f(e,-1,this.dim),t=f(t,-1,this.dim));const n=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[n],this.pixels[n+1],this.pixels[n+2])}static getUnpackVector(e){return bd[e]}get unpackVector(){return bd[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,r){return(256*e*256+256*t+r)/10-1e4}_unpackTerrarium(e,t,r){return 256*e+t+r/256-32768}static pack(e,t){const r=[0,0,0,0],n=wd.getUnpackVector(t);let i=Math.floor((e+n[3])/n[2]);return r[2]=i%256,i=Math.floor(i/256),r[1]=i%256,i=Math.floor(i/256),r[0]=i,r}getPixels(){return new AA({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=t*this.dim,i=t*this.dim+this.dim,s=r*this.dim,a=r*this.dim+this.dim;switch(t){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:s=a-1;break;case 1:a=s+1}const o=-t*this.dim,l=-r*this.dim;for(let t=s;t<a;t++)for(let r=n;r<i;r++){const n=4*this._idx(r,t),i=4*this._idx(r+o,t+l);this.pixels[n+0]=e.pixels[i+0],this.pixels[n+1]=e.pixels[i+1],this.pixels[n+2]=e.pixels[i+2],this.pixels[n+3]=e.pixels[i+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Dn(wd,"DEMData"),Dn(yd,"DemMinMaxQuadTree",{omit:["dem"]});class Td{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){const n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const i={value:t,timeout:void 0};if(void 0!==r&&(i.timeout=setTimeout((()=>{this.remove(e,i)}),r)),this.data[n].push(i),this.order.push(n),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const r=e.wrapped().key,n=void 0===t?0:this.data[r].indexOf(t),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const r in this.data)for(const n of this.data[r])e(n.value)||t.push(n);for(const e of t)this.remove(e.value.tileID,e)}}class Ed{constructor(e,t,r){this.func=e,this.mask=t,this.range=r}}Ed.ReadOnly=!1,Ed.ReadWrite=!0,Ed.disabled=new Ed(519,Ed.ReadOnly,[0,1]);const Md=7680;class Cd{constructor(e,t,r,n,i,s){this.test=e,this.ref=t,this.mask=r,this.fail=n,this.depthFail=i,this.pass=s}}Cd.disabled=new Cd({func:519,mask:0},0,0,Md,Md,Md);class Id{constructor(e,t,r){this.blendFunction=e,this.blendColor=t,this.mask=r}}Id.Replace=[1,0],Id.disabled=new Id(Id.Replace,gt.transparent,[!1,!1,!1,!1]),Id.unblended=new Id(Id.Replace,gt.transparent,[!0,!0,!0,!0]),Id.alphaBlended=new Id([1,771],gt.transparent,[!0,!0,!0,!0]);const Sd=1029,kd=2305;class zd{constructor(e,t,r){this.enable=e,this.mode=t,this.frontFace=r}}zd.disabled=new zd(!1,Sd,kd),zd.backCCW=new zd(!0,Sd,kd),zd.backCW=new zd(!0,Sd,2304),zd.frontCW=new zd(!0,1028,2304),zd.frontCCW=new zd(!0,1028,kd);class Dd extends Ge{constructor(e,t,r){super(),this.id=e,this._onlySymbols=r,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Td(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new pd,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const r=this._tiles[t];this._source.prepareTile(r)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,r.tileID),r.upload(e),r.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const r=this._tiles[t];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return y(this._tiles).map((e=>e.tileID)).sort(Bd).map((e=>e.key))}getRenderableIds(e){const t=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&t.push(this._tiles[r]);return e?t.sort(((e,t)=>{const r=e.tileID,n=t.tileID,s=new i(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),a=new i(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-n.overscaledZ||a.y-s.y||a.x-s.x})).map((e=>e.tileID.key)):t.map((e=>e.tileID)).sort(Bd).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(e,t,r,n){if(n)if(e.state="errored",404!==n.status)this._source.fire(new je(n,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=H.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ve("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let n=0;n<t.length;n++){const i=t[n];if(e.neighboringTiles&&e.neighboringTiles[i]){const t=this.getTileByID(i);r(e,t),r(t,e)}}function r(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let r=t.tileID.canonical.x-e.tileID.canonical.x;const n=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),s=t.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,r,n),e.neighboringTiles&&e.neighboringTiles[s]&&(e.neighboringTiles[s].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,r,n){for(const i in this._tiles){let s=this._tiles[i];if(n[i]||!s.hasData()||s.tileID.overscaledZ<=t||s.tileID.overscaledZ>r)continue;let a=s.tileID;for(;s&&s.tileID.overscaledZ>t+1;){const e=s.tileID.scaledTo(s.tileID.overscaledZ-1);s=this._tiles[e.key],s&&s.hasData()&&(a=e)}let o=a;for(;o.overscaledZ>t;)if(o=o.scaledTo(o.overscaledZ-1),e[o.key]){n[a.key]=a;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=t?r:null}for(let r=e.overscaledZ-1;r>=t;r--){const t=e.scaledTo(r),n=this._getLoadedTile(t);if(n)return n}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const r=Math.ceil(e.width/t)+1,n=Math.ceil(e.height/t)+1,i=Math.floor(r*n*5),s="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,i):i,a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(a)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const r in this._tiles){const n=this._tiles[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),e[n.tileID.key]=n}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,t,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!r)return;let n;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Cc(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(n=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(n=n.filter((e=>this._source.hasTile(e))))):n=[];const i=this._updateRetainedTiles(n);if(Pd(this._source.type)&&0!==n.length){const e={},t={},r=Object.keys(i);for(const n of r){const r=i[n],s=this._tiles[n];if(!s||s.fadeEndTime&&s.fadeEndTime<=H.now())continue;const a=this.findLoadedParent(r,Math.max(r.overscaledZ-Dd.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),e[a.tileID.key]=a.tileID),t[n]=r}const s=n[n.length-1].overscaledZ;for(const e in this._tiles){const r=this._tiles[e];if(i[e]||!r.hasData())continue;let n=r.tileID;for(;n.overscaledZ>s;){n=n.scaledTo(n.overscaledZ-1);const s=this._tiles[n.key];if(s&&s.hasData()&&t[n.key]){i[e]=r.tileID;break}}}for(const t in e)i[t]||(this._coveredTiles[t]=!0,i[t]=e[t])}for(const e in i)this._tiles[e].clearFadeHold();const s=function(e,t){const r=[];for(const n in e)n in t||r.push(n);return r}(this._tiles,i);for(const e of s){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const r={},n=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),i=e[0].overscaledZ,s=Math.max(i-Dd.maxOverzooming,this._source.minzoom),a=Math.max(i+Dd.maxUnderzooming,this._source.minzoom),o={};for(const r of e){const e=this._addTile(r);t[r.key]=r,e.hasData()||n<this._source.maxzoom&&(o[r.key]=r)}this._retainLoadedChildren(o,n,a,t);for(const n of e){let e=this._tiles[n.key];if(e.hasData())continue;if(n.canonical.z>=this._source.maxzoom){const e=n.children(this._source.maxzoom)[0],r=this.getTile(e);if(r&&r.hasData()){t[e.key]=e;continue}}else{const e=n.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let a=n.overscaledZ-1;a>=s;--a){const s=n.scaledTo(a);if(r[s.key])break;if(r[s.key]=!0,e=this.getTile(s),!e&&i&&(e=this._addTile(s)),e&&(t[s.key]=s,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let r,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}t.push(n.key);const e=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(e),r)break;n=e}for(const e of t)this._loadedParentTiles[e]=r}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const r=Boolean(t);if(!r){const r=this.map?this.map.painter:null;t=new hd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,r,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,r||this._source.fire(new Ve("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),r))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,r){const n=[],i=this.transform;if(!i)return n;const s="globe"===i.projection.name,a=Is(i.center.lng);for(const o in this._tiles){const l=this._tiles[o];if(r&&l.clearQueryDebugViz(),l.holdingForFade())continue;let u;if(s){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(f(a,...Ld(e,-1))-a),Math.abs(f(a,...Ld(e,1))-a)];u=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(f(a,...Ld(e,-1))-a),Math.abs(f(a,...Ld(e,0))-a),Math.abs(f(a,...Ld(e,1))-a)];u=[t.indexOf(Math.min(...t))-1]}}else u=[0];for(const r of u){const s=e.containsTile(l,i,t,r);s&&n.push(s)}}return n}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(const e of t)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Pd(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=H.now())return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){const n=this._tiles[e];n&&n.setDependencies(t,r)}reloadTilesForDependencies(e,t){for(const r in this._tiles)this._tiles[r].hasDependency(e,t)&&this._reloadTile(+r,"reloading");this._cache.filter((r=>!r.hasDependency(e,t)))}_preloadTiles(e,t){const r=new Map,n=Array.isArray(e)?e:[e],i=this.map.painter.terrain,s=this.usedForTerrain&&i?i.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)r.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}g(Array.from(r.values()),((e,t)=>{const r=new hd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(r,(e=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),t(e,r)}))}),t)}}function Bd(e,t){const r=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Pd(e){return"raster"===e||"image"===e||"video"===e}function Ld(e,t){const r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}Dd.maxOverzooming=10,Dd.maxUnderzooming=3;class Rd{constructor(e,t,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=r}static create(e,t,r){const n=r||e.findDEMTileFor(t);if(!n||!n.dem)return;const i=n.dem,s=n.tileID,a=1<<t.canonical.z-s.canonical.z;return new Rd(n,n.tileSize/bs/a,[(t.canonical.x/a-s.canonical.x)*i.dim,(t.canonical.y/a-s.canonical.y)*i.dim])}tileCoordToPixel(e,t){const r=t*this._scale+this._offset[1],n=Math.floor(e*this._scale+this._offset[0]),s=Math.floor(r);return new i(n,s)}getElevationAt(e,t,r,n){const i=e*this._scale+this._offset[0],s=t*this._scale+this._offset[1],a=Math.floor(i),o=Math.floor(s),l=this._dem;return n=!!n,r?_i(_i(l.get(a,o,n),l.get(a,o+1,n),s-o),_i(l.get(a+1,o,n),l.get(a+1,o+1,n),s-o),i-a):l.get(a,o,n)}getElevationAtPixel(e,t,r){return this._dem.get(e,t,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ks(1,e)*this._dem.stride}}class Fd{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Sn(bs,16,0),this.featureIndexArray=new Ra,this.promoteId=t}insert(e,t,r,n,i,s=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i,s);const o=this.grid;for(let e=0;e<t.length;e++){const r=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<r.length;e++){const t=r[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y)}n[0]<bs&&n[1]<bs&&n[2]>=0&&n[3]>=0&&o.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hc.VectorTile(new lu(this.rawTileData)).layers,this.sourceLayerCoder=new td(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,r,n){this.loadVTLayers();const i=e.params||{},s=Yr(i.filter),a=e.tileResult,o=e.transform,l=a.bufferedTilespaceBounds,u=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,r,n)=>nl(a.bufferedTilespaceGeometry,e,t,r,n)));u.sort(Ud);let A=null;o.elevation&&u.length>0&&(A=Rd.create(o.elevation,this.tileID));const c={};let p;for(let o=0;o<u.length;o++){const l=u[o];if(l===p)continue;p=l;const h=this.featureIndexArray.get(l);let d=null;this.loadMatchingFeature(c,h,s,i.layers,i.availableImages,t,r,n,((t,r,n,i=0)=>(d||(d=Ns(t,this.tileID.canonical,e.tileTransform)),r.queryIntersectsFeature(a,t,n,d,this.z,e.transform,e.pixelPosMatrix,A,i))))}return c}loadMatchingFeature(e,t,r,n,i,s,a,o,l){const{featureIndex:u,bucketIndex:A,sourceLayerIndex:c,layoutVertexArrayOffset:p}=t,h=this.bucketLayerIDs[A];if(n&&!function(e,t){for(let r=0;r<e.length;r++)if(t.indexOf(e[r])>=0)return!0;return!1}(n,h))return;const d=this.sourceLayerCoder.decode(c),f=this.vtLayers[d].feature(u);if(r.needGeometry){const e=Zs(f,!0);if(!r.filter(new Do(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!r.filter(new Do(this.tileID.overscaledZ),f))return;const m=this.getId(f,d);for(let t=0;t<h.length;t++){const r=h[t];if(n&&n.indexOf(r)<0)continue;const A=s[r];if(!A)continue;let c={};void 0!==m&&o&&(c=o.getState(A.sourceLayer||"_geojsonTileLayer",m));const d=x({},a[r]);d.paint=Od(d.paint,A.paint,f,c,i),d.layout=Od(d.layout,A.layout,f,c,i);const g=!l||l(f,A,c,p);if(!g)continue;const _=new id(f,this.z,this.x,this.y,m);_.layer=d;let b=e[r];void 0===b&&(b=e[r]=[]),b.push({featureIndex:u,feature:_,intersectionZ:g})}}lookupSymbolFeatures(e,t,r,n,i,s,a,o){const l={};this.loadVTLayers();const u=Yr(i);for(const i of e)this.loadMatchingFeature(l,{bucketIndex:r,sourceLayerIndex:n,featureIndex:i,layoutVertexArrayOffset:0},u,s,a,o,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:r}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(r),i=this.vtFeatures[n];if(i[t])return i[t];const s=this.vtLayers[n].feature(t);return i[t]=s,s}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;return this.promoteId&&(r=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof r&&(r=Number(r))),r}}function Od(e,t,r,n,i){return I(e,((e,s)=>{const a=t instanceof Vo?t.get(s):null;return a&&a.evaluate?a.evaluate(r,n,i):a}))}function Ud(e,t){return t-e}Dn(Fd,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Vd{constructor(e){const t={},r=[];for(const n in e){const i=e[n],s=t[n]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n=t.metrics.localGlyph?2:1,a={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};r.push(a),s[e]=a}}const{w:n,h:i}=zu(r),s=new lA({width:n||1,height:i||1});for(const r in e){const n=e[r];for(const e in n.glyphs){const i=n.glyphs[+e];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const a=t[r][e],o=i.metrics.localGlyph?2:1;lA.copy(i.bitmap,s,{x:0,y:0},{x:a.x+o,y:a.y+o},i.bitmap)}}this.image=s,this.positions=t}}Dn(Vd,"GlyphAtlas");class jd{constructor(e){this.tileID=new Cc(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ap(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,r,n,i){this.status="parsing",this.data=e,this.collisionBoxArray=new Ia;const s=new td(Object.keys(e.layers).sort()),a=new Fd(this.tileID,this.promoteId);a.bucketLayerIDs=[];const o={},l=new Yp(256,256),u={featureIndex:a,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:r},A=t.familiesBySource[this.source];for(const t in A){const n=e.layers[t];if(!n)continue;let i=!1,l=!1;for(const e of A[t])"symbol"===e[0].type?i=!0:l=!0;if(!0===this.isSymbolTile&&!i)continue;if(!1===this.isSymbolTile&&!l)continue;1===n.version&&D(`Vector tile source "${this.source}" layer "${t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const c=s.encode(t),p=[];for(let e=0;e<n.length;e++){const r=n.feature(e),i=a.getId(r,t);p.push({feature:r,id:i,index:e,sourceLayerIndex:c})}for(const e of A[t]){const t=e[0];void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(Gd(e,this.zoom,r),(o[t.id]=t.createBucket({index:a.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:c,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate(p,u,this.tileID.canonical,this.tileTransform),a.bucketLayerIDs.push(e.map((e=>e.id))))}}let c,p,h,d;l.trim();const f={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},m=I(u.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(m).length?n.send("getGlyphs",{uid:this.uid,stacks:m},((e,t)=>{c||(c=e,p=t,b.call(this))}),void 0,!1,f):p={};const g=Object.keys(u.iconDependencies);g.length?n.send("getImages",{icons:g,source:this.source,tileID:this.tileID,type:"icons"},((e,t)=>{c||(c=e,h=t,b.call(this))}),void 0,!1,f):h={};const _=Object.keys(u.patternDependencies);function b(){if(c)return i(c);if(p&&h&&d){const e=new Vd(p),t=new Bu(h,d);for(const n in o){const i=o[n];i instanceof Up?(Gd(i.layers,this.zoom,r),Th(i,p,e.positions,h,t.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):i.hasPattern&&(i instanceof Uc||i instanceof YA||i instanceof yc)&&(Gd(i.layers,this.zoom,r),i.addFeatures(u,this.tileID.canonical,t.patternPositions,r,this.tileTransform))}this.status="done",i(null,{buckets:y(o).filter((e=>!e.isEmpty())),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?h:null,glyphPositions:this.returnDependencies?e.positions:null})}}_.length?n.send("getImages",{icons:_,source:this.source,tileID:this.tileID,type:"patterns"},((e,t)=>{c||(c=e,d=t,b.call(this))}),void 0,!1,f):d={},b.call(this)}}function Gd(e,t,r){const n=new Do(t);for(const t of e)t.recalculate(n,r)}class Nd{constructor(e){this.entries={},this.scheduler=e}request(e,t,r,n){const i=this.entries[e]=this.entries[e]||{callbacks:[]};if(i.result){const[e,r]=i.result;return this.scheduler?this.scheduler.add((()=>{n(e,r)}),t):n(e,r),()=>{}}return i.callbacks.push(n),i.cancel||(i.cancel=r(((r,n)=>{i.result=[r,n];for(const e of i.callbacks)this.scheduler?this.scheduler.add((()=>{e(r,n)}),t):e(r,n);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{i.result||(i.callbacks=i.callbacks.filter((e=>e!==n)),i.callbacks.length||(i.cancel(),delete this.entries[e]))}}}function Zd(e,t,r){const n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const n=ke(e.request,((e,n,i,s)=>{e?t(e):n&&t(null,{vectorTile:r?void 0:new hc.VectorTile(new lu(n)),rawData:n,cacheControl:i,expires:s})}));return()=>{n.cancel(),t()}}),t)}e.ARRAY_TYPE=pl,e.AUTH_ERR_MSG=re,e.Aabb=Kl,e.Actor=class{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},M(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=L()?e:r,this.scheduler=new Jp}send(e,t,r,n,i=!1,s){const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=s,this.callbacks[a]=r);const o=O(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:e,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:Ln(t,o)},o),{cancel:()=>{r&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e.cancel()}else if(t.mustQueue||L()){const e=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add((()=>this.processTask(r,t)),e&&e.metadata||{type:"message"})}else this.processTask(r,t)}processTask(e,t){if("<response>"===t.type){const r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(Rn(t.error)):r(null,Rn(t.data)))}else{const r=O(this.globalScope)?void 0:[],n=t.hasCallback?(t,n)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Ln(t):null,data:Ln(n,r)},r)}:e=>{},i=Rn(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,i,n);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],i.source)[e[1]](i,n)}else n(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},e.CanonicalTileID=Ec,e.Color=gt,e.ColorMode=Id,e.CullFaceMode=zd,e.DEMData=wd,e.DataConstantProperty=jo,e.DedupedRequest=Nd,e.DepthMode=Ed,e.EXTENT=bs,e.Elevation=class{isDataAvailableAtPoint(e){const t=this._source();if(!t||e.y<0||e.y>1)return!1;const r=t.getSource().maxzoom,n=1<<r,i=Math.floor(e.x),s=Math.floor((e.x-i)*n),a=Math.floor(e.y*n),o=this.findDEMTileFor(new Cc(r,i,r,s,a));return!(!o||!o.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,r=!0){null==t&&(t=null);const n=this._source();if(!n)return t;if(e.y<0||e.y>1)return t;const i=n.getSource().maxzoom,s=1<<i,a=Math.floor(e.x),o=e.x-a,l=new Cc(i,a,i,Math.floor(o*s),Math.floor(e.y*s)),u=this.findDEMTileFor(l);if(!u||!u.dem)return t;const A=u.dem,c=1<<u.tileID.canonical.z,p=(o*c-u.tileID.canonical.x)*A.dim,h=(e.y*c-u.tileID.canonical.y)*A.dim,d=Math.floor(p),f=Math.floor(h);return(r?this.exaggeration():1)*_i(_i(A.get(d,f),A.get(d,f+1),h-f),_i(A.get(d+1,f),A.get(d+1,f+1),h-f),p-d)}getAtTileOffset(e,t,r){const n=1<<e.canonical.z;return this.getAtPointOrZero(new Ls(e.wrap+(e.canonical.x+t/bs)/n,(e.canonical.y+r/bs)/n))}getAtTileOffsetFunc(e,t,r,n){return i=>{const s=this.getAtTileOffset(e,i.x,i.y),a=n.upVector(e.canonical,i.x,i.y);return Dl(a,a,s*n.upVectorScale(e.canonical,t,r).metersToTile),a}}getForTilePoints(e,t,r,n){const i=Rd.create(this,e,n);return!!i&&(t.forEach((e=>{e[2]=this.exaggeration()*i.getElevationAt(e[0],e[1],r)})),!0)}getMinMaxForTile(e){const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const r=t.dem.tree,n=t.tileID,i=1<<e.canonical.z-n.canonical.z;let s=e.canonical.x/i-n.canonical.x,a=e.canonical.y/i-n.canonical.y,o=0;for(let t=0;t<e.canonical.z-n.canonical.z&&!r.leaves[o];t++){s*=2,a*=2;const e=2*Math.floor(a)+Math.floor(s);o=r.childOffsets[o]+e,s%=1,a%=1}return{min:this.exaggeration()*r.minimums[o],max:this.exaggeration()*r.maximums[o]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},e.ErrorEvent=je,e.EvaluationParameters=Do,e.Event=Ve,e.Evented=Ge,e.FillExtrusionBucket=yc,e.Frustum=Yl,e.FrustumCorners=Xl,e.GLOBE_METERS_TO_ECEF=Oh,e.GLOBE_RADIUS=Fh,e.GLOBE_SCALE_MATCH_LATITUDE=45,e.GLOBE_ZOOM_THRESHOLD_MAX=6,e.GLOBE_ZOOM_THRESHOLD_MIN=5,e.GlobeSharedBuffers=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const e of this._wireframeSegments)e.destroy()}}_createGrid(e){const t=new Jo,r=new fa,n=65;for(let e=0;e<n;e++)for(let r=0;r<n;r++)t.emplaceBack(r,e);this._gridSegments=[];for(let e=0,t=0;e<Uh.length;e++){const i=Uh[e];for(let e=0;e<i;e++)for(let t=0;t<64;t++){const i=e*n+t;r.emplaceBack(i+1,i,i+n),r.emplaceBack(i+n,i+n+1,i+1)}const s=64*i*2;this._gridSegments.push(vs.simpleSegment(0,t,(i+1)*n,s)),t+=s}this._gridBuffer=e.createVertexBuffer(t,Rh.members),this._gridIndexBuffer=e.createIndexBuffer(r,!0)}_createPoles(e){const t=new fa;for(let e=0;e<=64;e++)t.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const r=new ya,n=new ya;this._poleSegments=[];for(let e=0,t=0;e<5;e++){const i=1<<e,s=512*i/Math.PI/2,a=360/i;r.emplaceBack(0,-s,0,0,0,.5,0),n.emplaceBack(0,-s,0,0,0,.5,1);for(let e=0;e<=64;e++){const t=e/64,i=_i(0,a,t),[o,l,u]=Wh(ap,sp,i,s);r.emplaceBack(o,l,u,0,0,t,0),n.emplaceBack(o,l,u,0,0,t,1)}this._poleSegments.push(vs.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(r,Ph,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,Ph,!1)}getGridBuffers(e){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[e]]}getPoleBuffers(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}getWirefameBuffers(e,t){if(!this._wireframeSegments){const t=new ba,r=64,n=r+1;this._wireframeSegments=[];for(let e=0,i=0;e<Uh.length;e++){const s=Uh[e];for(let e=0;e<s;e++)for(let i=0;i<r;i++){const r=e*n+i;t.emplaceBack(r,r+1),t.emplaceBack(r,r+n),t.emplaceBack(r,r+n+1)}const a=s*r*3;this._wireframeSegments.push(vs.simpleSegment(0,i,(s+1)*n,a)),i+=a}this._wireframeIndexBuffer=e.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},e.GlyphManager=Ah,e.ImagePosition=Du,e.LineAtlas=Yp,e.LngLat=Es,e.LngLatBounds=ws,e.LocalGlyphMode=lh,e.MAX_MERCATOR_LATITUDE=Ps,e.MercatorCoordinate=Ls,e.ONE_EM=Yc,e.OverscaledTileID=Cc,e.Properties=$o,e.RGBAImage=AA,e.Ray=Wl,e.RequestManager=class{constructor(e,t,r){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",rt,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!ne(e))return e;const r=se(e);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!ne(e))return e;const r=se(e);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeSourceURL(e,t,r,n){if(!ne(e))return e;const i=se(e);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),r&&i.params.push(`language=${r}`),n&&i.params.push(`worldview=${n}`),this._makeAPIURL(i,this._customAccessToken||t)}normalizeSpriteURL(e,t,r,n){const i=se(e);return ne(e)?(i.path=`/styles/v1${i.path}/sprite${t}${r}`,this._makeAPIURL(i,this._customAccessToken||n)):(i.path+=`${t}${r}`,le(i))}normalizeTileURL(e,t,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!ne(e))return e;const n=se(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||r&&"raster"!==n.authority&&512===r?"@2x":""}${Y.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${X.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${X.TILE_URL_VERSION}${n.path}`);const i=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(n.params)||X.ACCESS_TOKEN;return X.REQUIRE_ACCESS_TOKEN&&i&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,i)}canonicalizeTileURL(e,t){const r=se(e);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return e;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${X.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${X.TILE_URL_VERSION}/`,"")}`;let i=r.params;return t&&(i=i.filter((e=>!e.match(/^access_token=/)))),i.length&&(n+=`?${i.join("&")}`),n}canonicalizeTileset(e,t){const r=!!t&&ne(t),n=[];for(const t of e.tiles||[])oe(t)?n.push(this.canonicalizeTileURL(t,r)):n.push(t);return n}_makeAPIURL(e,t){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=se(X.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==n.path&&(e.path=`${n.path}${e.path}`),!X.REQUIRE_ACCESS_TOKEN)return le(e);if(t=t||X.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),le(e)}},e.ResourceType=Me,e.SegmentVector=vs,e.SourceCache=Dd,e.StencilMode=Cd,e.StructArrayLayout1ui2=wa,e.StructArrayLayout2f1f2i16=ha,e.StructArrayLayout2i4=Jo,e.StructArrayLayout2ui4=ba,e.StructArrayLayout3f12=da,e.StructArrayLayout3ui6=fa,e.StructArrayLayout4i8=ta,e.StructArrayLayout5f20=xa,e.Texture=Xp,e.Tile=hd,e.Transitionable=Lo,e.Uniform1f=Ka,e.Uniform1i=class extends Ya{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.Uniform2f=class extends Ya{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.Uniform3f=class extends Ya{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.Uniform4f=Ja,e.UniformColor=es,e.UniformMatrix2f=class extends Ya{constructor(e,t){super(e,t),this.current=rs}set(e){for(let t=0;t<4;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix2fv(this.location,!1,e);break}}},e.UniformMatrix3f=class extends Ya{constructor(e,t){super(e,t),this.current=is}set(e){for(let t=0;t<9;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix3fv(this.location,!1,e);break}}},e.UniformMatrix4f=class extends Ya{constructor(e,t){super(e,t),this.current=ts}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.UnwrappedTileID=Mc,e.ValidationError=Gr,e.VectorTileWorkerSource=class extends Ge{constructor(e,t,r,n,i){super(),this.actor=e,this.layerIndex=t,this.availableImages=r,this.loadVectorData=i||Zd,this.loading={},this.loaded={},this.deduped=new Nd(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler}loadTile(e,t){const r=e.uid,n=e&&e.request,i=n&&n.collectResourceTiming,s=this.loading[r]=new jd(e);s.abort=this.loadVectorData(e,((a,o)=>{const l=!this.loading[r];if(delete this.loading[r],l||a||!o)return s.status="done",l||(this.loaded[r]=s),t(a);const u=o.rawData,A={};o.expires&&(A.expires=o.expires),o.cacheControl&&(A.cacheControl=o.cacheControl),s.vectorTile=o.vectorTile||new hc.VectorTile(new lu(u));const c=()=>{s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,r)=>{if(e||!r)return t(e);const s={};if(i){const e=G(n);e.length>0&&(s.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,x({rawTileData:u.slice(0)},r,A,s))}))};this.isSpriteLoaded?c():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(c,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):c()})),this.loaded=this.loaded||{},this.loaded[r]=s}))}reloadTile(e,t){const r=this.loaded,n=e.uid,i=this;if(r&&r[n]){const s=r[n];s.showCollisionBoxes=e.showCollisionBoxes,s.enableTerrain=!!e.enableTerrain,s.projection=e.projection,s.tileTransform=Ap(e.tileID.canonical,e.projection);const a=(e,r)=>{const n=s.reloadCallback;n&&(delete s.reloadCallback,s.parse(s.vectorTile,i.layerIndex,this.availableImages,i.actor,n)),t(e,r)};"parsing"===s.status?s.reloadCallback=a:"done"===s.status&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}}abortTile(e,t){const r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],t()}},e.WritingMode=Pu,e.ZoomHistory=Fn,e.add=Cl,e.addDynamicAttributes=Lp,e.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],l=t[6],u=t[7],A=t[8];return e[0]=a*A-o*u,e[1]=i*u-n*A,e[2]=n*o-i*a,e[3]=o*l-s*A,e[4]=r*A-i*l,e[5]=i*s-r*o,e[6]=s*u-a*l,e[7]=n*l-r*u,e[8]=r*a-n*s,e},e.asyncAll=g,e.bezier=p,e.bindAll=M,e.boundsAttributes=cd,e.bufferConvexPolygon=function(e,t){const r=[];for(let n=0;n<e.length;n++){const i=_(n-1,-1,e.length-1),s=_(n+1,-1,e.length-1),a=e[n],o=e[s],l=e[i].sub(a).unit(),u=o.sub(a).unit(),A=u.angleWithSep(l.x,l.y),c=l.add(u).unit().mult(-1*t/Math.sin(A/2));r.push(a.add(c))}return r},e.cacheEntryPossiblyAdded=function(e){Ee++,Ee>ye&&(e.getActor().send("enforceCacheSizeLimit",ge),Ee=0)},e.calculateGlobeLabelMatrix=function(e,t){const{x:r,y:n}=e.point,i=tp(r,n,e.worldSize/e._projectionScaler,0,0);return ml(i,i,ep($h(t)))},e.calculateGlobeMatrix=function(e){const{x:t,y:r}=e.point,{lng:n,lat:i}=e._center;return tp(t,r,e.worldSize,n,i)},e.calculateGlobeMercatorMatrix=function(e){const t=e.worldSize,r=e.point,n=ks(1,e.center.lat)*t,i=e.pixelsPerMeter,s=t/(n/e.pixelsPerMeter),a=dl(new Float64Array(16));return _l(a,a,[r.x,r.y,0]),gl(a,a,[s,s,i]),Float32Array.from(a)},e.circumferenceAtLatitude=Cs,e.clamp=f,e.clearTileCache=function(e){const t=[];for(const e in xe)t.push(r.caches.delete(e)),delete xe[e];e&&Promise.all(t).catch(e).then((()=>e()))},e.clipLine=nh,e.clone=function(e){var t=new pl(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=k,e.collisionCircleLayout=Xc,e.config=X,e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.create=function(){var e=new pl(16);return pl!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=fl,e.createExpression=Rr,e.createLayout=Yo,e.createStyleLayer=function(e){return"custom"===e.type?new $p(e):new Wp[e.type](e)},e.cross=Rl,e.degToRad=A,e.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},e.div=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},e.dot=Ll,e.ease=d,e.easeCubicInOut=h,e.emitValidationErrors=In,e.endsWith=C,e.enforceCacheSizeLimit=function(e){for(const t in xe)be(t),xe[t].then((t=>{t.keys().then((r=>{for(let n=0;n<r.length-e;n++)t.delete(r[n])}))}))},e.evaluateSizeForFeature=eu,e.evaluateSizeForZoom=th,e.evaluateVariableOffset=wh,e.evented=Io,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.exported=H,e.exported$1=Y,e.extend=x,e.extend$1=Ze,e.fillExtrusionHeightLift=vc,e.filterObject=S,e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=r+r,o=n+n,l=i+i,u=r*a,A=n*a,c=n*o,p=i*a,h=i*o,d=i*l,f=s*a,m=s*o,g=s*l;return e[0]=1-c-d,e[1]=A+g,e[2]=p-m,e[3]=0,e[4]=A-g,e[5]=1-u-d,e[6]=h+f,e[7]=0,e[8]=p+m,e[9]=h-f,e[10]=1-u-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return c[t]},e.getAABBPointSquareDist=function(e,t,r){let n=0;for(let i=0;i<2;++i){const s=r?r[i]:0;e[i]>s&&(n+=(e[i]-s)*(e[i]-s)),t[i]<s&&(n+=(s-t[i])*(s-t[i]))}return n},e.getAnchorAlignment=$u,e.getAnchorJustification=Eh,e.getBounds=function(e){let t=1/0,r=1/0,n=-1/0,s=-1/0;for(const i of e)t=Math.min(t,i.x),r=Math.min(r,i.y),n=Math.max(n,i.x),s=Math.max(s,i.y);return{min:new i(t,r),max:new i(n,s)}},e.getColumn=V,e.getGridMatrix=function(e,t,r){const[n,i]=t,s=.015625;return[0,(i[1]-n[1])*s,1<<e.z,(i[0]-n[0])/Uh[r],0,e.y,n[0],n[1],s]},e.getImage=Fe,e.getJSON=function(e,t){return Se(x(e,{type:"json"}),t)},e.getLatitudinalLod=function(e){const t=80.051129;e=f(e,-80.051129,t)/t*90;const r=Math.pow(Math.abs(Math.sin(A(e))),3);return Math.round(r*(Uh.length-1))},e.getMapSessionAPI=fe,e.getPerformanceMeasurement=G,e.getProjection=kp,e.getRTLTextPluginStatus=So,e.getReferrer=Ie,e.getTilePoint=function(e,{x:t,y:r},n=0){return new i(((t-n)*e.scale-e.x)*bs,(r*e.scale-e.y)*bs)},e.getTileVec3=function(e,t,r=0){return Ml(((t.x-r)*e.scale-e.x)*bs,(t.y*e.scale-e.y)*bs,Bs(t.z,t.y))},e.getVideo=function(e,t){const n=r.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let t=0;t<e.length;t++){const i=r.document.createElement("source");Be(e[t])||(n.crossOrigin="Anonymous"),i.src=e[t],n.appendChild(i)}return{cancel:()=>{}}},e.globeCenterToScreenPoint=function(e){const t=[0,0,0],r=dl(new Float64Array(16));return ml(r,e.pixelMatrix,e.globeMatrix),Fl(t,t,r),new i(t[0],t[1])},e.globeECEFOrigin=function(e,t){const r=[0,0,0];return Fl(r,r,Jh($h(t.canonical))),Fl(r,r,e),r},e.globeNormalizeECEF=Jh,e.globePixelsToTileUnits=function(e,t){return bs/(512*Math.pow(2,e))*Kh($h(t))},e.globePoleMatrixForTile=function(e,t,r){const n=dl(new Float64Array(16)),i=1<<e,s=360*(t/i-.5),a=r.point,o=r.worldSize/(r.tileSize*i);return _l(n,n,[a.x,a.y,-r.worldSize/Math.PI/2]),gl(n,n,[o,o,o]),yl(n,n,A(-r._center.lat)),xl(n,n,A(-r._center.lng+s)),Float32Array.from(n)},e.globeTileBounds=$h,e.globeTileLatLngCorners=Hh,e.globeTiltAtLngLat=np,e.globeToMercatorTransition=ip,e.globeUseCustomAntiAliasing=function(e,t,r){const n=ip(r.zoom),i=e.style.map._antialias,s=!!t.extStandardDerivatives,a=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===n&&!i&&!a&&s},e.identity=dl,e.identity$1=$l,e.invert=function(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],l=t[6],u=t[7],A=t[8],c=t[9],p=t[10],h=t[11],d=t[12],f=t[13],m=t[14],g=t[15],_=r*o-n*a,y=r*l-i*a,b=r*u-s*a,x=n*l-i*o,v=n*u-s*o,w=i*u-s*l,T=A*f-c*d,E=A*m-p*d,M=A*g-h*d,C=c*m-p*f,I=c*g-h*f,S=p*g-h*m,k=_*S-y*I+b*C+x*M-v*E+w*T;return k?(e[0]=(o*S-l*I+u*C)*(k=1/k),e[1]=(i*I-n*S-s*C)*k,e[2]=(f*w-m*v+g*x)*k,e[3]=(p*v-c*w-h*x)*k,e[4]=(l*M-a*S-u*E)*k,e[5]=(r*S-i*M+s*E)*k,e[6]=(m*b-d*w-g*y)*k,e[7]=(A*w-p*b+h*y)*k,e[8]=(a*I-o*M+u*T)*k,e[9]=(n*M-r*I-s*T)*k,e[10]=(d*v-f*b+g*_)*k,e[11]=(c*b-A*v-h*_)*k,e[12]=(o*E-a*C-l*T)*k,e[13]=(r*C-n*E+i*T)*k,e[14]=(f*y-d*x-m*_)*k,e[15]=(A*x-c*y+p*_)*k,e):null},e.isLngLatBehindGlobe=function(e,t){return np(e,t)>Math.PI/2*1.01},e.isMapAuthenticated=function(e){return me.has(e)},e.isMapboxURL=ne,e.isSafariWithAntialiasingBug=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!O(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.latFromMercatorY=Ds,e.len=Gl,e.length=El,e.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.loadVectorTile=Zd,e.makeRequest=Se,e.mapValue=function(e,t,r,n,i){return f((e-t)/(r-t)*(i-n)+n,n,i)},e.mercatorXfromLng=Is,e.mercatorYfromLat=Ss,e.mercatorZfromAltitude=ks,e.mul=bl,e.mul$1=jl,e.multiply=ml,e.multiply$1=function(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],A=t[7],c=t[8],p=r[0],h=r[1],d=r[2],f=r[3],m=r[4],g=r[5],_=r[6],y=r[7],b=r[8];return e[0]=p*n+h*a+d*u,e[1]=p*i+h*o+d*A,e[2]=p*s+h*l+d*c,e[3]=f*n+m*a+g*u,e[4]=f*i+m*o+g*A,e[5]=f*s+m*l+g*c,e[6]=_*n+y*a+b*u,e[7]=_*i+y*o+b*A,e[8]=_*s+y*l+b*c,e},e.multiply$2=Sl,e.nextPowerOfTwo=T,e.normalize=Pl,e.normalize$1=function(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=r*r+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=n*a,e[2]=i*a,e[3]=s*a,e},e.number=_i,e.ortho=function(e,t,r,n,i,s,a){var o=1/(t-r),l=1/(n-i),u=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*o,e[13]=(i+n)*l,e[14]=(a+s)*u,e[15]=1,e},e.pbf=lu,e.perspective=function(e,t,r,n,i){var s,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+n)*(s=1/(n-i)),e[14]=2*i*n*s):(e[10]=-1,e[14]=-2*n),e},e.pick=function(e,t){const r={};for(let n=0;n<t.length;n++){const i=t[n];i in e&&(r[i]=e[i])}return r},e.plugin=zo,e.pointGeometry=i,e.polygonContainsPoint=rl,e.polygonIntersectsBox=nl,e.polygonIntersectsPolygon=Hs,e.polygonizeBounds=function(e,t,r=0,n=!0){const s=new i(r,r),a=e.sub(s),o=t.add(s),l=[a,new i(o.x,a.y),o,new i(a.x,o.y)];return n&&l.push(a.clone()),l},e.posAttributes=Rh,e.postMapLoadEvent=dt,e.postTurnstileEvent=he,e.potpack=zu,e.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.radToDeg=u,e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.registerForPluginStateChange=function(e){return e({pluginStatus:To,pluginURL:Eo}),Io.on("pluginStateChange",e),e},e.removeAuthState=function(e){me.delete(e)},e.renderColorRamp=uA,e.resample=Fs,e.rotateX=yl,e.rotateX$1=Ql,e.rotateY=xl,e.rotateY$1=Hl,e.rotateZ=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],u=t[4],A=t[5],c=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+u*n,e[1]=a*i+A*n,e[2]=o*i+c*n,e[3]=l*i+p*n,e[4]=u*i-s*n,e[5]=A*i-a*n,e[6]=c*i-o*n,e[7]=p*i-l*n,e},e.rotateZ$1=function(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*o,e[1]=i*l-n*o,e[2]=s*l+a*o,e[3]=a*l-s*o,e},e.scale=gl,e.scale$1=Nl,e.scale$2=Dl,e.scaleAndAdd=Bl,e.setCacheLimits=function(e,t){ge=e,ye=t},e.setColumn=function(e,t,r){e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},e.setRTLTextPlugin=function(e,t,r=!1){if(To===xo||To===vo||To===bo)throw new Error("setRTLTextPlugin cannot be called multiple times.");Eo=H.resolveURL(e),To=xo,wo=t,Co(),r||ko()},e.smoothstep=m,e.spec=Ne,e.storeAuthState=function(e,t){t?me.add(e):me.delete(e)},e.sub=Vl,e.subtract=Il,e.symbolSize=tu,e.tileAABB=function(e,t,r,n,i,s,a,o,l){if("globe"===l.name)return Qh(e,t,new Ec(r,n,i));const u=Ap({z:r,x:n,y:i},l);return new Kl([(s+u.x/u.scale)*t,t*(u.y/u.scale),a],[(s+u.x2/u.scale)*t,t*(u.y2/u.scale),o])},e.tileTransform=Ap,e.transformMat3=function(e,t,r){var n=t[0],i=t[1],s=t[2];return e[0]=n*r[0]+i*r[3]+s*r[6],e[1]=n*r[1]+i*r[4]+s*r[7],e[2]=n*r[2]+i*r[5]+s*r[8],e},e.transformMat4=Fl,e.transformMat4$1=Zl,e.transformQuat=Ol,e.translate=_l,e.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},e.triggerPluginCompletionEvent=Mo,e.uniqueId=v,e.updateGlobeVertexNormal=function(e,t,r,n,i){const s=5*t+2;e.float32[s+0]=r,e.float32[s+1]=n,e.float32[s+2]=i},e.validateCustomStyleLayer=function(e){const t=[],r=e.id;return void 0===r&&t.push({message:`layers.${r}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${r}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},e.validateFilter=e=>Cn(li(e)),e.validateFog=e=>Cn(xn(e)),e.validateLayer=e=>Cn(dn(e)),e.validateLight=e=>Cn(gn(e)),e.validateSource=e=>Cn(_n(e)),e.validateStyle=Tn,e.validateTerrain=e=>Cn(yn(e)),e.values=y,e.vectorTile=hc,e.version=N,e.warnOnce=D,e.window=r,e.wrap=_})),o(["./shared"],(function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let r="[";for(const n of e)r+=`${t(n)},`;return`${r}]`}let r="{";for(const n of Object.keys(e).sort())r+=`${n}:${t(e[n])},`;return`${r}}`}function r(r){let n="";for(const o of e.refProperties)n+=`/${t(r[o])}`;return n}class n{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,n){for(const r of t)this._layerConfigs[r.id]=r,(this._layers[r.id]=e.createStyleLayer(r)).compileFilter(),this.keyCache[r.id]&&delete this.keyCache[r.id];for(const e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const o=function(e,t){const n={};for(let o=0;o<e.length;o++){const i=t&&t[e[o].id]||r(e[o]);t&&(t[e[o].id]=i);let s=n[i];s||(s=n[i]=[]),s.push(e[o])}const o=[];for(const e in n)o.push(n[e]);return o}(e.values(this._layerConfigs),this.keyCache);for(const e of o){const t=e.map((e=>this._layers[e.id])),r=t[0];if("none"===r.visibility)continue;const n=r.source||"";let o=this.familiesBySource[n];o||(o=this.familiesBySource[n]={});const i=r.sourceLayer||"_geojsonTileLayer";let s=o[i];s||(s=o[i]=[]),s.push(t)}}}class o{loadTile(t,r){const{uid:n,encoding:o,rawImageData:i,padding:s,buildQuadTree:a}=t,l=e.window.ImageBitmap&&i instanceof e.window.ImageBitmap?this.getImageData(i,s):i;r(null,new e.DEMData(n,l,o,s<1,a))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const r=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}var i=function e(t,r){var n,o=t&&t.type;if("FeatureCollection"===o)for(n=0;n<t.features.length;n++)e(t.features[n],r);else if("GeometryCollection"===o)for(n=0;n<t.geometries.length;n++)e(t.geometries[n],r);else if("Feature"===o)e(t.geometry,r);else if("Polygon"===o)s(t.coordinates,r);else if("MultiPolygon"===o)for(n=0;n<t.coordinates.length;n++)s(t.coordinates[n],r);return t};function s(e,t){if(0!==e.length){a(e[0],t);for(var r=1;r<e.length;r++)a(e[r],!t)}}function a(e,t){for(var r=0,n=0,o=0,i=e.length,s=i-1;o<i;s=o++){var a=(e[o][0]-e[s][0])*(e[s][1]+e[o][1]),l=r+a;n+=Math.abs(r)>=Math.abs(a)?r-l+a:a-l+r,r=l}r+n>=0!=!!t&&e.reverse()}const l=e.vectorTile.VectorTileFeature.prototype.toGeoJSON;class u{constructor(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const r of this._feature.geometry)t.push([new e.pointGeometry(r[0],r[1])]);return t}{const t=[];for(const r of this._feature.geometry){const n=[];for(const t of r)n.push(new e.pointGeometry(t[0],t[1]));t.push(n)}return t}}toGeoJSON(e,t,r){return l.call(this,e,t,r)}}class A{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t}feature(e){return new u(this._features[e])}}var c=e.vectorTile.VectorTileFeature,h=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function g(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new g(this.features[e],this.options.extent)},g.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var r=0;r<t.length;r++){for(var n=t[r],o=[],i=0;i<n.length;i++)o.push(new e.pointGeometry(n[i][0],n[i][1]));this.geometry.push(o)}return this.geometry},g.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,n=1/0,o=-1/0,i=0;i<e.length;i++)for(var s=e[i],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),r=Math.max(r,l.x),n=Math.min(n,l.y),o=Math.max(o,l.y)}return[t,n,r,o]},g.prototype.toGeoJSON=c.prototype.toGeoJSON;var d=m,f=h;function m(t){var r=new e.pbf;return function(e,t){for(var r in e.layers)t.writeMessage(3,_,e.layers[r])}(t,r),r.finish()}function _(e,t){var r;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<e.length;r++)n.feature=e.feature(r),t.writeMessage(2,y,n);var o=n.keys;for(r=0;r<o.length;r++)t.writeStringField(3,o[r]);var i=n.values;for(r=0;r<i.length;r++)t.writeMessage(4,b,i[r])}function y(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,x,e),t.writeVarintField(3,r.type),t.writeMessage(4,T,r)}function x(e,t){var r=e.feature,n=e.keys,o=e.values,i=e.keycache,s=e.valuecache;for(var a in r.properties){var l=r.properties[a],u=i[a];if(null!==l){void 0===u&&(n.push(a),i[a]=u=n.length-1),t.writeVarint(u);var A=typeof l;"string"!==A&&"boolean"!==A&&"number"!==A&&(l=JSON.stringify(l));var c=A+":"+l,h=s[c];void 0===h&&(o.push(l),s[c]=h=o.length-1),t.writeVarint(h)}}}function v(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function T(e,t){for(var r=e.loadGeometry(),n=e.type,o=0,i=0,s=r.length,a=0;a<s;a++){var l=r[a],u=1;1===n&&(u=l.length),t.writeVarint(v(1,u));for(var A=3===n?l.length-1:l.length,c=0;c<A;c++){1===c&&1!==n&&t.writeVarint(v(2,A-1));var h=l[c].x-o,p=l[c].y-i;t.writeVarint(w(h)),t.writeVarint(w(p)),o+=h,i+=p}3===n&&t.writeVarint(v(7,1))}}function b(e,t){var r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function E(e,t,r,n,o,i){if(o-n<=r)return;const s=n+o>>1;M(e,t,s,n,o,i%2),E(e,t,r,n,s-1,i+1),E(e,t,r,s+1,o,i+1)}function M(e,t,r,n,o,i){for(;o>n;){if(o-n>600){const s=o-n+1,a=r-n+1,l=Math.log(s),u=.5*Math.exp(2*l/3),A=.5*Math.sqrt(l*u*(s-u)/s)*(a-s/2<0?-1:1);M(e,t,r,Math.max(n,Math.floor(r-a*u/s+A)),Math.min(o,Math.floor(r+(s-a)*u/s+A)),i)}const s=t[2*r+i];let a=n,l=o;for(C(e,t,n,r),t[2*o+i]>s&&C(e,t,n,o);a<l;){for(C(e,t,a,l),a++,l--;t[2*a+i]<s;)a++;for(;t[2*l+i]>s;)l--}t[2*n+i]===s?C(e,t,n,l):(l++,C(e,t,l,o)),l<=r&&(n=l+1),r<=l&&(o=l-1)}}function C(e,t,r,n){I(e,r,n),I(t,2*r,2*n),I(t,2*r+1,2*n+1)}function I(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function S(e,t,r,n){const o=e-r,i=t-n;return o*o+i*i}d.fromVectorTileJs=m,d.fromGeojsonVt=function(e,t){t=t||{};var r={};for(var n in e)r[n]=new h(e[n].features,t),r[n].name=n,r[n].version=t.version,r[n].extent=t.extent;return m({layers:r})},d.GeoJSONWrapper=f;const k=e=>e[0],z=e=>e[1];class D{constructor(e,t=k,r=z,n=64,o=Float64Array){this.nodeSize=n,this.points=e;const i=e.length<65536?Uint16Array:Uint32Array,s=this.ids=new i(e.length),a=this.coords=new o(2*e.length);for(let n=0;n<e.length;n++)s[n]=n,a[2*n]=t(e[n]),a[2*n+1]=r(e[n]);E(s,a,n,0,s.length-1,0)}range(e,t,r,n){return function(e,t,r,n,o,i,s){const a=[0,e.length-1,0],l=[];let u,A;for(;a.length;){const c=a.pop(),h=a.pop(),p=a.pop();if(h-p<=s){for(let s=p;s<=h;s++)u=t[2*s],A=t[2*s+1],u>=r&&u<=o&&A>=n&&A<=i&&l.push(e[s]);continue}const g=Math.floor((p+h)/2);u=t[2*g],A=t[2*g+1],u>=r&&u<=o&&A>=n&&A<=i&&l.push(e[g]);const d=(c+1)%2;(0===c?r<=u:n<=A)&&(a.push(p),a.push(g-1),a.push(d)),(0===c?o>=u:i>=A)&&(a.push(g+1),a.push(h),a.push(d))}return l}(this.ids,this.coords,e,t,r,n,this.nodeSize)}within(e,t,r){return function(e,t,r,n,o,i){const s=[0,e.length-1,0],a=[],l=o*o;for(;s.length;){const u=s.pop(),A=s.pop(),c=s.pop();if(A-c<=i){for(let o=c;o<=A;o++)S(t[2*o],t[2*o+1],r,n)<=l&&a.push(e[o]);continue}const h=Math.floor((c+A)/2),p=t[2*h],g=t[2*h+1];S(p,g,r,n)<=l&&a.push(e[h]);const d=(u+1)%2;(0===u?r-o<=p:n-o<=g)&&(s.push(c),s.push(h-1),s.push(d)),(0===u?r+o>=p:n+o>=g)&&(s.push(h+1),s.push(A),s.push(d))}return a}(this.ids,this.coords,e,t,r,this.nodeSize)}}const B={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},P=Math.fround||(L=new Float32Array(1),e=>(L[0]=+e,L[0]));var L;class R{constructor(e){this.options=Z(Object.create(B),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:r,maxZoom:n,nodeSize:o}=this.options;t&&console.time("total time");const i=`prepare ${e.length} points`;t&&console.time(i),this.points=e;let s=[];for(let t=0;t<e.length;t++)e[t].geometry&&s.push(O(e[t],t));this.trees[n+1]=new D(s,$,Q,o,Float32Array),t&&console.timeEnd(i);for(let e=n;e>=r;e--){const r=+Date.now();s=this._cluster(s,e),this.trees[e]=new D(s,$,Q,o,Float32Array),t&&console.log("z%d: %d clusters in %dms",e,s.length,+Date.now()-r)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let o=180===e[2]?180:((e[2]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,o=180;else if(r>o){const e=this.getClusters([r,n,180,i],t),s=this.getClusters([-180,n,o,i],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(j(r),G(i),j(o),G(n)),l=[];for(const e of a){const t=s.points[e];l.push(t.numPoints?U(t):this.points[t.index])}return l}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",o=this.trees[r];if(!o)throw new Error(n);const i=o.points[t];if(!i)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,r-1)),a=o.within(i.x,i.y,s),l=[];for(const t of a){const r=o.points[t];r.parentId===e&&l.push(r.numPoints?U(r):this.points[r.index])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,r){const n=[];return this._appendLeaves(n,e,t=t||10,r=r||0,0),n}getTile(e,t,r){const n=this.trees[this._limitZoom(e)],o=Math.pow(2,e),{extent:i,radius:s}=this.options,a=s/i,l=(r-a)/o,u=(r+1+a)/o,A={features:[]};return this._addTileFeatures(n.range((t-a)/o,l,(t+1+a)/o,u),n.points,t,r,o,A),0===t&&this._addTileFeatures(n.range(1-a/o,l,1,u),n.points,o,r,o,A),t===o-1&&this._addTileFeatures(n.range(0,l,a/o,u),n.points,-1,r,o,A),A.features.length?A:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,n,o){const i=this.getChildren(t);for(const t of i){const i=t.properties;if(i&&i.cluster?o+i.point_count<=n?o+=i.point_count:o=this._appendLeaves(e,i.cluster_id,r,n,o):o<n?o++:e.push(t),e.length===r)break}return o}_addTileFeatures(e,t,r,n,o,i){for(const s of e){const e=t[s],a=e.numPoints;let l,u,A;if(a)l=V(e),u=e.x,A=e.y;else{const t=this.points[e.index];l=t.properties,u=j(t.geometry.coordinates[0]),A=G(t.geometry.coordinates[1])}const c={type:1,geometry:[[Math.round(this.options.extent*(u*o-r)),Math.round(this.options.extent*(A*o-n))]],tags:l};let h;a?h=e.id:this.options.generateId?h=e.index:this.points[e.index].id&&(h=this.points[e.index].id),void 0!==h&&(c.id=h),i.features.push(c)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))}_cluster(e,t){const r=[],{radius:n,extent:o,reduce:i,minPoints:s}=this.options,a=n/(o*Math.pow(2,t));for(let n=0;n<e.length;n++){const o=e[n];if(o.zoom<=t)continue;o.zoom=t;const l=this.trees[t+1],u=l.within(o.x,o.y,a),A=o.numPoints||1;let c=A;for(const e of u){const r=l.points[e];r.zoom>t&&(c+=r.numPoints||1)}if(c>A&&c>=s){let e=o.x*A,s=o.y*A,a=i&&A>1?this._map(o,!0):null;const h=(n<<5)+(t+1)+this.points.length;for(const r of u){const n=l.points[r];if(n.zoom<=t)continue;n.zoom=t;const u=n.numPoints||1;e+=n.x*u,s+=n.y*u,n.parentId=h,i&&(a||(a=this._map(o,!0)),i(a,this._map(n)))}o.parentId=h,r.push(F(e/c,s/c,h,c,a))}else if(r.push(o),c>1)for(const e of u){const n=l.points[e];n.zoom<=t||(n.zoom=t,r.push(n))}}return r}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?Z({},e.properties):e.properties;const r=this.points[e.index].properties,n=this.options.map(r);return t&&n===r?Z({},n):n}}function F(e,t,r,n,o){return{x:P(e),y:P(t),zoom:1/0,id:r,parentId:-1,numPoints:n,properties:o}}function O(e,t){const[r,n]=e.geometry.coordinates;return{x:P(j(r)),y:P(G(n)),zoom:1/0,index:t,parentId:-1}}function U(e){return{type:"Feature",id:e.id,properties:V(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),N(e.y)]}};var t}function V(e){const t=e.numPoints,r=t>=1e4?`${Math.round(t/1e3)}k`:t>=1e3?Math.round(t/100)/10+"k":t;return Z(Z({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:r})}function j(e){return e/360+.5}function G(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function N(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function Z(e,t){for(const r in t)e[r]=t[r];return e}function $(e){return e.x}function Q(e){return e.y}function H(e,t,r,n){for(var o,i=n,s=r-t>>1,a=r-t,l=e[t],u=e[t+1],A=e[r],c=e[r+1],h=t+3;h<r;h+=3){var p=W(e[h],e[h+1],l,u,A,c);if(p>i)o=h,i=p;else if(p===i){var g=Math.abs(h-s);g<a&&(o=h,a=g)}}i>n&&(o-t>3&&H(e,t,o,n),e[o+2]=i,r-o>3&&H(e,o,r,n))}function W(e,t,r,n,o,i){var s=o-r,a=i-n;if(0!==s||0!==a){var l=((e-r)*s+(t-n)*a)/(s*s+a*a);l>1?(r=o,n=i):l>0&&(r+=s*l,n+=a*l)}return(s=e-r)*s+(a=t-n)*a}function q(e,t,r,n){var o={id:void 0===e?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)X(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<t.length;n++)X(e,t[n]);else if("MultiPolygon"===r)for(n=0;n<t.length;n++)for(var o=0;o<t[n].length;o++)X(e,t[n][o])}(o),o}function X(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function Y(e,t,r,n){if(t.geometry){var o=t.geometry.coordinates,i=t.geometry.type,s=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),a=[],l=t.id;if(r.promoteId?l=t.properties[r.promoteId]:r.generateId&&(l=n||0),"Point"===i)K(o,a);else if("MultiPoint"===i)for(var u=0;u<o.length;u++)K(o[u],a);else if("LineString"===i)J(o,a,s,!1);else if("MultiLineString"===i){if(r.lineMetrics){for(u=0;u<o.length;u++)J(o[u],a=[],s,!1),e.push(q(l,"LineString",a,t.properties));return}ee(o,a,s,!1)}else if("Polygon"===i)ee(o,a,s,!0);else{if("MultiPolygon"!==i){if("GeometryCollection"===i){for(u=0;u<t.geometry.geometries.length;u++)Y(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<o.length;u++){var A=[];ee(o[u],A,s,!0),a.push(A)}}e.push(q(l,i,a,t.properties))}}function K(e,t){t.push(te(e[0])),t.push(ie(e[1])),t.push(0)}function J(e,t,r,n){for(var o,i,s=0,a=0;a<e.length;a++){var l=te(e[a][0]),u=ie(e[a][1]);t.push(l),t.push(u),t.push(0),a>0&&(s+=n?(o*u-l*i)/2:Math.sqrt(Math.pow(l-o,2)+Math.pow(u-i,2))),o=l,i=u}var A=t.length-3;t[2]=1,H(t,0,A,r),t[A+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function ee(e,t,r,n){for(var o=0;o<e.length;o++){var i=[];J(e[o],i,r,n),t.push(i)}}function te(e){return e/360+.5}function ie(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function re(e,t,r,n,o,i,s,a){if(n/=t,i>=(r/=t)&&s<n)return e;if(s<r||i>=n)return null;for(var l=[],u=0;u<e.length;u++){var A=e[u],c=A.geometry,h=A.type,p=0===o?A.minX:A.minY,g=0===o?A.maxX:A.maxY;if(p>=r&&g<n)l.push(A);else if(!(g<r||p>=n)){var d=[];if("Point"===h||"MultiPoint"===h)ne(c,d,r,n,o);else if("LineString"===h)oe(c,d,r,n,o,!1,a.lineMetrics);else if("MultiLineString"===h)se(c,d,r,n,o,!1);else if("Polygon"===h)se(c,d,r,n,o,!0);else if("MultiPolygon"===h)for(var f=0;f<c.length;f++){var m=[];se(c[f],m,r,n,o,!0),m.length&&d.push(m)}if(d.length){if(a.lineMetrics&&"LineString"===h){for(f=0;f<d.length;f++)l.push(q(A.id,h,d[f],A.tags));continue}"LineString"!==h&&"MultiLineString"!==h||(1===d.length?(h="LineString",d=d[0]):h="MultiLineString"),"Point"!==h&&"MultiPoint"!==h||(h=3===d.length?"Point":"MultiPoint"),l.push(q(A.id,h,d,A.tags))}}}return l.length?l:null}function ne(e,t,r,n,o){for(var i=0;i<e.length;i+=3){var s=e[i+o];s>=r&&s<=n&&(t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]))}}function oe(e,t,r,n,o,i,s){for(var a,l,u=ae(e),A=0===o?Ae:ce,c=e.start,h=0;h<e.length-3;h+=3){var p=e[h],g=e[h+1],d=e[h+2],f=e[h+3],m=e[h+4],_=0===o?p:g,y=0===o?f:m,x=!1;s&&(a=Math.sqrt(Math.pow(p-f,2)+Math.pow(g-m,2))),_<r?y>r&&(l=A(u,p,g,f,m,r),s&&(u.start=c+a*l)):_>n?y<n&&(l=A(u,p,g,f,m,n),s&&(u.start=c+a*l)):le(u,p,g,d),y<r&&_>=r&&(l=A(u,p,g,f,m,r),x=!0),y>n&&_<=n&&(l=A(u,p,g,f,m,n),x=!0),!i&&x&&(s&&(u.end=c+a*l),t.push(u),u=ae(e)),s&&(c+=a)}var v=e.length-3;p=e[v],g=e[v+1],d=e[v+2],(_=0===o?p:g)>=r&&_<=n&&le(u,p,g,d),v=u.length-3,i&&v>=3&&(u[v]!==u[0]||u[v+1]!==u[1])&&le(u,u[0],u[1],u[2]),u.length&&t.push(u)}function ae(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function se(e,t,r,n,o,i){for(var s=0;s<e.length;s++)oe(e[s],t,r,n,o,i,!1)}function le(e,t,r,n){e.push(t),e.push(r),e.push(n)}function Ae(e,t,r,n,o,i){var s=(i-t)/(n-t);return e.push(i),e.push(r+(o-r)*s),e.push(1),s}function ce(e,t,r,n,o,i){var s=(i-r)/(o-r);return e.push(t+(n-t)*s),e.push(i),e.push(1),s}function ue(e,t){for(var r=[],n=0;n<e.length;n++){var o,i=e[n],s=i.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)o=he(i.geometry,t);else if("MultiLineString"===s||"Polygon"===s){o=[];for(var a=0;a<i.geometry.length;a++)o.push(he(i.geometry[a],t))}else if("MultiPolygon"===s)for(o=[],a=0;a<i.geometry.length;a++){for(var l=[],u=0;u<i.geometry[a].length;u++)l.push(he(i.geometry[a][u],t));o.push(l)}r.push(q(i.id,s,o,i.tags))}return r}function he(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function pe(e,t){if(e.transformed)return e;var r,n,o,i=1<<e.z,s=e.x,a=e.y;for(r=0;r<e.features.length;r++){var l=e.features[r],u=l.geometry,A=l.type;if(l.geometry=[],1===A)for(n=0;n<u.length;n+=2)l.geometry.push(de(u[n],u[n+1],t,i,s,a));else for(n=0;n<u.length;n++){var c=[];for(o=0;o<u[n].length;o+=2)c.push(de(u[n][o],u[n][o+1],t,i,s,a));l.geometry.push(c)}}return e.transformed=!0,e}function de(e,t,r,n,o,i){return[Math.round(r*(e*n-o)),Math.round(r*(t*n-i))]}function fe(e,t,r,n,o){for(var i=t===o.maxZoom?0:o.tolerance/((1<<t)*o.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,me(s,e[a],i,o);var l=e[a].minX,u=e[a].minY,A=e[a].maxX,c=e[a].maxY;l<s.minX&&(s.minX=l),u<s.minY&&(s.minY=u),A>s.maxX&&(s.maxX=A),c>s.maxY&&(s.maxY=c)}return s}function me(e,t,r,n){var o=t.geometry,i=t.type,s=[];if("Point"===i||"MultiPoint"===i)for(var a=0;a<o.length;a+=3)s.push(o[a]),s.push(o[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===i)_e(s,o,e,r,!1,!1);else if("MultiLineString"===i||"Polygon"===i)for(a=0;a<o.length;a++)_e(s,o[a],e,r,"Polygon"===i,0===a);else if("MultiPolygon"===i)for(var l=0;l<o.length;l++){var u=o[l];for(a=0;a<u.length;a++)_e(s,u[a],e,r,!0,0===a)}if(s.length){var A=t.tags||null;if("LineString"===i&&n.lineMetrics){for(var c in A={},t.tags)A[c]=t.tags[c];A.mapbox_clip_start=o.start/o.size,A.mapbox_clip_end=o.end/o.size}var h={geometry:s,type:"Polygon"===i||"MultiPolygon"===i?3:"LineString"===i||"MultiLineString"===i?2:1,tags:A};null!==t.id&&(h.id=t.id),e.features.push(h)}}function _e(e,t,r,n,o,i){var s=n*n;if(n>0&&t.size<(o?s:n))r.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>s)&&(r.numSimplified++,a.push(t[l]),a.push(t[l+1])),r.numPoints++;o&&function(e,t){for(var r=0,n=0,o=e.length,i=o-2;n<o;i=n,n+=2)r+=(e[n]-e[i])*(e[n+1]+e[i+1]);if(r>0===t)for(n=0,o=e.length;n<o/2;n+=2){var s=e[n],a=e[n+1];e[n]=e[o-2-n],e[n+1]=e[o-1-n],e[o-2-n]=s,e[o-1-n]=a}}(a,i),e.push(a)}}function ge(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)Y(r,e.features[n],t,n);else Y(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(e,t){var r=t.buffer/t.extent,n=e,o=re(e,1,-1-r,r,0,-1,2,t),i=re(e,1,1-r,2+r,0,-1,2,t);return(o||i)&&(n=re(e,1,-r,1+r,0,-1,2,t)||[],o&&(n=ue(o,1).concat(n)),i&&(n=n.concat(ue(i,-1)))),n}(n,t)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ye(e,t,r){return 32*((1<<e)*r+t)+e}function xe(e,t){const r=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return t(null,null);const o=new A(n.features);let i=d(o);0===i.byteOffset&&i.byteLength===i.buffer.byteLength||(i=new Uint8Array(i)),t(null,{vectorTile:o,rawData:i.buffer})}ge.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ge.prototype.splitTile=function(e,t,r,n,o,i,s){for(var a=[e,t,r,n],l=this.options,u=l.debug;a.length;){n=a.pop(),r=a.pop(),t=a.pop(),e=a.pop();var A=1<<t,c=ye(t,r,n),h=this.tiles[c];if(!h&&(u>1&&console.time("creation"),h=this.tiles[c]=fe(e,t,r,n,l),this.tileCoords.push({z:t,x:r,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(h.source=e,o){if(t===l.maxZoom||t===o)continue;var g=1<<o-t;if(r!==Math.floor(i/g)||n!==Math.floor(s/g))continue}else if(t===l.indexMaxZoom||h.numPoints<=l.indexMaxPoints)continue;if(h.source=null,0!==e.length){u>1&&console.time("clipping");var d,f,m,_,y,x,v=.5*l.buffer/l.extent,w=.5-v,T=.5+v,b=1+v;d=f=m=_=null,y=re(e,A,r-v,r+T,0,h.minX,h.maxX,l),x=re(e,A,r+w,r+b,0,h.minX,h.maxX,l),e=null,y&&(d=re(y,A,n-v,n+T,1,h.minY,h.maxY,l),f=re(y,A,n+w,n+b,1,h.minY,h.maxY,l),y=null),x&&(m=re(x,A,n-v,n+T,1,h.minY,h.maxY,l),_=re(x,A,n+w,n+b,1,h.minY,h.maxY,l),x=null),u>1&&console.timeEnd("clipping"),a.push(d||[],t+1,2*r,2*n),a.push(f||[],t+1,2*r,2*n+1),a.push(m||[],t+1,2*r+1,2*n),a.push(_||[],t+1,2*r+1,2*n+1)}}},ge.prototype.getTile=function(e,t,r){var n=this.options,o=n.extent,i=n.debug;if(e<0||e>24)return null;var s=1<<e,a=ye(e,t=(t%s+s)%s,r);if(this.tiles[a])return pe(this.tiles[a],o);i>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var l,u=e,A=t,c=r;!l&&u>0;)u--,A=Math.floor(A/2),c=Math.floor(c/2),l=this.tiles[ye(u,A,c)];return l&&l.source?(i>1&&console.log("found parent tile z%d-%d-%d",u,A,c),i>1&&console.time("drilling down"),this.splitTile(l.source,u,A,c,e,t,r),i>1&&console.timeEnd("drilling down"),this.tiles[a]?pe(this.tiles[a],o):null):null};class ve extends e.VectorTileWorkerSource{constructor(e,t,r,n,o){super(e,t,r,n,xe),o&&(this.loadGeoJSON=o)}loadData(t,r){const n=t&&t.request,o=n&&n.collectResourceTiming;this.loadGeoJSON(t,((s,a)=>{if(s||!a)return r(s);if("object"!=typeof a)return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{i(a,!0);try{if(t.filter){const r=e.createExpression(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===r.result)throw new Error(r.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const n=a.features.filter((e=>r.value.evaluate({zoom:0},e)));a={type:"FeatureCollection",features:n}}this._geoJSONIndex=t.cluster?new R(function({superclusterOptions:t,clusterProperties:r}){if(!r||!t)return t;const n={},o={},i={accumulated:null,zoom:0},s={properties:null},a=Object.keys(r);for(const t of a){const[i,s]=r[t],a=e.createExpression(s),l=e.createExpression("string"==typeof i?[i,["accumulated"],["get",t]]:i);n[t]=a.value,o[t]=l.value}return t.map=e=>{s.properties=e;const t={};for(const e of a)t[e]=n[e].evaluate(i,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const t of a)i.accumulated=e[t],e[t]=o[t].evaluate(i,s)},t}(t)).load(a.features):function(e,t){return new ge(e,t)}(a,t.geojsonVtOptions)}catch(s){return r(s)}this.loaded={};const l={};if(o){const r=e.getPerformanceMeasurement(n);r&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(r)))}r(null,l)}}))}reloadTile(e,t){const r=this.loaded;return r&&r[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,r){if(t.request)e.getJSON(t.request,r);else{if("string"!=typeof t.data)return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return r(null,JSON.parse(t.data))}catch(e){return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class be{constructor(t){this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.getProjection({name:"mercator"}),this.workerSourceTypes={vector:e.VectorTileWorkerSource,geojson:ve},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],r()}checkIfReady(e,t,r){r()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,r){this.isSpriteLoaded[t]=r;for(const n in this.workerSources[t]){const o=this.workerSources[t][n];for(const t in o)o[t]instanceof e.VectorTileWorkerSource&&(o[t].isSpriteLoaded=r,o[t].fire(new e.Event("isSpriteLoaded")))}}setImages(e,t,r){this.availableImages[e]=t;for(const r in this.workerSources[e]){const n=this.workerSources[e][r];for(const e in n)n[e].availableImages=t}r()}enableTerrain(e,t,r){this.terrain=t,r()}setProjection(t,r){this.projections[t]=e.getProjection(r)}setLayers(e,t,r){this.getLayerIndex(e).replace(t),r()}updateLayers(e,t,r){this.getLayerIndex(e).update(t.layers,t.removedIds),r()}loadTile(t,r,n){const o=this.enableTerrain?e.extend({enableTerrain:this.terrain},r):r;o.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,r.type,r.source).loadTile(o,n)}loadDEMTile(t,r,n){const o=this.enableTerrain?e.extend({buildQuadTree:this.terrain},r):r;this.getDEMWorkerSource(t,r.source).loadTile(o,n)}reloadTile(t,r,n){const o=this.enableTerrain?e.extend({enableTerrain:this.terrain},r):r;o.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,r.type,r.source).reloadTile(o,n)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source).removeTile(t,r)}removeSource(e,t,r){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const n=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,r):r()}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e.toString())}}syncRTLPluginState(t,r,n){try{e.plugin.setState(r);const t=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=t){this.self.importScripts(t);const r=e.plugin.isParsed();n(r?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),r)}}catch(e){n(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new n),t}getWorkerSource(e,t,r){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][r]||(this.workerSources[e][t][r]=new this.workerSourceTypes[t]({send:(t,r,n,o,i,s)=>{this.actor.send(t,r,n,e,i,s)},scheduler:this.actor.scheduler},this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])),this.workerSources[e][t][r]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new o),this.demWorkerSources[e][t]}enforceCacheSizeLimit(t,r){e.enforceCacheSizeLimit(r)}getWorkerPerformanceMetrics(e,t,r){r(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new be(self)),be})),o(["./shared"],(function(e){function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],i[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const r in e)if(!t(e[r],i[r]))return!1;return!0}return e===i}var i=r;function r(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===n[t=e&&e.failIfMajorPerformanceCaveat]&&(n[t]=function(e){var t,i=function(e){var t=document.createElement("canvas"),i=Object.create(r.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}(e);if(!i)return!1;try{t=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!t||i.isContextLost())&&(i.shaderSource(t,"void main() {}"),i.compileShader(t),!0===i.getShaderParameter(t,i.COMPILE_STATUS))}(t)),n[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var n={};function o(t,i,r){const n=e.window.document.createElement(t);return void 0!==i&&(n.className=i),r&&r.appendChild(n),n}function a(t,i,r){const n=e.window.document.createElementNS("http://www.w3.org/2000/svg",t);for(const e of Object.keys(i))n.setAttributeNS(null,e,i[e]);return r&&r.appendChild(n),n}r.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const s=e.window.document&&e.window.document.documentElement.style,l=s&&void 0!==s.userSelect?"userSelect":"WebkitUserSelect";let A;function c(){s&&l&&(A=s[l],s[l]="none")}function u(){s&&l&&(s[l]=A)}function h(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",h,!0)}function d(){e.window.addEventListener("click",h,!0),e.window.setTimeout((()=>{e.window.removeEventListener("click",h,!0)}),0)}function f(e,t){const i=e.getBoundingClientRect();return g(e,i,t)}function p(e,t){const i=e.getBoundingClientRect(),r=[];for(let n=0;n<t.length;n++)r.push(g(e,i,t[n]));return r}function m(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function g(t,i,r){const n=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.pointGeometry((r.clientX-i.left)*n,(r.clientY-i.top)*n)}function _(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],a=i*o-n*r;return a?(e[0]=o*(a=1/a),e[1]=-r*a,e[2]=-n*a,e[3]=i*a,e):null}function y(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class x extends e.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}hasImage(e){return!!this.getImage(e)}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t)}_validate(t,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let i=0;for(const r of e){if(r[0]<i||r[1]<r[0]||t<r[1])return!1;i=r[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(t,i){const r={};for(const i of t){this.images[i]||this.fire(new e.Event("styleimagemissing",{id:i}));const t=this.images[i];t?r[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,r)}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(t){const i=this.patterns[t],r=this.getImage(t);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new e.ImagePosition(i,r);this.patterns[t]={bin:i,position:n}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const i=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:r}=e.potpack(t),n=this.atlasImage;n.resize({width:i||1,height:r||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],r=i.x+1,o=i.y+1,a=this.images[t].data,s=a.width,l=a.height;e.RGBAImage.copy(a,n,{x:0,y:0},{x:r,y:o},{width:s,height:l}),e.RGBAImage.copy(a,n,{x:0,y:l-1},{x:r,y:o-1},{width:s,height:1}),e.RGBAImage.copy(a,n,{x:0,y:0},{x:r,y:o+l},{width:s,height:1}),e.RGBAImage.copy(a,n,{x:s-1,y:0},{x:r-1,y:o},{width:1,height:l}),e.RGBAImage.copy(a,n,{x:0,y:0},{x:r+s,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];y(e)&&this.updateImage(t,e)}}}const b=new e.Properties({anchor:new e.DataConstantProperty(e.spec.light.anchor),position:new class{constructor(){this.specification=e.spec.light.position}possiblyEvaluate(t,i){return function([t,i,r]){const n=e.degToRad(i+90),o=e.degToRad(r);return{x:t*Math.cos(n)*Math.sin(o),y:t*Math.sin(n)*Math.sin(o),z:t*Math.cos(o),azimuthal:i,polar:r}}(t.expression.evaluate(i))}interpolate(t,i,r){return{x:e.number(t.x,i.x,r),y:e.number(t.y,i.y,r),z:e.number(t.z,i.z,r),azimuthal:e.number(t.azimuthal,i.azimuthal,r),polar:e.number(t.polar,i.polar,r)}}},color:new e.DataConstantProperty(e.spec.light.color),intensity:new e.DataConstantProperty(e.spec.light.intensity)}),v="-transition";class w extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(b),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i={}){if(!this._validate(e.validateLight,t,i))for(const i in t){const r=t[i];e.endsWith(i,v)?this._transitionable.setTransition(i.slice(0,-v.length),r):this._transitionable.setValue(i,r)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}const T=new e.Properties({source:new e.DataConstantProperty(e.spec.terrain.source),exaggeration:new e.DataConstantProperty(e.spec.terrain.exaggeration)}),E="-transition";class M extends e.Evented{constructor(t,i){super(),this._transitionable=new e.Transitionable(T),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(t){for(const i in t){const r=t[i];e.endsWith(i,E)?this._transitionable.setTransition(i.slice(0,-E.length),r):this._transitionable.setValue(i,r)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}}function C(t,i,r,n){const o=e.smoothstep(45,65,r),[a,s]=I(t,n),l=e.length(i);let A=1-Math.min(1,Math.exp((l-a)/(s-a)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*o*t.alpha}function I(e,t){const i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}const S=new e.Properties({range:new e.DataConstantProperty(e.spec.fog.range),color:new e.DataConstantProperty(e.spec.fog.color),"high-color":new e.DataConstantProperty(e.spec.fog["high-color"]),"space-color":new e.DataConstantProperty(e.spec.fog["space-color"]),"horizon-blend":new e.DataConstantProperty(e.spec.fog["horizon-blend"]),"star-intensity":new e.DataConstantProperty(e.spec.fog["star-intensity"])}),k="-transition";class z extends e.Evented{constructor(t,i){super(),this._transitionable=new e.Transitionable(S),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){const t=this._transform,i="globe"===t.projection.name,r=e.globeToMercatorTransition(t.zoom),n=this.properties.get("range"),o=[.5,3];return{range:i?[e.number(o[0],n[0],r),e.number(o[1],n[1],r)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i={}){if(!this._validate(e.validateFog,t,i)){for(const i of Object.keys(e.spec.fog))t&&void 0===t[i]&&(t[i]=e.spec.fog[i].default);for(const i in t){const r=t[i];e.endsWith(i,k)?this._transitionable.setTransition(i.slice(0,-k.length),r):this._transitionable.setValue(i,r)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.smoothstep(45,65,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(t,i,r){const n=e.MercatorCoordinate.fromLngLat(i),o=r.elevation?r.elevation.getAtPointOrZero(n):0,a=[n.x,n.y,o];return e.transformMat4(a,a,r.mercatorFogMatrix),C(t,a,r.pitch,r._fov)}(this.state,t,i):0}getFovAdjustedRange(e){return this._transform.projection.supportsFog?I(this.state,e):[0,1]}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}class D{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=e.uniqueId();const r=this.workerPool.acquire(this.id);for(let e=0;e<r.length;e++){const t=new D.Actor(r[e],i,this.id);t.name=`Worker ${e}`,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,i,r){e.asyncAll(this.actors,((e,r)=>{e.send(t,i,r)}),r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}function B(t,i,r){return i*(e.EXTENT/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}D.Actor=e.Actor;class P{constructor(e,t,i,r){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(t,i){let r,n;if(t instanceof e.pointGeometry||"number"==typeof t[0]){const o=e.pointGeometry.convert(t);r=[e.pointGeometry.convert(t)],n=i.isPointAboveHorizon(o)}else{const o=e.pointGeometry.convert(t[0]),a=e.pointGeometry.convert(t[1]);r=[o,a],n=e.polygonizeBounds(o,a).every((e=>i.isPointAboveHorizon(e)))}return new P(r,i.getCameraPoint(),n,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.pointGeometry(1,1)):this.screenBounds[1],n=e.polygonizeBounds(i,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(n[3]=this.cameraPoint)),e.bufferConvexPolygon(n,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.pointGeometry(1,1)):this.screenBounds[1],n=e.polygonizeBounds(i,r,t),o=this.cameraPoint.clone();switch(3*((o.y>i.y)+(o.y>r.y))+((o.x>i.x)+(o.x>r.x))){case 0:n[0]=o,n[4]=o.clone();break;case 1:n.splice(1,0,o);break;case 2:n[1]=o;break;case 3:n.splice(4,0,o);break;case 5:n.splice(2,0,o);break;case 6:n[3]=o;break;case 7:n.splice(3,0,o);break;case 8:n[2]=o}return n}containsTile(t,i,r,n=0){const o=t.queryPadding/i._projectionScaler+1,a=r?this._bufferedCameraMercator(o,i):this._bufferedScreenMercator(o,i);let s=t.tileID.wrap+(a.unwrapped?n:0);const l=a.polygon.map((i=>e.getTilePoint(t.tileTransform,i,s)));if(!e.polygonIntersectsBox(l,0,0,e.EXTENT,e.EXTENT))return;s=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const A=this.screenGeometryMercator.polygon.map((i=>e.getTileVec3(t.tileTransform,i,s))),c=A.map((t=>new e.pointGeometry(t[0],t[1]))),u=i.getFreeCameraOptions().position||new e.MercatorCoordinate(0,0,0),h=e.getTileVec3(t.tileTransform,u,s),d=A.map((t=>{const i=e.sub(t,t,h);return e.normalize(i,i),new e.Ray(h,i)})),f=B(t,1,i.zoom)*i._projectionScaler;return{queryGeometry:this,tilespaceGeometry:c,tilespaceRays:d,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(p=e.getBounds(l),p.min.x=e.clamp(p.min.x,0,e.EXTENT),p.min.y=e.clamp(p.min.y,0,e.EXTENT),p.max.x=e.clamp(p.max.x,0,e.EXTENT),p.max.y=e.clamp(p.max.y,0,e.EXTENT),p),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var p}_bufferedScreenMercator(e,t){const i=F(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[i]=r,r}}_bufferedCameraMercator(e,t){const i=F(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[i]=r,r}}_projectAndResample(t,i){const r=function(t,i){const r=e.multiply([],i.pixelMatrix,i.globeMatrix),n=[0,-e.GLOBE_RADIUS,0,1],o=[0,e.GLOBE_RADIUS,0,1],a=[0,0,0,1];e.transformMat4$1(n,n,r),e.transformMat4$1(o,o,r),e.transformMat4$1(a,a,r);const s=new e.pointGeometry(n[0]/n[3],n[1]/n[3]),l=new e.pointGeometry(o[0]/o[3],o[1]/o[3]),A=e.polygonContainsPoint(t,s)&&n[3]<a[3],c=e.polygonContainsPoint(t,l)&&o[3]<a[3];if(!A&&!c)return null;const u=function(e,t,i){for(let r=1;r<e.length;r++){const n=R(t.pointCoordinate3D(e[r-1]).x),o=R(t.pointCoordinate3D(e[r]).x);if(i<0){if(n<o)return{idx:r,t:-n/(o-1-n)}}else if(o<n)return{idx:r,t:(1-n)/(o+1-n)}}return null}(t,i,A?-1:1);if(!u)return null;const{idx:h,t:d}=u;let f=h>1?L(t.slice(0,h),i):[],p=h<t.length?L(t.slice(h),i):[];f=f.map((t=>new e.pointGeometry(R(t.x),t.y))),p=p.map((t=>new e.pointGeometry(R(t.x),t.y)));const m=[...f];0===m.length&&m.push(p[p.length-1]);const g=e.number(m[m.length-1].y,(0===p.length?f[0]:p[0]).y,d);let _;return _=A?[new e.pointGeometry(0,g),new e.pointGeometry(0,0),new e.pointGeometry(1,0),new e.pointGeometry(1,g)]:[new e.pointGeometry(1,g),new e.pointGeometry(1,1),new e.pointGeometry(0,1),new e.pointGeometry(0,g)],m.push(..._),0===p.length?m.push(f[0]):m.push(...p),{polygon:m.map((t=>new e.MercatorCoordinate(t.x,t.y))),unwrapped:!1}}(t,i);if(r)return r;const n=function(t,i){let r=!1,n=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>n&&(n=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const i=(o+e)%(t.length-1),n=t[i],a=t[i+1];Math.abs(n.x-a.x)>.5&&(n.x<a.x?(n.x+=1,0===i&&(t[t.length-1].x+=1)):(a.x+=1,i+1===t.length-1&&(t[0].x+=1)),r=!0)}const a=e.mercatorXfromLng(i.center.lng);return r&&a<Math.abs(a-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:r}}(L(t,i).map((t=>new e.pointGeometry(R(t.x),t.y))),i);return{polygon:n.polygon.map((t=>new e.MercatorCoordinate(t.x,t.y))),unwrapped:n.unwrapped}}}function L(t,i){return e.resample(t,(e=>{const t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function R(e){return e<0?1+e%1:e%1}function F(e){return 100*e|0}function O(t,i,r,n,o){const a=function(r,n){if(r)return o(r);if(n){const r=e.pick(e.extend(n,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(r.vectorLayers=n.vector_layers,r.vectorLayerIds=r.vectorLayers.map((e=>e.id))),n.language_options&&(r.languageOptions=n.language_options),n.language&&n.language[n.id]&&(r.language=n.language[n.id]),n.worldview_options&&(r.worldviewOptions=n.worldview_options),n.worldview?r.worldview=n.worldview[n.id]:n.worldview_default&&(r.worldview=n.worldview_default),r.tiles=i.canonicalizeTileset(r,t.url),o(null,r)}};return t.url?e.getJSON(i.transformRequest(i.normalizeSourceURL(t.url,null,r,n),e.ResourceType.Source),a):e.exported.frame((()=>a(null,t)))}class U{constructor(t,i,r){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),r=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*i),n=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*i),o=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*i),a=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*i);return t.x>=r&&t.x<o&&t.y>=n&&t.y<a}}class V{constructor(e,t,i){this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const j={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class G{constructor(e,t,i,r){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),e.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=t.attributes[n.name];void 0!==o&&e.vertexAttribPointer(o,n.components,e[j[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class N{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Z extends N{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class $ extends N{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Q extends N{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class q extends N{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class H extends N{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class W extends N{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class X extends N{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Y extends N{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class K extends N{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class J extends N{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ee extends N{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class te extends N{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ie extends N{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class re extends N{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ne extends N{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class oe extends N{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ae extends N{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class se extends N{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class le extends N{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Ae extends N{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ce extends N{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ue extends N{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class he extends N{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class pe extends N{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class de extends N{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class fe extends N{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class me extends N{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class _e extends N{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class ge extends N{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ye extends N{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class xe extends N{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class ve extends N{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class be extends ve{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class we extends ve{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Te extends we{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ee{constructor(e,t,i,r){this.context=e,this.width=t,this.height=i;const n=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new be(e,n),r&&(this.depthAttachment=new we(e,n))}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class Me{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Z(this),this.clearDepth=new $(this),this.clearStencil=new Q(this),this.colorMask=new q(this),this.depthMask=new H(this),this.stencilMask=new W(this),this.stencilFunc=new X(this),this.stencilOp=new Y(this),this.stencilTest=new K(this),this.depthRange=new J(this),this.depthTest=new ee(this),this.depthFunc=new te(this),this.blend=new ie(this),this.blendFunc=new re(this),this.blendColor=new ne(this),this.blendEquation=new oe(this),this.cullFace=new ae(this),this.cullFaceSide=new se(this),this.frontFace=new le(this),this.program=new Ae(this),this.activeTexture=new ce(this),this.viewport=new ue(this),this.bindFramebuffer=new he(this),this.bindRenderbuffer=new pe(this),this.bindTexture=new de(this),this.bindVertexBuffer=new fe(this),this.bindElementBuffer=new me(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new _e(this),this.pixelStoreUnpack=new ge(this),this.pixelStoreUnpackPremultiplyAlpha=new ye(this),this.pixelStoreUnpackFlipY=new xe(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=e.getExtension("OES_standard_derivatives"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new V(this,e,t)}createVertexBuffer(e,t,i){return new G(this,e,t,i)}createRenderbuffer(e,t,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,i){return new Ee(this,e,t,i)}clear({color:e,depth:t,stencil:i}){const r=this.gl;let n=0;e&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(n|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(n)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(i){t(i.blendFunction,e.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ce extends e.Evented{constructor(t,i,r,n){super(),this.id=t,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.extend({type:"raster"},i),e.extend(this,e.pick(i,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=O(this._options,this.map._requestManager,null,null,((t,i)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new U(i.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(i.tiles),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const r=e.exported.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(n,e.ResourceType.Tile),((r,n,o,a)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):r?(t.state="errored",i(r)):n?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:a}),t.setTexture(n,this.map.painter),t.state="loaded",e.cacheEntryPossiblyAdded(this.dispatcher),void i(null)):i(null))))}static loadTileData(e,t,i){e.setTexture(t,i)}static unloadTileData(e,t){e.texture&&t.saveTileTexture(e.texture)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}}let Ie;function Se(t,i,r,n,o,a,s,l){const A=[t,r,o,i,n,a,1,1,1],c=[s,l,1],u=e.adjoint([],A),[h,d,f]=e.transformMat3(c,c,e.transpose(u,u));return e.multiply$1(A,[h,0,0,0,d,0,0,0,f],A)}class ke extends e.Evented{constructor(e,t,i,r){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=t}load(t,i){this._loaded=i||!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),((i,r)=>{if(this._loaded=!0,i)this.fire(new e.ErrorEvent(i));else if(r){const{HTMLImageElement:i}=e.window;this.image=r instanceof i?e.exported.getImageData(r):r,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const i=t.map(e.MercatorCoordinate.fromLngLat);return this.tileID=function(t){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const e of t)i=Math.min(i,e.x),r=Math.min(r,e.y),n=Math.max(n,e.x),o=Math.max(o,e.y);const a=Math.max(n-i,o-r),s=Math.max(0,Math.floor(-Math.log(a)/Math.LN2)),l=Math.pow(2,s);return new e.CanonicalTileID(s,Math.floor((i+n)/2*l),Math.floor((r+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray)return;const i=e.tileTransform(this.tileID,this.map.transform.projection),[r,n,o,a]=this.coordinates.map((t=>{const r=i.projection.project(t[0],t[1]);return e.getTilePoint(i,r)._round()}));this.perspectiveTransform=function(t,i,r,n,o,a,s,l,A,c){const u=Se(0,0,t,0,0,i,t,i),h=Se(r,n,o,a,s,l,A,c);return e.multiply$1(h,e.adjoint(u,u),h),[h[6]/h[8]*t/e.EXTENT,h[7]/h[8]*i/e.EXTENT]}(this.width,this.height,r.x,r.y,n.x,n.y,a.x,a.y,o.x,o.y);const s=this._boundsArray=new e.StructArrayLayout4i8;s.emplaceBack(r.x,r.y,0,0),s.emplaceBack(n.x,n.y,e.EXTENT,0),s.emplaceBack(a.x,a.y,0,e.EXTENT),s.emplaceBack(o.x,o.y,e.EXTENT,e.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(s,e.boundsAttributes.members),this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,i=t.gl;this.texture?this.texture.update(this.image):(this.texture=new e.Texture(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ze={vector:class extends e.Evented{constructor(t,i,r,n){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(i,["url","scheme","tileSize","promoteId"])),this._options=e.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new e.DedupedRequest}load(t){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"}));const i=this.language||this.map._language,r=this.worldview||this.map._worldview;this._tileJSONRequest=O(this._options,this.map._requestManager,i,r,((n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${i}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new e.ErrorEvent(n))):o&&(e.extend(this,o),o.bounds&&(this.tileBounds=new U(o.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load((()=>{const e=this.map.style._getSourceCaches(this.id);for(const t of e)t.clearTiles()}))}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}_setLanguage(e){return e===this.language||this.setSourceProperty((()=>{this.language=e})),this}_setWorldview(e){return e===this.worldview?this:this.worldviewOptions&&e&&!this.worldviewOptions[e]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${e}".`),this):(this.setSourceProperty((()=>{this.worldview=e})),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,e.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(n.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",n,o.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",n,o.bind(this),void 0,!0);else{const i=e.loadVectorTile.call({deduped:this._deduped},n,((e,i)=>{e||!i?o.call(this,e):(n.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",n,o.bind(this),void 0,!0))}),!0);t.request={cancel:i}}function o(r,n){return delete t.request,t.aborted?i(null):r&&404!==r.status?i(r):(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Ce,"raster-dem":class extends Ce{constructor(t,i,r,n){super(t,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=e.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(e,r){e&&(t.state="errored",i(e)),r&&(t.dem=r,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null))}t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),function(r,o,a,s){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(r)t.state="errored",i(r);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:s});const i=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap&&(null==Ie&&(Ie=e.window.OffscreenCanvas&&new e.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof e.window.createImageBitmap),Ie),r=1-(o.width-e.prevPowerOfTwo(o.width))/2;r<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=i?o:e.exported.getImageData(o,r),A={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:r};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",A,n.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const i=t.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?t.wrap-1:t.wrap,a=(i.x+1+r)%r,s=i.x+1===r?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,a,i.y).key]={backfilled:!1},i.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,a,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new e.OverscaledTileID(t.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,a,i.y+1).key]={backfilled:!1}),l}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends e.Evented{constructor(t,i,r,n){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=e.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.Event("dataloading",{dataType:"source"})),this._loaded=!1;const t=e.extend({},this.workerOptions),i=this._data;"string"==typeof i?(t.request=this.map._requestManager.transformRequest(e.exported.resolveURL(i),e.ResourceType.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((t,i)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new e.ErrorEvent(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(t.resourceTiming=i.resourceTiming[this.id]),this.fire(new e.Event("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,i){const r=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(r,{type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((e,n)=>(delete t.request,t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(n,this.map.painter,"reloadTile"===r),i(null)))),void 0,"loadTile"===r)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ke{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.ResourceType.Source).url);e.getVideo(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ke,canvas:class extends ke{constructor(t,i,r,n){super(t,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.Evented{constructor(t,i,r,n){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=i,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new U(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.coveringTiles=this._coveringTiles.bind(this),e.extend(this,e.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:r}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const{x:r,y:n,z:o}=t.tileID.canonical,a=new e.window.AbortController,s=this._implementation.loadTile({x:r,y:n,z:o},{signal:a.signal});if(!s)return this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",i(null);s.cancel=()=>a.abort(),t.request=s.then(function(r){return delete t.request,t.aborted?(t.state="unloaded",i(null)):r?function(t){return t instanceof e.window.ImageData||t instanceof e.window.ImageBitmap||t instanceof e.window.HTMLCanvasElement}(r)?(this.loadTileData(t,r),t.state="loaded",void i(null)):(t.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",i(null))}.bind(this)).catch((e=>{20!==e.code&&(t.state="errored",i(e))}))}loadTileData(e,t){Ce.loadTileData(e,t,this._map.painter)}unloadTileData(e){Ce.unloadTileData(e,this._map.painter)}prepareTile(e){if(!this._implementation.prepareTile)return null;const{x:t,y:i,z:r}=e.tileID.canonical,n=this._implementation.prepareTile({x:t,y:i,z:r});return n?(this.loadTileData(e,n),e.state="loaded",n):null}unloadTile(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){const{x:t,y:i,z:r}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:i,z:r})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_update(){this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}}},De=function(t,i,r,n){const o=new ze[i.type](t,i,r,n);if(o.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${o.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],o),o};function Be(t,i){const r=e.identity([]);return e.scale(r,r,[.5*t.width,.5*-t.height,1]),e.translate(r,r,[1,-1,0]),e.multiply(r,r,t.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(r)}function Pe(e,t,i,r,n,o,a,s=!1){const l=e.tilesIn(r,a,s);l.sort(Re);const A=[];for(const r of l)A.push({wrappedTileID:r.tile.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(t,i,e._state,r,n,o,Be(e.transform,r.tile.tileID),s)});const c=function(e){const t={},i={};for(const r of e){const e=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in e){const r=e[i],n=o[i]=o[i]||{},a=t[i]=t[i]||[];for(const e of r)n[e.featureIndex]||(n[e.featureIndex]=!0,a.push(e))}}return t}(A);for(const t in c)c[t].forEach((t=>{const i=t.feature,r=i.layer;r&&"background"!==r.type&&"sky"!==r.type&&(i.source=r.source,r["source-layer"]&&(i.sourceLayer=r["source-layer"]),i.state=void 0!==i.id?e.getFeatureState(r["source-layer"],i.id):{})}));return c}function Le(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],n={};for(let e=0;e<i.length;e++){const o=i[e],a=o.tileID.canonical.key;n[a]||(n[a]=!0,o.querySourceFeatures(r,t))}return r}function Re(e,t){const i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}function Fe(){return null!=uo.workerClass?new uo.workerClass:new e.window.Worker(uo.workerUrl)}const Oe="mapboxgl_preloaded_worker_pool";class Ue{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ue.workerCount;)this.workers.push(new Fe);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Oe]}numActive(){return Object.keys(this.active).length}}let Ve;function je(){return Ve||(Ve=new Ue),Ve}function Ge(t,i){const r={};for(const e in t)"ref"!==e&&(r[e]=t[e]);return e.refProperties.forEach((e=>{e in i&&(r[e]=i[e])})),r}function Ne(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=Ge(e[i],t[e[i].ref]));return e}Ue.workerCount=2;const Ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qe(e,t,i){i.push({command:Ze.addSource,args:[e,t[e]]})}function $e(e,t,i){t.push({command:Ze.removeSource,args:[e]}),i[e]=!0}function Qe(e,t,i,r){$e(e,i,r),qe(e,t,i)}function He(e,i,r){let n;for(n in e[r])if(e[r].hasOwnProperty(n)&&"data"!==n&&!t(e[r][n],i[r][n]))return!1;for(n in i[r])if(i[r].hasOwnProperty(n)&&"data"!==n&&!t(e[r][n],i[r][n]))return!1;return!0}function We(e,i,r,n,o,a){let s;for(s in i=i||{},e=e||{})e.hasOwnProperty(s)&&(t(e[s],i[s])||r.push({command:a,args:[n,s,i[s],o]}));for(s in i)i.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t(e[s],i[s])||r.push({command:a,args:[n,s,i[s],o]}))}function Xe(e){return e.id}function Ye(e,t){return e[t.id]=t,e}class Ke{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);let i=1,r=this._distances[i];const n=t*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const o=i-1,a=this._distances[o],s=r-a,l=s>0?(n-a)/s:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}class Je{constructor(e,t,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)}_insertBoxCell(e,t,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(e,t,i,r,n,o){this.circleCells[n].push(o)}_query(e,t,i,r,n,o){if(i<0||e>this.width||r<0||t>this.height)return!n&&[];const a=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],r=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-r,y1:i-r,x2:t+r,y2:i+r})}return o?a.filter(o):a}return this._forEachCell(e,t,i,r,this._queryCell,a,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?a.length>0:a}_queryCircle(e,t,i,r,n){const o=e-i,a=e+i,s=t-i,l=t+i;if(a<0||o>this.width||l<0||s>this.height)return!r&&[];const A=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,A,{hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},n),r?A.length>0:A}query(e,t,i,r,n){return this._query(e,t,i,r,!1,n)}hitTest(e,t,i,r,n){return this._query(e,t,i,r,!0,n)}hitTestCircle(e,t,i,r){return this._queryCircle(e,t,i,!0,r)}_queryCell(e,t,i,r,n,o,a,s){const l=a.seenUids,A=this.boxCells[n];if(null!==A){const n=this.bboxes;for(const c of A)if(!l.box[c]){l.box[c]=!0;const A=4*c;if(e<=n[A+2]&&t<=n[A+3]&&i>=n[A+0]&&r>=n[A+1]&&(!s||s(this.boxKeys[c]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[c],x1:n[A],y1:n[A+1],x2:n[A+2],y2:n[A+3]})}}}const c=this.circleCells[n];if(null!==c){const n=this.circles;for(const A of c)if(!l.circle[A]){l.circle[A]=!0;const c=3*A;if(this._circleAndRectCollide(n[c],n[c+1],n[c+2],e,t,i,r)&&(!s||s(this.circleKeys[A]))){if(a.hitTest)return o.push(!0),!0;{const e=n[c],t=n[c+1],i=n[c+2];o.push({key:this.circleKeys[A],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,r,n,o,a,s){const l=a.circle,A=a.seenUids,c=this.boxCells[n];if(null!==c){const e=this.bboxes;for(const t of c)if(!A.box[t]){A.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!s||s(this.boxKeys[t])))return o.push(!0),!0}}const u=this.circleCells[n];if(null!==u){const e=this.circles;for(const t of u)if(!A.circle[t]){A.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,i,r,n,o,a,s){const l=this._convertToXCellCoord(e),A=this._convertToYCellCoord(t),c=this._convertToXCellCoord(i),u=this._convertToYCellCoord(r);for(let h=l;h<=c;h++)for(let l=A;l<=u;l++)if(n.call(this,e,t,i,r,this.xCellCount*l+h,o,a,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,r,n,o){const a=r-e,s=n-t,l=i+o;return l*l>a*a+s*s}_circleAndRectCollide(e,t,i,r,n,o,a){const s=(o-r)/2,l=Math.abs(e-(r+s));if(l>s+i)return!1;const A=(a-n)/2,c=Math.abs(t-(n+A));if(c>A+i)return!1;if(l<=s||c<=A)return!0;const u=l-s,h=c-A;return u*u+h*h<=i*i}}const et=Math.tan(85*Math.PI/180);function tt(t,i,r,n,o,a,s){const l=e.create();if(r)if("globe"===a.name){const t=e.calculateGlobeLabelMatrix(o,i);e.multiply(l,l,t)}else{const t=_([],s);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],n||e.rotateZ(l,l,o.angle)}else e.multiply(l,o.labelPlaneMatrix,t);return l}function it(e,t,i,r,n,o,a){const s=tt(e,t,i,r,n,o,a);return"globe"===o.name&&i||(s[2]=s[6]=s[10]=s[14]=0),s}function nt(t,i,r,n,o,a,s){if(r){if("globe"===a.name){const l=tt(t,i,r,n,o,a,s);return e.invert(l,l),e.multiply(l,t,l),l}{const i=e.clone(t),r=e.identity([]);return r[0]=s[0],r[1]=s[1],r[4]=s[2],r[5]=s[3],e.multiply(i,i,r),n||e.rotateZ(i,i,-o.angle),i}}return o.glCoordMatrix}function rt(t,i,r=0){const n=[t.x,t.y,r,1];r?e.transformMat4$1(n,n,i):_t(n,n,i);const o=n[3];return{point:[n[0]/o,n[1]/o,n[2]/o],signedDistanceFromCamera:o}}function ot(t,i){const r=[t[0],t[1],t[2],1];e.transformMat4$1(r,r,i);const n=r[3];return{point:[r[0]/n,r[1]/n,r[2]/n],signedDistanceFromCamera:n}}function at(e,t){return Math.min(.5+e/t*.5,1.5)}function st(e,t){const i=e[0]/e[3],r=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&r>=-t[1]&&r<=t[1]}function lt(t,i,r,n,o,a,s,l,A,c){const u=r.transform,h=n?t.textSizeData:t.iconSizeData,d=e.evaluateSizeForZoom(h,r.transform.zoom),f="globe"===u.projection.name,p=[256/r.width*2+1,256/r.height*2+1],m=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;m.clear();let g=null;f&&(g=n?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const _=t.lineVertexArray,y=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=r.transform.width/r.transform.height;let b=!1;for(let n=0;n<y.length;n++){const f=y.get(n);if(f.writingMode!==e.WritingMode.vertical||b||0!==n&&y.get(n-1).writingMode===e.WritingMode.horizontal||(b=!0),(f.hidden||f.writingMode===e.WritingMode.vertical)&&!b){mt(f.numGlyphs,m);continue}b=!1;const v=new e.pointGeometry(f.tileAnchorX,f.tileAnchorY),w=A?A(v):[0,0,0],T=u.projection.projectTilePoint(v.x,v.y,c.canonical),E=[T.x+w[0],T.y+w[1],T.z+w[2]],M=[...E,1];if(e.transformMat4$1(M,M,i),!st(M,p)){mt(f.numGlyphs,m);continue}const C=at(r.transform.cameraToCenterDistance,M[3]),I=e.evaluateSizeForFeature(h,d,f),S=s?I/C:I*C,k=rt(new e.pointGeometry(E[0],E[1]),o,E[2]);if(k.signedDistanceFromCamera<=0){mt(f.numGlyphs,m);continue}let z={};const D=s?null:A,B=ut(f,S,!1,l,i,o,a,t.glyphOffsetArray,_,m,g,k.point,v,z,x,D,u.projection,c,s);b=B.useVertical,D&&B.needsFlipping&&(z={}),(B.notEnoughRoom||b||B.needsFlipping&&ut(f,S,!0,l,i,o,a,t.glyphOffsetArray,_,m,g,k.point,v,z,x,D,u.projection,c,s).notEnoughRoom)&&mt(f.numGlyphs,m)}n?(t.text.dynamicLayoutVertexBuffer.updateData(m),g&&t.text.globeExtVertexBuffer.updateData(g)):(t.icon.dynamicLayoutVertexBuffer.updateData(m),g&&t.icon.globeExtVertexBuffer.updateData(g))}function At(e,t,i,r,n,o,a,s,l,A,c,u,h,d,f,p){const m=s.glyphStartIndex+s.numGlyphs,g=s.lineStartIndex,_=s.lineStartIndex+s.lineLength,y=t.getoffsetX(s.glyphStartIndex),x=t.getoffsetX(m-1),b=pt(e*y,i,r,n,o,a,s.segment,g,_,l,A,c,u,h,!0,d,f,p);if(!b)return null;const v=pt(e*x,i,r,n,o,a,s.segment,g,_,l,A,c,u,h,!0,d,f,p);return v?{first:b,last:v}:null}function ct(t,i,r,n){return t.writingMode===e.WritingMode.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*n?{useVertical:!0}:t.writingMode===e.WritingMode.vertical?i.y<r.y?{needsFlipping:!0}:null:0!==t.flipState&&function(e,t,i){const r=(t.x-e.x)*i;return 0===r||Math.abs((t.y-e.y)/r)>et}(i,r,n)?1===t.flipState?{needsFlipping:!0}:null:i.x>r.x?{needsFlipping:!0}:null}function ut(t,i,r,n,o,a,s,l,A,c,u,h,d,f,p,m,g,_,y){const x=i/24,b=t.lineOffsetX*x,v=t.lineOffsetY*x;let w;if(t.numGlyphs>1){const i=t.glyphStartIndex+t.numGlyphs,o=t.lineStartIndex,c=t.lineStartIndex+t.lineLength,u=At(x,l,b,v,r,h,d,t,A,a,f,m,!1,g,_,y);if(!u)return{notEnoughRoom:!0};const T=ot(u.first.point,s).point,E=ot(u.last.point,s).point,M=new e.pointGeometry(T[0],T[1]),C=new e.pointGeometry(E[0],E[1]);if(n&&!r){const e=ct(t,M,C,p);if(t.flipState=e&&e.needsFlipping?1:2,e)return e}w=[u.first];for(let e=t.glyphStartIndex+1;e<i-1;e++)w.push(pt(x*l.getoffsetX(e),b,v,r,h,d,t.segment,o,c,A,a,f,m,!1,!1,g,_,y));w.push(u.last)}else{if(n&&!r){const i=rt(d,o).point,r=t.lineStartIndex+t.segment+1,n=new e.pointGeometry(A.getx(r),A.gety(r)),a=rt(n,o),s=a.signedDistanceFromCamera>0?a.point:dt(d,n,i,1,o,void 0,g,_.canonical),l=ct(t,new e.pointGeometry(i[0],i[1]),new e.pointGeometry(s[0],s[1]),p);if(t.flipState=l&&l.needsFlipping?1:2,l)return l}const i=pt(x*l.getoffsetX(t.glyphStartIndex),b,v,r,h,d,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,A,a,f,m,!1,!1,g,_,y);if(!i)return{notEnoughRoom:!0};w=[i]}if(u)for(const t of w)e.updateGlobeVertexNormal(u,c.length+0,t.up[0],t.up[1],t.up[2]),e.updateGlobeVertexNormal(u,c.length+1,t.up[0],t.up[1],t.up[2]),e.updateGlobeVertexNormal(u,c.length+2,t.up[0],t.up[1],t.up[2]),e.updateGlobeVertexNormal(u,c.length+3,t.up[0],t.up[1],t.up[2]),e.addDynamicAttributes(c,t.point[0],t.point[1],t.point[2],t.angle);else for(const t of w)e.addDynamicAttributes(c,t.point[0],t.point[1],t.point[2],t.angle);return{}}function ht(t,i,r,n,o){const a=n.projectTilePoint(t.x,t.y,i);if(!o)return rt(a,r,a.z);const s=o(t);return rt(new e.pointGeometry(a.x+s[0],a.y+s[1]),r,a.z+s[2])}function dt(t,i,r,n,o,a,s,l){const A=ht(t.add(t.sub(i)._unit()),l,o,s,a).point,c=e.sub([],r,A);return e.scaleAndAdd([],r,c,n/e.length(c))}function pt(t,i,r,n,o,a,s,l,A,c,u,h,d,f,p,m,g,_){const y=n?t-i:t+i;let x=y>0?1:-1,b=0;n&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let v=x>0?l+s:l+s+1,w=o,T=o,E=0,M=0;const C=Math.abs(y),I=[],S=[];let k=a;const z=()=>{const t=v-x;return 0===E?a:new e.pointGeometry(c.getx(t),c.gety(t))},D=()=>dt(z(),k,T,C-E+1,u,d,m,g.canonical);for(;E+M<=C;){if(v+=x,v<l||v>=A)return null;if(T=w,I.push(w),f&&S.push(k||z()),w=h[v],void 0===w){k=new e.pointGeometry(c.getx(v),c.gety(v));const t=ht(k,g.canonical,u,m,d);w=t.signedDistanceFromCamera>0?h[v]=t.point:D()}else k=null;E+=M,M=e.distance(T,w)}k=k||new e.pointGeometry(c.getx(v),c.gety(v));const B=z();p&&d&&(h[v]=w=void 0===h[v]?w:D(),M=e.distance(T,w));const P=(C-E)/M,L=k.sub(B).mult(P)._add(B),R=e.sub([],w,T),F=e.scaleAndAdd([],T,R,P);let O=[0,0,1],U=R[0],V=R[1];if(_&&(O=m.upVector(g.canonical,L.x,L.y),0!==O[0]||0!==O[1]||1!==O[2])){const t=[1,0,0],i=[0,1,0];t[0]=O[2],t[1]=0,t[2]=-O[0],e.cross(i,O,t),e.normalize(t,t),e.normalize(i,i),U=e.dot(R,t),V=e.dot(R,i)}if(r){const t=e.cross([],O,R);e.normalize(t,t),e.scaleAndAdd(F,F,t,r*x)}const j=b+Math.atan2(V,U);return I.push(F),f&&S.push(L),{point:F,angle:j,path:I,tilePath:S,up:O}}const ft=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function mt(e,t){for(let i=0;i<e;i++){const e=t.length;t.resize(e+4),t.float32.set(ft,4*e)}}function _t(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e[3]=i[3]*r+i[7]*n+i[15],e}const gt=100;class yt{constructor(e,t,i=new Je(e.width+200,e.height+200,25),r=new Je(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+gt,this.screenBottomBoundary=e.height+gt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,i,r,n,o,a,s){let l=i.projectedAnchorX,A=i.projectedAnchorY,c=i.projectedAnchorZ;const u=i.elevation,h=i.tileID;if(u&&h){const t=e.getProjection().upVector(h.canonical,i.tileAnchorX,i.tileAnchorY),r=e.getProjection().upVectorScale(h.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=t[0]*u*r,A+=t[1]*u*r,c+=t[2]*u*r}const d=this.projectAndGetPerspectiveRatio(a,[l,A,c],i.tileID,"globe"===e.projection.name||!!u||this.transform.pitch>0,e.getProjection()),f=o*d.perspectiveRatio,p=(i.x1*t+r.x-i.padding)*f+d.point.x,m=(i.y1*t+r.y-i.padding)*f+d.point.y,g=(i.x2*t+r.x+i.padding)*f+d.point.x,_=(i.y2*t+r.y+i.padding)*f+d.point.y,y=d.perspectiveRatio<=.55||d.occluded;return!this.isInsideGrid(p,m,g,_)||!n&&this.grid.hitTest(p,m,g,_,s)||y?{box:[],offscreen:!1,occluded:d.occluded}:{box:[p,m,g,_],offscreen:this.isOffscreen(p,m,g,_),occluded:!1}}placeCollisionCircles(t,i,r,n,o,a,s,l,A,c,u,h,d,f,p){const m=[],g=this.transform.elevation,_=g?g.getAtTileOffsetFunc(p,this.transform.center.lat,this.transform.worldSize,t.getProjection()):e=>[0,0,0],y=new e.pointGeometry(r.tileAnchorX,r.tileAnchorY),x=t.getProjection().projectTilePoint(r.tileAnchorX,r.tileAnchorY,p.canonical),b=_(y),v=[x.x+b[0],x.y+b[1],x.z+b[2]],w="globe"===t.projection.name,T=this.projectAndGetPerspectiveRatio(s,[v[0],v[1],v[2]],p,w||!!g||this.transform.pitch>0,t.getProjection()),{perspectiveRatio:E}=T,M=(u?a/E:a*E)/e.ONE_EM,C=rt(new e.pointGeometry(v[0],v[1]),l,v[2]).point,I=T.signedDistanceFromCamera>0?At(M,o,r.lineOffsetX*M,r.lineOffsetY*M,!1,C,y,r,n,l,{},g&&!u?_:null,u&&!!g,t.getProjection(),p,u):null;let S=!1,k=!1,z=!0;if(I&&!T.occluded){const t=.5*d*E+f,r=new e.pointGeometry(-100,-100),n=new e.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),o=new Ke,a=I.first,s=I.last;let l=[];for(let e=a.path.length-1;e>=1;e--)l.push(a.path[e]);for(let e=1;e<s.path.length;e++)l.push(s.path[e]);const u=2.5*t;if(A){const e=l.map(g&&!w?(e,t)=>{const i=_(t<a.path.length-1?a.tilePath[a.path.length-1-t]:s.tilePath[t-a.path.length+2]);return e[2]=i[2],ot(e,A)}:e=>ot(e,A));l=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let p=[];if(l.length>0){const t=l.map((t=>new e.pointGeometry(t[0],t[1])));let i=1/0,o=-1/0,a=1/0,s=-1/0;for(let e=0;e<t.length;e++)i=Math.min(i,t[e].x),a=Math.min(a,t[e].y),o=Math.max(o,t[e].x),s=Math.max(s,t[e].y);p=i>=r.x&&o<=n.x&&a>=r.y&&s<=n.y?[t]:o<r.x||i>n.x||s<r.y||a>n.y?[]:e.clipLine([t],r.x,r.y,n.x,n.y)}for(const e of p){o.reset(e,.25*t);let r=0;r=o.length<=.5*t?1:Math.ceil(o.paddedLength/u)+1;for(let e=0;e<r;e++){const n=e/Math.max(r-1,1),a=o.lerp(n),s=a.x+gt,l=a.y+gt;m.push(s,l,t,0);const A=s-t,u=l-t,d=s+t,f=l+t;if(z=z&&this.isOffscreen(A,u,d,f),k=k||this.isInsideGrid(A,u,d,f),!i&&this.grid.hitTestCircle(s,l,t,h)&&(S=!0,!c))return{circles:[],offscreen:!1,collisionDetected:S,occluded:!1}}}}return{circles:!c&&S||!k?[]:m,offscreen:z,collisionDetected:S,occluded:T.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,o=-1/0,a=-1/0;for(const s of t){const t=new e.pointGeometry(s.x+gt,s.y+gt);r=Math.min(r,t.x),n=Math.min(n,t.y),o=Math.max(o,t.x),a=Math.max(a,t.y),i.push(t)}const s=this.grid.query(r,n,o,a).concat(this.ignoredGrid.query(r,n,o,a)),l={},A={};for(const t of s){const r=t.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new e.pointGeometry(t.x1,t.y1),new e.pointGeometry(t.x2,t.y1),new e.pointGeometry(t.x2,t.y2),new e.pointGeometry(t.x1,t.y2)];e.polygonIntersectsPolygon(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===A[r.bucketInstanceId]&&(A[r.bucketInstanceId]=[]),A[r.bucketInstanceId].push(r.featureIndex))}return A}insertCollisionBox(e,t,i,r,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,r,n){const o=t?this.ignoredGrid:this.grid,a={bucketInstanceId:i,featureIndex:r,collisionGroupID:n};for(let t=0;t<e.length;t+=4)o.insertCircle(a,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,i,r,n,o){const a=[i[0],i[1],i[2],1];let s=!1;if(i[2]||this.transform.pitch>0){e.transformMat4$1(a,a,t);const n="globe"===o.name;this.fogState&&r&&!n&&(s=function(t,i,r,n,o,a){const s=a.calculateFogTileMatrix(o),l=[i,r,n];return e.transformMat4(l,l,s),C(t,l,a.pitch,a._fov)}(this.fogState,i[0],i[1],i[2],r.toUnwrapped(),this.transform)>.9)}else _t(a,a,t);return{point:new e.pointGeometry((a[0]/a[3]+1)/2*this.transform.width+gt,(-a[1]/a[3]+1)/2*this.transform.height+gt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(o)/a[3]*.5,1.5),signedDistanceFromCamera:a[3],occluded:n&&a[2]>a[3]||s}}isOffscreen(e,t,i,r){return i<gt||e>=this.screenRightBoundary||r<gt||t>this.screenBottomBoundary}isInsideGrid(e,t,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t}}function xt(t,i,r){const n=i.createTileMatrix(t,t.worldSize,r.toUnwrapped());return e.multiply(new Float32Array(16),t.projMatrix,n)}function vt(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const r=i.clone();return r.setProjection(t.projection),xt(r,t.getProjection(),e)}function bt(e,t,i){return t.name===i.projection.name?e.projMatrix:xt(i,t,e)}class wt{constructor(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Tt{constructor(e,t,i,r,n,o=!1){this.text=new wt(e?e.text:null,t,i,n),this.icon=new wt(e?e.icon:null,t,r,n),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Et{constructor(e,t,i,r=!1){this.text=e,this.icon=t,this.skipFade=i,this.clipped=r}}class Mt{constructor(){this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]}}class Ct{constructor(e,t,i,r,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class It{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function St(t,i,r,n,o){const{horizontalAlign:a,verticalAlign:s}=e.getAnchorAlignment(t),l=-(a-.5)*i,A=-(s-.5)*r,c=e.evaluateVariableOffset(t,n);return new e.pointGeometry(l+c[0]*o,A+c[1]*o)}function kt(t,i,r,n,o){const a=new e.pointGeometry(t,i);return r&&a._rotate(n?o:-o),a}class zt{constructor(e,t,i,r,n){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new yt(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new It(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,r,n){const o=r.getBucket(i),a=r.latestFeatureIndex;if(!o||!a||i.id!==o.layerIds[0])return;const s=o.layers[0].layout,l=r.collisionBoxArray,A=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/e.EXTENT,u=r.tileID.toUnwrapped();this.transform.setProjection(o.projection);const h=(d=r.tileID,f=o.getProjection(),p=this.transform,f.name===this.projection?p.calculateProjMatrix(d.toUnwrapped()):xt(p,f,d));var d,f,p;const m="map"===s.get("text-pitch-alignment"),g="map"===s.get("text-rotation-alignment");i.compileFilter();const _=i.dynamicFilter(),y=i.dynamicFilterNeedsFeature(),x=this.transform.calculatePixelsToTileUnitsMatrix(r),b=it(h,r.tileID.canonical,m,g,this.transform,o.getProjection(),x);let v=null;if(m){const t=nt(h,r.tileID.canonical,m,g,this.transform,o.getProjection(),x);v=e.multiply([],this.transform.labelPlaneMatrix,t)}let w=null;_&&r.latestFeatureIndex&&(w={unwrappedTileID:u,dynamicFilter:_,dynamicFilterNeedsFeature:y,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new Ct(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID);const T={bucket:o,layout:s,posMatrix:h,textLabelPlaneMatrix:b,labelToScreenMatrix:v,clippingData:w,scale:A,textPixelRatio:c,holdingForFade:r.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const e of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=e;t.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:T})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:T})}attemptAnchorPlacement(e,t,i,r,n,o,a,s,l,A,c,u,h,d,f,p,m,g){const _=[u.textOffset0,u.textOffset1],y=St(e,i,r,_,n),x=this.collisionIndex.placeCollisionBox(d,n,t,kt(y.x,y.y,o,a,this.transform.angle),c,s,l,A.predicate);if((!p||0!==this.collisionIndex.placeCollisionBox(d,d.getSymbolInstanceIconSize(g,this.transform.zoom,h),p,kt(y.x,y.y,o,a,this.transform.angle),c,s,l,A.predicate).box.length)&&x.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[u.crossTileID]&&this.prevPlacement.placements[u.crossTileID]&&this.prevPlacement.placements[u.crossTileID].text&&(t=this.prevPlacement.variableOffsets[u.crossTileID].anchor),this.variableOffsets[u.crossTileID]={textOffset:_,width:i,height:r,anchor:e,textScale:n,prevAnchor:t},this.markUsedJustification(d,e,u,f),d.allowVerticalPlacement&&(this.markUsedOrientation(d,f,u),this.placedOrientations[u.crossTileID]=f),{shift:y,placedGlyphBoxes:x}}}placeLayerBucketPart(t,i,r,n){const{bucket:o,layout:a,posMatrix:s,textLabelPlaneMatrix:l,labelToScreenMatrix:A,clippingData:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:p,collisionGroup:m}=t.parameters,g=a.get("text-optional"),_=a.get("icon-optional"),y=a.get("text-allow-overlap"),x=a.get("icon-allow-overlap"),b="map"===a.get("text-rotation-alignment"),v="map"===a.get("text-pitch-alignment"),w="none"!==a.get("icon-text-fit"),T="viewport-y"===a.get("symbol-z-order");this.transform.setProjection(o.projection);let E=y&&(x||!o.hasIconData()||_),M=x&&(y||!o.hasTextData()||g);!o.collisionArrays&&d&&o.deserializeCollisionBoxes(d),r&&n&&o.updateCollisionDebugBuffers(this.transform.zoom,d);const C=(t,n,d)=>{if(c){const r={zoom:this.transform.zoom,pitch:this.transform.pitch};let n=null;if(c.dynamicFilterNeedsFeature){const e=this.retainedQueryData[o.bucketInstanceId];n=c.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,c.dynamicFilter)(r,n,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new e.pointGeometry(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(c.unwrappedTileID)))return this.placements[t.crossTileID]=new Et(!1,!1,!1,!0),void(i[t.crossTileID]=!0)}if(i[t.crossTileID])return;if(h)return void(this.placements[t.crossTileID]=new Et(!1,!1,!1));let T=!1,C=!1,I=!0,S=!1,k=!1,z=null,D={box:null,offscreen:null,occluded:null},B={box:null,offscreen:null,occluded:null},P=null,L=null,R=null,F=0,O=0,U=0;d.textFeatureIndex?F=d.textFeatureIndex:t.useRuntimeCollisionCircles&&(F=t.featureIndex),d.verticalTextFeatureIndex&&(O=d.verticalTextFeatureIndex);const V=e=>{e.tileID=this.retainedQueryData[o.bucketInstanceId].tileID,(this.transform.elevation||e.elevation)&&(e.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[o.bucketInstanceId].tileID,e.tileAnchorX,e.tileAnchorY):0)},j=d.textBox;if(j){V(j);const i=i=>{let r=e.WritingMode.horizontal;if(o.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,r=e,this.markUsedOrientation(o,r,t))}return r},r=(i,r)=>{if(o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&d.verticalTextBox){for(const t of o.writingModes)if(t===e.WritingMode.vertical?(D=r(),B=D):D=i(),D&&D.box&&D.box.length)break}else D=i()};if(a.get("text-variable-anchor")){let l=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[t.crossTileID]){const e=this.prevPlacement.variableOffsets[t.crossTileID];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const A=(e,i,r)=>{const a=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,n),A=(e.x2-e.x1)*a+2*e.padding,c=(e.y2-e.y1)*a+2*e.padding,h=w&&!x?i:null;h&&V(h);let d={box:[],offscreen:!1,occluded:!1};const g=y?2*l.length:l.length;for(let i=0;i<g;++i){const g=this.attemptAnchorPlacement(l[i%l.length],e,A,c,a,b,v,u,s,m,i>=l.length,t,n,o,r,h,f,p);if(g&&(d=g.placedGlyphBoxes,d&&d.box&&d.box.length)){T=!0,z=g.shift;break}}return d};r((()=>A(j,d.iconBox,e.WritingMode.horizontal)),(()=>{const i=d.verticalTextBox;return i&&V(i),o.allowVerticalPlacement&&!(D&&D.box&&D.box.length)&&t.numVerticalGlyphVertices>0&&i?A(i,d.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),D&&(T=D.box,I=D.offscreen,S=D.occluded);const c=i(D&&D.box);if(!T&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(o,e.anchor,t,c))}}else{const a=(i,r)=>{const a=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,n),l=this.collisionIndex.placeCollisionBox(o,a,i,new e.pointGeometry(0,0),y,u,s,m.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,r,t),this.placedOrientations[t.crossTileID]=r),l};r((()=>a(j,e.WritingMode.horizontal)),(()=>{const i=d.verticalTextBox;return o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&i?(V(i),a(i,e.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),i(D&&D.box&&D.box.length)}}if(P=D,T=P&&P.box&&P.box.length>0,I=P&&P.offscreen,S=P&&P.occluded,t.useRuntimeCollisionCircles){const i=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),n=e.evaluateSizeForFeature(o.textSizeData,f,i),c=a.get("text-padding");L=this.collisionIndex.placeCollisionCircles(o,y,i,o.lineVertexArray,o.glyphOffsetArray,n,s,l,A,r,v,m.predicate,t.collisionCircleDiameter*n/e.ONE_EM,c,this.retainedQueryData[o.bucketInstanceId].tileID),T=y||L.circles.length>0&&!L.collisionDetected,I=I&&L.offscreen,S=L.occluded}if(d.iconFeatureIndex&&(U=d.iconFeatureIndex),d.iconBox){const t=t=>{V(t);const i=w&&z?kt(z.x,z.y,b,v,this.transform.angle):new e.pointGeometry(0,0),r=o.getSymbolInstanceIconSize(p,this.transform.zoom,n);return this.collisionIndex.placeCollisionBox(o,r,t,i,x,u,s,m.predicate)};B&&B.box&&B.box.length&&d.verticalIconBox?(R=t(d.verticalIconBox),C=R.box.length>0):(R=t(d.iconBox),C=R.box.length>0),I=I&&R.offscreen,k=R.occluded}const G=g||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,N=_||0===t.numIconVertices;if(G||N?N?G||(C=C&&T):T=C&&T:C=T=C&&T,T&&P&&P.box&&this.collisionIndex.insertCollisionBox(P.box,a.get("text-ignore-placement"),o.bucketInstanceId,B&&B.box&&O?O:F,m.ID),C&&R&&this.collisionIndex.insertCollisionBox(R.box,a.get("icon-ignore-placement"),o.bucketInstanceId,U,m.ID),L&&(T&&this.collisionIndex.insertCollisionCircles(L.circles,a.get("text-ignore-placement"),o.bucketInstanceId,F,m.ID),r)){const e=o.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Mt);for(let e=0;e<L.circles.length;e+=4)t.circles.push(L.circles[e+0]),t.circles.push(L.circles[e+1]),t.circles.push(L.circles[e+2]),t.circles.push(L.collisionDetected?1:0)}const Z="globe"!==o.projection.name;E=E&&(Z||!S),M=M&&(Z||!k),this.placements[t.crossTileID]=new Et(T||E,C||M,I||o.justReloaded),i[t.crossTileID]=!0};if(T){const e=o.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];C(o.symbolInstances.get(i),i,o.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)C(o.symbolInstances.get(e),e,o.collisionArrays[e]);if(r&&o.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[o.bucketInstanceId];e.invert(t.invProjMatrix,s),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(t,i,r,n){let o;o=n===e.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[e.getAnchorJustification(i)];const a=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const e of a)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=o>=0&&e!==o?0:r.crossTileID)}markUsedOrientation(t,i,r){const n=i===e.WritingMode.horizontal||i===e.WritingMode.horizontalOnly?i:0,o=i===e.WritingMode.vertical?i:0,a=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const e of a)t.text.placedSymbolArray.get(e).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},o=t?t.variableOffsets:{},a=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=n[e];o?(this.opacities[e]=new Tt(o,r,t.text,t.icon,null,t.clipped),i=i||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new Tt(null,r,t.text,t.icon,t.skipFade,t.clipped),i=i||t.text||t.icon)}for(const e in n){const t=n[e];if(!this.opacities[e]){const n=new Tt(t,r,!1,!1);n.isHidden()||(this.opacities[e]=n,i=i||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in a)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=a[e]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const i={};for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i,r.collisionBoxArray)}}updateBucketOpacities(t,i,r){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const n=t.layers[0].layout,o=!!t.layers[0].dynamicFilter(),a=new Tt(null,0,!1,!1,!0),s=n.get("text-allow-overlap"),l=n.get("icon-allow-overlap"),A=n.get("text-variable-anchor"),c="map"===n.get("text-rotation-alignment"),u="map"===n.get("text-pitch-alignment"),h="none"!==n.get("icon-text-fit"),d=new Tt(null,0,s&&(l||!t.hasIconData()||n.get("icon-optional")),l&&(s||!t.hasTextData()||n.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const f=(e,t,i)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(i)};let p=0;for(let r=0;r<t.symbolInstances.length;r++){const n=t.symbolInstances.get(r),{numHorizontalGlyphVertices:s,numVerticalGlyphVertices:l,crossTileID:m}=n;let g=this.opacities[m];i[m]?g=a:g||(g=d,this.opacities[m]=g),i[m]=!0;const _=s>0||l>0,y=n.numIconVertices>0,x=this.placedOrientations[n.crossTileID],b=x===e.WritingMode.vertical,v=x===e.WritingMode.horizontal||x===e.WritingMode.horizontalOnly;if(!_&&!y||g.isHidden()||p++,_){const e=Vt(g.text);f(t.text,s,b?jt:e),f(t.text,l,v?jt:e);const i=g.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=i||b?1:0)})),n.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||v?1:0);const r=this.variableOffsets[n.crossTileID];r&&this.markUsedJustification(t,r.anchor,n,x);const o=this.placedOrientations[n.crossTileID];o&&(this.markUsedJustification(t,"left",n,o),this.markUsedOrientation(t,o,n))}if(y){const e=Vt(g.icon);n.placedIconSymbolIndex>=0&&(f(t.icon,n.numIconVertices,b?jt:e),t.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=g.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(f(t.icon,n.numVerticalIconVertices,v?jt:e),t.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=g.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[r];if(i){let r=new e.pointGeometry(0,0),n=!0;if(i.textBox||i.verticalTextBox){if(A){const e=this.variableOffsets[m];e?(r=St(e.anchor,e.width,e.height,e.textOffset,e.textScale),c&&r._rotate(u?this.transform.angle:-this.transform.angle)):n=!1}o&&(n=!g.clipped),i.textBox&&Dt(t.textCollisionBox.collisionVertexArray,g.text.placed,!n||b,r.x,r.y),i.verticalTextBox&&Dt(t.textCollisionBox.collisionVertexArray,g.text.placed,!n||v,r.x,r.y)}const a=n&&Boolean(!v&&i.verticalIconBox);i.iconBox&&Dt(t.iconCollisionBox.collisionVertexArray,g.icon.placed,a,h?r.x:0,h?r.y:0),i.verticalIconBox&&Dt(t.iconCollisionBox.collisionVertexArray,g.icon.placed,!a,h?r.x:0,h?r.y:0)}}}if(t.fullyClipped=0===p,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function Dt(e,t,i,r,n){e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0)}const Bt=Math.pow(2,25),Pt=Math.pow(2,24),Lt=Math.pow(2,17),Rt=Math.pow(2,16),Ft=Math.pow(2,9),Ot=Math.pow(2,8),Ut=Math.pow(2,1);function Vt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*Bt+t*Pt+i*Lt+t*Rt+i*Ft+t*Ot+i*Ut+t}const jt=0;class Gt{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,i,r,n){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class Nt{constructor(e,t,i,r,n,o,a,s){this.placement=new zt(e,n,o,a,s),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,i,r){const n=e.exported.now(),o=()=>{const t=e.exported.now()-n;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=i[t[this._currentPlacementIndex]],n=this.placement.collisionIndex.transform.zoom;if("symbol"===e.type&&(!e.minzoom||e.minzoom<=n)&&(!e.maxzoom||e.maxzoom>n)){if(this._inProgressLayer||(this._inProgressLayer=new Gt(e)),this._inProgressLayer.continuePlacement(r[e.source],this.placement,this._showCollisionBoxes,e,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Zt=512/e.EXTENT/2;class qt{constructor(e,t,i){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(let i=0;i<t.length;i++){const r=t.get(i),n=r.key;this.indexedSymbolInstances[n]||(this.indexedSymbolInstances[n]=[]),this.indexedSymbolInstances[n].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,e)})}}getScaledCoordinates(t,i){const r=Zt/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return{x:Math.floor((i.canonical.x*e.EXTENT+t.tileAnchorX)*r),y:Math.floor((i.canonical.y*e.EXTENT+t.tileAnchorY)*r)}}findMatches(e,t,i){const r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let n=0;n<e.length;n++){const o=e.get(n);if(o.crossTileID)continue;const a=this.indexedSymbolInstances[o.key];if(!a)continue;const s=this.getScaledCoordinates(o,t);for(const e of a)if(Math.abs(e.coord.x-s.x)<=r&&Math.abs(e.coord.y-s.y)<=r&&!i[e.crossTileID]){i[e.crossTileID]=!0,o.crossTileID=e.crossTileID;break}}}}class $t{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],r={};for(const e in i){const n=i[e];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),r[n.tileID.key]=n}this.indexes[e]=r}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,r)}else{const o=n[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,r)}}for(let e=0;e<t.symbolInstances.length;e++){const n=t.symbolInstances.get(e);n.crossTileID||(n.crossTileID=i.generate(),r[n.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new qt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i in t.indexedSymbolInstances)for(const r of t.indexedSymbolInstances[i])delete this.usedCrossTileIDs[e][r.crossTileID]}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)e[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],t=!0)}return t}}class Ht{constructor(){this.layerIndexes={},this.crossTileIDs=new $t,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i,r){let n=this.layerIndexes[e.id];void 0===n&&(n=this.layerIndexes[e.id]=new Qt);let o=!1;const a={};"globe"!==r.name&&n.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(i.tileID,t,this.crossTileIDs)&&(o=!0),a[t.bucketInstanceId]=!0)}return n.removeStaleBuckets(a)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const Wt=(t,i)=>e.emitValidationErrors(t,i&&i.filter((e=>"source.canvas"!==e.identifier))),Xt=e.pick(Ze,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Yt=e.pick(Ze,["setCenter","setZoom","setBearing","setPitch"]),Kt={version:8,layers:[],sources:{}},Jt={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ei extends e.Evented{constructor(t,i={}){super(),this.map=t,this.dispatcher=new D(je(),this),this.imageManager=new x,this.imageManager.setEventedParent(this),this.glyphManager=new e.GlyphManager(t._requestManager,i.localFontFamily?e.LocalGlyphMode.all:i.localIdeographFontFamily?e.LocalGlyphMode.ideographs:e.LocalGlyphMode.none,i.localFontFamily||i.localIdeographFontFamily),this.lineAtlas=new e.LineAtlas(256,512),this.crossTileSymbolIndex=new Ht,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const r=this;this._rtlTextPluginCallback=ei.registerForPluginStateChange((t=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.triggerPluginCompletionEvent(t),i&&i.every((e=>e)))for(const e in r._sourceCaches){const t=r._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const i=this._layers[e];i.source===t.id&&this._validateLayer(i)}}))}loadURL(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"}));const r="boolean"==typeof i.validate?i.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken);const n=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(n,((t,i)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):i&&this._load(i,r)}))}loadJSON(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((()=>{this._request=null,this._load(t,!1!==i.validate)}))}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(Kt,!1)}_updateLayerCount(e,t){const i=t?1:-1;e.is3D()&&(this._num3DLayers+=i),"circle"===e.type&&(this._numCircleLayers+=i),"symbol"===e.type&&(this._numSymbolLayers+=i)}_load(t,i){if(i&&Wt(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=e.clone$1(t),this._updateMapProjection();for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const r=Ne(this.stylesheet.layers);this._order=r.map((e=>e.id)),this._layers={},this._serializedLayers={};for(let t of r)t=e.createStyleLayer(t),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize(),this._updateLayerCount(t,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(t,i,r){let n,o,a;const s=e.exported.devicePixelRatio>1?"@2x":"";let l=e.getJSON(i.transformRequest(i.normalizeSpriteURL(t,s,".json"),e.ResourceType.SpriteJSON),((e,t)=>{l=null,a||(a=e,n=t,c())})),A=e.getImage(i.transformRequest(i.normalizeSpriteURL(t,s,".png"),e.ResourceType.SpriteImage),((e,t)=>{A=null,a||(a=e,o=t,c())}));function c(){if(a)r(a);else if(n&&o){const t=e.exported.getImageData(o),i={};for(const r in n){const{width:o,height:a,x:s,y:l,sdf:A,pixelRatio:c,stretchX:u,stretchY:h,content:d}=n[r],f=new e.RGBAImage({width:o,height:a});e.RGBAImage.copy(t,f,{x:s,y:l},{x:0,y:0},{width:o,height:a}),i[r]={data:f,pixelRatio:c,sdf:A,stretchX:u,stretchY:h,content:d}}r(null,i)}}return{cancel(){l&&(l.cancel(),l=null),A&&(A.cancel(),A=null)}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(i)for(const e in i)this.imageManager.addImage(e,i[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new e.Event("data",{dataType:"style"}))}))}_validateLayer(t){const i=this.getSource(t.source);if(!i)return;const r=t.sourceLayer;r&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];"custom"!==e.type&&t.push(e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(e){return!!this.terrain&&Jt[e.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const i=this._changed;if(this._changed){const e=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(e.length||i.length)&&this._updateWorkerLayers(e,i);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const r={};for(const e in this._sourceCaches){const t=this._sourceCaches[e];r[e]=t.used,t.used=!1}for(const e of this._order){const i=this._layers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this._getLayerSourceCache(i);e&&(e.used=!0)}const r=this.map.painter;if(r){const e=i.getProgramIds();if(!e)continue;const n=i.getProgramConfiguration(t.zoom);for(const t of e)r.useProgram(t,n)}}for(const t in r){const i=this._sourceCaches[t];r[t]!==i.used&&i.getSource().fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new e.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Wt(this,e.validateStyle(i)))return!1;(i=e.clone$1(i)).layers=Ne(i.layers);const r=function(e,i){if(!e)return[{command:Ze.setStyle,args:[i]}];let r=[];try{if(!t(e.version,i.version))return[{command:Ze.setStyle,args:[i]}];t(e.center,i.center)||r.push({command:Ze.setCenter,args:[i.center]}),t(e.zoom,i.zoom)||r.push({command:Ze.setZoom,args:[i.zoom]}),t(e.bearing,i.bearing)||r.push({command:Ze.setBearing,args:[i.bearing]}),t(e.pitch,i.pitch)||r.push({command:Ze.setPitch,args:[i.pitch]}),t(e.sprite,i.sprite)||r.push({command:Ze.setSprite,args:[i.sprite]}),t(e.glyphs,i.glyphs)||r.push({command:Ze.setGlyphs,args:[i.glyphs]}),t(e.transition,i.transition)||r.push({command:Ze.setTransition,args:[i.transition]}),t(e.light,i.light)||r.push({command:Ze.setLight,args:[i.light]}),t(e.fog,i.fog)||r.push({command:Ze.setFog,args:[i.fog]}),t(e.projection,i.projection)||r.push({command:Ze.setProjection,args:[i.projection]});const n={},o=[];!function(e,i,r,n){let o;for(o in i=i||{},e=e||{})e.hasOwnProperty(o)&&(i.hasOwnProperty(o)||$e(o,r,n));for(o in i)i.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t(e[o],i[o])||("geojson"===e[o].type&&"geojson"===i[o].type&&He(e,i,o)?r.push({command:Ze.setGeoJSONSourceData,args:[o,i[o].data]}):Qe(o,i,r,n)):qe(o,i,r))}(e.sources,i.sources,o,n);const a=[];e.layers&&e.layers.forEach((e=>{e.source&&n[e.source]?r.push({command:Ze.removeLayer,args:[e.id]}):a.push(e)}));let s=e.terrain;s&&n[s.source]&&(r.push({command:Ze.setTerrain,args:[void 0]}),s=void 0),r=r.concat(o),t(s,i.terrain)||r.push({command:Ze.setTerrain,args:[i.terrain]}),function(e,i,r){i=i||[];const n=(e=e||[]).map(Xe),o=i.map(Xe),a=e.reduce(Ye,{}),s=i.reduce(Ye,{}),l=n.slice(),A=Object.create(null);let c,u,h,d,f,p,m;for(c=0,u=0;c<n.length;c++)h=n[c],s.hasOwnProperty(h)?u++:(r.push({command:Ze.removeLayer,args:[h]}),l.splice(l.indexOf(h,u),1));for(c=0,u=0;c<o.length;c++)h=o[o.length-1-c],l[l.length-1-c]!==h&&(a.hasOwnProperty(h)?(r.push({command:Ze.removeLayer,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,p=l[l.length-c],r.push({command:Ze.addLayer,args:[s[h],p]}),l.splice(l.length-c,0,h),A[h]=!0);for(c=0;c<o.length;c++)if(h=o[c],d=a[h],f=s[h],!A[h]&&!t(d,f))if(t(d.source,f.source)&&t(d["source-layer"],f["source-layer"])&&t(d.type,f.type)){for(m in We(d.layout,f.layout,r,h,null,Ze.setLayoutProperty),We(d.paint,f.paint,r,h,null,Ze.setPaintProperty),t(d.filter,f.filter)||r.push({command:Ze.setFilter,args:[h,f.filter]}),t(d.minzoom,f.minzoom)&&t(d.maxzoom,f.maxzoom)||r.push({command:Ze.setLayerZoomRange,args:[h,f.minzoom,f.maxzoom]}),d)d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?We(d[m],f[m],r,h,m.slice(6),Ze.setPaintProperty):t(d[m],f[m])||r.push({command:Ze.setLayerProperty,args:[h,m,f[m]]}));for(m in f)f.hasOwnProperty(m)&&!d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?We(d[m],f[m],r,h,m.slice(6),Ze.setPaintProperty):t(d[m],f[m])||r.push({command:Ze.setLayerProperty,args:[h,m,f[m]]}))}else r.push({command:Ze.removeLayer,args:[h]}),p=l[l.lastIndexOf(h)+1],r.push({command:Ze.addLayer,args:[f,p]})}(a,i.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:Ze.setStyle,args:[i]}]}return r}(this.serialize(),i).filter((e=>!(e.command in Yt)));if(0===r.length)return!1;const n=r.filter((e=>!(e.command in Xt)));if(n.length>0)throw new Error(`Unimplemented: ${n.map((e=>e.command)).join(", ")}.`);return r.forEach((e=>{"setTransition"!==e.command&&this[e.command].apply(this,e.args)})),this.stylesheet=i,this._updateMapProjection(),!0}addImage(t,i){return this.getImage(t)?this.fire(new e.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,i),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new e.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,i,r={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(e.validateSource,`sources.${t}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=De(t,i,this.dispatcher,this);n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:n.serialize(),sourceId:t})));const o=i=>{const r=(i?"symbol:":"other:")+t,o=this._sourceCaches[r]=new e.SourceCache(r,n,i);(i?this._symbolSourceCaches:this._otherSourceCaches)[t]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==i.type&&"geojson"!==i.type||o(!0),n.onAdd&&n.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const i=this.getSource(t);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const r=this._getSourceCaches(t);for(const t of r)delete this._sourceCaches[t.id],delete this._updatedSources[t.id],t.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}getSource(e){const t=this._getSourceCache(e);return t&&t.getSource()}addLayer(t,i,r={}){this._checkLoaded();const n=t.id;if(this.getLayer(n))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${n}" already exists on this map`)));let o;if("custom"===t.type){if(Wt(this,e.validateCustomStyleLayer(t)))return;o=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=e.clone$1(t),t=e.extend(t,{source:n})),this._validate(e.validateLayer,`layers.${n}`,t,{arrayIndex:-1},r))return;o=e.createStyleLayer(t),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const a=i?this._order.indexOf(i):this._order.length;if(i&&-1===a)return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));this._order.splice(a,0,n),this._layerOrderChanged=!0,this._layers[n]=o;const s=this._getLayerSourceCache(o);if(this._removedLayers[n]&&o.source&&s&&"custom"!==o.type){const e=this._removedLayers[n];delete this._removedLayers[n],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",s.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const r=this._order.indexOf(t);this._order.splice(r,1);const n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(n,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));i.setEventedParent(null),this._updateLayerCount(i,!1);const r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(t,i,r){this._checkLoaded();const n=this.getLayer(t);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,r,n={}){this._checkLoaded();const o=this.getLayer(i);if(o){if(!t(o.filter,r))return null==r?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(e.validateFilter,`layers.${o.id}.filter`,r,{layerType:o.type},n)||(o.filter=e.clone$1(r),this._updateLayer(o)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const i=this.getLayer(t);return i&&e.clone$1(i.filter)}setLayoutProperty(i,r,n,o={}){this._checkLoaded();const a=this.getLayer(i);a?t(a.getLayoutProperty(r),n)||(a.setLayoutProperty(r,n,o),this._updateLayer(a)):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,i){const r=this.getLayer(t);if(r)return r.getLayoutProperty(i);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(i,r,n,o={}){this._checkLoaded();const a=this.getLayer(i);a?t(a.getPaintProperty(r),n)||(a.setPaintProperty(r,n,o)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,t){const i=this.getLayer(e);return i&&i.getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const r=t.source,n=t.sourceLayer,o=this.getSource(r);if(!o)return void this.fire(new e.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const a=o.type;if("geojson"===a&&n)return void this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===a&&!n)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));const s=this._getSourceCaches(r);for(const e of s)e.setFeatureState(n,t.id,i)}removeFeatureState(t,i){this._checkLoaded();const r=t.source,n=this.getSource(r);if(!n)return void this.fire(new e.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const o=n.type,a="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!a)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const s=this._getSourceCaches(r);for(const e of s)e.removeFeatureState(a,t.id,i)}getFeatureState(t){this._checkLoaded();const i=t.source,r=t.sourceLayer,n=this.getSource(i);if(n){if("vector"!==n.type||r)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(i)[0].getFeatureState(r,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0;const t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,i={},r=[];for(let n=this._order.length-1;n>=0;n--){const o=this._order[n];if(t(o)){i[o]=n;for(const t of e){const e=t[o];if(e)for(const t of e)r.push(t)}}}r.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const n=[];for(let o=this._order.length-1;o>=0;o--){const a=this._order[o];if(t(a))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(i[t.layer.id]<o)break;n.push(t),r.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)n.push(t.feature)}}return n}queryRenderedFeatures(t,i,r){i&&i.filter&&this._validate(e.validateFilter,"queryRenderedFeatures.filter",i.filter,null,i);const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const a=i&&i.layers?i.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),s=P.createFromScreenPoints(t,r);for(const e in this._sourceCaches){const t=this._sourceCaches[e].getSource().id;i.layers&&!n[t]||o.push(Pe(this._sourceCaches[e],this._layers,this._serializedLayers,s,i,r,a,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(e,t,i,r,n,o,a){const s={},l=o.queryRenderedSymbols(r),A=[];for(const e of Object.keys(l).map(Number))A.push(a[e]);A.sort(Re);for(const i of A){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],t,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,e);for(const e in r){const t=s[e]=s[e]||[],n=r[e];n.sort(((e,t)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of n)t.push(e)}}for(const t in s)s[t].forEach((r=>{const n=r.feature,o=i(e[t]).getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=o}));return s}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),s.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.validateFilter,"querySourceFeatures.filter",i.filter,null,i);const r=this._getSourceCaches(t);let n=[];for(const e of r)n=n.concat(Le(e,i));return n}addSourceType(e,t,i){return ei.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(ei.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const r=this.light.getLight();let n=!1;for(const i in e)if(!t(e[i],r[i])){n=!0;break}if(!n)return;const o=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(e,i),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,r=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===r){if("object"==typeof i.source){const t="terrain-dem-src";this.addSource(t,i.source),i=e.clone$1(i),i=e.extend(i,{source:t})}if(this._validate(e.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&r!==this.terrain.drapeRenderMode)this._createTerrain(i,r);else{const r=this.terrain,n=r.get();for(const t of Object.keys(e.spec.terrain))!i.hasOwnProperty(t)&&e.spec.terrain[t].default&&(i[t]=e.spec.terrain[t].default);for(const e in i)if(!t(i[e],n[e])){r.set(i),this.stylesheet.terrain=i;const e=this._setTransitionParameters({duration:0});r.updateTransitions(e);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new z(e,this.map.transform);this.stylesheet.fog=e;const i=this._setTransitionParameters({duration:0});t.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog,r=i.get();0===Object.keys(e).length&&i.set(e);for(const n in e)if(!t(e[n],r[n])){i.set(e),this.stylesheet.fog=e;const t=this._setTransitionParameters({duration:0});i.updateTransitions(t);break}}else this._createFog(e);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:e.exported.now(),transition:e.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const e=this._order.filter((e=>this.isLayerDraped(this._layers[e]))),t=this._order.filter((e=>!this.isLayerDraped(this._layers[e])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const i=this.terrain=new M(e,t);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const r=this._setTransitionParameters({duration:0});i.updateTransitions(r)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,i,r,n,o={}){return(!o||!1!==o.validate)&&Wt(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:r,styleSpec:e.spec},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles(),this._sourceCaches[e].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){const t=this._getSourceCaches(e);for(const e of t)e.clearTiles()}_reloadSource(e){const t=this._getSourceCaches(e);for(const e of t)e.resume(),e.reload()}_updateSources(e){for(const t in this._sourceCaches)this._sourceCaches[t].update(e)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,i,r,n,o=!1){let a=!1,s=!1;const l={};for(const e of this._order){const i=this._layers[e];if("symbol"!==i.type)continue;if(!l[i.source]){const e=this._getLayerSourceCache(i);if(!e)continue;l[i.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(i,l[i.source],t.center.lng,t.projection);a=a||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new e.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now(),t.zoom))&&(this.pauseablePlacement=new Nt(t,this._order,o,i,r,n,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.exported.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,i){this.imageManager.getImages(t.icons,i),this._updateTilesForChangedImages();const r=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};r(this._otherSourceCaches[t.source]),r(this._symbolSourceCaches[t.source])}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,i)}getResource(t,i,r){return e.makeRequest(i,r)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}_getSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const i=this._getSourceCaches(t);return 0===i.length?(this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):i.every((e=>e.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ei.getSourceType=function(e){return ze[e]},ei.setSourceType=function(e,t){ze[e]=t},ei.registerForPluginStateChange=e.registerForPluginStateChange;var ti="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ii="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ri={},ni={};ri=Ai("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),ni=Ai("#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const oi=Ai("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ai=ti,si="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var li={background:Ai("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ai("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ai("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ai("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ai("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ai("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ai("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ai("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Ai("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ai("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ai("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ai("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ai("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ai("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ai("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ai("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ai("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ai("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ai("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ai("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Ai("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Ai("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Ai("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Ai("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ai("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ii),skyboxGradient:Ai("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ii),skyboxCapture:Ai("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ai("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Ai("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Ai(e,t,i){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,o=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),a=e.match(n),s=t.match(n),l=ti.match(n);let A=s?s.concat(a):a;i||(ri.staticUniforms&&(A=ri.staticUniforms.concat(A)),ni.staticUniforms&&(A=ni.staticUniforms.concat(A))),A&&(A=A.concat(l));const c={};return{fragmentSource:e=e.replace(r,((e,t,i,r,n)=>(c[n]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`))),vertexSource:t=t.replace(r,((e,t,i,r,n)=>{const o="float"===r?"vec2":"vec4",a=n.match(/color/)?"color":o;return c[n]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${o} a_${n};\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${o} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:o,staticUniforms:A}}class ci{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,i,r,n,o,a,s,l){this.context=e;let A=this.boundPaintVertexBuffers.length!==r.length;for(let e=0;!A&&e<r.length;e++)this.boundPaintVertexBuffers[e]!==r[e]&&(A=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===i&&!A&&this.boundIndexBuffer===n&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s&&this.boundDynamicVertexBuffer3===l?(e.bindVertexArrayOES.set(this.vao),a&&a.bind(),n&&n.dynamicDraw&&n.bind(),s&&s.bind(),l&&l.bind()):this.freshBind(t,i,r,n,o,a,s,l)}freshBind(e,t,i,r,n,o,a,s){let l;const A=e.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),l=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a,this.boundDynamicVertexBuffer3=s;else{l=c.currentNumAttributes||0;for(let e=A;e<l;e++)u.disableVertexAttribArray(e)}t.enableAttributes(u,e);for(const t of i)t.enableAttributes(u,e);o&&o.enableAttributes(u,e),a&&a.enableAttributes(u,e),s&&s.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,n);for(const t of i)t.bind(),t.setVertexAttribPointers(u,e,n);o&&(o.bind(),o.setVertexAttribPointers(u,e,n)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(u,e,n)),s&&(s.bind(),s.setVertexAttribPointers(u,e,n)),c.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ui(t,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new e.MercatorCoordinate(0,n/r).toLngLat().lat,new e.MercatorCoordinate(0,(n+1)/r).toLngLat().lat]}function hi(t,i,r,n,o,a,s){const l=t.context,A=l.gl,c=r.fbo;if(!c)return;t.prepareDrawTile();const u=t.useProgram("hillshade");l.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,c.colorAttachment.get());const h=((e,t,i,r)=>{const n=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),a=i.paint.get("hillshade-accent-color");let s=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);const l=!e.options.moving;return{u_matrix:r||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:ui(0,t.tileID),u_light:[i.paint.get("hillshade-exaggeration"),s],u_shadow:n,u_highlight:o,u_accent:a}})(t,r,n,t.terrain?i.projMatrix:null);t.prepareDrawProgram(l,u,i.toUnwrapped());const{tileBoundsBuffer:d,tileBoundsIndexBuffer:f,tileBoundsSegments:p}=t.getTileBoundsBuffers(r);u.draw(l,A.TRIANGLES,o,a,s,e.CullFaceMode.disabled,h,n.id,d,f,p)}function pi(t,i,r){if(!i.needsDEMTextureUpload)return;const n=t.context,o=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(r.stride);const a=r.getPixels();i.demTexture?i.demTexture.update(a,{premultiply:!1}):i.demTexture=new e.Texture(n,a,o.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function di(t,i,r,n,o,a){const s=t.context,l=s.gl;if(!i.dem)return;const A=i.dem;if(s.activeTexture.set(l.TEXTURE1),pi(t,i,A),!i.demTexture)return;i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const c=A.dim;s.activeTexture.set(l.TEXTURE0);let u=i.fbo;if(!u){const t=new e.Texture(s,{width:c,height:c,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),u=i.fbo=s.createFramebuffer(c,c,!0),u.colorAttachment.set(t.texture)}s.bindFramebuffer.set(u.framebuffer),s.viewport.set([0,0,c,c]);const{tileBoundsBuffer:h,tileBoundsIndexBuffer:d,tileBoundsSegments:f}=t.getMercatorTileBoundsBuffers();t.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,n,o,a,e.CullFaceMode.disabled,((t,i)=>{const r=i.stride,n=e.create();return e.ortho(n,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(n,n,[0,-e.EXTENT,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ,u_unpack:i.unpackVector}})(i.tileID,A),r.id,h,d,f),i.needsHillshadePrepare=!1}const fi=(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image0:new e.Uniform1i(t,i.u_image0),u_skirt_height:new e.Uniform1f(t,i.u_skirt_height)}),mi=(e,t)=>({u_matrix:e,u_image0:0,u_skirt_height:t}),_i=(e,t,i,r,n,o,a,s,l,A,c,u,h,d)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:o,u_image0:0,u_frustum_tl:a,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:A,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_grid_matrix:d?Float32Array.from(d):new Float32Array(9)});function gi(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const yi=new class{constructor(){this.operations={}}newMorphing(e,t,i,r,n){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:r,phase:0,duration:n,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},xi={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function vi(e,t){const i=1<<e.z;return!t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const bi=e=>({u_matrix:e});function wi(t,i,r,n,o){if(o>0){const a=e.exported.now(),s=(a-t.timeAdded)/o,l=i?(a-i.timeAdded)/o:-1,A=r.getSource(),c=n.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),u=!i||Math.abs(i.tileID.overscaledZ-c)>Math.abs(t.tileID.overscaledZ-c),h=u&&t.refreshedUponExpiration?1:e.clamp(u?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-h}:{opacity:h,mix:0}}return{opacity:1,mix:0}}class Ti extends e.SourceCache{constructor(e){const t={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new D(je(),null),r=De("mock-dem",t,i,e.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Ei extends e.SourceCache{constructor(e){const t=De("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new D(je(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,r){if(t.freezeTileCoverage)return;this.transform=t;const n=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((i,r)=>{if(i[r.key]="",!this._tiles[r.key]){const i=new e.Tile(r,this._source.tileSize*r.overscaleFactor(),t.tileZoom);i.state="loaded",this._tiles[r.key]=i}return i}),{});for(const e in this._tiles)e in n||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const i=Object.values(t);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Mi extends e.OverscaledTileID{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i}}class Ci extends e.Elevation{constructor(t,i){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,o]=function(t){const i=new e.StructArrayLayout4i8,r=new e.StructArrayLayout3ui6,n=131;i.reserve(17161),r.reserve(33800);const o=e.EXTENT/128,a=e.EXTENT+o/2,s=a+o;for(let t=-o;t<s;t+=o)for(let r=-o;r<s;r+=o){const n=r<0||r>a||t<0||t>a?24575:0,o=e.clamp(Math.round(r),0,e.EXTENT),s=e.clamp(Math.round(t),0,e.EXTENT);i.emplaceBack(o+n,s,o,s)}const l=(e,t)=>{const i=t*n+e;r.emplaceBack(i+1,i,i+n),r.emplaceBack(i+n,i+n+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[i,r,32768]}(),a=t.context;this.gridBuffer=a.createVertexBuffer(r,e.boundsAttributes.members),this.gridIndexBuffer=a.createIndexBuffer(n),this.gridSegments=e.SegmentVector.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=e.SegmentVector.simpleSegment(0,0,r.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ei(i.map),this.orthoMatrix=e.create(),e.ortho(this.orthoMatrix,0,e.EXTENT,0,e.EXTENT,0,1);const s=a.gl;this._overlapStencilMode=new e.StencilMode({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ti(i.map)}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency()}update(t,i,r){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const n=t.terrain.properties;this.sourceCache=0===t.terrain.drapeRenderMode?this._mockSourceCache:t._getSourceCache(n.get("source")),this._exaggeration=n.get("exaggeration");const o=()=>{this.sourceCache.used&&e.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(i,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),i.updateElevation(!r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&e.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=r.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,i){const r=i.transform.pointCoordinate(i.transform.getCameraPoint()),n=new e.pointGeometry(r.x,r.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const r=new e.pointGeometry(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.pointGeometry(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),a=n.mult(1<<t.canonical.z);return a.x-=.5,a.y-=.5,a.distSqr(r)-a.distSqr(o)}))}(n,this.painter),this._previousZoom=r.zoom;const o=this.proxyToSource||{};this.proxyToSource={},n.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const a=this._style._sourceCaches;for(const e in a){const i=a[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],o),i.usedForTerrain)continue;const r=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[i.id]=n.map((e=>new Mi(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=e.exported.now();const s={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in s||(this._visibleDemTiles.push(t),s[i]=i)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const r=this.terrainTileForTile[i],n=r.dem;!n||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),pi(this.painter,r,n))}}_prepareDemTileUniforms(e,t,i,r){if(!t||null==t.demTexture)return!1;const n=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-n.z),a=r||"";return i[`u_dem_tl${a}`]=[n.x*o%1,n.y*o%1],i[`u_dem_scale${a}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){const r=new e.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.Texture(t,r,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const r=i.dem.tree.minimums[0];return r>0&&e++,t+r}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),n=new e.RGBAImage({width:1,height:1},new Uint8Array(e.DEMData.pack(r,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(n,{premultiply:!1}):o=this._emptyDEMTexture=new e.Texture(t,n,i.RGBA,{premultiply:!1}),o}setupElevationDraw(t,i,r){const n=this.painter.context,o=n.gl,a=(s=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:e.DEMData.getUnpackVector(s),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var s;a.u_dem_size=this.sourceCache.getSource().tileSize,a.u_exaggeration=this.exaggeration();const l=this.painter.transform,A=l.projection,c=t.tileID.canonical;a.u_tile_tl_up=A.upVector(c,0,0),a.u_tile_tr_up=A.upVector(c,e.EXTENT,0),a.u_tile_br_up=A.upVector(c,e.EXTENT,e.EXTENT),a.u_tile_bl_up=A.upVector(c,0,e.EXTENT),a.u_tile_up_scale=r&&r.useDenormalizedUpVectorScale?e.GLOBE_METERS_TO_ECEF:A.upVectorScale(c,l.center.lat,l.worldSize).metersToTile;let u=null,h=null,d=1;if(r&&r.morphing&&this._useVertexMorphing){const e=r.morphing.srcDemTile,i=r.morphing.dstDemTile;d=r.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,a,"_prev")&&(h=e),this._prepareDemTileUniforms(t,i,a)&&(u=i))}if(h&&u?(n.activeTexture.set(o.TEXTURE2),u.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),n.activeTexture.set(o.TEXTURE4),h.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),a.u_dem_lerp=d):(u=this.terrainTileForTile[t.tileID.key],n.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(t,u,a)?u.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE)),n.activeTexture.set(o.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(a.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),a.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&u){const t=(1<<u.tileID.canonical.z)*e.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=t}r&&r.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(n,a)}renderToBackBuffer(t){const i=this.painter,r=this.painter.context;0!==t.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,i,r,n,o){if("globe"===t.transform.projection.name)!function(t,i,r,n,o){const a=t.context,s=a.gl;let l,A;const c=t.options.showTerrainWireframe?2:0,u=t.transform,h=e.globeUseCustomAntiAliasing(t,a,u),d=(e,i)=>{if(A===e)return;const r=[xi[e],"PROJECTION_GLOBE_VIEW"];h&&r.push("CUSTOM_ANTIALIASING"),i&&r.push(xi[c]),l=t.useProgram("globeRaster",null,r),A=e},f=t.colorModeForRenderPass(),p=new e.DepthMode(s.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);yi.update(o);const m=e.calculateGlobeMercatorMatrix(u),g=[e.mercatorXfromLng(u.center.lng),e.mercatorYfromLat(u.center.lat)],_=t.globeSharedBuffers,y=[u.width*e.exported.devicePixelRatio,u.height*e.exported.devicePixelRatio];if((c?[!1,!0]:[!1]).forEach((c=>{A=-1;const h=c?s.LINES:s.TRIANGLES;for(const A of n){const n=r.getTile(A),x=e.StencilMode.disabled,b=i.prevTerrainTileForTile[A.key],v=i.terrainTileForTile[A.key];gi(b,v)&&yi.newMorphing(A.key,b,v,o,250),a.activeTexture.set(s.TEXTURE0),n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const w=yi.getMorphValuesForProxy(A.key),T=w?1:0,E={useDenormalizedUpVectorScale:!0};w&&e.extend$1(E,{morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:e.easeCubicInOut(w.phase)}});const M=Float32Array.from(u.globeMatrix),C=e.globeTileLatLngCorners(A.canonical),I=e.getLatitudinalLod((C[0][0]+C[1][0])/2),S=e.getGridMatrix(A.canonical,C,I),k=e.globeNormalizeECEF(e.globeTileBounds(A.canonical)),z=_i(u.projMatrix,M,m,k,e.globeToMercatorTransition(u.zoom),g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,S);if(d(T,c),i.setupElevationDraw(n,l,E),t.prepareDrawProgram(a,l,A.toUnwrapped()),_){const[i,r,n]=c?_.getWirefameBuffers(t.context,I):_.getGridBuffers(I);l.draw(a,h,p,x,f,e.CullFaceMode.backCCW,z,"globe_raster",i,r,n)}}})),_){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&o.push("CUSTOM_ANTIALIASING"),l=t.useProgram("globeRaster",null,o);for(const o of n){const{x:n,y:A,z:c}=o.canonical,h=0===A,d=A===(1<<c)-1,[m,x,b,v]=_.getPoleBuffers(c);if(v&&(h||d)){const A=r.getTile(o);a.activeTexture.set(s.TEXTURE0),A.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let _=e.globePoleMatrixForTile(c,n,u);const w=e.globeNormalizeECEF(e.globeTileBounds(o.canonical)),T=(t,i)=>t.draw(a,s.TRIANGLES,p,e.StencilMode.disabled,f,e.CullFaceMode.disabled,_i(u.projMatrix,_,_,w,0,g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y),"globe_pole_raster",i,b,v);i.setupElevationDraw(A,l,{}),t.prepareDrawProgram(a,l,o.toUnwrapped()),h&&T(l,m),d&&(_=e.scale(e.create(),_,[1,-1,1]),T(l,x))}}}}(t,i,r,n,o);else{const a=t.context,s=a.gl;let l,A;const c=t.options.showTerrainWireframe?2:0,u=(e,i)=>{if(A===e)return;const r=[xi[e]];i&&r.push(xi[c]),l=t.useProgram("terrainRaster",null,r),A=e},h=t.colorModeForRenderPass(),d=new e.DepthMode(s.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);yi.update(o);const f=t.transform,p=6*Math.pow(1.5,22-f.zoom)*i.exaggeration();(c?[!1,!0]:[!1]).forEach((c=>{A=-1;const m=c?s.LINES:s.TRIANGLES,[g,_]=c?i.getWirefameBuffer():[i.gridIndexBuffer,i.gridSegments];for(const A of n){const n=r.getTile(A),y=e.StencilMode.disabled,x=i.prevTerrainTileForTile[A.key],b=i.terrainTileForTile[A.key];gi(x,b)&&yi.newMorphing(A.key,x,b,o,250),a.activeTexture.set(s.TEXTURE0),n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST);const v=yi.getMorphValuesForProxy(A.key),w=v?1:0;let T;v&&(T={morphing:{srcDemTile:v.from,dstDemTile:v.to,phase:e.easeCubicInOut(v.phase)}});const E=mi(A.projMatrix,vi(A.canonical,f.renderWorldCopies)?p/10:p);u(w,c),i.setupElevationDraw(n,l,T),t.prepareDrawProgram(a,l,A.toUnwrapped()),l.draw(a,m,d,y,h,e.CullFaceMode.backCCW,E,"terrain_raster",i.gridBuffer,g,_)}}))}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const i=this.painter,r=this.painter.context,n=this.proxySourceCache,o=this.proxiedCoords[n.id],a=this._drapedRenderBatches.shift(),s=[],l=i.style.order;let A=0;for(const c of o){const o=n.getTileByID(c.proxyTileKey),u=n.proxyCachedFBO[c.key]?n.proxyCachedFBO[c.key][t]:void 0,h=void 0!==u?n.renderCache[u]:this.pool[A++],d=void 0!==u;if(o.texture=h.tex,d&&!h.dirty){s.push(o.tileID);continue}let f;r.bindFramebuffer.set(h.fb.framebuffer),this.renderedToTile=!1,h.dirty&&(r.clear({color:e.Color.transparent,stencil:0}),h.dirty=!1);for(let e=a.start;e<=a.end;++e){const t=i.style._layers[l[e]];if(t.isHidden(i.transform.zoom))continue;const n=i.style._getLayerSourceCache(t),o=n?this.proxyToSource[c.key][n.id]:[c];if(!o)continue;const a=o;r.viewport.set([0,0,h.fb.width,h.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(h,o,t,n),f=n?n.id:null),i.renderLayer(i,n,t,a)}this.renderedToTile?(h.dirty=!0,s.push(o.tileID)):d||--A,5===A&&(A=0,this.renderToBackBuffer(s))}return this.renderToBackBuffer(s),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),a.end+1}postRender(){}renderCacheEfficiency(e){const t=e.order.length;if(0===t)return{efficiency:100};let i,r=0,n=0,o=!1;for(let a=0;a<t;++a){const t=e._layers[e.order[a]];this._style.isLayerDraped(t)?(o&&++r,++n):o||(o=!0,i=t.id)}return 0===n?{efficiency:100}:{efficiency:100*(1-r/n),firstUndrapedLayer:i}}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,i){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter((e=>e.dem)).map((r=>{const n=r.tileID,o=Math.pow(2,n.overscaledZ),{x:a,y:s}=n.canonical,l=a/o,A=(a+1)/o,c=s/o,u=(s+1)/o;return{minx:l,miny:c,maxx:A,maxy:u,t:r.dem.tree.raycastRoot(l,c,A,u,e,t,i),tile:r}}));r.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const n of r){if(null==n.t)return null;const r=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,e,t,i);if(null!=r)return r}return null}_createFBO(){const t=this.painter.context,i=t.gl,r=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const n=new e.Texture(t,{width:r[0],height:r[1],data:null},i.RGBA);n.bind(i.LINEAR,i.CLAMP_TO_EDGE);const o=t.createFramebuffer(r[0],r[1],!1);return o.colorAttachment.set(n.texture),o.depthAttachment=new Te(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._layers[e],i=t.isHidden(this.painter.transform.zoom),r=t.getCrossfadeParameters(),n=!!r&&1!==r.t,o=t.hasTransition();return"custom"!==t.type&&!i&&(n||o)}))}_clearRasterFadeFromRenderCache(){let e=!1;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t]._source instanceof Ce){e=!0;break}if(e)for(let e=0;e<this._style.order.length;++e){const t=this._style._layers[this._style.order[e]],i=t.isHidden(this.painter.transform.zoom),r=this._style._getLayerSourceCache(t);if("raster"!==t.type||i||!r)continue;const n=t.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t){const t=wi(r.getTile(e),r.findLoadedParent(e,0),r,this.painter.transform,n);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(r.id,e)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const i=[];let r,n=0,o=this._style._layers[e[n]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++n<t;)o=this._style._layers[e[n]];for(;n<t;++n){const t=this._style._layers[e[n]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===r&&(r=n):void 0!==r&&(i.push({start:r,end:n-1}),r=void 0))}void 0!==r&&i.push({start:r,end:n-1}),this._drapedRenderBatches=i}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let i=0;i<e.length;++i){const r=Object.values(e[i]);t.renderCachePool.push(...r)}}return}this._clearRasterFadeFromRenderCache();const i=this.proxyCoords,r=this._tilesDirty;for(let n=i.length-1;n>=0;n--){const o=i[n];if(t.getTileByID(o.key),void 0!==t.proxyCachedFBO[o.key]){const i=e[o.key],n=this.proxyToSource[o.key];let a=0;for(const e in n){const t=n[e],o=i[e];if(!o||o.length!==t.length||t.some(((t,i)=>t!==o[i]||r[e]&&r[e].hasOwnProperty(t.key)))){a=-1;break}++a}for(const e in t.proxyCachedFBO[o.key])t.renderCache[t.proxyCachedFBO[o.key][e]].dirty=a<0||a!==Object.values(i).length}}const n=[...this._drapedRenderBatches];n.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of n)for(const r of i){if(t.proxyCachedFBO[r.key])continue;let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(t.proxyCachedFBO[r.key]={},t.proxyCachedFBO[r.key][e.start]=i,t.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,i,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,o=n.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let a;if(i.isTileClipped())a=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);a=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+a>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=a,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.StencilMode.disabled}_renderTileClippingMasks(t,i){const r=this.painter,n=this.painter.context,o=n.gl;r._tileClippingMaskIDs={},n.setColorMode(e.ColorMode.disabled),n.setDepthMode(e.DepthMode.disabled);const a=r.useProgram("clippingMask");for(const s of t){const t=r._tileClippingMaskIDs[s.key]=--i;a.draw(n,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,bi(s.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const r=[t.x,t.y,1,1];e.transformMat4$1(r,r,i.pixelMatrixInverse),e.scale$1(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const n=i._camera.position,o=e.mercatorZfromAltitude(1,i.center.lat),a=[n[0],n[1],n[2]/o,0],s=e.subtract([],r.slice(0,3),a);e.normalize(s,s);const l=this.raycast(a,s,this._exaggeration);return null!==l&&l?(e.scaleAndAdd(a,a,s,l),a[3]=a[2],a[2]*=o,a):null}drawDepth(){const t=this.painter,i=t.context,r=this.proxySourceCache,n=Math.ceil(t.width),o=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=i.gl,r=i.createFramebuffer(n,o,!0);i.activeTexture.set(t.TEXTURE0);const a=new e.Texture(i,{width:n,height:o,data:null},t.RGBA);a.bind(t.NEAREST,t.CLAMP_TO_EDGE),r.colorAttachment.set(a.texture);const s=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,n,o);r.depthAttachment.set(s),this._depthFBO=r,this._depthTexture=a}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,n,o]),function(t,i,r,n){if("globe"===t.transform.projection.name)return;const o=t.context,a=o.gl;o.clear({depth:1});const s=t.useProgram("terrainDepth"),l=new e.DepthMode(a.LESS,e.DepthMode.ReadWrite,t.depthRangeFor3D);for(const t of n){const n=r.getTile(t),A=mi(t.projMatrix,0);i.setupElevationDraw(n,s),s.draw(o,a.TRIANGLES,l,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.backCCW,A,"terrain_depth",i.gridBuffer,i.gridIndexBuffer,i.gridNoSkirtSegments)}}(t,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,i){if(e.getSource()instanceof ke)return this._setupProxiedCoordsForImageSource(e,t,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const r=this.proxiedCoords[e.id]=[],n=this.proxyCoords;for(let t=0;t<n.length;t++){const o=n[t],a=this._findTileCoveringTileID(o,e);if(a){const t=this._createProxiedId(o,a,i[o.key]&&i[o.key][e.id]);r.push(t),this.proxyToSource[o.key][e.id]=[t]}}let o=!1;for(let n=0;n<t.length;n++){const a=e.getTile(t[n]);if(!a||!a.hasData())continue;const s=this._findTileCoveringTileID(a.tileID,this.proxySourceCache);if(s&&s.tileID.canonical.z!==a.tileID.canonical.z){const t=this.proxyToSource[s.tileID.key][e.id],n=this._createProxiedId(s.tileID,a,i[s.tileID.key]&&i[s.tileID.key][e.id]);t?t.splice(t.length-1,0,n):this.proxyToSource[s.tileID.key][e.id]=[n],r.push(n),o=!0}}this._sourceTilesOverlap[e.id]=o}_setupProxiedCoordsForImageSource(t,i,r){if(!t.getSource().loaded())return;const n=this.proxiedCoords[t.id]=[],o=this.proxyCoords,a=t.getSource(),s=new e.pointGeometry(a.tileID.x,a.tileID.y)._div(1<<a.tileID.z),l=a.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-s.x),e.min.y=Math.min(e.min.y,t.y-s.y),e.max.x=Math.max(e.max.x,t.x-s.x),e.max.y=Math.max(e.max.y,t.y-s.y),e)),{min:new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(t,i)=>{const r=t.wrap+t.canonical.x/(1<<t.canonical.z),n=t.canonical.y/(1<<t.canonical.z),o=e.EXTENT/(1<<t.canonical.z),a=i.wrap+i.canonical.x/(1<<i.canonical.z),s=i.canonical.y/(1<<i.canonical.z);return r+o<a+l.min.x||r>a+l.max.x||n+o<s+l.min.y||n>s+l.max.y};for(let e=0;e<o.length;e++){const a=o[e];for(let e=0;e<i.length;e++){const o=t.getTile(i[e]);if(!o||!o.hasData())continue;if(A(a,o.tileID))continue;const s=this._createProxiedId(a,o,r[a.key]&&r[a.key][t.id]),l=this.proxyToSource[a.key][t.id];l?l.push(s):this.proxyToSource[a.key][t.id]=[s],n.push(s)}}}_createProxiedId(t,i,r){let n=this.orthoMatrix;if(r){const e=r.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const r=t.canonical.z-i.tileID.canonical.z;let o,a,s;n=e.create();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;r>0?(o=e.EXTENT>>r,a=o*((i.tileID.canonical.x<<r)-t.canonical.x+l),s=o*((i.tileID.canonical.y<<r)-t.canonical.y)):(o=e.EXTENT<<-r,a=e.EXTENT*(i.tileID.canonical.x-(t.canonical.x+l<<-r)),s=e.EXTENT*(i.tileID.canonical.y-(t.canonical.y<<-r))),e.ortho(n,0,o,0,o,0,1),e.translate(n,n,[a,s,0])}return new Mi(i.tileID,t.key,n)}_findTileCoveringTileID(t,i){let r=i.getTile(t);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[i.id],o=n[t.key];if(r=o?i.getTileByID(o):null,r&&r.hasData()||null===o)return r;let a=r?r.tileID:t,s=a.overscaledZ;const l=i.getSource().minzoom,A=[];if(!o){const n=i.getSource().maxzoom;if(t.canonical.z>=n){const r=t.canonical.z-n;i.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,i.transform.tileZoom),a=new e.OverscaledTileID(s,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r)):0!==r&&(s=n,a=new e.OverscaledTileID(s,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r))}a.key!==t.key&&(A.push(a.key),r=i.getTile(a))}const c=e=>{A.forEach((t=>{n[t]=e})),A.length=0};for(s-=1;s>=l&&(!r||!r.hasData());s--){r&&c(r.tileID.key);const e=a.calculateScaledKey(s);if(r=i.getTileByID(e),r&&r.hasData())break;const t=n[e];if(null===t)break;void 0===t?A.push(e):r=i.getTileByID(t)}return c(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(t){let i=0;const r=new e.StructArrayLayout2ui4,n=131;for(let e=1;e<129;e++){for(let t=1;t<129;t++)i=e*n+t,r.emplaceBack(i,i+1),r.emplaceBack(i,i+n),r.emplaceBack(i+1,i+n),128===e&&r.emplaceBack(i+n,i+n+1);r.emplaceBack(i+1,i+1+n)}return r}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=e.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Ii(e){const t=[];for(let i=0;i<e.length;i++){if(null===e[i])continue;const r=e[i].split(" ");t.push(r.pop())}return t}class Si{static cacheKey(e,t,i){let r=`${e}${i?i.cacheKey:""}`;for(const e of t)r+=`/${e}`;return r}constructor(t,i,r,n,o,a){const s=t.gl;this.program=s.createProgram();const l=Ii(r.staticAttributes),A=n?n.getBinderAttributes():[],c=l.concat(A),u=r.staticUniforms?Ii(r.staticUniforms):[],h=n?n.getBinderUniforms():[],d=u.concat(h),f=[];for(const e of d)f.indexOf(e)<0&&f.push(e);let p=n?n.defines():[];p=p.concat(a.map((e=>`#define ${e}`)));const m=p.concat(t.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(si):si,si,ai,oi.fragmentSource,ni.fragmentSource,r.fragmentSource).join("\n"),g=p.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ai,oi.vertexSource,ni.vertexSource,ri.vertexSource,r.vertexSource).join("\n"),_=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(_,m),s.compileShader(_),s.attachShader(this.program,_);const y=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(y,g),s.compileShader(y),s.attachShader(this.program,y),this.attributes={};const x={};this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)c[e]&&(s.bindAttribLocation(this.program,e,c[e]),this.attributes[c[e]]=e);s.linkProgram(this.program),s.deleteShader(y),s.deleteShader(_);for(let e=0;e<f.length;e++){const t=f[e];if(t&&!x[t]){const e=s.getUniformLocation(this.program,t);e&&(x[t]=e)}}this.fixedUniforms=o(t,x),this.binderUniforms=n?n.getUniforms(t,x):[],-1!==a.indexOf("TERRAIN")&&(this.terrainUniforms=((t,i)=>({u_dem:new e.Uniform1i(t,i.u_dem),u_dem_prev:new e.Uniform1i(t,i.u_dem_prev),u_dem_unpack:new e.Uniform4f(t,i.u_dem_unpack),u_dem_tl:new e.Uniform2f(t,i.u_dem_tl),u_dem_scale:new e.Uniform1f(t,i.u_dem_scale),u_dem_tl_prev:new e.Uniform2f(t,i.u_dem_tl_prev),u_dem_scale_prev:new e.Uniform1f(t,i.u_dem_scale_prev),u_dem_size:new e.Uniform1f(t,i.u_dem_size),u_dem_lerp:new e.Uniform1f(t,i.u_dem_lerp),u_exaggeration:new e.Uniform1f(t,i.u_exaggeration),u_depth:new e.Uniform1i(t,i.u_depth),u_depth_size_inv:new e.Uniform2f(t,i.u_depth_size_inv),u_meter_to_dem:new e.Uniform1f(t,i.u_meter_to_dem),u_label_plane_matrix_inv:new e.UniformMatrix4f(t,i.u_label_plane_matrix_inv),u_tile_tl_up:new e.Uniform3f(t,i.u_tile_tl_up),u_tile_tr_up:new e.Uniform3f(t,i.u_tile_tr_up),u_tile_br_up:new e.Uniform3f(t,i.u_tile_br_up),u_tile_bl_up:new e.Uniform3f(t,i.u_tile_bl_up),u_tile_up_scale:new e.Uniform1f(t,i.u_tile_up_scale)}))(t,x)),-1!==a.indexOf("FOG")&&(this.fogUniforms=((t,i)=>({u_fog_matrix:new e.UniformMatrix4f(t,i.u_fog_matrix),u_fog_range:new e.Uniform2f(t,i.u_fog_range),u_fog_color:new e.Uniform4f(t,i.u_fog_color),u_fog_horizon_blend:new e.Uniform1f(t,i.u_fog_horizon_blend),u_fog_temporal_offset:new e.Uniform1f(t,i.u_fog_temporal_offset),u_frustum_tl:new e.Uniform3f(t,i.u_frustum_tl),u_frustum_tr:new e.Uniform3f(t,i.u_frustum_tr),u_frustum_br:new e.Uniform3f(t,i.u_frustum_br),u_frustum_bl:new e.Uniform3f(t,i.u_frustum_bl),u_globe_pos:new e.Uniform3f(t,i.u_globe_pos),u_globe_radius:new e.Uniform1f(t,i.u_globe_radius),u_globe_transition:new e.Uniform1f(t,i.u_globe_transition),u_is_globe:new e.Uniform1i(t,i.u_is_globe),u_viewport:new e.Uniform2f(t,i.u_viewport)}))(t,x))}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].location&&i[e].set(t[e])}}draw(e,t,i,r,n,o,a,s,l,A,c,u,h,d,f,p,m){const g=e.gl;if(this.failedToCreate)return;e.program.set(this.program),e.setDepthMode(i),e.setStencilMode(r),e.setColorMode(n),e.setCullFace(o);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(a[e]);d&&d.setUniforms(e,this.binderUniforms,u,{zoom:h});const _={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[t];for(const i of c.get()){const r=i.vaos||(i.vaos={});(r[s]||(r[s]=new ci)).bind(e,this,l,d?d.getPaintVertexBuffers():[],A,i.vertexOffset,f,p,m),g.drawElements(t,i.primitiveLength*_,g.UNSIGNED_SHORT,i.primitiveOffset*_*2)}}}function ki(e,t,i){const r=1/B(i,1,t.transform.tileZoom),n=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,t.transform.tileZoom)/n,a=o*(i.tileID.canonical.x+i.tileID.wrap*n),s=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}const zi=e.create(),Di=(t,i,r,n,o,a,s,l,A)=>{const c=i.style.light,u=c.properties.get("position"),h=[u.x,u.y,u.z],d=e.create$1();"viewport"===c.properties.get("anchor")&&(e.fromRotation(d,-i.transform.angle),e.transformMat3(h,h,d));const f=c.properties.get("color"),p=i.transform,m={u_matrix:t,u_lightpos:h,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[f.r,f.g,f.b],u_vertical_gradient:+r,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zi,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===p.projection.name&&(m.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],m.u_zoom_transition=s,m.u_inv_rot_matrix=A,m.u_merc_center=l,m.u_up_dir=p.projection.upVector(new e.CanonicalTileID(0,0,0),l[0]*e.EXTENT,l[1]*e.EXTENT),m.u_height_lift=a),m},Bi=(t,i,r,n,o,a,s,l,A,c,u)=>{const h=Di(t,i,r,n,o,l,A,c,u),d={u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8};return e.extend(h,ki(a,i,s),d)},Pi=e=>({u_matrix:e}),Li=(t,i,r,n)=>e.extend(Pi(t),ki(r,i,n)),Ri=(e,t)=>({u_matrix:e,u_world:t}),Fi=(t,i,r,n,o)=>e.extend(Li(t,i,r,n),{u_world:o}),Oi=e.create(),Ui=(t,i,r,n,o,a)=>{const s=t.transform,l="globe"===s.projection.name;let A;if("map"===a.paint.get("circle-pitch-alignment"))if(l){const t=e.globePixelsToTileUnits(s.zoom,i.canonical)*s._projectionScaler;A=Float32Array.from([t,0,0,t])}else A=s.calculatePixelsToTileUnitsMatrix(r);else A=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:s.cameraToCenterDistance,u_matrix:t.translatePosMatrix(i.projMatrix,r,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_device_pixel_ratio:e.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:Oi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){c.u_inv_rot_matrix=n,c.u_merc_center=o,c.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],c.u_zoom_transition=e.globeToMercatorTransition(s.zoom);const t=o[0]*e.EXTENT,r=o[1]*e.EXTENT;c.u_up_dir=s.projection.upVector(new e.CanonicalTileID(0,0,0),t,r)}return c},Vi=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},ji=(t,i,r,n)=>{const o=e.EXTENT/r.tileSize;return{u_matrix:t,u_camera_to_center_distance:i.getCameraToCenterDistance(n),u_extrude_scale:[i.pixelsToGLUnits[0]/o,i.pixelsToGLUnits[1]/o]}},Gi=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),Ni=e.create(),Zi=(t,i,r,n,o,a,s)=>{const l=t.transform,A="globe"===l.projection.name,c=A?e.globePixelsToTileUnits(l.zoom,i.canonical)*l._projectionScaler:B(r,1,a),u={u_matrix:i.projMatrix,u_extrude_scale:c,u_intensity:s,u_inv_rot_matrix:Ni,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){u.u_inv_rot_matrix=n,u.u_merc_center=o,u.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],u.u_zoom_transition=e.globeToMercatorTransition(l.zoom);const t=o[0]*e.EXTENT,r=o[1]*e.EXTENT;u.u_up_dir=l.projection.upVector(new e.CanonicalTileID(0,0,0),t,r)}return u},qi=(e,t,i,r,n,o,a,s)=>{const l=e.transform,A=l.calculatePixelsToTileUnitsMatrix(t),c={u_matrix:Hi(e,t,i,n),u_pixels_to_tile_units:A,u_device_pixel_ratio:a,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:o,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:s};if(Wi(i)){const i=Qi(t,e.transform);c.u_texsize=t.lineAtlasTexture.size,c.u_scale=[i,r.fromScale,r.toScale],c.u_mix=r.t}return c},$i=(e,t,i,r,n,o)=>{const a=e.transform,s=Qi(t,a);return{u_matrix:Hi(e,t,i,n),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:a.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:o,u_image:0,u_scale:[s,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Qi(e,t){return 1/B(e,1,t.tileZoom)}function Hi(e,t,i,r){return e.translatePosMatrix(r||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}function Wi(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Xi=(e,t,i,r,n,o)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:i,u_fade_t:r.mix,u_opacity:r.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(s=n.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(a=n.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:Yi(n.paint.get("raster-hue-rotate")),u_perspective_transform:o};var a,s};function Yi(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const Ki=e.create(),Ji=(t,i,r,n,o,a,s,l,A,c,u,h,d,f,p,m)=>{const g=o.transform,_={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:g.cameraToCenterDistance,u_rotate_symbol:+r,u_aspect_ratio:g.width/g.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+A,u_pitch_with_map:+n,u_texsize:c,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ki,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ki,u_up_vector:[0,-1,0]};return"globe"===m.name&&(_.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],_.u_zoom_transition=h,_.u_inv_rot_matrix=f,_.u_merc_center=d,_.u_camera_forward=g._camera.forward(),_.u_ecef_origin=e.globeECEFOrigin(g.globeMatrix,u.toUnwrapped()),_.u_tile_matrix=Float32Array.from(g.globeMatrix),_.u_up_vector=p),_},er=(t,i,r,n,o,a,s,l,A,c,u,h,d,f,p,m,g)=>e.extend(Ji(t,i,r,n,o,a,s,l,A,c,h,d,f,p,m,g),{u_gamma_scale:n?o.transform.cameraToCenterDistance*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.exported.devicePixelRatio,u_is_halo:+u}),ir=(t,i,r,n,o,a,s,l,A,c,u,h,d,f,p,m)=>e.extend(er(t,i,r,n,o,a,s,l,!0,A,!0,u,h,d,f,p,m),{u_texsize_icon:c,u_texture_icon:1}),rr=(e,t,i)=>({u_matrix:e,u_opacity:t,u_color:i}),nr=(t,i,r,n,o,a)=>e.extend(function(e,t,i,r){const n=i.imageManager.getPattern(e.from.toString()),o=i.imageManager.getPattern(e.to.toString()),{width:a,height:s}=i.imageManager.getPixelSize(),l=Math.pow(2,r.tileID.overscaledZ),A=r.tileSize*Math.pow(2,i.transform.tileZoom)/l,c=A*(r.tileID.canonical.x+r.tileID.wrap*l),u=A*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[a,s],u_mix:t.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/B(r,1,i.transform.tileZoom),u_pixel_coord_upper:[c>>16,u>>16],u_pixel_coord_lower:[65535&c,65535&u]}}(n,a,r,o),{u_matrix:t,u_opacity:i}),or={fillExtrusion:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_lightpos:new e.Uniform3f(t,i.u_lightpos),u_lightintensity:new e.Uniform1f(t,i.u_lightintensity),u_lightcolor:new e.Uniform3f(t,i.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,i.u_vertical_gradient),u_opacity:new e.Uniform1f(t,i.u_opacity),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_up_dir:new e.Uniform3f(t,i.u_up_dir),u_height_lift:new e.Uniform1f(t,i.u_height_lift)}),fillExtrusionPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_lightpos:new e.Uniform3f(t,i.u_lightpos),u_lightintensity:new e.Uniform1f(t,i.u_lightintensity),u_lightcolor:new e.Uniform3f(t,i.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,i.u_vertical_gradient),u_height_factor:new e.Uniform1f(t,i.u_height_factor),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_up_dir:new e.Uniform3f(t,i.u_up_dir),u_height_lift:new e.Uniform1f(t,i.u_height_lift),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade),u_opacity:new e.Uniform1f(t,i.u_opacity)}),fill:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}),fillPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}),fillOutline:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world)}),fillOutlinePattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}),circle:(t,i)=>({u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_extrude_scale:new e.UniformMatrix2f(t,i.u_extrude_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_up_dir:new e.Uniform3f(t,i.u_up_dir)}),collisionBox:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,i.u_extrude_scale)}),collisionCircle:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_matrix:new e.UniformMatrix4f(t,i.u_inv_matrix),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_viewport_size:new e.Uniform2f(t,i.u_viewport_size)}),debug:(t,i)=>({u_color:new e.UniformColor(t,i.u_color),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_overlay:new e.Uniform1i(t,i.u_overlay),u_overlay_scale:new e.Uniform1f(t,i.u_overlay_scale)}),clippingMask:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}),heatmap:(t,i)=>({u_extrude_scale:new e.Uniform1f(t,i.u_extrude_scale),u_intensity:new e.Uniform1f(t,i.u_intensity),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_up_dir:new e.Uniform3f(t,i.u_up_dir)}),heatmapTexture:(t,i)=>({u_image:new e.Uniform1i(t,i.u_image),u_color_ramp:new e.Uniform1i(t,i.u_color_ramp),u_opacity:new e.Uniform1f(t,i.u_opacity)}),hillshade:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_latrange:new e.Uniform2f(t,i.u_latrange),u_light:new e.Uniform2f(t,i.u_light),u_shadow:new e.UniformColor(t,i.u_shadow),u_highlight:new e.UniformColor(t,i.u_highlight),u_accent:new e.UniformColor(t,i.u_accent)}),hillshadePrepare:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_dimension:new e.Uniform2f(t,i.u_dimension),u_zoom:new e.Uniform1f(t,i.u_zoom),u_unpack:new e.Uniform4f(t,i.u_unpack)}),line:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_pixels_to_tile_units:new e.UniformMatrix2f(t,i.u_pixels_to_tile_units),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_dash_image:new e.Uniform1i(t,i.u_dash_image),u_gradient_image:new e.Uniform1i(t,i.u_gradient_image),u_image_height:new e.Uniform1f(t,i.u_image_height),u_texsize:new e.Uniform2f(t,i.u_texsize),u_scale:new e.Uniform3f(t,i.u_scale),u_mix:new e.Uniform1f(t,i.u_mix),u_alpha_discard_threshold:new e.Uniform1f(t,i.u_alpha_discard_threshold),u_trim_offset:new e.Uniform2f(t,i.u_trim_offset)}),linePattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixels_to_tile_units:new e.UniformMatrix2f(t,i.u_pixels_to_tile_units),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_image:new e.Uniform1i(t,i.u_image),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade),u_alpha_discard_threshold:new e.Uniform1f(t,i.u_alpha_discard_threshold)}),raster:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_tl_parent:new e.Uniform2f(t,i.u_tl_parent),u_scale_parent:new e.Uniform1f(t,i.u_scale_parent),u_fade_t:new e.Uniform1f(t,i.u_fade_t),u_opacity:new e.Uniform1f(t,i.u_opacity),u_image0:new e.Uniform1i(t,i.u_image0),u_image1:new e.Uniform1i(t,i.u_image1),u_brightness_low:new e.Uniform1f(t,i.u_brightness_low),u_brightness_high:new e.Uniform1f(t,i.u_brightness_high),u_saturation_factor:new e.Uniform1f(t,i.u_saturation_factor),u_contrast_factor:new e.Uniform1f(t,i.u_contrast_factor),u_spin_weights:new e.Uniform3f(t,i.u_spin_weights),u_perspective_transform:new e.Uniform2f(t,i.u_perspective_transform)}),symbolIcon:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_camera_forward:new e.Uniform3f(t,i.u_camera_forward),u_tile_matrix:new e.UniformMatrix4f(t,i.u_tile_matrix),u_up_vector:new e.Uniform3f(t,i.u_up_vector),u_ecef_origin:new e.Uniform3f(t,i.u_ecef_origin),u_texture:new e.Uniform1i(t,i.u_texture)}),symbolSDF:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texture:new e.Uniform1i(t,i.u_texture),u_gamma_scale:new e.Uniform1f(t,i.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_camera_forward:new e.Uniform3f(t,i.u_camera_forward),u_tile_matrix:new e.UniformMatrix4f(t,i.u_tile_matrix),u_up_vector:new e.Uniform3f(t,i.u_up_vector),u_ecef_origin:new e.Uniform3f(t,i.u_ecef_origin),u_is_halo:new e.Uniform1i(t,i.u_is_halo)}),symbolTextAndIcon:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texsize_icon:new e.Uniform2f(t,i.u_texsize_icon),u_texture:new e.Uniform1i(t,i.u_texture),u_texture_icon:new e.Uniform1i(t,i.u_texture_icon),u_gamma_scale:new e.Uniform1f(t,i.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,i.u_is_halo)}),background:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_opacity:new e.Uniform1f(t,i.u_opacity),u_color:new e.UniformColor(t,i.u_color)}),backgroundPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_opacity:new e.Uniform1f(t,i.u_opacity),u_image:new e.Uniform1i(t,i.u_image),u_pattern_tl_a:new e.Uniform2f(t,i.u_pattern_tl_a),u_pattern_br_a:new e.Uniform2f(t,i.u_pattern_br_a),u_pattern_tl_b:new e.Uniform2f(t,i.u_pattern_tl_b),u_pattern_br_b:new e.Uniform2f(t,i.u_pattern_br_b),u_texsize:new e.Uniform2f(t,i.u_texsize),u_mix:new e.Uniform1f(t,i.u_mix),u_pattern_size_a:new e.Uniform2f(t,i.u_pattern_size_a),u_pattern_size_b:new e.Uniform2f(t,i.u_pattern_size_b),u_scale_a:new e.Uniform1f(t,i.u_scale_a),u_scale_b:new e.Uniform1f(t,i.u_scale_b),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_tile_units_to_pixels:new e.Uniform1f(t,i.u_tile_units_to_pixels)}),terrainRaster:fi,terrainDepth:fi,skybox:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_sun_direction:new e.Uniform3f(t,i.u_sun_direction),u_cubemap:new e.Uniform1i(t,i.u_cubemap),u_opacity:new e.Uniform1f(t,i.u_opacity),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset)}),skyboxGradient:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_color_ramp:new e.Uniform1i(t,i.u_color_ramp),u_center_direction:new e.Uniform3f(t,i.u_center_direction),u_radius:new e.Uniform1f(t,i.u_radius),u_opacity:new e.Uniform1f(t,i.u_opacity),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset)}),skyboxCapture:(t,i)=>({u_matrix_3f:new e.UniformMatrix3f(t,i.u_matrix_3f),u_sun_direction:new e.Uniform3f(t,i.u_sun_direction),u_sun_intensity:new e.Uniform1f(t,i.u_sun_intensity),u_color_tint_r:new e.Uniform4f(t,i.u_color_tint_r),u_color_tint_m:new e.Uniform4f(t,i.u_color_tint_m),u_luminance:new e.Uniform1f(t,i.u_luminance)}),globeRaster:(t,i)=>({u_proj_matrix:new e.UniformMatrix4f(t,i.u_proj_matrix),u_globe_matrix:new e.UniformMatrix4f(t,i.u_globe_matrix),u_normalize_matrix:new e.UniformMatrix4f(t,i.u_normalize_matrix),u_merc_matrix:new e.UniformMatrix4f(t,i.u_merc_matrix),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_image0:new e.Uniform1i(t,i.u_image0),u_grid_matrix:new e.UniformMatrix3f(t,i.u_grid_matrix),u_frustum_tl:new e.Uniform3f(t,i.u_frustum_tl),u_frustum_tr:new e.Uniform3f(t,i.u_frustum_tr),u_frustum_br:new e.Uniform3f(t,i.u_frustum_br),u_frustum_bl:new e.Uniform3f(t,i.u_frustum_bl),u_globe_pos:new e.Uniform3f(t,i.u_globe_pos),u_globe_radius:new e.Uniform1f(t,i.u_globe_radius),u_viewport:new e.Uniform2f(t,i.u_viewport)}),globeAtmosphere:(t,i)=>({u_frustum_tl:new e.Uniform3f(t,i.u_frustum_tl),u_frustum_tr:new e.Uniform3f(t,i.u_frustum_tr),u_frustum_br:new e.Uniform3f(t,i.u_frustum_br),u_frustum_bl:new e.Uniform3f(t,i.u_frustum_bl),u_horizon:new e.Uniform1f(t,i.u_horizon),u_transition:new e.Uniform1f(t,i.u_transition),u_fadeout_range:new e.Uniform1f(t,i.u_fadeout_range),u_color:new e.Uniform4f(t,i.u_color),u_high_color:new e.Uniform4f(t,i.u_high_color),u_space_color:new e.Uniform4f(t,i.u_space_color),u_star_intensity:new e.Uniform1f(t,i.u_star_intensity),u_star_density:new e.Uniform1f(t,i.u_star_density),u_star_size:new e.Uniform1f(t,i.u_star_size),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset),u_horizon_angle:new e.Uniform1f(t,i.u_horizon_angle),u_rotation_matrix:new e.UniformMatrix4f(t,i.u_rotation_matrix)})};let ar;function sr(t,i,r,n,o,a,s){const l=t.context,A=l.gl,c=t.transform,u=t.useProgram("collisionBox"),h=[];let d=0,f=0;for(let p=0;p<n.length;p++){const m=n[p],g=i.getTile(m),_=g.getBucket(r);if(!_)continue;const y=vt(m,_,c);let x=y;0===o[0]&&0===o[1]||(x=t.translatePosMatrix(y,g,o,a));const b=s?_.textCollisionBox:_.iconCollisionBox,v=_.collisionCircleArray;if(v.length>0){const t=e.create(),i=x;e.mul(t,_.placementInvProjMatrix,c.glCoordMatrix),e.mul(t,t,_.placementViewportMatrix),h.push({circleArray:v,circleOffset:f,transform:i,invTransform:t,projection:_.getProjection()}),d+=v.length/4,f=d}b&&(t.terrain&&t.terrain.setupElevationDraw(g,u),u.draw(l,A.LINES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,ji(x,c,g,_.getProjection()),r.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,null,c.zoom,null,b.collisionVertexBuffer,b.collisionVertexBufferExt))}if(!s||!h.length)return;const p=t.useProgram("collisionCircle"),m=new e.StructArrayLayout2f1f2i16;m.resize(4*d),m._trim();let g=0;for(const e of h)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,r=e.circleArray[i+0],n=e.circleArray[i+1],o=e.circleArray[i+2],a=e.circleArray[i+3];m.emplace(g++,r,n,o,a,0),m.emplace(g++,r,n,o,a,1),m.emplace(g++,r,n,o,a,2),m.emplace(g++,r,n,o,a,3)}(!ar||ar.length<2*d)&&(ar=function(t){const i=2*t,r=new e.StructArrayLayout3ui6;r.resize(i),r._trim();for(let e=0;e<i;e++){const t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(d));const _=l.createIndexBuffer(ar,!0),y=l.createVertexBuffer(m,e.collisionCircleLayout.members,!0);for(const i of h){const n={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(x=c).getCameraToCenterDistance(i.projection),u_viewport_size:[x.width,x.height]};p.draw(l,A.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,n,r.id,y,_,e.SegmentVector.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,c.zoom)}var x;y.destroy(),_.destroy()}const lr=e.create();function Ar(t,i,r,n,o,a){const{horizontalAlign:s,verticalAlign:l}=e.getAnchorAlignment(t),A=-(s-.5)*i,c=-(l-.5)*r,u=e.evaluateVariableOffset(t,n);return new e.pointGeometry((A/o+u[0])*a,(c/o+u[1])*a)}function cr(t,i,r,n,o,a,s,l,A,c,u){const h=t.text.placedSymbolArray,d=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,p={},m=bt(l,t.getProjection(),a),g=a.elevation,_=t.getProjection().upVectorScale(l.canonical,a.center.lat,a.worldSize);d.clear();for(let f=0;f<h.length;f++){const y=h.get(f),x=t.allowVerticalPlacement&&!y.placedOrientation,b=y.hidden||!y.crossTileID||x?null:n[y.crossTileID];if(b){const n=new e.pointGeometry(y.tileAnchorX,y.tileAnchorY),h=t.getProjection().upVector(l.canonical,n.x,n.y),f=g?g.getAtTileOffset(l,n.x,n.y):0,x=ot([y.projectedAnchorX+f*h[0]*_.metersToTile,y.projectedAnchorY+f*h[1]*_.metersToTile,y.projectedAnchorZ+f*h[2]*_.metersToTile],r?m:s),v=at(a.getCameraToCenterDistance(t.getProjection()),x.signedDistanceFromCamera);let w=o.evaluateSizeForFeature(t.textSizeData,c,y)*v/e.ONE_EM;r&&(w*=t.tilePixelRatio/A);const{width:T,height:E,anchor:M,textOffset:C,textScale:I}=b,S=Ar(M,T,E,C,I,w);let k;if(r){const e=n.add(S),{x:i,y:r,z:o}=t.getProjection().projectTilePoint(e.x,e.y,l.canonical);k=ot([i+f*h[0]*_.metersToTile,r+f*h[1]*_.metersToTile,o+f*h[2]*_.metersToTile],s).point}else{const e=i?S.rotate(-a.angle):S;k=[x.point[0]+e.x,x.point[1]+e.y,0]}const z=t.allowVerticalPlacement&&y.placedOrientation===e.WritingMode.vertical?Math.PI/2:0;for(let t=0;t<y.numGlyphs;t++)e.addDynamicAttributes(d,k[0],k[1],k[2],z);u&&y.associatedIconIndex>=0&&(p[y.associatedIconIndex]={shiftedAnchor:k,angle:z})}else mt(y.numGlyphs,d)}if(u){f.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const r=i.get(t);if(r.hidden)mt(r.numGlyphs,f);else{const i=p[t];if(i)for(let t=0;t<r.numGlyphs;t++)e.addDynamicAttributes(f,i.shiftedAnchor[0],i.shiftedAnchor[1],i.shiftedAnchor[2],i.angle);else mt(r.numGlyphs,f)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(d)}function ur(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function pr(t,i,r,n,o,a,s,l,A,c,u,h){const d=t.context,f=d.gl,p=t.transform,m="map"===l,g="map"===A,_=m&&"point"!==r.layout.get("symbol-placement"),y=m&&!g&&!_,x=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let b=!1;const v=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),w=[e.mercatorXfromLng(p.center.lng),e.mercatorYfromLat(p.center.lat)],T=r.layout.get("text-variable-anchor"),E="globe"===p.projection.name,M=[],C=[0,-1,0];let I=C;!E&&!p.mercatorFromTransition||m||(I=function(t){const i=t._camera.getWorldToCamera(t.worldSize,1),r=e.multiply([],i,t.globeMatrix);e.invert(r,r);const n=[0,0,0],o=[0,1,0,0];return e.transformMat4$1(o,o,r),n[0]=o[0],n[1]=o[1],n[2]=o[2],e.normalize(n,n),n}(p));for(const l of n){const n=i.getTile(l),A=n.getBucket(r);if(!A)continue;if("mercator"===A.projection.name&&E)continue;const u=o?A.text:A.icon;if(!u||A.fullyClipped||!u.segments.get().length)continue;const h=u.programConfigurations.get(r.id),d=o||A.sdfIcons,v=o?A.textSizeData:A.iconSizeData,S=g||0!==p.pitch,k=e.evaluateSizeForZoom(v,p.zoom);let z,D,B,P,L=[0,0],R=null;if(o){if(D=n.glyphAtlasTexture,B=f.LINEAR,z=n.glyphAtlasTexture.size,A.iconsInText){L=n.imageAtlasTexture.size,R=n.imageAtlasTexture;const e="composite"===v.kind||"camera"===v.kind;P=S||t.options.rotating||t.options.zooming||e?f.LINEAR:f.NEAREST}}else{const e=1!==r.layout.get("icon-size").constantOr(0)||A.iconsNeedLinear;D=n.imageAtlasTexture,B=d||t.options.rotating||t.options.zooming||e||S?f.LINEAR:f.NEAREST,z=n.imageAtlasTexture.size}const F="globe"===A.projection.name,O=F?I:C,U=F?e.globeToMercatorTransition(p.zoom):0,V=bt(l,A.getProjection(),p),j=p.calculatePixelsToTileUnitsMatrix(n),G=tt(V,n.tileID.canonical,g,m,p,A.getProjection(),j),N=t.terrain&&g&&_?e.invert(e.create(),G):lr,Z=nt(V,n.tileID.canonical,g,m,p,A.getProjection(),j),$=T&&A.hasTextData(),Q="none"!==r.layout.get("icon-text-fit")&&$&&A.hasIconData();if(_){const e=p.elevation,i=e?e.getAtTileOffsetFunc(l,p.center.lat,p.worldSize,A.getProjection()):e=>[0,0,0],r=it(V,n.tileID.canonical,g,m,p,A.getProjection(),j);lt(A,V,t,o,r,Z,g,c,i,l)}const q=_||o&&T||Q,H=t.translatePosMatrix(V,n,a,s),W=q?lr:G,X=t.translatePosMatrix(Z,n,a,s,!0),Y=A.getProjection().createInversionMatrix(p,l.canonical),K=[];t.terrain&&g&&K.push("PITCH_WITH_MAP_TERRAIN"),F&&K.push("PROJECTION_GLOBE_VIEW"),q&&K.push("PROJECTED_POS_ON_VIEWPORT");const J=d&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let ee;ee=d?A.iconsInText?ir(v.kind,k,y,g,t,H,W,X,z,L,l,U,w,Y,O,A.getProjection()):er(v.kind,k,y,g,t,H,W,X,o,z,!0,l,U,w,Y,O,A.getProjection()):Ji(v.kind,k,y,g,t,H,W,X,o,z,l,U,w,Y,O,A.getProjection());const te={program:t.useProgram(ur(d,o,A),h,K),buffers:u,uniformValues:ee,atlasTexture:D,atlasTextureIcon:R,atlasInterpolation:B,atlasInterpolationIcon:P,isSDF:d,hasHalo:J,tile:n,labelPlaneMatrixInv:N};if(x&&A.canOverlap){b=!0;const t=u.segments.get();for(const i of t)M.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:te})}else M.push({segments:u.segments,sortKey:0,state:te})}b&&M.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of M){const i=e.state;if(t.terrain&&t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:!E,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),d.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(d.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,dr(i.buffers,e.segments,r,t,i.program,v,u,h,n)),n.u_is_halo=0}dr(i.buffers,e.segments,r,t,i.program,v,u,h,i.uniformValues)}}function dr(t,i,r,n,o,a,s,l,A){const c=n.context;o.draw(c,c.gl.TRIANGLES,a,s,l,e.CullFaceMode.disabled,A,r.id,t.layoutVertexBuffer,t.indexBuffer,i,r.paint,n.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.globeExtVertexBuffer)}function fr(t,i,r,n,o,a,s){const l=t.context.gl,A=r.paint.get("fill-pattern"),c=A&&A.constantOr(1),u=r.getCrossfadeParameters();let h,d,f,p,m;s?(d=c&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",h=l.LINES):(d=c?"fillPattern":"fill",h=l.TRIANGLES);for(const g of n){const n=i.getTile(g);if(c&&!n.patternsLoaded())continue;const _=n.getBucket(r);if(!_)continue;t.prepareDrawTile();const y=_.programConfigurations.get(r.id),x=t.useProgram(d,y);c&&(t.context.activeTexture.set(l.TEXTURE0),n.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),y.updatePaintBuffers(u));const b=A.constantOr(null);if(b&&n.imageAtlas){const e=n.imageAtlas,t=e.patternPositions[b.to.toString()],i=e.patternPositions[b.from.toString()];t&&i&&y.setConstantPatternPositions(t,i)}const v=t.translatePosMatrix(g.projMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(s){p=_.indexBuffer2,m=_.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];f="fillOutlinePattern"===d&&c?Fi(v,t,u,n,e):Ri(v,e)}else p=_.indexBuffer,m=_.segments,f=c?Li(v,t,u,n):Pi(v);t.prepareDrawProgram(t.context,x,g.toUnwrapped()),x.draw(t.context,h,o,t.stencilModeForClipping(g),a,e.CullFaceMode.disabled,f,r.id,_.layoutVertexBuffer,p,m,r.paint,t.transform.zoom,y)}}function mr(t,i,r,n,o,a,s){const l=t.context,A=l.gl,c=t.transform,u=r.paint.get("fill-extrusion-pattern"),h=u.constantOr(1),d=r.getCrossfadeParameters(),f=r.paint.get("fill-extrusion-opacity"),p="globe"===c.projection.name?e.fillExtrusionHeightLift():0,m="globe"===c.projection.name,g=m?e.globeToMercatorTransition(c.zoom):0,_=[e.mercatorXfromLng(c.center.lng),e.mercatorYfromLat(c.center.lat)],y=[];m&&y.push("PROJECTION_GLOBE_VIEW");for(const x of n){const n=i.getTile(x),b=n.getBucket(r);if(!b||b.projection.name!==c.projection.name)continue;const v=b.programConfigurations.get(r.id),w=t.useProgram(h?"fillExtrusionPattern":"fillExtrusion",v,y);if(t.terrain){const e=t.terrain;if(t.style.terrainSetForDrapingOnly())e.setupElevationDraw(n,w,{useMeterToDem:!0});else{if(!b.enableTerrain)continue;if(e.setupElevationDraw(n,w,{useMeterToDem:!0}),_r(l,i,x,b,r,e),!b.centroidVertexBuffer){const e=w.attributes.a_centroid_pos;void 0!==e&&A.vertexAttrib2f(e,0,0)}}}h&&(t.context.activeTexture.set(A.TEXTURE0),n.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),v.updatePaintBuffers(d));const T=u.constantOr(null);if(T&&n.imageAtlas){const e=n.imageAtlas,t=e.patternPositions[T.to.toString()],i=e.patternPositions[T.from.toString()];t&&i&&v.setConstantPatternPositions(t,i)}const E=t.translatePosMatrix(x.projMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),M=c.projection.createInversionMatrix(c,x.canonical),C=r.paint.get("fill-extrusion-vertical-gradient"),I=h?Bi(E,t,C,f,x,d,n,p,g,_,M):Di(E,t,C,f,x,p,g,_,M);t.prepareDrawProgram(l,w,x.toUnwrapped()),w.draw(l,l.gl.TRIANGLES,o,a,s,e.CullFaceMode.backCCW,I,r.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,r.paint,t.transform.zoom,v,t.terrain?b.centroidVertexBuffer:null,m?b.layoutVertexExtBuffer:null)}}function _r(t,i,r,n,o,a){const s=[t=>{let i=t.canonical.x-1,r=t.wrap;return i<0&&(i=(1<<t.canonical.z)-1,r--),new e.OverscaledTileID(t.overscaledZ,r,t.canonical.z,i,t.canonical.y)},t=>{let i=t.canonical.x+1,r=t.wrap;return i===1<<t.canonical.z&&(i=0,r++),new e.OverscaledTileID(t.overscaledZ,r,t.canonical.z,i,t.canonical.y)},t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)],l=e=>{const t=i.getSource().minzoom,r=e=>{const t=i.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},n=[0,-1,1];for(const i of n){if(e.overscaledZ+i<t)continue;const n=r(e.calculateScaledKey(e.overscaledZ+i));if(n)return n}},A=[0,0,0],c=(t,i)=>(A[0]=Math.min(t.min.y,i.min.y),A[1]=Math.max(t.max.y,i.max.y),A[2]=e.EXTENT-i.min.x>t.max.x?i.min.x-e.EXTENT:t.max.x,A),u=(t,i)=>(A[0]=Math.min(t.min.x,i.min.x),A[1]=Math.max(t.max.x,i.max.x),A[2]=e.EXTENT-i.min.y>t.max.y?i.min.y-e.EXTENT:t.max.y,A),h=[(e,t)=>c(e,t),(e,t)=>c(t,e),(e,t)=>u(e,t),(e,t)=>u(t,e)],d=new e.pointGeometry(0,0);let f,p,m;const g=(t,i,n,o,s)=>{const l=[[o?n:t,o?t:n,0],[o?n:i,o?i:n,0]],A=s<0?e.EXTENT+s:s,c=[o?A:(t+i)/2,o?(t+i)/2:A,0];return 0===n&&s<0||0!==n&&s>0?a.getForTilePoints(m,[c],!0,p):l.push(c),a.getForTilePoints(r,l,!0,f),Math.max(l[0][2],l[1][2],c[2])/a.exaggeration()};for(let t=0;t<4;t++){const i=(t<2?1:5)-t,o=n.borders[t];if(0===o.length)continue;const A=m=s[t](r),c=l(A);if(!(c&&c instanceof e.FillExtrusionBucket&&c.enableTerrain))continue;if(n.borderDoneWithNeighborZ[t]===c.canonical.z&&c.borderDoneWithNeighborZ[i]===n.canonical.z)continue;if(p=a.findDEMTileFor(A),!p||!p.dem)continue;if(!f){const e=a.findDEMTileFor(r);if(!e||!e.dem)return;f=e}const u=c.borders[i];let _=0;const y=c.borderDoneWithNeighborZ[i]!==n.canonical.z;if(n.canonical.z===c.canonical.z){for(let r=0;r<o.length;r++){const a=n.featuresOnBorder[o[r]],s=a.borders[t];let l;for(;_<u.length&&(l=c.featuresOnBorder[u[_]],!(l.borders[i][1]>s[0]+3));)y&&c.encodeCentroid(void 0,l,!1),_++;if(l&&_<u.length){const r=_;let o=0;for(;!(l.borders[i][0]>s[1]-3)&&(o++,++_!==u.length);)l=c.featuresOnBorder[u[_]];if(l=c.featuresOnBorder[u[r]],a.intersectsCount()>1||l.intersectsCount()>1||1!==o){1!==o&&(_=r),n.encodeCentroid(void 0,a,!1),y&&c.encodeCentroid(void 0,l,!1);continue}const A=h[t](a,l),f=t%2?e.EXTENT-1:0;d.x=g(A[0],Math.min(e.EXTENT-1,A[1]),f,t<2,A[2]),d.y=0,n.encodeCentroid(d,a,!1),y&&c.encodeCentroid(d,l,!1)}else n.encodeCentroid(void 0,a,!1)}n.borderDoneWithNeighborZ[t]=c.canonical.z,n.needsCentroidUpdate=!0,y&&(c.borderDoneWithNeighborZ[i]=n.canonical.z,c.needsCentroidUpdate=!0)}else{for(const e of o)n.encodeCentroid(void 0,n.featuresOnBorder[e],!1);if(y){for(const e of u)c.encodeCentroid(void 0,c.featuresOnBorder[e],!1);c.borderDoneWithNeighborZ[i]=n.canonical.z,c.needsCentroidUpdate=!0}n.borderDoneWithNeighborZ[t]=c.canonical.z,n.needsCentroidUpdate=!0}}(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(t)}const gr=new e.Color(1,0,0,1),yr=new e.Color(0,1,0,1),xr=new e.Color(0,0,1,1),vr=new e.Color(1,0,1,1),wr=new e.Color(0,1,1,1);function Tr(e,t,i,r){Mr(e,0,t+i/2,e.transform.width,i,r)}function Er(e,t,i,r){Mr(e,t-i/2,0,i,e.transform.height,r)}function Mr(t,i,r,n,o,a){const s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.exported.devicePixelRatio,r*e.exported.devicePixelRatio,n*e.exported.devicePixelRatio,o*e.exported.devicePixelRatio),s.clear({color:a}),l.disable(l.SCISSOR_TEST)}function Cr(t,i,r){const n=t.context,o=n.gl,a="globe"===t.transform.projection.name,s=r.projMatrix,l=t.useProgram("debug",null,a?["PROJECTION_GLOBE_VIEW"]:null),A=i.getTileByID(r.key);t.terrain&&t.terrain.setupElevationDraw(A,l);const c=e.DepthMode.disabled,u=e.StencilMode.disabled,h=t.colorModeForRenderPass(),d="$debug";n.activeTexture.set(o.TEXTURE0),t.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),a?A._makeGlobeTileDebugBuffers(t.context,t.transform.projection):A._makeDebugTileBoundsBuffers(t.context,t.transform.projection);const f=A._tileDebugBuffer||t.debugBuffer,p=A._tileDebugIndexBuffer||t.debugIndexBuffer,m=A._tileDebugSegments||t.debugSegments;l.draw(n,o.LINE_STRIP,c,u,h,e.CullFaceMode.disabled,Gi(s,e.Color.red),d,f,p,m,null,null,null,A._globeTileDebugBorderBuffer);const g=A.latestRawTileData,_=Math.floor((g&&g.byteLength||0)/1024),y=i.getTile(r).tileSize,x=512/Math.min(y,512)*(r.overscaledZ/t.transform.zoom)*.5;let b=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(b+=` => ${r.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,r=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,`${b} ${_}kb`);const v=A._tileDebugTextBuffer||t.debugBuffer,w=A._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,T=A._tileDebugTextSegments||t.debugSegments;l.draw(n,o.TRIANGLES,c,u,e.ColorMode.alphaBlended,e.CullFaceMode.disabled,Gi(s,e.Color.transparent,x),d,v,w,T,null,null,null,A._globeTileDebugTextBuffer)}const Ir=e.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Sr}=Ir;function kr(e,t,i,r){e.emplaceBack(t,i,r)}class zr{constructor(t){this.vertexArray=new e.StructArrayLayout3f12,this.indices=new e.StructArrayLayout3ui6,kr(this.vertexArray,-1,-1,1),kr(this.vertexArray,1,-1,1),kr(this.vertexArray,-1,1,1),kr(this.vertexArray,1,1,1),kr(this.vertexArray,-1,-1,-1),kr(this.vertexArray,1,-1,-1),kr(this.vertexArray,-1,1,-1),kr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Sr),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.SegmentVector.simpleSegment(0,0,36,12)}}function Dr(t,i,r,n,o,a){const s=t.gl,l=i.paint.get("sky-atmosphere-color"),A=i.paint.get("sky-atmosphere-halo-color"),c=i.paint.get("sky-atmosphere-sun-intensity"),u=((e,t,i,r,n)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(e.fromMat4(e.create$1(),n),o,c,l,A);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+a,i.skyboxTexture,0),r.draw(t,s.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.frontCW,u,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Br=e.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Pr{constructor(t){const i=new e.StructArrayLayout5f20;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const r=new e.StructArrayLayout3ui6;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,Br.members),this.indexBuffer=t.createIndexBuffer(r),this.segments=e.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Lr={symbol:function(t,i,r,n,o){if("translucent"!==t.renderPass)return;const a=e.StencilMode.disabled,s=t.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(t,i,r,n,o,a,s){const l=i.transform,A="map"===o,c="map"===a;for(const i of t){const t=n.getTile(i),o=t.getBucket(r);if(!o||!o.text||!o.text.segments.get().length)continue;const a=e.evaluateSizeForZoom(o.textSizeData,l.zoom),u=bt(i,o.getProjection(),l),h=l.calculatePixelsToTileUnitsMatrix(t),d=tt(u,t.tileID.canonical,c,A,l,o.getProjection(),h),f="none"!==r.layout.get("icon-text-fit")&&o.hasIconData();if(a){const r=Math.pow(2,l.zoom-t.tileID.overscaledZ);cr(o,A,c,s,e.symbolSize,l,d,i,r,a,f)}}}(n,t,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&pr(t,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,s),0!==r.paint.get("text-opacity").constantOr(1)&&pr(t,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,s),i.map.showCollisionBoxes&&(sr(t,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),sr(t,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(t,i,r,n){if("translucent"!==t.renderPass)return;const o=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===a.constantOr(1)||0===s.constantOr(1)))return;const A=t.context,c=A.gl,u=t.transform,h=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),d=e.StencilMode.disabled,f=t.colorModeForRenderPass(),p="globe"===u.projection.name,m=[e.mercatorXfromLng(u.center.lng),e.mercatorYfromLat(u.center.lat)],g=[];for(let o=0;o<n.length;o++){const a=n[o],s=i.getTile(a),A=s.getBucket(r);if(!A||A.projection.name!==u.projection.name)continue;const c=A.programConfigurations.get(r.id),h=Vi(r);p&&h.push("PROJECTION_GLOBE_VIEW");const d=t.useProgram("circle",c,h),f=A.layoutVertexBuffer,_=A.globeExtVertexBuffer,y=A.indexBuffer,x=u.projection.createInversionMatrix(u,a.canonical),b={programConfiguration:c,program:d,layoutVertexBuffer:f,globeExtVertexBuffer:_,indexBuffer:y,uniformValues:Ui(t,a,s,x,m,r),tile:s};if(l){const t=A.segments.get();for(const i of t)g.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:b})}else g.push({segments:A.segments,sortKey:0,state:b})}l&&g.sort(((e,t)=>e.sortKey-t.sortKey));const _={useDepthForOcclusion:!p};for(const i of g){const{programConfiguration:n,program:o,layoutVertexBuffer:a,globeExtVertexBuffer:s,indexBuffer:l,uniformValues:m,tile:g}=i.state,y=i.segments;t.terrain&&t.terrain.setupElevationDraw(g,o,_),t.prepareDrawProgram(A,o,g.tileID.toUnwrapped()),o.draw(A,c.TRIANGLES,h,d,f,e.CullFaceMode.disabled,m,r.id,a,l,y,r.paint,u.zoom,n,p?s:null)}},heatmap:function(t,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,a=o.gl,s=e.StencilMode.disabled,l=new e.ColorMode([a.ONE,a.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,i,r){const n=e.gl,o=t.width*r,a=t.height*r;e.activeTexture.set(n.TEXTURE1),e.viewport.set([0,0,o,a]);let s=i.heatmapFbo;if(!s||s&&(s.width!==o||s.height!==a)){s&&s.destroy();const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),s=i.heatmapFbo=e.createFramebuffer(o,a,!1),function(e,t,i,r,n,o){const a=e.gl;a.texImage2D(a.TEXTURE_2D,0,a.RGBA,n,o,0,a.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:a.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(e,0,t,s,o,a)}else n.bindTexture(n.TEXTURE_2D,s.colorAttachment.get()),e.bindFramebuffer.set(s.framebuffer)}(o,t,r,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.Color.transparent});const A=t.transform,c="globe"===A.projection.name,u=c?["PROJECTION_GLOBE_VIEW"]:null,h=c?e.CullFaceMode.frontCCW:e.CullFaceMode.disabled,d=[e.mercatorXfromLng(A.center.lng),e.mercatorYfromLat(A.center.lat)];for(let f=0;f<n.length;f++){const p=n[f];if(i.hasRenderableParent(p))continue;const m=i.getTile(p),g=m.getBucket(r);if(!g||g.projection.name!==A.projection.name)continue;const _=g.programConfigurations.get(r.id),y=t.useProgram("heatmap",_,u),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(m,y),t.prepareDrawProgram(o,y,p.toUnwrapped());const b=A.projection.createInversionMatrix(A,p.canonical);y.draw(o,a.TRIANGLES,e.DepthMode.disabled,s,l,h,Zi(t,p,m,b,d,x,r.paint.get("heatmap-intensity")),r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,t.transform.zoom,_,c?g.globeExtVertexBuffer:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const r=t.context,n=r.gl,o=i.heatmapFbo;if(!o)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let a=i.colorRampTexture;a||(a=i.colorRampTexture=new e.Texture(r,i.colorRamp,n.RGBA)),a.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(r,n.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,((e,t,i,r)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,r))},line:function(t,i,r,n){if("translucent"!==t.renderPass)return;const o=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0===o.constantOr(1)||0===a.constantOr(1))return;const s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),A=t.terrain&&t.terrain.renderingToTexture?1:e.exported.devicePixelRatio,c=r.paint.get("line-dasharray"),u=c.constantOr(1),h=r.layout.get("line-cap"),d=r.paint.get("line-pattern"),f=d.constantOr(1),p=r.paint.get("line-gradient"),m=r.getCrossfadeParameters(),g=f?"linePattern":"line",_=t.context,y=_.gl,x=(e=>{const t=[];Wi(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=e.paint.get("line-trim-offset");0===i[0]&&0===i[1]||t.push("RENDER_LINE_TRIM_OFFSET");const r=e.paint.get("line-pattern").constantOr(1),n=1!==e.paint.get("line-opacity").constantOr(1);return!r&&n&&t.push("RENDER_LINE_ALPHA_DISCARD"),t})(r);let b=x.includes("RENDER_LINE_ALPHA_DISCARD");t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(b=!1);for(const o of n){const n=i.getTile(o);if(f&&!n.patternsLoaded())continue;const a=n.getBucket(r);if(!a)continue;t.prepareDrawTile();const v=a.programConfigurations.get(r.id),w=t.useProgram(g,v,x),T=d.constantOr(null);if(T&&n.imageAtlas){const e=n.imageAtlas,t=e.patternPositions[T.to.toString()],i=e.patternPositions[T.from.toString()];t&&i&&v.setConstantPatternPositions(t,i)}const E=c.constantOr(null),M=h.constantOr(null);if(!f&&E&&M&&n.lineAtlas){const e=n.lineAtlas,t=e.getDash(E.to,M),i=e.getDash(E.from,M);t&&i&&v.setConstantPatternPositions(t,i)}let[C,I]=r.paint.get("line-trim-offset");if("round"===M||"square"===M){const e=1;C!==I&&(0===C&&(C-=e),1===I&&(I+=e))}const S=t.terrain?o.projMatrix:null,k=f?$i(t,n,r,m,S,A):qi(t,n,r,m,S,a.lineClipsArray.length,A,[C,I]);if(p){const n=a.gradients[r.id];let s=n.texture;if(r.gradientVersion!==n.version){let l=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=o.canonical.z===r?Math.ceil(1<<t.transform.maxZoom-o.canonical.z):1;l=e.clamp(e.nextPowerOfTwo(a.maxLineLength/e.EXTENT*1024*n),256,_.maxTextureSize)}n.gradient=e.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:n.gradient||void 0,clips:a.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new e.Texture(_,n.gradient,y.RGBA),n.version=r.gradientVersion,s=n.texture}_.activeTexture.set(y.TEXTURE1),s.bind(r.stepInterpolant?y.NEAREST:y.LINEAR,y.CLAMP_TO_EDGE)}u&&(_.activeTexture.set(y.TEXTURE0),n.lineAtlasTexture.bind(y.LINEAR,y.REPEAT),v.updatePaintBuffers(m)),f&&(_.activeTexture.set(y.TEXTURE0),n.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),v.updatePaintBuffers(m)),t.prepareDrawProgram(_,w,o.toUnwrapped());const z=i=>{w.draw(_,y.TRIANGLES,s,i,l,e.CullFaceMode.disabled,k,r.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,r.paint,t.transform.zoom,v,a.layoutVertexBuffer2)};if(b){const i=t.stencilModeForClipping(o).ref;0===i&&t.terrain&&_.clear({stencil:0});const r={func:y.EQUAL,mask:255};k.u_alpha_discard_threshold=.8,z(new e.StencilMode(r,i,255,y.KEEP,y.KEEP,y.INVERT)),k.u_alpha_discard_threshold=0,z(new e.StencilMode(r,i,255,y.KEEP,y.KEEP,y.KEEP))}else z(t.stencilModeForClipping(o))}b&&(t.resetStencilClippingMasks(),t.terrain&&_.clear({stencil:0}))},fill:function(t,i,r,n){const o=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0===a.constantOr(1))return;const s=t.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),A=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(e.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(t.renderPass===A){const o=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly);fr(t,i,r,n,o,s,!1)}if("translucent"===t.renderPass&&r.paint.get("fill-antialias")){const o=t.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,e.DepthMode.ReadOnly);fr(t,i,r,n,o,s,!0)}},"fill-extrusion":function(t,i,r,n){const o=r.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===t.renderPass){const a=new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==o||r.paint.get("fill-extrusion-pattern").constantOr(1))mr(t,i,r,n,a,e.StencilMode.disabled,e.ColorMode.disabled),mr(t,i,r,n,a,t.stencilModeFor3D(),t.colorModeForRenderPass()),t.resetStencilClippingMasks();else{const o=t.colorModeForRenderPass();mr(t,i,r,n,a,e.StencilMode.disabled,o)}}},hillshade:function(t,i,r,n){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const o=t.context,a=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),s=t.colorModeForRenderPass(),l=t.terrain&&t.terrain.renderingToTexture,[A,c]="translucent"!==t.renderPass||l?[{},n]:t.stencilConfigForOverlap(n);for(const n of c){const o=i.getTile(n);if(o.needsHillshadePrepare&&"offscreen"===t.renderPass)di(t,o,r,a,e.StencilMode.disabled,s);else if("translucent"===t.renderPass){const e=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(n):A[n.overscaledZ];hi(t,n,o,r,a,e,s)}}o.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,i,r,n,o,a){if("translucent"!==t.renderPass)return;if(0===r.paint.get("raster-opacity"))return;if(!n.length)return;const s=t.context,l=s.gl,A=i.getSource(),c=t.useProgram("raster"),u=t.colorModeForRenderPass(),h=t.terrain&&t.terrain.renderingToTexture,[d,f]=A instanceof ke||h?[{},n]:t.stencilConfigForOverlap(n),p=f[f.length-1].overscaledZ,m=!t.options.moving;for(const n of f){const o=h?e.DepthMode.disabled:t.depthModeForSublayer(n.overscaledZ-p,1===r.paint.get("raster-opacity")?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly,l.LESS),f=n.toUnwrapped(),g=i.getTile(n);if(h&&(!g||!g.hasData()))continue;const _=h?n.projMatrix:t.transform.calculateProjMatrix(f,m),y=t.terrain&&h?t.terrain.stencilModeForRTTOverlap(n):d[n.overscaledZ],x=a?0:r.paint.get("raster-fade-duration");g.registerFadeDuration(x);const b=i.findLoadedParent(n,0),v=wi(g,b,i,t.transform,x);let w,T;t.terrain&&t.terrain.prepareDrawTile();const E="nearest"===r.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;s.activeTexture.set(l.TEXTURE0),g.texture.bind(E,l.CLAMP_TO_EDGE),s.activeTexture.set(l.TEXTURE1),b?(b.texture.bind(E,l.CLAMP_TO_EDGE),w=Math.pow(2,b.tileID.overscaledZ-g.tileID.overscaledZ),T=[g.tileID.canonical.x*w%1,g.tileID.canonical.y*w%1]):g.texture.bind(E,l.CLAMP_TO_EDGE);const M=Xi(_,T||[0,0],w||1,v,r,A instanceof ke?A.perspectiveTransform:[0,0]);if(t.prepareDrawProgram(s,c,f),A instanceof ke)A.boundsBuffer&&A.boundsSegments&&c.draw(s,l.TRIANGLES,o,e.StencilMode.disabled,u,e.CullFaceMode.disabled,M,r.id,A.boundsBuffer,t.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:i,tileBoundsIndexBuffer:n,tileBoundsSegments:a}=t.getTileBoundsBuffers(g);c.draw(s,l.TRIANGLES,o,y,u,e.CullFaceMode.disabled,M,r.id,i,n,a)}}t.resetStencilClippingMasks()},background:function(t,i,r,n){const o=r.paint.get("background-color"),a=r.paint.get("background-opacity");if(0===a)return;const s=t.context,l=s.gl,A=t.transform,c=A.tileSize,u=r.paint.get("background-pattern");if(t.isPatternMissing(u))return;const h=!u&&1===o.a&&1===a&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==h)return;const d=e.StencilMode.disabled,f=t.depthModeForSublayer(0,"opaque"===h?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly),p=t.colorModeForRenderPass(),m=t.useProgram(u?"backgroundPattern":"background");let g,_=n;_||(g=t.getBackgroundTiles(),_=Object.values(g).map((e=>e.tileID))),u&&(s.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context));const y=r.getCrossfadeParameters();for(const h of _){const _=h.toUnwrapped(),x=n?h.projMatrix:t.transform.calculateProjMatrix(_);t.prepareDrawTile();const b=i?i.getTile(h):g?g[h.key]:new e.Tile(h,c,A.zoom,t),v=u?nr(x,a,t,u,{tileID:h,tileSize:c},y):rr(x,a,o);t.prepareDrawProgram(s,m,_);const{tileBoundsBuffer:w,tileBoundsIndexBuffer:T,tileBoundsSegments:E}=t.getTileBoundsBuffers(b);m.draw(s,l.TRIANGLES,f,d,p,e.CullFaceMode.disabled,v,r.id,w,T,E)}},sky:function(t,i,r){const n=t.transform,o="mercator"===n.projection.name||"globe"===n.projection.name?1:e.smoothstep(7,8,n.zoom),a=r.paint.get("sky-opacity")*o;if(0===a)return;const s=t.context,l=r.paint.get("sky-type"),A=new e.DepthMode(s.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===t.renderPass?r.needsSkyboxCapture(t)&&(function(t,i,r,n){const o=t.context,a=o.gl;let s=i.skyboxFbo;if(!s){s=i.skyboxFbo=o.createFramebuffer(32,32,!1),i.skyboxGeometry=new zr(o),i.skyboxTexture=o.gl.createTexture(),a.bindTexture(a.TEXTURE_CUBE_MAP,i.skyboxTexture),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR);for(let e=0;e<6;++e)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,a.RGBA,32,32,0,a.RGBA,a.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(s.framebuffer),o.viewport.set([0,0,32,32]);const l=i.getCenter(t,!0),A=t.useProgram("skyboxCapture"),c=new Float64Array(16);e.identity(c),e.rotateY(c,c,.5*-Math.PI),Dr(o,i,A,c,l,0),e.identity(c),e.rotateY(c,c,.5*Math.PI),Dr(o,i,A,c,l,1),e.identity(c),e.rotateX(c,c,.5*-Math.PI),Dr(o,i,A,c,l,2),e.identity(c),e.rotateX(c,c,.5*Math.PI),Dr(o,i,A,c,l,3),e.identity(c),Dr(o,i,A,c,l,4),e.identity(c),e.rotateY(c,c,Math.PI),Dr(o,i,A,c,l,5),o.viewport.set([0,0,t.width,t.height])}(t,r),r.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,i,r,n,o){const a=t.context,s=a.gl,l=t.transform,A=t.useProgram("skybox");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture);const c=((e,t,i,r,n)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:r,u_temporal_offset:n}))(l.skyboxMatrix,i.getCenter(t,!1),0,n,o);t.prepareDrawProgram(a,A),A.draw(a,s.TRIANGLES,r,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,c,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,r,A,a,c):"gradient"===l&&"sky"===t.renderPass&&function(t,i,r,n,o){const a=t.context,s=a.gl,l=t.transform,A=t.useProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new zr(a)),a.activeTexture.set(s.TEXTURE0);let c=i.colorRampTexture;c||(c=i.colorRampTexture=new e.Texture(a,i.colorRamp,s.RGBA)),c.bind(s.LINEAR,s.CLAMP_TO_EDGE);const u=((t,i,r,n,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.degToRad(r),u_opacity:n,u_temporal_offset:o}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),n,o);t.prepareDrawProgram(a,A),A.draw(a,s.TRIANGLES,r,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,u,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,r,A,a,c)},debug:function(e,t,i){for(let r=0;r<i.length;r++)Cr(e,t,i[r])},custom:function(t,i,r){const n=t.context,o=r.implementation;if(t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes("custom"))e.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===t.renderPass){const e=o.prerender;e&&(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),e.call(o,n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(e.StencilMode.disabled);const i="3d"===o.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.DepthMode.ReadOnly);n.setDepthMode(i),o.render(n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}};class Rr{constructor(t,i){this.context=new Me(t),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=e.SourceCache.maxUnderzooming+e.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ht,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(e,t){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ci(this,e));const r=this._terrain;this.transform.elevation=i?r:null,r.update(e,this.transform,t)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,r]=t.getFovAdjustedRange(this.transform._fov);if(i>r)return void(this.transform.fogCullDistSq=null);const n=i+.78*(r-i);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,i){if(this.width=t*e.exported.devicePixelRatio,this.height=i*e.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._layers[e].resize()}setup(){const t=this.context,i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(i,e.posAttributes.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);const r=new e.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(e.EXTENT,0),r.emplaceBack(0,e.EXTENT),r.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(r,e.posAttributes.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);const n=new e.StructArrayLayout2i4;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(n,e.posAttributes.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);const o=new e.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(e.EXTENT,0,e.EXTENT,0),o.emplaceBack(0,e.EXTENT,0,e.EXTENT),o.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.boundsAttributes.members),this.mercatorBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);const a=new e.StructArrayLayout3ui6;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(a);const s=new e.StructArrayLayout1ui2;for(const e of[0,1,3,2,0])s.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.Texture(t,new e.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.create();const l=this.context.gl;this.stencilClearMode=new e.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(e.window.performance.now()),this.atmosphereBuffer=new Pr(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,i.TRIANGLES,e.DepthMode.disabled,this.stencilClearMode,e.ColorMode.disabled,e.CullFaceMode.disabled,bi(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,r){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!r||0===r.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of r)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=i.id;const n=this.context,o=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(e.ColorMode.disabled),n.setDepthMode(e.DepthMode.disabled);const a=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of r){const r=i.getTile(t),s=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,{tileBoundsBuffer:l,tileBoundsIndexBuffer:A,tileBoundsSegments:c}=this.getTileBoundsBuffers(r);a.draw(n,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},s,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,bi(t.projMatrix),"$clipping",l,A,c)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new e.StencilMode({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new e.StencilMode({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,r=t.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),n=r[r.length-1].overscaledZ,o=r[0].overscaledZ-n+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const t={};for(let r=0;r<o;r++)t[r+n]=new e.StencilMode({func:i.GEQUAL,mask:255},r+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=o,[t,r]}return[{[n]:e.StencilMode.disabled},r]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}depthModeForSublayer(t,i,r){if(!this.opaquePassEnabledForLayer())return e.DepthMode.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(r||this.context.gl.LEQUAL,i,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now()),this.imageManager.beginFrame();const r=this.style.order,n=this.style._sourceCaches;for(const e in n){const t=n[e];t.used&&t.prepare(this.context)}const o={},a={},s={};for(const e in n){const t=n[e];o[e]=t.getVisibleCoordinates(),a[e]=o[e].slice().reverse(),s[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<r.length;e++)if(this.style._layers[r[e]].is3D()){this.opaquePassCutoff=e;break}if(this.terrain&&(this.terrain.updateTileBinding(s),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.GlobeSharedBuffers(this.context)),e.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const e of r){const i=this.style._layers[e],r=t._getLayerSourceCache(i);if(!i.hasOffscreenPass()||i.isHidden(this.transform.zoom))continue;const n=r?a[r.id]:void 0;("custom"===i.type||i.isSky()||n&&n.length)&&this.renderLayer(this,r,i,n)}if(this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:i.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[r[this.currentLayer]],i=t._getLayerSourceCache(e);if(e.isSky())continue;const n=i?a[i.id]:void 0;this._renderTileClippingMasks(e,i,n),this.renderLayer(this,i,e,n)}if(this.style.fog&&this.transform.projection.supportsFog&&function(t,i){const r=t.context,n=r.gl,o=t.transform,a=new e.DepthMode(n.LEQUAL,e.DepthMode.ReadOnly,[0,1]),s=t.useProgram("globeAtmosphere",null,"globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),l=e.globeToMercatorTransition(o.zoom),A=i.properties.get("color").toArray01(),c=i.properties.get("high-color").toArray01(),u=i.properties.get("space-color").toArray01PremultipliedAlpha(),h=e.identity$1([]);e.rotateY$1(h,h,-e.degToRad(o._center.lng)),e.rotateX$1(h,h,e.degToRad(o._center.lat)),e.rotateZ$1(h,h,o.angle),e.rotateX$1(h,h,-o._pitch);const d=e.fromQuat(new Float32Array(16),h),f=e.mapValue(i.properties.get("star-intensity"),0,1,0,.25),p=5e-4,m=e.mapValue(i.properties.get("horizon-blend"),0,1,p,.25),g=e.globeUseCustomAntiAliasing(t,r,o)&&m===p?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,_=t.frameCounter/1e3%1,y=e.length(o.globeCenterInViewSpace),x=Math.sqrt(Math.pow(y,2)-Math.pow(g,2)),b=Math.acos(x/y),v=((t,i,r,n,o,a,s,l,A,c,u,h,d,f)=>({u_frustum_tl:t,u_frustum_tr:i,u_frustum_br:r,u_frustum_bl:n,u_horizon:o,u_transition:a,u_fadeout_range:s,u_color:l,u_high_color:A,u_space_color:c,u_star_intensity:u,u_star_size:5*e.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:h,u_horizon_angle:d,u_rotation_matrix:f}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,l,m,A,c,u,f,_,b,d);t.prepareDrawProgram(r,s);const w=t.atmosphereBuffer;w&&s.draw(r,n.TRIANGLES,a,e.StencilMode.disabled,e.ColorMode.alphaBlended,e.CullFaceMode.backCW,v,"skybox",w.vertexBuffer,w.indexBuffer,w.segments)}(this,this.style.fog),this.renderPass="sky",(e.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const e=this.style._layers[r[this.currentLayer]],i=t._getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?a[i.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;){const e=this.style._layers[r[this.currentLayer]],i=t._getLayerSourceCache(e);if(e.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const n=i?("symbol"===e.type?s:a)[i.id]:void 0;this._renderTileClippingMasks(e,i,i?o[i.id]:void 0),this.renderLayer(this,i,e,n),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let i=null;e.values(this.style._layers).forEach((e=>{const r=t._getLayerSourceCache(e);r&&!e.isHidden(this.transform.zoom)&&(!i||i.getSource().maxzoom<r.getSource().maxzoom)&&(i=r)})),i&&this.options.showTileBoundaries&&Lr.debug(this,i,i.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;Tr(e,e.transform.height-(t.top||0),3,gr),Tr(e,t.bottom||0,3,yr),Er(e,t.left||0,3,xr),Er(e,e.transform.width-(t.right||0),3,vr);const i=e.transform.centerPoint;!function(e,t,i,r){Mr(e,t-1,i-10,2,20,r),Mr(e,t-10,i-1,20,2,r)}(e,i.x,e.transform.height-i.y,wr)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(e.window.performance.now()),this.saveCanvasCopy())}}renderLayer(e,t,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(i.type)||Lr[i.type](e,t,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),i.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=e.createQueryEXT();this.deferredRenderGpuTimeQueries.push(t),e.beginQueryEXT(e.TIME_ELAPSED_EXT,t)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const i in e){const r=e[i],n=this.context.extTimerQuery,o=n.getQueryObjectEXT(r.query,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(r.query),t[i]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery;let i=0;for(const r of e)i+=t.getQueryObjectEXT(r,t.QUERY_RESULT_EXT)/1e6,t.deleteQueryEXT(r);return i}translatePosMatrix(t,i,r,n,o){if(!r[0]&&!r[1])return t;const a=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(a){const e=Math.sin(a),t=Math.cos(a);r=[r[0]*t-r[1]*e,r[0]*e+r[1]*t]}const s=[o?r[0]:B(i,r[0],this.transform.zoom),o?r[1]:B(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return e.translate(l,t,s),l}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),i=this.imageManager.getPattern(e.to.toString());return!t||!i}currentGlobalDefines(){const e=this.terrain&&this.terrain.renderingToTexture,t=this.style&&this.style.fog,i=[];return this.terrain&&!this.terrain.renderingToTexture&&i.push("TERRAIN"),t&&!e&&0!==t.getOpacity(this.transform.pitch)&&i.push("FOG"),e&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}useProgram(e,t,i){this.cache=this.cache||{};const r=i||[],n=this.currentGlobalDefines().concat(r),o=Si.cacheKey(e,n,t);return this.cache[o]||(this.cache[o]=new Si(this.context,e,li[e],t,or[e],n)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,i,r){if(this.terrain&&this.terrain.renderingToTexture)return;const n=this.style.fog;if(n){const o=n.getOpacity(this.transform.pitch),a=((t,i,r,n,o,a,s,l,A,c,u)=>{const h=t.transform,d=i.properties.get("color").toArray01();d[3]=n;const f=t.frameCounter/1e3%1;return{u_fog_matrix:r?h.calculateFogTileMatrix(r):t.identityMat,u_fog_range:i.getFovAdjustedRange(h._fov),u_fog_color:d,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_temporal_offset:f,u_frustum_tl:o,u_frustum_tr:a,u_frustum_br:s,u_frustum_bl:l,u_globe_pos:A,u_globe_radius:c,u_viewport:u,u_globe_transition:e.globeToMercatorTransition(h.zoom),u_is_globe:+("globe"===h.projection.name)}})(this,n,r,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.exported.devicePixelRatio,this.transform.height*e.exported.devicePixelRatio]);i.setFogUniformValues(t,a)}}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,i=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const n of r)i[n.key]=t[n.key]||new e.Tile(n,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}}class Fr{constructor(e=0,t=0,i=0,r=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=r}interpolate(t,i,r){return null!=i.top&&null!=t.top&&(this.top=e.number(t.top,i.top,r)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,i.bottom,r)),null!=i.left&&null!=t.left&&(this.left=e.number(t.left,i.left,r)),null!=i.right&&null!=t.right&&(this.right=e.number(t.right,i.right,r)),this}getCenter(t,i){const r=e.clamp((this.left+t-this.right)/2,0,t),n=e.clamp((this.top+i-this.bottom)/2,0,i);return new e.pointGeometry(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Fr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Or(t,i){const r=e.getColumn(t,3);e.fromQuat(t,i),e.setColumn(t,3,r)}function Ur(t,i){const r=e.identity$1([]);return e.rotateZ$1(r,r,-i),e.rotateX$1(r,r,-t),r}function Vr(t,i){const r=[t[0],t[1],0],n=[i[0],i[1],0];if(e.length(r)>=1e-15){const t=e.normalize([],r);e.scale$2(n,t,e.dot(n,t)),i[0]=n[0],i[1]=n[1]}const o=e.cross([],i,t);if(e.len(o)<1e-15)return null;const a=Math.atan2(-o[1],o[0]);return Ur(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),a)}class jr{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const i=t instanceof e.MercatorCoordinate?t:new e.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=e.wrap(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const r=this._elevation?this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(t)):0,n=this.position,o=e.MercatorCoordinate.fromLngLat(t,r),a=[o.x-n.x,o.y-n.y,o.z-n.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Vr(a,i)}setPitchBearing(t,i){this.orientation=Ur(e.degToRad(t),e.degToRad(-i))}}class Gr{constructor(t,i){this._transform=e.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new e.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=e.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&e.setColumn(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.identity$1([]),t&&Or(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Ur(e,t),Or(this._transform,this._orientation)}forward(){const t=e.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const r=new Float64Array(16);return e.invert(r,this.getWorldToCamera(t,i)),r}getWorldToCameraPosition(t,i,r){const n=this.position;e.scale$2(n,n,-t);const o=new Float64Array(16);return e.fromScaling(o,[r,r,r]),e.translate(o,o,n),o[10]*=i,o}getWorldToCamera(t,i){const r=new Float64Array(16),n=new Float64Array(4),o=this.position;return e.conjugate(n,this._orientation),e.scale$2(o,o,-t),e.fromQuat(r,n),e.translate(r,r,o),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(t,i,r,n){const o=new Float64Array(16);return e.perspective(o,t,i,r,n),o}getDistanceToElevation(t){const i=0===t?0:e.mercatorZfromAltitude(t,this.position[1]),r=this.forward();return(i-this.position[2])/r[2]}clone(){return new Gr([...this.position],[...this.orientation])}}function Nr(t,i){const r=qr(t.projection,t.zoom,t.width,t.height),n=function(t,i,r,n,o){const a=new e.LngLat(r.lng-180*$r,r.lat),s=new e.LngLat(r.lng+180*$r,r.lat),l=t.project(a.lng,a.lat),A=t.project(s.lng,s.lat),c=-Math.atan2(A.y-l.y,A.x-l.x),u=e.MercatorCoordinate.fromLngLat(r);u.y=e.clamp(u.y,-.999975,.999975);const h=u.toLngLat(),d=t.project(h.lng,h.lat),f=e.MercatorCoordinate.fromLngLat(h);f.x+=$r;const p=f.toLngLat(),m=t.project(p.lng,p.lat),g=Hr(m.x-d.x,m.y-d.y,c),_=e.MercatorCoordinate.fromLngLat(h);_.y+=$r;const y=_.toLngLat(),x=t.project(y.lng,y.lat),b=Hr(x.x-d.x,x.y-d.y,c),v=Math.abs(g.x)/Math.abs(b.y),w=e.identity([]);e.rotateZ(w,w,-c*(1-(o?0:n)));const T=e.identity([]);return e.scale(T,T,[1,1-(1-v)*n,1]),T[4]=-b.x/b.y*n,e.rotateZ(T,T,c),e.multiply(T,w,T),T}(t.projection,0,t.center,r,i),o=Zr(t);return e.scale(n,n,[o,o,1]),n}function Zr(t){const i=t.projection,r=qr(t.projection,t.zoom,t.width,t.height),n=Qr(i,t.center),o=Qr(i,e.LngLat.convert(i.center));return Math.pow(2,n*r+(1-r)*o)}function qr(t,i,r,n,o=1/0){const a=t.range;if(!a)return 0;const s=Math.min(o,Math.max(r,n)),l=Math.log(s/1024)/Math.LN2;return e.smoothstep(a[0]+l,a[1]+l,i)}const $r=1/4e4;function Qr(t,i){const r=e.clamp(i.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),n=new e.LngLat(i.lng-180*$r,r),o=new e.LngLat(i.lng+180*$r,r),a=t.project(n.lng,r),s=t.project(o.lng,r),l=e.MercatorCoordinate.fromLngLat(n),A=e.MercatorCoordinate.fromLngLat(o),c=s.x-a.x,u=s.y-a.y,h=A.x-l.x,d=A.y-l.y,f=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(f)/Math.LN2}function Hr(e,t,i){const r=Math.cos(i),n=Math.sin(i);return{x:e*r-t*n,y:e*n+t*r}}class Wr{constructor(t,i,r,n,o,a,s){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setProjection(a),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Fr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Gr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const e=new Wr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(e){const t=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||t)&&this._updateCameraOnTerrain(),(e||t)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return e.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=e.getProjection(this.projectionOptions);const n=!t(r,this.getProjection());return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.pointGeometry(this.width,this.height)}get bearing(){return e.wrap(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;var r;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=(r=new e.ARRAY_TYPE(4),e.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r),function(e,t,i){var r=t[0],n=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=r*l+o*s,e[1]=n*l+a*s,e[2]=r*-s+o*l,e[3]=n*-s+a*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const e=this._elevation;this._centerAltitude=e.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=e.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,o=0;for(let a=0;a<i.length;a++){const s=new e.pointGeometry(i[a][0]*this.width,r+i[a][1]*(this.height-r)),l=t.pointCoordinate(s);if(!l)continue;const A=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);n+=l[3]*A,o+=A}return 0===o?NaN:n/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*t,r=this._mercatorZfromZoom(e),n=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-i,n);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let r;r=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const n=e.length(e.sub([],this._camera.position,r));return e.clamp(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const r=[t.position.x,t.position.y,t.position.z];e.exactEquals$1(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new jr;return i.position=new e.MercatorCoordinate(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!e.length$1(t))return!1;e.normalize$1(t,t);const i=e.transformQuat([],[0,0,-1],t),r=e.transformQuat([],[0,-1,0],t);if(r[2]<0)return!1;const n=Vr(i,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;t[2]=e.clamp(t[2],n/r,n/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const r=this.pointCoordinate(new e.pointGeometry(0,0)),n=this.pointCoordinate(new e.pointGeometry(this.width,0)),o=this.pointCoordinate(new e.pointGeometry(this.width,this.height)),a=this.pointCoordinate(new e.pointGeometry(0,this.height)),s=Math.floor(Math.min(r.x,n.x,o.x,a.x)),l=Math.floor(Math.max(r.x,n.x,o.x,a.x)),A=1;for(let r=s-A;r<=l+A;r++)0!==r&&i.push(new e.UnwrappedTileID(r,t))}return i}coveringTiles(t){let i=this.coveringZoomLevel(t);const r=i,n=this.elevation&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const a=this.locationCoordinate(this.center),s=this.center.lat,l=1<<i,A=[l*a.x,l*a.y,0],c="globe"===this.projection.name,u=!c,h=e.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,u),d=c?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*e.mercatorZfromAltitude(1,this.center.lat),p=this._camera.position[2]/e.mercatorZfromAltitude(1,this.center.lat),m=[l*d.x,l*d.y,p*(u?1:f)],g=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),_=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?i:0,y=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,x=t.isTerrainDEM?-y:this._elevation?this._elevation.getMinElevationBelowMSL():0,b=this.projection.isReprojectedInTileSpace?Zr(this):1,v=t=>{const i=1/4e4,r=new e.MercatorCoordinate(t.x+i,t.y,t.z),n=new e.MercatorCoordinate(t.x,t.y+i,t.z),o=t.toLngLat(),a=r.toLngLat(),s=n.toLngLat(),l=this.locationCoordinate(o),A=this.locationCoordinate(a),c=this.locationCoordinate(s),u=Math.hypot(A.x-l.x,A.y-l.y),h=Math.hypot(c.x-l.x,c.y-l.y);return Math.sqrt(u*h)*b/i},w=t=>{const i=y,r=x;return{aabb:e.tileAABB(this,l,0,0,0,t,r,i,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:i,wrap:t,fullyVisible:!1}},T=[];let E=[];const M=i,C=t.reparseOverscaled?r:i,I=e=>e*e,S=I((p-this._centerAltitude)*f),k=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=z(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},z=t=>{if(t.zoom<_)return!0;if(t.zoom===M)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const i=t.aabb.distanceX(m),o=t.aabb.distanceY(m);let a=S,l=1;if(c){a=I(t.aabb.distanceZ(m));const i=Math.pow(2,t.zoom),r=e.latFromMercatorY((t.y+1)/i),n=e.latFromMercatorY(t.y/i),o=Math.min(Math.max(s,r),n),A=e.circumferenceAtLatitude(o)/e.circumferenceAtLatitude(s);if(l=o===s?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,A/this._mercatorScaleRatio),this.zoom<=e.GLOBE_ZOOM_THRESHOLD_MIN&&t.zoom===M-1&&A>=.9)return!0}else if(n&&(a=I(t.aabb.distanceZ(m)*f)),this.projection.isReprojectedInTileSpace&&r<=5){const i=Math.pow(2,t.zoom),r=v(new e.MercatorCoordinate((t.x+.5)/i,(t.y+.5)/i));l=r>.85?1:r}const A=i*i+o*o+a;return A<I((1<<M-t.zoom)*g*l*((e,t)=>{if(t*I(.707)<e)return 1;const i=Math.sqrt(t/e);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(a,S),A))};if(this.renderWorldCopies)for(let e=1;e<=3;e++)T.push(w(-e)),T.push(w(e));for(T.push(w(0));T.length>0;){const r=T.pop(),a=r.x,s=r.y;let u=r.fullyVisible;if(!u){const e=r.aabb.intersects(h);if(0===e)continue;u=2===e}if(r.zoom!==M&&z(r))for(let t=0;t<4;t++){const i=(a<<1)+t%2,A=(s<<1)+(t>>1),h={aabb:o?r.aabb.quadrant(t):e.tileAABB(this,l,r.zoom+1,i,A,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:i,y:A,wrap:r.wrap,fullyVisible:u,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};n&&!c&&(h.tileID=new e.OverscaledTileID(r.zoom+1===M?C:r.zoom+1,r.wrap,r.zoom+1,i,A),k(h)),T.push(h)}else{const n=r.zoom===M?C:r.zoom;if(t.minzoom&&t.minzoom>n)continue;const o=A[0]-(.5+a+(r.wrap<<r.zoom))*(1<<i-r.zoom),l=A[1]-.5-s,c=r.tileID?r.tileID:new e.OverscaledTileID(n,r.wrap,r.zoom,a,s);E.push({tileID:c,distanceSq:o*o+l*l})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,r=this.horizonLineFromTop();E=E.filter((n=>{const o=[0,0,0,1],a=[e.EXTENT,e.EXTENT,0,1],s=this.calculateFogTileMatrix(n.tileID.toUnwrapped());e.transformMat4$1(o,o,s),e.transformMat4$1(a,a,s);const l=e.getAABBPointSquareDist(o,a);if(0===l)return!0;let A=!1;const c=this._elevation;if(c&&l>i&&0!==r){const i=this.calculateProjMatrix(n.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=c.getMinMaxForTile(n.tileID)),o||(o={min:x,max:y});const a=e.furthestTileCorner(this.rotation),s=[a[0]*e.EXTENT,a[1]*e.EXTENT,o.max];e.transformMat4(s,s,i),A=(1-s[1])*this.height*.5<r}return l<i||A}))}return E.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.clamp(t.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),r=this.projection.project(t.lng,i);return new e.pointGeometry(r.x*this.worldSize,r.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,i){let r,n;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;r=(i.x-o.x)/e,n=(i.y-o.y)/e}else{const e=this.pointCoordinate(i),t=this.pointCoordinate(o);r=e.x-t.x,n=e.y-t.y}const a=this.locationCoordinate(t);this.setLocation(new e.MercatorCoordinate(a.x-r,a.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,i){const r=i?e.mercatorZfromAltitude(i,t.lat):void 0,n=this.projection.project(t.lng,t.lat);return new e.MercatorCoordinate(n.x,n.y,r)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,i){const r=null!=i?i:this._centerAltitude,n=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.transformMat4$1(n,n,this.pixelMatrixInverse),e.transformMat4$1(o,o,this.pixelMatrixInverse);const a=o[3];e.scale$1(n,n,1/n[3]),e.scale$1(o,o,1/a);const s=n[2],l=o[2];return{p0:n,p1:o,t:s===l?0:(r-s)/(l-s)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],r=[t.x,t.y,1,1];return e.transformMat4$1(i,i,this.pixelMatrixInverse),e.transformMat4$1(r,r,this.pixelMatrixInverse),e.scale$1(i,i,1/i[3]),e.scale$1(r,r,1/r[3]),i[2]=e.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,r[2]=e.mercatorZfromAltitude(r[2],this._center.lat)*this.worldSize,e.scale$1(i,i,1/this.worldSize),e.scale$1(r,r,1/this.worldSize),new e.Ray([i[0],i[1],i[2]],e.normalize([],e.sub([],r,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:r,t:n}=t,o=e.mercatorZfromAltitude(i[2],this._center.lat),a=e.mercatorZfromAltitude(r[2],this._center.lat);return new e.MercatorCoordinate(e.number(i[0],r[0],n)/this.worldSize,e.number(i[1],r[1],n)/this.worldSize,e.number(o,a,n))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new e.MercatorCoordinate(i[0],i[1],i[2]);let r=0,n=this.horizonLineFromTop();if(t.y>n)return this.pointCoordinate(t);const o=.02*n,a=t.clone();for(let t=0;t<10&&n-r>o;t++){a.y=e.number(r,n,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(n=a.y,i=t):r=a.y}return i?new e.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}_coordinatePoint(t,i){const r=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,n=[t.x*this.worldSize,t.y*this.worldSize,r+t.toAltitude(),1];return e.transformMat4$1(n,n,this.pixelMatrix),n[3]>0?new e.pointGeometry(n[0]/n[3],n[1]/n[3]):new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,i){const r=new e.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),n=new e.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),o=new e.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),a=new e.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let s=this.pointCoordinate(r,t),l=this.pointCoordinate(n,t);const A=this.pointCoordinate(o,i),c=this.pointCoordinate(a,i),u=(e,t)=>(t.y-e.y)/(t.x-e.x);return s.y>1&&l.y>=0?s=new e.MercatorCoordinate((1-c.y)/u(c,s)+c.x,1):s.y<0&&l.y<=1&&(s=new e.MercatorCoordinate(-c.y/u(c,s)+c.x,0)),l.y>1&&s.y>=0?l=new e.MercatorCoordinate((1-A.y)/u(A,l)+A.x,1):l.y<0&&s.y<=1&&(l=new e.MercatorCoordinate(-A.y/u(A,l)+A.x,0)),(new e.LngLatBounds).extend(this.coordinateLocation(s)).extend(this.coordinateLocation(l)).extend(this.coordinateLocation(c)).extend(this.coordinateLocation(A))}_getBounds3D(){const e=this.elevation;if(!e.visibleDemTiles.length)return this._getBounds(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBounds(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.MAX_MERCATOR_LATITUDE,this.maxLat=e.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=e.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=e.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=e.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const i=t.key,r=this._distanceTileDataCache;if(r[i])return r[i];const n=t.canonical,o=1/this.height,a=this.cameraWorldSize/this.zoomScale(n.z),s=(n.x+Math.pow(2,n.z)*t.wrap)*a,l=n.y*a,A=this.point,c=this.angle,u=Math.sin(-c),h=-Math.cos(-c);return r[i]={bearing:[u,h],center:[(A.x-s)*o,(A.y-l)*o],scale:a/e.EXTENT*o},r[i]}calculateFogTileMatrix(t){const i=t.key,r=this._fogTileMatrixCache;if(r[i])return r[i];const n=this.projection.createTileMatrix(this,this.cameraWorldSize,t);return e.multiply(n,this.worldToFogMatrix,n),r[i]=new Float32Array(n),r[i]}calculateProjMatrix(t,i=!1){const r=t.key,n=i?this._alignedProjMatrixCache:this._projMatrixCache;if(n[r])return n[r];const o=this.calculatePosMatrix(t,this.worldSize);return e.multiply(o,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.alignedProjMatrix:this.projMatrix,o),n[r]=new Float32Array(o),n[r]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,r=this._pixelsToTileUnitsCache;if(r[i])return r[i];const n=function(t,i){const{scale:r}=t.tileTransform,n=r*e.EXTENT/(t.tileSize*Math.pow(2,i.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o=new Float32Array(4),l=(a=i.inverseAdjustmentMatrix)[1],A=a[2],c=a[3],h=(s=[n,n])[1],o[0]=a[0]*(u=s[0]),o[1]=l*u,o[2]=A*h,o[3]=c*h,o;var o,a,s,l,A,c,u,h}(t,this);return r[i]=n,r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const i=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=this._camera.forward(),o=e.mercatorZfromAltitude(1,this._center.lat);r[2]/=o,n[2]/=o,e.normalize(n,n);const a=t.raycast(r,n,t.exaggeration());if(a){const t=e.scaleAndAdd([],r,n,a),i=new e.MercatorCoordinate(t[0],t[1],e.mercatorZfromAltitude(t[2],e.latFromMercatorY(t[1]))),s=(i.z+e.length([i.x-r[0],i.y-r[1],i.z-r[2]*o]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const i=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=t.getAtPointOrZero(new e.MercatorCoordinate(...r)),o=this._minimumHeightOverTerrain()*Math.cos(e.degToRad(this._maxPitch)),a=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*n;if(a<o){const t=this.locationCoordinate(this._center,this._centerAltitude),i=[t.x-r[0],t.y-r[1],t.z-r[2]],n=e.length(i);i[2]-=(o-a)/this._projectionScaler;const s=e.length(i);if(0===s)return;e.scale$2(i,i,n/s*this._projectionScaler),this._camera.position=[t.x-i[0],t.y-i[1],t.z*this._projectionScaler-i[2]],this._camera.orientation=Vr(i,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const t=this.center;return t.lat=e.clamp(t.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(t.lng=e.clamp(t.lng,this.minLng,this.maxLng)),this.center=t,void(this._constraining=!1)}const t=this._unmodified,{x:i,y:r}=this.point;let n=0,o=i,a=r;const s=this.width/2,l=this.height/2,A=this.worldMinY*this.scale,c=this.worldMaxY*this.scale;if(r-l<A&&(a=A+l),r+l>c&&(a=c-l),c-A<this.height&&(n=Math.max(n,this.height/(c-A)),a=(c+A)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,r=this.worldSize/2-(e+t)/2;o=(i+r+this.worldSize)%this.worldSize-r,o-s<e&&(o=e+s),o+s>t&&(o=t-s),t-e<this.width&&(n=Math.max(n,this.width/(t-e)),o=(t+e)/2)}o===i&&a===r||(this.center=this.unproject(new e.pointGeometry(o,a))),n&&(this.zoom+=this.scaleZoom(n)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.pixelsPerMeter;if("globe"===this.projection.name){const t=e.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,i=e.mercatorZfromAltitude(1,e.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=t/i}const r=qr(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const n=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?i:1),o=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);o[8]=2*-t.x/this.width,o[9]=2*t.y/this.height;let a=e.mul([],o,n);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),i=e.identity([]);e.translate(i,i,[t.x*this.worldSize,t.y*this.worldSize,0]),e.multiply(i,i,Nr(this)),e.translate(i,i,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.multiply(a,a,i),this.inverseAdjustmentMatrix=function(e){const t=Nr(e,!0);return _([],[t[0],t[1],t[4],t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=e.scale([],a,[this.worldSize,this.worldSize,this.worldSize/i,1]),this.projMatrix=a,this.invProjMatrix=e.invert(new Float64Array(16),this.projMatrix);const s=e.invert([],o);this.frustumCorners=e.FrustumCorners.fromInvProjectionMatrix(s,this.horizonLineFromTop(),this.height);const l=new Float32Array(16);e.identity(l),e.scale(l,l,[1,-1,1]),e.rotateX(l,l,this._pitch),e.rotateZ(l,l,this.angle);const A=e.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),c=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;A[8]=2*-t.x/this.width,A[9]=2*(t.y+c)/this.height,this.skyboxMatrix=e.multiply(l,A,l);const u=this.point,h=u.x,d=u.y,f=this.width%2/2,p=this.height%2/2,m=Math.cos(this.angle),g=Math.sin(this.angle),y=h-Math.round(h)+m*f+g*p,x=d-Math.round(d)+m*p+g*f,b=new Float64Array(a);if(e.translate(b,b,[y>.5?y-1:y,x>.5?x-1:x,0]),this.alignedProjMatrix=b,a=e.create(),e.scale(a,a,[this.width/2,-this.height/2,1]),e.translate(a,a,[1,-1,0]),this.labelPlaneMatrix=a,a=e.create(),e.scale(a,a,[1,-1,1]),e.translate(a,a,[-1,-1,0]),e.scale(a,a,[2/this.width,2/this.height,1]),this.glCoordMatrix=a,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},a=e.invert(new Float64Array(16),this.pixelMatrix),!a)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=a,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.calculateGlobeMatrix(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.transformMat4(t,t,n),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=a;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,i=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._projectionScaler,o=[t,t,i];e.scale$2(o,o,n),e.scale$2(r,r,-1),e.multiply$2(r,r,o);const a=e.create();e.translate(a,a,r),e.scale(a,a,o),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,n)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),r=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-i[0]*n,r.y/this.worldSize-i[1]*n,e/this.worldSize*this._centerAltitude-i[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=t[2];let n=1;r>0&&(n=Math.min((i-this._camera.position[2])/r,1)),this._camera.position=e.scaleAndAdd([],this._camera.position,t,n),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),o=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.degToRad(this._maxPitch)),s=Math.max((t[2]-o)/Math.cos(r),a),l=this._zoomFromMercatorZ(s);e.scaleAndAdd(t,t,i,s),this._pitch=e.clamp(r,e.degToRad(this.minPitch),e.degToRad(this.maxPitch)),this.angle=e.wrap(n,-Math.PI,Math.PI),this._setZoom(e.clamp(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const r=Math.min(t.x,i.x),n=Math.max(t.x,i.x),o=Math.min(t.y,i.y),a=Math.max(t.y,i.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new e.pointGeometry(r,o),new e.pointGeometry(n,a),new e.pointGeometry(r,a),new e.pointGeometry(n,o)],l=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(const e of s){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>A||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.pointGeometry(0,0),new e.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,i){const r=e.length(e.sub([],this._camera.position,t)),n=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,i){const r=[t[0],t[1],t[2],1];e.transformMat4$1(r,r,i);const n=Math.max(r[3],1e-6);return[r[0]/n,r[1]/n,r[2]/n,n]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.pointGeometry(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.pointGeometry(0,t))}}getCameraToCenterDistance(e){const t=qr(e,this.zoom,this.width,this.height,1024),i=e.pixelSpaceConversion(this.center.lat,this.worldSize,t);return.5/Math.tan(.5*this._fov)*this.height*i}}function Xr(e,t){let i=!1,r=null;const n=()=>{r=null,i&&(e(),r=setTimeout(n,t),i=!1)};return()=>(i=!0,r||n(),r)}class Yr{constructor(t){this._hashName=t&&encodeURIComponent(t),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xr(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),e.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const i=this._map;if(!i)return"";const r=i.getCenter(),n=Math.round(100*i.getZoom())/100,o=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,o),s=Math.round(r.lng*a)/a,l=Math.round(r.lat*a)/a,A=i.getBearing(),c=i.getPitch();let u="";if(u+=t?`/${s}/${l}/${n}`:`${n}/${l}/${s}`,(A||c)&&(u+="/"+Math.round(10*A)/10),c&&(u+=`/${Math.round(c)}`),this._hashName){const t=this._hashName;let i=!1;const r=e.window.location.hash.slice(1).split("&").map((e=>{const r=e.split("=")[0];return r===t?(i=!0,`${r}=${u}`):e})).filter((e=>e));return i||r.push(`${t}=${u}`),`#${r.join("&")}`}return`#${u}`}_getCurrentHash(){const t=e.window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((e=>e.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:i,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());e.window.history.replaceState(e.window.history.state,null,t)}}const Kr={linearity:.3,easing:e.bezier(0,0,.3,1)},Jr=e.extend({deceleration:2500,maxSpeed:1400},Kr),en=e.extend({deceleration:20,maxSpeed:1400},Kr),tn=e.extend({deceleration:1e3,maxSpeed:360},Kr),rn=e.extend({deceleration:1e3,maxSpeed:90},Kr);class tr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.exported.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const o=on(i.pan.mag(),r,e.extend({},Jr,t||{}));n.offset=i.pan.mult(o.amount/i.pan.mag()),n.center=this._map.transform.center,nn(n,o)}if(i.zoom){const e=on(i.zoom,r,en);n.zoom=this._map.transform.zoom+e.amount,nn(n,e)}if(i.bearing){const t=on(i.bearing,r,tn);n.bearing=this._map.transform.bearing+e.clamp(t.amount,-179,179),nn(n,t)}if(i.pitch){const e=on(i.pitch,r,rn);n.pitch=this._map.transform.pitch+e.amount,nn(n,e)}if(n.zoom||n.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function nn(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function on(t,i,r){const{maxSpeed:n,linearity:o,deceleration:a}=r,s=e.clamp(t*o/(i/1e3),-n,n),l=Math.abs(s)/(a*o);return{easing:r.easing,duration:1e3*l,amount:s*(l/2)}}class an extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r,n={}){const o=f(i.getCanvasContainer(),r),a=i.unproject(o);super(t,e.extend({point:o,lngLat:a,originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class sn extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){const n="touchend"===t?r.changedTouches:r.touches,o=p(i.getCanvasContainer(),n),a=o.map((e=>i.unproject(e))),s=o.reduce(((e,t,i,r)=>e.add(t.div(r.length))),new e.pointGeometry(0,0));super(t,{points:o,point:s,lngLats:a,lngLat:i.unproject(s),originalEvent:r}),this._defaultPrevented=!1}}class ln extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class An{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new ln(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new an(e.type,this._map,e))}mouseup(e){this._map.fire(new an(e.type,this._map,e))}preclick(t){const i=e.extend({},t);i.type="preclick",this._map.fire(new an(i.type,this._map,i))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new an(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new an(e.type,this._map,e))}mouseover(e){this._map.fire(new an(e.type,this._map,e))}mouseout(e){this._map.fire(new an(e.type,this._map,e))}touchstart(e){return this._firePreventable(new sn(e.type,this._map,e))}touchmove(e){this._map.fire(new sn(e.type,this._map,e))}touchend(e){this._map.fire(new sn(e.type,this._map,e))}touchcancel(e){this._map.fire(new sn(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cn{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new an(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new an("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new an(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class un{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(c(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const r=this._startPos;this._lastPos=i,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const n=Math.min(r.x,i.x),a=Math.max(r.x,i.x),s=Math.min(r.y,i.y),l=Math.max(r.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${n}px,${s}px)`,this._box.style.width=a-n+"px",this._box.style.height=l-s+"px")}))}mouseupWindow(t,i){if(!this._active)return;if(0!==t.button)return;const r=this._startPos,n=i;if(this.reset(),d(),r.x!==n.x||r.y!==n.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),u(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))}}function hr(e,t){const i={};for(let r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}class hn{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){const i=new e.pointGeometry(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=hr(r,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const r=hr(i,t);for(const e in this.touches){const t=this.touches[e],i=r[e];(!i||i.dist(t)>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class pn{constructor(e){this.singleTap=new hn(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const r=this.singleTap.touchend(e,t,i);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class dn{constructor(){this._zoomIn=new pn({numTouches:1,numTaps:2}),this._zoomOut=new pn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const r=this._zoomIn.touchend(e,t,i),n=this._zoomOut.touchend(e,t,i);return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(r)},{originalEvent:e})}):n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(n)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fn={0:1,2:2};class mn{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const i=m(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i)}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const i=fn[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&m(e)===this._eventButton&&(this._moved&&d(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _n extends mn{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class gn extends mn{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class yn extends mn{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class xn{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.pointGeometry(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(e,t,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.preventDefault(),this._calculateTransform(e,t,i)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,r){r.length>0&&(this._active=!0);const n=hr(r,i),o=new e.pointGeometry(0,0),a=new e.pointGeometry(0,0);let s=0;for(const e in n){const t=n[e],i=this._touches[e];i&&(o._add(t),a._add(t.sub(i)),s++,n[e]=t)}if(this._touches=n,s<this._minTouches||!a.mag())return;const l=a.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(s),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")}),500)}}class vn{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){const r=this._firstTwoTouches;if(!r)return;e.preventDefault();const[n,o]=r,a=br(i,t,n),s=br(i,t,o);if(!a||!s)return;const l=this._aroundCenter?null:a.add(s).div(2);return this._move([a,s],l,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,o=br(i,t,r),a=br(i,t,n);o&&a||(this._active&&d(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function br(e,t,i){for(let r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function bn(e,t){return Math.log(e/t)/Math.LN2}class wn extends vn{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(bn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bn(this._distance,i),pinchAround:t}}}function Tn(e,t){return 180*e.angleWith(t)/Math.PI}class En extends vn{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Tn(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=Tn(e,this._startVector);return Math.abs(i)<t}}function Mn(e){return Math.abs(e.y)>Math.abs(e.x)}class Cn extends vn{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Mn(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,i){const r=this._lastPoints;if(!r)return;const n=e[0].sub(r[0]),o=e[1].sub(r[1]);return this._map._cooperativeGestures&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(n,o,i.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(n.y+o.y)/2*-.5})}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,n=t.mag()>=2;if(!r&&!n)return;if(!r||!n)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return Mn(e)&&Mn(t)&&o}}const In={panStep:100,bearingStep:15,pitchStep:10};class Sn{constructor(){const e=In;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,r=0,n=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),n=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),n=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:a=>{const s=a.getZoom();a.easeTo({duration:300,easeId:"keyboardHandler",easing:kn,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:a.getBearing()+i*this._bearingStep,pitch:a.getPitch()+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:a.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kn(e){return e*(2-e)}const zn=4.000244140625;class Dn{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,e.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=e.exported.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%zn==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=f(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform,i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>zn?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);const n=i(),o=Math.pow(2,n),a="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(a*r))),"wheel"===this._type&&(this._startZoom=i(),this._easing=this._smoothOutEasing(200)),this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:i(),n=this._startZoom,o=this._easing;let a,s=!1;if("wheel"===this._type&&n&&o){const t=Math.min((e.exported.now()-this._lastWheelEventTime)/200,1),i=o(t);a=e.number(n,r,i),t<1?this._frameId||(this._frameId=!0):s=!0}else a=r,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!s,zoomDelta:a-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.ease;if(this._prevEase){const t=this._prevEase,r=(e.exported.now()-t.start)/t.duration,n=t.easing(r+.01)-t.easing(r),o=.27/Math.sqrt(n*n+1e-4)*.01,a=Math.sqrt(.0729-o*o);i=e.bezier(o,a,.25,1)}return this._prevEase={start:e.exported.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(e.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!e.window.document.fullscreenElement||!!e.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")}),200)}}class Bn{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Pn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ln{constructor(){this._tap=new pn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=t[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rn{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fn{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class On{constructor(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Un=e=>e.zoom||e.drag||e.pitch||e.rotate;class Vn extends e.Event{}class jn{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const r=e.sub([],i,t);this.radius=e.length(r[2]<0?e.div([],r,this.constants):[r[0],r[1],0])}projectRay(t){e.div(t,t,this.constants),e.normalize(t,t),e.mul$1(t,t,this.constants);const i=e.scale$2([],t,this.radius);if(i[2]>0){const t=e.scale$2([],[0,0,1],e.dot(i,[0,0,1])),r=e.scale$2([],e.normalize([],[i[0],i[1],0]),this.radius),n=e.add([],i,e.scale$2([],e.sub([],e.add([],r,t),i),2));i[0]=n[0],i[1]=n[1]}return i}}function Gn(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Nn{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tr(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new jn,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.bindAll(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[e.window,"blur",void 0]];for(const[t,i,r]of this._listeners)t.addEventListener(i,t===e.window.document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(const[t,i,r]of this._listeners)t.removeEventListener(i,t===e.window.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new An(t,e));const r=t.boxZoom=new un(t,e);this._add("boxZoom",r);const n=new dn,o=new Pn;t.doubleClickZoom=new Bn(o,n),this._add("tapZoom",n),this._add("clickZoom",o);const a=new Ln;this._add("tapDragZoom",a);const s=t.touchPitch=new Cn(t);this._add("touchPitch",s);const l=new gn(e),A=new yn(e);t.dragRotate=new Fn(e,l,A),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]);const c=new _n(e),u=new xn(t,e);t.dragPan=new Rn(i,c,u),this._add("mousePan",c),this._add("touchPan",u,["touchZoom","touchRotate"]);const h=new En,d=new wn;t.touchZoomRotate=new On(i,d,h,a),this._add("touchRotate",h,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]),this._add("blockableMapEvent",new cn(t));const f=t.scrollZoom=new Dn(t,this);this._add("scrollZoom",f,["mousePan"]);const p=t.keyboard=new Sn;this._add("keyboard",p);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Un(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,t,i){for(const r in e)if(r!==i&&(!t||t.indexOf(r)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){this._updatingCamera=!0;const i="renderFrame"===e.type,r=i?void 0:e,n={needsRenderFrame:!1},o={},a={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?p(this._el,s):i?void 0:f(this._el,e);for(const{handlerName:i,handler:A,allowed:c}of this._handlers){if(!A.isEnabled())continue;let u;this._blockedByActive(a,c,i)?A.reset():A[t||e.type]&&(u=A[t||e.type](e,l,s),this.mergeHandlerResult(n,o,u,i,r),u&&u.needsRenderFrame&&this._triggerRenderFrame()),(u||A.isActive())&&(a[i]=A)}const A={};for(const e in this._previousActiveHandlers)a[e]||(A[e]=r);this._previousActiveHandlers=a,(Object.keys(A).length||Gn(n))&&(this._changes.push([n,o,A]),this._triggerRenderFrame()),(Object.keys(a).length||Gn(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=n;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))}mergeHandlerResult(t,i,r,n,o){if(!r)return;e.extend(t,r);const a={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=a),void 0!==r.panDelta&&(i.drag=a),void 0!==r.pitchDelta&&(i.pitch=a),void 0!==r.bearingDelta&&(i.rotate=a)}_applyChanges(){const t={},i={},r={};for(const[n,o,a]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new e.pointGeometry(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(t.around=n.around),void 0!==n.aroundCoord&&(t.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),e.extend(i,o),e.extend(r,a);this._updateMapTransform(t,i,r),this._changes=[]}_updateMapTransform(t,i,r){const n=this._map,o=n.transform,a=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Gn(t)){const e=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",e!==o.zoom&&this._map._update(!0)}if(!Gn(t))return void this._fireEvents(i,r,!0);let{panDelta:s,zoomDelta:l,bearingDelta:A,pitchDelta:c,around:u,aroundCoord:h,pinchAround:d}=t;void 0!==d&&(u=d),(e=>i.drag&&!this._eventsInProgress.drag)()&&u&&(this._dragOrigin=a(o.pointCoordinate3D(u)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",n._stop(!0),u=u||n.transform.centerPoint,A&&(o.bearing+=A),c&&(o.pitch+=c),o._updateCameraState();const f=[0,0,0];if(s){const t=o.pointCoordinate(u);if("globe"===o.projection.name){const i=e.latFromMercatorY(t.y),r=o.center.lat,n=Math.min(e.mercatorZfromAltitude(1,i)/e.mercatorZfromAltitude(1,r),2);s=s.rotate(-o.angle),f[0]=-s.x/o.worldSize*n,f[1]=-s.y/o.worldSize*n}else{const e=o.pointCoordinate(u.sub(s));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const p=o.zoom,m=[0,0,0];if(l){const t=a(h||o.pointCoordinate3D(u)),i={dir:e.normalize([],e.sub([],t,o._camera.position))};if(i.dir[2]<0){const r=o.zoomDeltaToMovement(t,l);e.scale$2(m,i.dir,r)}}const g=e.add(f,f,m);o._translateCameraConstrained(g),l&&Math.abs(o.zoom-p)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,r,!0)}_fireEvents(t,i,r){const n=Un(this._eventsInProgress),o=Un(t),a={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(a[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in a)this._fireEvent(e,a[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const s={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||r,s[`${e}end`]=l)}for(const e in s)this._fireEvent(e,s[e]);const A=Un(this._eventsInProgress);if(r&&(n||o)&&!A){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.Event("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.Event(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new Vn("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Zn="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qn extends e.Evented{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,e.bindAll(["_renderFrameCallback"],this)}getCenter(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,r){return t=e.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),r)}panTo(t,i,r){return this.easeTo(e.extend({center:t},i),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,r){return this.easeTo(e.extend({zoom:t},i),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,r){return this.easeTo(e.extend({bearing:t},i),r)}resetNorth(t,i){return this.rotateTo(0,e.extend({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){"globe"===this.transform.projection.name&&e.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),t=e.LngLatBounds.convert(t);const r=i&&i.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),r,i)}_extendCameraOptions(t){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.extend(i,t.padding),t}_cameraForBoxAndBearing(t,i,r,n){const o=this._extendCameraOptions(n),a=this.transform,s=a.padding,l=a.project(e.LngLat.convert(t)),A=a.project(e.LngLat.convert(i)),c=new e.pointGeometry(l.x,A.y),u=new e.pointGeometry(A.x,l.y),h=-e.degToRad(r),d=l.rotate(h),f=A.rotate(h),p=c.rotate(h),m=u.rotate(h),g=new e.pointGeometry(Math.max(d.x,f.x,p.x,m.x),Math.max(d.y,f.y,p.y,m.y)),_=new e.pointGeometry(Math.min(d.x,f.x,p.x,m.x),Math.min(d.y,f.y,p.y,m.y)),y=g.sub(_),x=(a.width-((s.left||0)+(s.right||0)+o.padding.left+o.padding.right))/y.x,b=(a.height-((s.top||0)+(s.bottom||0)+o.padding.top+o.padding.bottom))/y.y;if(b<0||x<0)return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const v=Math.min(a.scaleZoom(a.scale*Math.min(x,b)),o.maxZoom),w="number"==typeof o.offset.x&&"number"==typeof o.offset.y?new e.pointGeometry(o.offset.x,o.offset.y):e.pointGeometry.convert(o.offset),T=new e.pointGeometry((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(r*Math.PI/180),E=w.add(T).mult(a.scale/a.zoomScale(v));return{center:a.unproject(l.add(A).div(2).sub(E)),zoom:v,bearing:r}}_cameraForBox(t,i,r,n,o){const a=this._extendCameraOptions(o);r=r||0,n=n||0,t=e.LngLat.convert(t),i=e.LngLat.convert(i);const s=this.transform.clone();s.padding=a.padding;const l=this.getFreeCameraOptions(),A=new e.LngLat(.5*(t.lng+i.lng),.5*(t.lat+i.lat)),c=.5*(r+n);if(s._camera.position[2]<e.mercatorZfromAltitude(c,A.lat))return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(A),s.setFreeCameraOptions(l);const u=e.MercatorCoordinate.fromLngLat(t),h=e.MercatorCoordinate.fromLngLat(i),d=s.pointRayIntersection(s.centerPoint,c),f=[(p=s.rayIntersectionCoordinate(d)).x,p.y,p.z];var p;const m=s.screenPointToMercatorRay(s.centerPoint),g="globe"!==s.projection.name;let _,y=0;do{const o=Math.floor(s.zoom),i=1<<o,l=Math.min(i*u.x,i*h.x),a=Math.min(i*u.y,i*h.y),A=Math.max(i*u.x,i*h.x),c=Math.max(i*u.y,i*h.y),d=new e.Aabb([l,a,r],[A,c,n]),y=e.Frustum.fromInvProjectionMatrix(s.invProjMatrix,s.worldSize,o,g);if(2!==d.intersects(y)){_&&(s._camera.position=e.scaleAndAdd([],s._camera.position,m.dir,-_),s._updateStateFromCamera());break}const p=e.sub([],s._camera.position,f);_=.5*e.length(p),s._camera.position=e.scaleAndAdd([],s._camera.position,m.dir,_);try{s._updateStateFromCamera()}catch(t){return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++y<10);return{center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}}fitBounds(t,i,r){return"globe"===this.transform.projection.name&&e.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(t,i),i,r)}_raycastElevationBox(t,i){const r=this.transform.elevation;if(!r)return;const n=new e.pointGeometry(t.x,i.y),o=new e.pointGeometry(i.x,t.y),a=r.pointCoordinate(t);if(!a)return;const s=r.pointCoordinate(i);if(!s)return;const l=r.pointCoordinate(n);if(!l)return;const A=r.pointCoordinate(o);if(!A)return;const c=new e.MercatorCoordinate(a[0],a[1]).toLngLat(),u=new e.MercatorCoordinate(s[0],s[1]).toLngLat(),h=new e.MercatorCoordinate(l[0],l[1]).toLngLat(),d=new e.MercatorCoordinate(A[0],A[1]).toLngLat(),f=Math.min(c.lng,Math.min(u.lng,Math.min(h.lng,d.lng))),p=Math.min(c.lat,Math.min(u.lat,Math.min(h.lat,d.lat))),m=Math.max(c.lng,Math.max(u.lng,Math.max(h.lng,d.lng))),g=Math.max(c.lat,Math.max(u.lat,Math.max(h.lat,d.lat))),_=Math.min(a[3],Math.min(s[3],Math.min(l[3],A[3]))),y=Math.max(a[3],Math.max(s[3],Math.max(l[3],A[3])));return{minLngLat:new e.LngLat(f,p),maxLngLat:new e.LngLat(m,g),minAltitude:_,maxAltitude:y}}fitScreenCoordinates(t,i,r,n,o){let a,s,l,A;"globe"===this.transform.projection.name&&e.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const c=e.pointGeometry.convert(t),u=e.pointGeometry.convert(i),h=this._raycastElevationBox(c,u);if(h)a=h.minLngLat,s=h.maxLngLat,l=h.minAltitude,A=h.maxAltitude;else{if(this.transform.anyCornerOffEdge(c,u))return this;a=this.transform.pointLocation(c),s=this.transform.pointLocation(u)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(e.pointGeometry.convert(t)),this.transform.pointLocation(e.pointGeometry.convert(i)),r,n):this._cameraForBox(a,s,l,A,n),n,o)}_fitInternal(t,i,r){return t?(delete(i=e.extend(t,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(t,i){this.stop();const r=t.preloadOnly?this.transform.clone():this.transform;let n=!1,o=!1,a=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(n=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.LngLat.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(o=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(a=!0,r.pitch=+t.pitch),null==t.padding||r.isPaddingEqual(t.padding)||(r.padding=t.padding),t.preloadOnly?(this._preloadTiles(r),this):(this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),n&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),o&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),a&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.warnOnce(Zn),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const r=this.transform;if(!r.projection.supportsFreeCamera)return e.warnOnce(Zn),this;this.stop();const n=r.zoom,o=r.pitch,a=r.bearing;r.setFreeCameraOptions(t);const s=n!==r.zoom,l=o!==r.pitch,A=a!==r.bearing;return this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),s&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),A&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),l&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.exported.prefersReducedMotion)&&(t.duration=0);const r=this.transform,n=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in t?+t.zoom:n,A="bearing"in t?this._normalizeBearing(t.bearing,o):o,c="pitch"in t?+t.pitch:a,u="padding"in t?t.padding:r.padding,h=e.pointGeometry.convert(t.offset);let d,f,p;if("globe"===r.projection.name){const i=e.MercatorCoordinate.fromLngLat(r.center),n=h.rotate(-r.angle);i.x+=n.x/r.worldSize,i.y+=n.y/r.worldSize;const o=i.toLngLat(),a=e.LngLat.convert(t.center||o);this._normalizeCenter(a),d=r.centerPoint.add(n),f=new e.pointGeometry(i.x,i.y).mult(r.worldSize),p=new e.pointGeometry(e.mercatorXfromLng(a.lng),e.mercatorYfromLat(a.lat)).mult(r.worldSize).sub(f)}else{d=r.centerPoint.add(h);const i=r.pointLocation(d),n=e.LngLat.convert(t.center||i);this._normalizeCenter(n),f=r.project(i),p=r.project(n).sub(f)}const m=r.zoomScale(l-n);let g,_;t.around&&(g=e.LngLat.convert(t.around),_=r.locationPoint(g));const y=this._zooming||l!==n,x=this._rotating||o!==A,b=this._pitching||c!==a,v=!r.isPaddingEqual(u),w=r=>w=>{if(y&&(r.zoom=e.number(n,l,w)),x&&(r.bearing=e.number(o,A,w)),b&&(r.pitch=e.number(a,c,w)),v&&(r.interpolatePadding(s,u,w),d=r.centerPoint.add(h)),g)r.setLocationAtPoint(g,_);else{const e=r.zoomScale(r.zoom-n),t=l>n?Math.min(2,m):Math.max(.5,m),i=Math.pow(t,1-w),o=r.unproject(f.add(p.mult(w*i)).mult(e));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,d)}return t.preloadOnly||this._fireMoveEvents(i),r};if(t.preloadOnly){const e=this._emulate(w,t.duration,r);return this._preloadTiles(e),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=y,this._rotating=x,this._pitching=b,this._padding=v,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,T),this._ease(w(r),(e=>{r.recenterOnTerrain(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",i||r.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.Event("zoomend",t)),n&&this.fire(new e.Event("rotateend",t)),o&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}flyTo(t,i){if(!t.essential&&e.exported.prefersReducedMotion){const r=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);const r=this.transform,n=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in t?e.clamp(+t.zoom,r.minZoom,r.maxZoom):n,A="bearing"in t?this._normalizeBearing(t.bearing,o):o,c="pitch"in t?+t.pitch:a,u="padding"in t?t.padding:r.padding,h=r.zoomScale(l-n),d=e.pointGeometry.convert(t.offset);let f=r.centerPoint.add(d);const p=r.pointLocation(f),m=e.LngLat.convert(t.center||p);this._normalizeCenter(m);const g=r.project(p),_=r.project(m).sub(g);let y=t.curve;const x=Math.max(r.width,r.height),b=x/h,v=_.mag();if("minZoom"in t){const i=e.clamp(Math.min(t.minZoom,n,l),r.minZoom,r.maxZoom),o=x/r.zoomScale(i-n);y=Math.sqrt(o/v*2)}const w=y*y;function T(e){const t=(b*b-x*x+(e?-1:1)*w*w*v*v)/(2*(e?b:x)*w*v);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function M(e){return(Math.exp(e)+Math.exp(-e))/2}const C=T(0);let I=function(e){return M(C)/M(C+y*e)},S=function(e){return x*((M(C)*(E(t=C+y*e)/M(t))-E(C))/w)/v;var t},k=(T(1)-C)/y;if(Math.abs(v)<1e-6||!isFinite(k)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,i);const e=b<x?-1:1;k=Math.abs(Math.log(b/x))/y,S=function(){return 0},I=function(t){return Math.exp(e*y*t)}}t.duration="duration"in t?+t.duration:1e3*k/("screenSpeed"in t?+t.screenSpeed/y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const z=o!==A,D=c!==a,B=!r.isPaddingEqual(u),P=r=>h=>{const p=h*k,y=1/I(p);r.zoom=1===h?l:n+r.scaleZoom(y),z&&(r.bearing=e.number(o,A,h)),D&&(r.pitch=e.number(a,c,h)),B&&(r.interpolatePadding(s,u,h),f=r.centerPoint.add(d));const x=1===h?m:r.unproject(g.add(_.mult(S(p))).mult(y));return r.setLocationAtPoint(r.renderWorldCopies?x.wrap():x,f),r._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),r};if(t.preloadOnly){const e=this._emulate(P,t.duration,r);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=z,this._pitching=D,this._padding=B,this._prepareEase(i,!1),this._ease(P(r),(()=>this._afterEase(i)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,i,r){!1===r.animate||0===r.duration?(t(1),i()):(this._easeStart=e.exported.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.exported.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=e.wrap(t,-180,180);const r=Math.abs(t-i);return Math.abs(t-360-i)<r&&(t-=360),Math.abs(t+360-i)<r&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.maxBounds)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}_emulate(e,t,i){const r=Math.ceil(15*t/1e3),n=[],o=e(i.clone());for(let e=0;e<=r;e++){const t=o(e/r);n.push(t.clone())}return n}}class $n{constructor(t={}){this.options=t,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const i=this._map._getUIString(`AttributionControl.${t}`);e.setAttribute("aria-label",i),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){const r=i.reduce(((e,t,r)=>(t.value&&(e+=`${t.key}=${t.value}${r<i.length-1?"&":""}`),e)),"?");t.href=`${e.config.FEEDBACK_URL}/${r}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const i in t){const r=t[i];if(r.used){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let r=i+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Qn{constructor(){e.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=o("div","mapboxgl-ctrl");const t=o("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class Hn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Wn(t,i,r){if(t=new e.LngLat(t.lng,t.lat),i){const n=new e.LngLat(t.lng-360,t.lat),o=new e.LngLat(t.lng+360,t.lat),a=360*Math.ceil(Math.abs(t.lng-r.center.lng)/360),s=r.locationPoint(t).distSqr(i),l=i.x<0||i.y<0||i.x>r.width||i.y>r.height;r.locationPoint(n).distSqr(i)<s&&(l||Math.abs(n.lng-r.center.lng)<a)?t=n:r.locationPoint(o).distSqr(i)<s&&(l||Math.abs(o.lng-r.center.lng)<a)&&(t=o)}for(;Math.abs(t.lng-r.center.lng)>180;){const e=r.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}const Xn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Yn extends e.Evented{constructor(t,i){if(super(),(t instanceof e.window.HTMLElement||i)&&(t=e.extend({element:t},i)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=e.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const i=41,r=27,n=a("svg",{display:"block",height:i*this._scale+"px",width:r*this._scale+"px",viewBox:`0 0 ${r} ${i}`},this._element),s=a("radialGradient",{id:"shadowGradient"},a("defs",{},n));a("stop",{offset:"10%","stop-opacity":.4},s),a("stop",{offset:"100%","stop-opacity":.05},s),a("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n),a("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),a("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),a("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),this._offset=e.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const r=this._element.classList;for(const e in Xn)r.remove(`mapboxgl-marker-anchor-${e}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,r=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-i+r)],"bottom-right":[-r,-1*(t-i+r)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map;if(!e)return!1;const t=e.unproject(this._pos),i=e.getFreeCameraOptions();if(!i.position)return!1;const r=i.position.toLngLat();return r.distanceTo(t)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const r=t.unproject(i);let n;t._usingGlobe()&&e.isLngLatBehindGlobe(t.transform,this._lngLat)?n=0:(n=1-t._queryFogOpacity(r),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(n*=.2)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._calculateXYTransform()+this._calculateZTransform(),i=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px) ${Xn[this._anchor]}\n            ${t}\n            translate(${i.x}px,${i.y}px)\n        `}_calculateXYTransform(){const t=this._pos,i=this._map;if("map"!==this.getPitchAlignment()||!i||!t)return"";if(!i._usingGlobe()){const e=i.getPitch();return e?`rotateX(${e}deg)`:""}const r=e.radToDeg(e.globeTiltAtLngLat(i.transform,this._lngLat)),n=t.sub(e.globeCenterToScreenPoint(i.transform)),o=r/(Math.abs(n.x)+Math.abs(n.y)),a=n.x*o,s=-n.y*o;return s||a?`rotateX(${s}deg) rotateY(${a}deg)`:""}_calculateZTransform(){const e=this._calculateRotation();return e?`rotateZ(${e}deg)`:""}_calculateRotation(){if("viewport"===this._rotationAlignment||"auto"===this._rotationAlignment)return this._rotation;if(this._map&&"map"===this._rotationAlignment){const t=this._map;if(this._pos&&t&&t._usingGlobe()){const i=t.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),r=t.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(i);return this._rotation+e.radToDeg(Math.atan2(r.y,r.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(t){e.window.cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=Wn(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),!0===t?this._updateFrameId=e.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),i._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._usingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.pointGeometry.convert(t),this._update(),this}_onMove(t){const i=this._map;if(i){if(!this._isDragging){const e=this._clickTolerance||i._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map;t&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class Kn{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=e.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i}}const Jn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},eo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function to(e){e.parentNode&&e.parentNode.removeChild(e)}const io={showCompass:!0,showZoom:!0,visualizePitch:!1};class ro{constructor(t,i,r=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new gn({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,r&&(this.mousePitch=new yn({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),c()}move(e,t){const i=this.map,r=this.mouseRotate.mousemoveWindow(e,t),n=r&&r.bearingDelta;if(n&&i.setBearing(i.getBearing()+n),this.mousePitch){const r=this.mousePitch.mousemoveWindow(e,t),n=r&&r.pitchDelta;n&&i.setPitch(i.getPitch()+n)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){u(),e.window.removeEventListener("mousemove",this.mousemove),e.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),f(this.element,t)),e.window.addEventListener("mousemove",this.mousemove),e.window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,f(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=p(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=p(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const no={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},oo={maxWidth:100,unit:"metric"};function ao(e,t,i){const r=so(t),n=r/t,o={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[i];this._map._requestDomTask((()=>{this._container.style.width=e*n+"px",this._container.innerHTML=`${r}&nbsp;${o}`}))}function so(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}const lo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ao=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function co(t=new e.pointGeometry(0,0),i="bottom"){if("number"==typeof t){const r=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(i){case"top":return new e.pointGeometry(0,t);case"top-left":return new e.pointGeometry(r,r);case"top-right":return new e.pointGeometry(-r,r);case"bottom":return new e.pointGeometry(0,-t);case"bottom-left":return new e.pointGeometry(r,-r);case"bottom-right":return new e.pointGeometry(-r,-r);case"left":return new e.pointGeometry(t,0);case"right":return new e.pointGeometry(-t,0)}return new e.pointGeometry(0,0)}return t instanceof e.pointGeometry||Array.isArray(t)?e.pointGeometry.convert(t):e.pointGeometry.convert(t[i]||[0,0])}const uo={version:e.version,supported:i,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:class extends qn{constructor(t){if(null!=(t=e.extend({},eo,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.isSafariWithAntialiasingBug(e.window)&&(t.antialias=!1,e.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Wr(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._optimizeForTerrain=t.optimizeForTerrain,this._language="auto"===t.language?e.window.navigator.language:t.language,this._worldview=t.worldview,this._renderTaskQueue=new Hn,this._domRenderTaskQueue=new Hn,this._controls=[],this._markers=[],this._mapId=e.uniqueId(),this._locale=e.extend({},Jn,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Kn(0),this._explicitProjection=null,this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof e.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1),e.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Nn(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),this._hash=t.hash&&new Yr("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),t.attributionControl&&this.addControl(new $n({customAttribution:t.customAttribution})),this._logoControl=new Qn,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.Event(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.Event(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=t.onAdd(this);this._controls.push(t);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)),this.fire(new e.Event("resize",t)),i&&this.fire(new e.Event("moveend",t)),this}getBounds(){return"globe"===this.transform.projection.name&&e.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}getLanguage(){return this._language}setLanguage(t){if(this._language="auto"===t?e.window.navigator.language:t,this.style)for(const e in this.style._sourceCaches){const t=this.style._sourceCaches[e]._source;t._setLanguage&&t._setLanguage(this._language)}for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){if(this._worldview=e,this.style)for(const t in this.style._sourceCaches){const i=this.style._sourceCaches[t]._source;i._setWorldview&&i._setWorldview(e)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._updateProjection(e)}_updateProjection(t){const i=this.getProjection();null===t&&(this._explicitProjection=null);const r=t||this.getProjection();let n;if(r&&"globe"===r.name&&this.transform.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?(n=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(n=this.transform.setProjection(r),this.transform.mercatorFromTransition=!1),t&&(this._explicitProjection="globe"===t.name?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),n){if("globe"===i.name&&"globe"===this.getProjection().name)this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const e in this.style._sourceCaches)this.style._sourceCaches[e].clearTiles()}this._update(!0)}return this}project(t){return this.transform.locationPoint3D(e.LngLat.convert(t))}unproject(t){return this.transform.pointLocation3D(e.pointGeometry.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let r=!1;const n=n=>{const o=t.filter((e=>this.getLayer(e))),a=o.length?this.queryRenderedFeatures(n.point,{layers:o}):[];a.length?r||(r=!0,i.call(this,new an(e,this,n.originalEvent,{features:a}))):r=!1},o=()=>{r=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:n,mouseout:o}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const n=n=>{const o=t.filter((e=>this.getLayer(e)));(o.length?this.queryRenderedFeatures(n.point,{layers:o}):[]).length?r=!0:r&&(r=!1,i.call(this,new an(e,this,n.originalEvent)))},o=t=>{r&&(r=!1,i.call(this,new an(e,this,t.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:n,mouseout:o}}}{const r=e=>{const r=t.filter((e=>this.getLayer(e))),n=r.length?this.queryRenderedFeatures(e.point,{layers:r}):[];n.length&&(e.features=n,i.call(this,e),delete e.features)};return{layers:new Set(t),listener:i,delegates:{[e]:r}}}}on(e,t,i){if(void 0===i)return super.on(e,t);Array.isArray(t)||(t=[t]);const r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const e in r.delegates)this.on(e,r.delegates[e]);return this}once(e,t,i){if(void 0===i)return super.once(e,t);Array.isArray(t)||(t=[t]);const r=this._createDelegatedListener(e,t,i);for(const e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,t,i){if(void 0===i)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);const r=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},n=this._delegatedListeners?this._delegatedListeners[e]:void 0;return n&&(e=>{for(let n=0;n<e.length;n++){const o=e[n];if(o.listener===i&&r(o.layers,t)){for(const e in o.delegates)this.off(e,o.delegates[e]);return e.splice(n,1),this}}})(n),this}queryRenderedFeatures(t,i){return this.style?(void 0!==i||void 0===t||t instanceof e.pointGeometry||Array.isArray(t)||(i=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}queryTerrainElevation(t,i){const r=this.transform.elevation;return r?(i=e.extend({},{exaggerated:!0},i),r.getAtPoint(e.MercatorCoordinate.fromLngLat(t),null,i.exaggerated)):null}setStyle(t,i){return!1!==(i=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new ei(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ei(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){if("string"==typeof t){const r=this._requestManager.normalizeStyleURL(t),n=this._requestManager.transformRequest(r,e.ResourceType.Style);e.getJSON(n,((t,r)=>{t?this.fire(new e.ErrorEvent(t)):r&&this._updateDiff(r,i)}))}else"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(t,i){try{this.style.setState(t)&&this._update(!0)}catch(r){e.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.warnOnce("There is no style added to the map."),!1)}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){return!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(t,i,{pixelRatio:r=1,sdf:n=!1,stretchX:o,stretchY:a,content:s}={}){if(this._lazyInitEmptyStyle(),i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap){const{width:l,height:A,data:c}=e.exported.getImageData(i);this.style.addImage(t,{data:new e.RGBAImage({width:l,height:A},c),pixelRatio:r,stretchX:o,stretchY:a,content:s,sdf:n,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:A}=i,c=i;this.style.addImage(t,{data:new e.RGBAImage({width:l,height:A},new Uint8Array(c.data)),pixelRatio:r,stretchX:o,stretchY:a,content:s,sdf:n,version:0,userImage:c}),c.onAdd&&c.onAdd(this,t)}}updateImage(t,i){const r=this.style.getImage(t);if(!r)return void this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap?e.exported.getImageData(i):i,{width:o,height:a}=n;void 0!==o&&void 0!==a?o===r.data.width&&a===r.data.height?(r.data.replace(n.data,!(i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap)),this.style.updateImage(t,r)):this.fire(new e.ErrorEvent(new Error(`The width and height of the updated image (${o}, ${a})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`))):this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,i){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),((t,r)=>{i(t,r instanceof e.window.HTMLImageElement?e.exported.getImageData(r):r)}))}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0)}setFilter(e,t,i={}){return this.style.setFilter(e,t,i),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i,r={}){return this.style.setPaintProperty(e,t,i,r),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i,r={}){return this.style.setLayoutProperty(e,t,i,r),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.LngLat.convert(t),this.transform):0}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let r,n,o,a=this._container;for(;a&&(!n||!o);){const t=e.window.getComputedStyle(a).transform;t&&"none"!==t&&(r=t.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(n=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(o=r[3])),a=a.parentElement}this._containerWidth=n?Math.abs(t/n):t,this._containerHeight=o?Math.abs(i/o):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=o("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=o("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=o("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{r[e]=o("div",`mapboxgl-ctrl-${e}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,i){const r=e.exported.devicePixelRatio||1;this._canvas.width=r*Math.ceil(t),this._canvas.height=r*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_setupPainter(){const t=e.extend({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);r?(e.storeAuthState(r,!0),this.painter=new Rr(r,this.transform),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.exported$1.testSupport(r)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;const r=this.painter.context.extTimerQuery,n=e.exported.now();if(this.listens("gpu-timing-frame")&&(i=r.createQueryEXT(),r.beginQueryEXT(r.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;"globe"===this.getProjection().name&&(this.transform.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?"globe"===this.transform.projection.name&&this._updateProjection():"mercator"===this.transform.projection.name&&this._updateProjection());let o=!1;const a=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,r=e.exported.now();this.style.zoomHistory.update(t,r);const n=new e.EvaluationParameters(t,{now:r,fadeDuration:a,pitch:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),s=n.crossFadingFactor();1===s&&s===this._crossFadingFactor||(o=!0,this._crossFadingFactor=s),this.style.update(n)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(n),this.style._updateSources(this.transform),this._forceMarkerUpdate()):s=this._updateAverageElevation(n),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.exported.now()-n;r.endQueryEXT(r.TIME_ELAPSED_EXT,i),setTimeout((()=>{const o=r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(i),this.fire(new e.Event("gpu-timing-frame",{cpuTime:t,gpuTime:o})),e.window.performance.mark("frame-gpu",{startTime:n,detail:{gpuTime:o}})}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.Event("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.Event("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(s=this._updateAverageElevation(n,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.Event("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const e of this._markers)e._update()}_updateAverageElevation(e,t=!1){const i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let r=this.transform.sampleAverageElevation(),n=!1;this.transform.elevation&&(n=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-r);if(o>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(r),i(r);this._averageElevation.easeTo(r,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(r),i(r)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){e.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.AUTH_ERR_MSG||401===t.status)){const t=this.painter.context.gl;e.storeAuthState(t,!1),this._logoControl instanceof Qn&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(e),t.canvasCopies.map(n),t.timeStamps)}_canvasPixelComparison(e,t,i){let r=i[1]-i[0];const n=e.length/4;for(let o=0;o<t.length;o++){const a=t[o];let s=0;for(let t=0;t<a.length;t+=4)a[t]===e[t]&&a[t+1]===e[t+1]&&a[t+2]===e[t+2]&&a[t+3]===e[t+3]&&(s+=1);r+=(i[o+2]-i[o+1])*(1-s/n)}return r}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),to(this._canvasContainer),to(this._controlContainer),to(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),e.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new e.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.exported.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const i=this.style?Object.values(this.style._sourceCaches):[];return e.asyncAll(i,((e,i)=>e._preloadTiles(t,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}_setCacheLimits(t,i){e.setCacheLimits(t,i)}get version(){return e.version}},NavigationControl:class{constructor(t){this.options=e.extend({},io,t),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),r=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ro(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const i=o("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends e.Evented{constructor(t){super(),this.options=e.extend({geolocation:e.window.navigator.geolocation},no,t),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xr(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>{this._supportsGeolocation="denied"!==e.state,t(this._supportsGeolocation)})):(this._supportsGeolocation=!!this.options.geolocation,t(this._supportsGeolocation))}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}}_updateCamera(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=this._map.getBearing(),o=e.extend({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(r),o,{geolocateSource:!0})}_updateMarker(t){if(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,i=e.mercatorZfromAltitude(1,t._center.lat)*t.worldSize,r=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yn({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")))}))}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{e.window.addEventListener("ondeviceorientationabsolute"in e.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==e.window.DeviceMotionEvent&&"function"==typeof e.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),e.window.removeEventListener("deviceorientation",this._onDeviceOrientation),e.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:$n,ScaleControl:class{constructor(t){this.options=e.extend({},oo,t),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch(e){return!1}}()||(this._setScale=ao.bind(this)),e.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,r=t._containerWidth/2-e/2,n=t.unproject([r,i]),o=t.unproject([r+e,i]),a=n.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*a;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,a/1852,"nautical-mile"):a>=1e3?this._setScale(e,a/1e3,"kilometer"):this._setScale(e,a,"meter")}_setScale(e,t,i){const r=so(t),n=r/t;this._map._requestDomTask((()=>{this._container.style.width=e*n+"px",this._container.innerHTML="nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:i}).format(r):`${r}&nbsp;nm`}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in e.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!e.window.document.fullscreenEnabled&&!e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(lo),t),e.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const i=e.window.document.createDocumentFragment(),r=e.window.document.createElement("body");let n;for(r.innerHTML=t;n=r.firstChild,n;)i.appendChild(n);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=o("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,r=this._pos;if(!t||!i||!r)return"bottom";const n=i.offsetWidth,o=i.offsetHeight,a=r.x<n/2,s=r.x>t.transform.width-n/2;if(r.y+e<o)return a?"top-left":s?"top-right":"top";if(r.y>t.transform.height-o){if(a)return"bottom-left";if(s)return"bottom-right"}return a?"left":s?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const i=this._map,r=this._content;if(!i||!this._lngLat&&!this._trackPointer||!r)return;let n=this._container;if(n||(n=this._container=o("div","mapboxgl-popup",i.getContainer()),this._tip=o("div","mapboxgl-popup-tip",n),n.appendChild(r)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wn(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const e=this._pos=this._trackPointer&&t?t:i.project(this._lngLat),r=co(this.options.offset),n=this._anchor=this._getAnchor(r.y),o=co(this.options.offset,n),a=e.add(o).round();i._requestDomTask((()=>{this._container&&n&&(this._container.style.transform=`${Xn[n]} translate(${a.x}px,${a.y}px)`)}))}if(!this._marker&&i._usingGlobe()){const t=e.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(Ao);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Yn,Style:ei,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.pointGeometry,MercatorCoordinate:e.MercatorCoordinate,FreeCameraOptions:jr,Evented:e.Evented,config:e.config,prewarm:function(){je().acquire(Oe)},clearPrewarmedResources:function(){const e=Ve;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Oe),Ve=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return Ue.workerCount},set workerCount(e){Ue.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:e.exported.setNow,restoreNow:e.exported.restoreNow};return uo})),n}()}).call(this,r(182))},272:function(e,t,r){e.exports=r(286)},273:function(e,t,r){var content=r(287);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(132).default)("301c241e",content,!0,{sourceMap:!1})},277:function(e,t,r){"use strict";function n(e,t,r){if(null!==e)for(var o,l,A,c,h,d,f,m,_=0,y=0,x=e.type,v="FeatureCollection"===x,w="Feature"===x,T=v?e.features.length:1,E=0;E<T;E++){h=(m=!!(f=v?e.features[E].geometry:w?e.geometry:e)&&"GeometryCollection"===f.type)?f.geometries.length:1;for(var M=0;M<h;M++){var C=0,I=0;if(null!==(c=m?f.geometries[M]:f)){d=c.coordinates;var S=c.type;switch(_=!r||"Polygon"!==S&&"MultiPolygon"!==S?0:1,S){case null:break;case"Point":if(!1===t(d,y,E,C,I))return!1;y++,C++;break;case"LineString":case"MultiPoint":for(o=0;o<d.length;o++){if(!1===t(d[o],y,E,C,I))return!1;y++,"MultiPoint"===S&&C++}"LineString"===S&&C++;break;case"Polygon":case"MultiLineString":for(o=0;o<d.length;o++){for(l=0;l<d[o].length-_;l++){if(!1===t(d[o][l],y,E,C,I))return!1;y++}"MultiLineString"===S&&C++,"Polygon"===S&&I++}"Polygon"===S&&C++;break;case"MultiPolygon":for(o=0;o<d.length;o++){for(I=0,l=0;l<d[o].length;l++){for(A=0;A<d[o][l].length-_;A++){if(!1===t(d[o][l][A],y,E,C,I))return!1;y++}I++}C++}break;case"GeometryCollection":for(o=0;o<c.geometries.length;o++)if(!1===n(c.geometries[o],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(e){var t=[1/0,1/0,-1/0,-1/0];return n(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}o.default=o;t.a=o},286:function(e,t,r){var h3=r(250),n="Feature",o="FeatureCollection",l="Polygon",A="MultiPolygon";function c(e){for(var t=null,i=0;i<e.length;i++)if(null!==t)for(var r=0;r<e[i].length;r++)t.push(e[i][r]);else t=e[i];return Array.from(new Set(t))}function h(e,t,r){void 0===r&&(r={});var d=e.type,f=e.geometry,m=f&&f.type;if(d===o)return function(e,t){var r=e.features;if(!r)throw new Error("No features found");return c(r.map((function(e){return h(e,t)})))}(e,t);if(d!==n)throw new Error("Unhandled type: "+d);if(m!==l&&m!==A)throw new Error("Unhandled geometry type: "+m);return c((m===l?[f.coordinates]:f.coordinates).map((function(polygon){var e=h3.polyfill(polygon,t,!0);if(e.length||!r.ensureOutput)return e;var n=function(polygon){for(var e=0,t=0,r=0,n=polygon[0],i=0;i<n.length;i++)e+=n[i][0],t+=n[i][1],r++;return[e/r,t/r]}(polygon),o=n[0],l=n[1];return[h3.geoToH3(l,o,t)]})))}function d(e,t){void 0===t&&(t={});var r=[h3.h3ToGeoBoundary(e,!0)];return{type:n,id:e,properties:t,geometry:{type:l,coordinates:r}}}e.exports={featureToH3Set:h,h3ToFeature:d,h3SetToFeature:function(e,t){void 0===t&&(t={});var r=h3.h3SetToMultiPolygon(e,!0),o=r.length>1,c=o?A:l,h=o?r:r[0]||[];return{type:n,properties:t,geometry:{type:c,coordinates:h}}},h3SetToMultiPolygonFeature:function(e,t){void 0===t&&(t={});var r=e.map((function(e){return[h3.h3ToGeoBoundary(e,{geoJson:!0})]}));return{type:n,properties:t,geometry:{type:A,coordinates:r}}},h3SetToFeatureCollection:function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i],l=t?t(n):{};r.push(d(n,l))}return{type:o,features:r}}}},287:function(e,t,r){var n=r(131)(!1);n.push([e.i,".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer;overflow:hidden}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl-group button:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:only-child{border-radius:inherit}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus.focus-visible,.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(.focus-visible),.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box;white-space:nowrap}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform;opacity:1;transition:opacity .2s}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35000000000000003)}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading{width:0;height:0}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after,.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{content:\"\";border-bottom:7.5px solid #4aa1eb;position:absolute}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-left:7.5px solid transparent;transform:translateY(-28px) skewY(-20deg)}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after{border-right:7.5px solid transparent;transform:translate(7.5px,-28px) skewY(20deg)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{transform:scale(1);opacity:1}70%{transform:scale(3);opacity:0}to{transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{transform:scale(1);opacity:1}70%{transform:scale(3);opacity:0}to{transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}.mapboxgl-scroll-zoom-blocker,.mapboxgl-touch-pan-blocker{color:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;justify-content:center;text-align:center;position:absolute;display:flex;align-items:center;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7000000000000001);opacity:0;pointer-events:none;transition:opacity .75s ease-in-out;transition-delay:1s}.mapboxgl-scroll-zoom-blocker-show,.mapboxgl-touch-pan-blocker-show{opacity:1;transition:opacity .1s ease-in-out}.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page,.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page .mapboxgl-canvas{touch-action:pan-x pan-y}",""]),e.exports=n}}]);